25-01-14 00:48:48 | I | === Configurations ===
25-01-14 00:48:48 | I | LlmRunConfig(
25-01-14 00:48:48 | I |   model=LlmModelConfig(
25-01-14 00:48:48 | I |     name=llama2-7b,
25-01-14 00:48:48 | I |     path=/data/gyy/llama2-7b,
25-01-14 00:48:48 | I |     root=/dataset/models,
25-01-14 00:48:48 | I |     local_path=/dataset/models/llama2/llama2-7b,
25-01-14 00:48:48 | I |     local_root=/dataset/models,
25-01-14 00:48:48 | I |     family=llama2,
25-01-14 00:48:48 | I |     size=7.0),
25-01-14 00:48:48 | I |   eval=LlmEvalConfig(
25-01-14 00:48:48 | I |     num_gpus=4,
25-01-14 00:48:48 | I |     batch_size=8,
25-01-14 00:48:48 | I |     output_root=runs,
25-01-14 00:48:48 | I |     output_dirname=skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250114.004848,
25-01-14 00:48:48 | I |     attach_timestamp=True,
25-01-14 00:48:48 | I |     timestamp=250114.004848,
25-01-14 00:48:48 | I |     output_dirname_without_timestamp=skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0],
25-01-14 00:48:48 | I |     tasks=['wikitext'],
25-01-14 00:48:48 | I |     max_seq_length=-4096,
25-01-14 00:48:48 | I |     evaluator=gptq),
25-01-14 00:48:48 | I |   calib=LlmCalibConfig(
25-01-14 00:48:48 | I |     data=pileval,
25-01-14 00:48:48 | I |     num_samples=128,
25-01-14 00:48:48 | I |     cache_root=runs,
25-01-14 00:48:48 | I |     cache_dirpath=runs/llm/cache/pileval.128x1024.[0-0],
25-01-14 00:48:48 | I |     dataset_path=mit-han-lab/pile-val-backup,
25-01-14 00:48:48 | I |     seq_length=1024,
25-01-14 00:48:48 | I |     min_seq_length=0,
25-01-14 00:48:48 | I |     max_seq_length=0,
25-01-14 00:48:48 | I |     local_dataset_path=/dataset/pile),
25-01-14 00:48:48 | I |   quant=LlmQuantConfig(
25-01-14 00:48:48 | I |     wgts=WeightQuantizerConfig(
25-01-14 00:48:48 | I |       dtype=zint4,
25-01-14 00:48:48 | I |       group_shapes=((1, -1, -1), (1, 128, -1)),
25-01-14 00:48:48 | I |       group_scale_dtypes=(torch.float16, sint8),
25-01-14 00:48:48 | I |       compute_dtype=sint8,
25-01-14 00:48:48 | I |       compute_group_level=0,
25-01-14 00:48:48 | I |       saturate_compute_dtype=False,
25-01-14 00:48:48 | I |       exponent_scaling_level=2,
25-01-14 00:48:48 | I |       skips=['embed', 'head', 'router'],
25-01-14 00:48:48 | I |       static=True,
25-01-14 00:48:48 | I |       calib_kernel=QuantizerKernelConfig(
25-01-14 00:48:48 | I |         _kernels={'proj_1st': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512), 'proj_2nd': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512), 'proj_out': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512), 'proj_qkv': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512)},
25-01-14 00:48:48 | I |         gptq=QuantGPTQConfig(
25-01-14 00:48:48 | I |           includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'],
25-01-14 00:48:48 | I |           damp_percentage=0.01,
25-01-14 00:48:48 | I |           block_size=128,
25-01-14 00:48:48 | I |           num_inv_tries=250,
25-01-14 00:48:48 | I |           hessian_block_size=512)),
25-01-14 00:48:48 | I |       calib_range=DynamicRangeCalibConfig(
25-01-14 00:48:48 | I |         degree=2,
25-01-14 00:48:48 | I |         skips=[],
25-01-14 00:48:48 | I |         objective=SearchBasedCalibObjective.OutputsError,
25-01-14 00:48:48 | I |         strategy=SearchBasedCalibStrategy.Manual,
25-01-14 00:48:48 | I |         granularity=SearchBasedCalibGranularity.Group,
25-01-14 00:48:48 | I |         element_batch_size=64,
25-01-14 00:48:48 | I |         sample_batch_size=-1,
25-01-14 00:48:48 | I |         element_size=512,
25-01-14 00:48:48 | I |         sample_size=-1,
25-01-14 00:48:48 | I |         pre_reshape=True,
25-01-14 00:48:48 | I |         outputs_device=cpu,
25-01-14 00:48:48 | I |         allow_kernel_calib=False,
25-01-14 00:48:48 | I |         ratio=1.0,
25-01-14 00:48:48 | I |         max_shrink=0.2,
25-01-14 00:48:48 | I |         max_expand=1.0,
25-01-14 00:48:48 | I |         num_grids=80)),
25-01-14 00:48:48 | I |     ipts=ActivationQuantizerConfig(
25-01-14 00:48:48 | I |       dtype=sint8,
25-01-14 00:48:48 | I |       group_shapes=((1, -1, -1),),
25-01-14 00:48:48 | I |       group_scale_dtypes=(torch.float16,),
25-01-14 00:48:48 | I |       compute_dtype=None,
25-01-14 00:48:48 | I |       compute_group_level=-1,
25-01-14 00:48:48 | I |       saturate_compute_dtype=False,
25-01-14 00:48:48 | I |       exponent_scaling_level=1,
25-01-14 00:48:48 | I |       skips=['embed', 'head', 'router'],
25-01-14 00:48:48 | I |       static=False,
25-01-14 00:48:48 | I |       calib_kernel=None,
25-01-14 00:48:48 | I |       calib_range=None),
25-01-14 00:48:48 | I |     opts=ActivationQuantizerConfig(
25-01-14 00:48:48 | I |       dtype=zint4,
25-01-14 00:48:48 | I |       group_shapes=((1, 128, -1),),
25-01-14 00:48:48 | I |       group_scale_dtypes=(torch.float16,),
25-01-14 00:48:48 | I |       compute_dtype=None,
25-01-14 00:48:48 | I |       compute_group_level=-1,
25-01-14 00:48:48 | I |       saturate_compute_dtype=False,
25-01-14 00:48:48 | I |       exponent_scaling_level=1,
25-01-14 00:48:48 | I |       skips=['attn_q'],
25-01-14 00:48:48 | I |       static=False,
25-01-14 00:48:48 | I |       calib_kernel=None,
25-01-14 00:48:48 | I |       calib_range=None),
25-01-14 00:48:48 | I |     rotation=QuantRotationConfig(
25-01-14 00:48:48 | I |       random=False,
25-01-14 00:48:48 | I |       transforms=[]),
25-01-14 00:48:48 | I |     reorder=QuantReorderConfig(
25-01-14 00:48:48 | I |       degree=2,
25-01-14 00:48:48 | I |       skips=['proj_out', 'proj_qkv', 'residual'],
25-01-14 00:48:48 | I |       objective=SearchBasedCalibObjective.OutputsError,
25-01-14 00:48:48 | I |       strategy=SearchBasedCalibStrategy.Manual,
25-01-14 00:48:48 | I |       granularity=SearchBasedCalibGranularity.Layer,
25-01-14 00:48:48 | I |       element_batch_size=-1,
25-01-14 00:48:48 | I |       sample_batch_size=-1,
25-01-14 00:48:48 | I |       element_size=-1,
25-01-14 00:48:48 | I |       sample_size=-1,
25-01-14 00:48:48 | I |       pre_reshape=True,
25-01-14 00:48:48 | I |       outputs_device=cpu,
25-01-14 00:48:48 | I |       allow_kernel_calib=False,
25-01-14 00:48:48 | I |       channel_metric=ChannelMetric.InputsAbsMax,
25-01-14 00:48:48 | I |       channel_index=ChannelIndex.Sequential,
25-01-14 00:48:48 | I |       dynamic=False),
25-01-14 00:48:48 | I |     smooth=QuantSmoothConfig(
25-01-14 00:48:48 | I |       xw=QuantSmoothCalibConfig(
25-01-14 00:48:48 | I |         degree=2,
25-01-14 00:48:48 | I |         skips=['proj_1st', 'proj_qkv'],
25-01-14 00:48:48 | I |         objective=SearchBasedCalibObjective.OutputsError,
25-01-14 00:48:48 | I |         strategy=SearchBasedCalibStrategy.Manual,
25-01-14 00:48:48 | I |         granularity=SearchBasedCalibGranularity.Layer,
25-01-14 00:48:48 | I |         element_batch_size=-1,
25-01-14 00:48:48 | I |         sample_batch_size=-1,
25-01-14 00:48:48 | I |         element_size=-1,
25-01-14 00:48:48 | I |         sample_size=-1,
25-01-14 00:48:48 | I |         pre_reshape=True,
25-01-14 00:48:48 | I |         outputs_device=cpu,
25-01-14 00:48:48 | I |         allow_kernel_calib=False,
25-01-14 00:48:48 | I |         ranges=[(<RangeMode.AbsMax: 1>, <RangeMode.AbsMax: 1>)],
25-01-14 00:48:48 | I |         x_ranges=[<RangeMode.AbsMax: 1>],
25-01-14 00:48:48 | I |         w_ranges=[<RangeMode.AbsMax: 1>],
25-01-14 00:48:48 | I |         alpha=0.3,
25-01-14 00:48:48 | I |         beta=0.7,
25-01-14 00:48:48 | I |         num_grids=20),
25-01-14 00:48:48 | I |       yx=QuantSmoothCalibConfig(
25-01-14 00:48:48 | I |         degree=2,
25-01-14 00:48:48 | I |         skips=[],
25-01-14 00:48:48 | I |         objective=SearchBasedCalibObjective.OutputsError,
25-01-14 00:48:48 | I |         strategy=SearchBasedCalibStrategy.Manual,
25-01-14 00:48:48 | I |         granularity=SearchBasedCalibGranularity.Layer,
25-01-14 00:48:48 | I |         element_batch_size=-1,
25-01-14 00:48:48 | I |         sample_batch_size=-1,
25-01-14 00:48:48 | I |         element_size=-1,
25-01-14 00:48:48 | I |         sample_size=-1,
25-01-14 00:48:48 | I |         pre_reshape=True,
25-01-14 00:48:48 | I |         outputs_device=cpu,
25-01-14 00:48:48 | I |         allow_kernel_calib=False,
25-01-14 00:48:48 | I |         ranges=[(<RangeMode.AbsMax: 1>, <RangeMode.AbsMax: 1>)],
25-01-14 00:48:48 | I |         x_ranges=[<RangeMode.AbsMax: 1>],
25-01-14 00:48:48 | I |         w_ranges=[<RangeMode.AbsMax: 1>],
25-01-14 00:48:48 | I |         alpha=0.5,
25-01-14 00:48:48 | I |         beta=0.0,
25-01-14 00:48:48 | I |         num_grids=20)),
25-01-14 00:48:48 | I |     bias_correction=False,
25-01-14 00:48:48 | I |     post_rotary=True,
25-01-14 00:48:48 | I |     develop_dtype=torch.float32,
25-01-14 00:48:48 | I |     select_wgts=None,
25-01-14 00:48:48 | I |     select_ipts=None,
25-01-14 00:48:48 | I |     select_opts=None,
25-01-14 00:48:48 | I |     keywords_i={'proj_qkv': ['q_proj', 'k_proj', 'v_proj'], 'proj_out': ['out_proj', 'o_proj'], 'proj_1st': ['fc1', 'up_proj', 'gate_proj', 'w1', 'w3'], 'proj_2nd': ['fc2', 'down_proj', 'w2'], 'head': ['output', 'score', 'qa_outputs'], 'embed': ['embed', 'lm_head', 'embed_out'], 'router': ['block_sparse_moe']},
25-01-14 00:48:48 | I |     keywords_w={'proj_qkv': ['q_proj', 'k_proj', 'v_proj'], 'proj_out': ['out_proj', 'o_proj'], 'proj_1st': ['fc1', 'up_proj', 'gate_proj', 'w1', 'w3'], 'proj_2nd': ['fc2', 'down_proj', 'w2'], 'head': ['output', 'score', 'qa_outputs'], 'embed': ['embed', 'lm_head', 'embed_out'], 'router': ['block_sparse_moe.gate']},
25-01-14 00:48:48 | I |     keywords_o={'attn_q': ['q_rotary_emb'], 'attn_k': ['k_rotary_emb'], 'attn_v': ['v_proj']},
25-01-14 00:48:48 | I |     module_types_i=(<class 'torch.nn.modules.linear.Linear'>, <class 'transformers.models.mixtral.modeling_mixtral.MixtralSparseMoeBlock'>),
25-01-14 00:48:48 | I |     module_types_w=(<class 'torch.nn.modules.linear.Linear'>,),
25-01-14 00:48:48 | I |     module_types_o=(<class 'torch.nn.modules.linear.Linear'>, <class 'lmquant.llm.nn.attention.RotaryEmbedding'>),
25-01-14 00:48:48 | I |     num_hidden_layers=-1),
25-01-14 00:48:48 | I |   seed=12345,
25-01-14 00:48:48 | I |   save_model=True,
25-01-14 00:48:48 | I |   output_dirpath=runs/llm/llama2/llama2-7b/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/rot-reorder-smooth.xw.yx-w.static.kernel/skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250114.004848,
25-01-14 00:48:48 | I |   cache_dirpath=LlmQuantCachePath(rotation='runs/llm/cache/rotation/hadamard', reorder='runs/llm/cache/pileval.128x1024.[0-0]/reorder/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]', smooth='runs/llm/cache/pileval.128x1024.[0-0]/smooth/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]', wgts='runs/llm/cache/pileval.128x1024.[0-0]/wgts/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]/w.kernel.gptq.d0p01.b128/w.kernel.gptq.include.[proj_1st+proj_2nd+proj_out+proj_qkv]/w.range.OutputsError.Manual.Group.d2.e512.sn1/w.range.r.[1].static/w.range.skip.[]', acts=''),
25-01-14 00:48:48 | I |   cache_path=LlmQuantCachePath(rotation='runs/llm/cache/rotation/hadamard/llama2-7b.pt', reorder='runs/llm/cache/pileval.128x1024.[0-0]/reorder/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/llama2-7b.pt', smooth='runs/llm/cache/pileval.128x1024.[0-0]/smooth/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]/llama2-7b.pt', wgts='runs/llm/cache/pileval.128x1024.[0-0]/wgts/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]/w.kernel.gptq.d0p01.b128/w.kernel.gptq.include.[proj_1st+proj_2nd+proj_out+proj_qkv]/w.range.OutputsError.Manual.Group.d2.e512.sn1/w.range.r.[1].static/w.range.skip.[]/llama2-7b.pt', acts=''),
25-01-14 00:48:48 | I |   fairseq_args=/data/gyy/lmquant-main/projects/llm/configs/fairseq_args_7b.json,
25-01-14 00:48:48 | I |   gen_teacher_opts=False,
25-01-14 00:48:48 | I |   enable_cache=True,
25-01-14 00:48:48 | I |   with_prepocess=False)
25-01-14 00:48:48 | I | === Dumped Configurations ===
25-01-14 00:48:48 | I | { 'calib': { 'cache_root': 'runs',
25-01-14 00:48:48 | I |              'data': 'pileval',
25-01-14 00:48:48 | I |              'dataset_path': 'mit-han-lab/pile-val-backup',
25-01-14 00:48:48 | I |              'local_dataset_path': '/dataset/pile',
25-01-14 00:48:48 | I |              'max_seq_length': 0,
25-01-14 00:48:48 | I |              'min_seq_length': 0,
25-01-14 00:48:48 | I |              'num_samples': 128,
25-01-14 00:48:48 | I |              'seq_length': 1024},
25-01-14 00:48:48 | I |   'enable_cache': True,
25-01-14 00:48:48 | I |   'eval': { 'attach_timestamp': True,
25-01-14 00:48:48 | I |             'batch_size': 8,
25-01-14 00:48:48 | I |             'evaluator': 'gptq',
25-01-14 00:48:48 | I |             'max_seq_length': -4096,
25-01-14 00:48:48 | I |             'num_gpus': 4,
25-01-14 00:48:48 | I |             'output_dirname': 'skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250114.004848',
25-01-14 00:48:48 | I |             'output_root': 'runs',
25-01-14 00:48:48 | I |             'tasks': ['wikitext']},
25-01-14 00:48:48 | I |   'fairseq_args': '/data/gyy/lmquant-main/projects/llm/configs/fairseq_args_7b.json',
25-01-14 00:48:48 | I |   'gen_teacher_opts': False,
25-01-14 00:48:48 | I |   'model': { 'local_path': '/dataset/models/llama2/llama2-7b',
25-01-14 00:48:48 | I |              'local_root': '/dataset/models',
25-01-14 00:48:48 | I |              'name': 'llama2-7b',
25-01-14 00:48:48 | I |              'path': '/data/gyy/llama2-7b',
25-01-14 00:48:48 | I |              'root': '/dataset/models'},
25-01-14 00:48:48 | I |   'quant': { 'bias_correction': False,
25-01-14 00:48:48 | I |              'develop_dtype': 'torch.float32',
25-01-14 00:48:48 | I |              'enable_reorder': True,
25-01-14 00:48:48 | I |              'enable_rotation': True,
25-01-14 00:48:48 | I |              'enable_select_ipts': False,
25-01-14 00:48:48 | I |              'enable_select_opts': False,
25-01-14 00:48:48 | I |              'enable_select_wgts': False,
25-01-14 00:48:48 | I |              'enable_smooth': True,
25-01-14 00:48:48 | I |              'ipts': { 'compute_dtype': None,
25-01-14 00:48:48 | I |                        'compute_group_level': -1,
25-01-14 00:48:48 | I |                        'dtype': 'sint8',
25-01-14 00:48:48 | I |                        'enable_calib_range': False,
25-01-14 00:48:48 | I |                        'group_scale_dtypes': ['torch.float16'],
25-01-14 00:48:48 | I |                        'group_shapes': [[1, -1, -1]],
25-01-14 00:48:48 | I |                        'saturate_compute_dtype': False,
25-01-14 00:48:48 | I |                        'skips': ['embed', 'head', 'router'],
25-01-14 00:48:48 | I |                        'static': False},
25-01-14 00:48:48 | I |              'opts': { 'compute_dtype': None,
25-01-14 00:48:48 | I |                        'compute_group_level': -1,
25-01-14 00:48:48 | I |                        'dtype': 'zint4',
25-01-14 00:48:48 | I |                        'enable_calib_range': False,
25-01-14 00:48:48 | I |                        'group_scale_dtypes': ['torch.float16'],
25-01-14 00:48:48 | I |                        'group_shapes': [[1, 128, -1]],
25-01-14 00:48:48 | I |                        'saturate_compute_dtype': False,
25-01-14 00:48:48 | I |                        'skips': ['attn_q'],
25-01-14 00:48:48 | I |                        'static': False},
25-01-14 00:48:48 | I |              'post_rotary': True,
25-01-14 00:48:48 | I |              'reorder': { 'allow_kernel_calib': False,
25-01-14 00:48:48 | I |                           'channel_index': 'Sequential',
25-01-14 00:48:48 | I |                           'channel_metric': 'InputsAbsMax',
25-01-14 00:48:48 | I |                           'degree': 2,
25-01-14 00:48:48 | I |                           'dynamic': False,
25-01-14 00:48:48 | I |                           'element_batch_size': -1,
25-01-14 00:48:48 | I |                           'element_size': -1,
25-01-14 00:48:48 | I |                           'outputs_device': 'cpu',
25-01-14 00:48:48 | I |                           'pre_reshape': True,
25-01-14 00:48:48 | I |                           'sample_batch_size': -1,
25-01-14 00:48:48 | I |                           'sample_size': -1,
25-01-14 00:48:48 | I |                           'skips': ['proj_out', 'proj_qkv', 'residual'],
25-01-14 00:48:48 | I |                           'strategy': 'Manual'},
25-01-14 00:48:48 | I |              'rotation': {'random': False, 'transforms': []},
25-01-14 00:48:48 | I |              'smooth': { 'enable_xw': True,
25-01-14 00:48:48 | I |                          'enable_yx': True,
25-01-14 00:48:48 | I |                          'xw': { 'allow_kernel_calib': False,
25-01-14 00:48:48 | I |                                  'alpha': 0.3,
25-01-14 00:48:48 | I |                                  'beta': 0.7,
25-01-14 00:48:48 | I |                                  'degree': 2,
25-01-14 00:48:48 | I |                                  'element_batch_size': -1,
25-01-14 00:48:48 | I |                                  'element_size': -1,
25-01-14 00:48:48 | I |                                  'granularity': 'Layer',
25-01-14 00:48:48 | I |                                  'num_grids': 20,
25-01-14 00:48:48 | I |                                  'objective': 'OutputsError',
25-01-14 00:48:48 | I |                                  'outputs_device': 'cpu',
25-01-14 00:48:48 | I |                                  'pre_reshape': True,
25-01-14 00:48:48 | I |                                  'ranges': [['AbsMax', 'AbsMax']],
25-01-14 00:48:48 | I |                                  'sample_batch_size': -1,
25-01-14 00:48:48 | I |                                  'sample_size': -1,
25-01-14 00:48:48 | I |                                  'skips': ['proj_1st', 'proj_qkv'],
25-01-14 00:48:48 | I |                                  'strategy': 'Manual'},
25-01-14 00:48:48 | I |                          'yx': { 'allow_kernel_calib': False,
25-01-14 00:48:48 | I |                                  'alpha': 0.5,
25-01-14 00:48:48 | I |                                  'beta': 0.0,
25-01-14 00:48:48 | I |                                  'degree': 2,
25-01-14 00:48:48 | I |                                  'element_batch_size': -1,
25-01-14 00:48:48 | I |                                  'element_size': -1,
25-01-14 00:48:48 | I |                                  'granularity': 'Layer',
25-01-14 00:48:48 | I |                                  'num_grids': 20,
25-01-14 00:48:48 | I |                                  'objective': 'OutputsError',
25-01-14 00:48:48 | I |                                  'outputs_device': 'cpu',
25-01-14 00:48:48 | I |                                  'pre_reshape': True,
25-01-14 00:48:48 | I |                                  'ranges': [['AbsMax', 'AbsMax']],
25-01-14 00:48:48 | I |                                  'sample_batch_size': -1,
25-01-14 00:48:48 | I |                                  'sample_size': -1,
25-01-14 00:48:48 | I |                                  'skips': [],
25-01-14 00:48:48 | I |                                  'strategy': 'Manual'}},
25-01-14 00:48:48 | I |              'wgts': { 'calib_kernel': { 'enable_gptq': True,
25-01-14 00:48:48 | I |                                          'gptq': { 'block_size': 128,
25-01-14 00:48:48 | I |                                                    'damp_percentage': 0.01,
25-01-14 00:48:48 | I |                                                    'hessian_block_size': 512,
25-01-14 00:48:48 | I |                                                    'includes': ['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'],
25-01-14 00:48:48 | I |                                                    'num_inv_tries': 250}},
25-01-14 00:48:48 | I |                        'calib_range': { 'allow_kernel_calib': False,
25-01-14 00:48:48 | I |                                         'degree': 2,
25-01-14 00:48:48 | I |                                         'element_batch_size': 64,
25-01-14 00:48:48 | I |                                         'element_size': 512,
25-01-14 00:48:48 | I |                                         'granularity': 'Group',
25-01-14 00:48:48 | I |                                         'max_expand': 1.0,
25-01-14 00:48:48 | I |                                         'max_shrink': 0.2,
25-01-14 00:48:48 | I |                                         'num_grids': 80,
25-01-14 00:48:48 | I |                                         'objective': 'OutputsError',
25-01-14 00:48:48 | I |                                         'outputs_device': 'cpu',
25-01-14 00:48:48 | I |                                         'pre_reshape': True,
25-01-14 00:48:48 | I |                                         'ratio': 1.0,
25-01-14 00:48:48 | I |                                         'sample_batch_size': -1,
25-01-14 00:48:48 | I |                                         'sample_size': -1,
25-01-14 00:48:48 | I |                                         'skips': [],
25-01-14 00:48:48 | I |                                         'strategy': 'Manual'},
25-01-14 00:48:48 | I |                        'compute_dtype': 'sint8',
25-01-14 00:48:48 | I |                        'compute_group_level': 0,
25-01-14 00:48:48 | I |                        'dtype': 'zint4',
25-01-14 00:48:48 | I |                        'enable_calib_kernel': True,
25-01-14 00:48:48 | I |                        'enable_calib_range': True,
25-01-14 00:48:48 | I |                        'group_scale_dtypes': ['torch.float16', 'sint8'],
25-01-14 00:48:48 | I |                        'group_shapes': [[1, -1, -1], [1, 128, -1]],
25-01-14 00:48:48 | I |                        'saturate_compute_dtype': False,
25-01-14 00:48:48 | I |                        'skips': ['embed', 'head', 'router']}},
25-01-14 00:48:48 | I |   'save_model': True,
25-01-14 00:48:48 | I |   'seed': 12345,
25-01-14 00:48:48 | I |   'with_prepocess': False}
25-01-14 00:48:48 | I | === Output Directory ===
25-01-14 00:48:48 | I | runs/llm/llama2/llama2-7b/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/rot-reorder-smooth.xw.yx-w.static.kernel/skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250114.004848
25-01-14 00:48:48 | I | === Start Evaluating ===
25-01-14 00:48:48 | I | * Building model llama2-7b from /data/gyy/llama2-7b
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.0.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.1.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.2.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.3.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.4.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.5.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.6.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.7.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.8.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.9.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.10.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.11.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.12.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.13.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.14.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.15.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.16.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.17.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.18.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.19.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.20.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.21.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.22.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.23.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.24.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.25.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.26.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.27.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.28.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.29.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.30.self_attn
25-01-14 00:48:53 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.31.self_attn
25-01-14 00:48:53 | I | * Development dtype is torch.float32
25-01-14 00:48:53 | I | * Begin to QAT
25-01-14 00:48:54 | D | Setting JobRuntime:name=UNKNOWN_NAME
25-01-14 00:48:54 | D | Setting JobRuntime:name=utils
25-01-14 00:48:59 | I | distributed init (rank 0): env://
25-01-14 00:48:59 | I | initialized host 3fb0cc53fbf9 as rank 0
25-01-14 00:49:00 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 2.490234375, 'gpu_3_mem_used_gb': 0.0, 'gpu_4_mem_used_gb': 6.150390625, 'gpu_5_mem_used_gb': 7.0859375, 'gpu_6_mem_used_gb': 7.0859375, 'gpu_7_mem_used_gb': 6.06640625}
25-01-14 00:49:00 | I | {'_name': None, 'common': {'_name': None, 'no_progress_bar': False, 'log_interval': 1, 'log_format': 'simple', 'log_file': None, 'tensorboard_logdir': None, 'wandb_project': 'layer_wise_quant', 'azureml_logging': False, 'seed': 1, 'cpu': False, 'tpu': False, 'bf16': False, 'memory_efficient_bf16': False, 'fp16': True, 'memory_efficient_fp16': True, 'fp16_no_flatten_grads': False, 'fp16_init_scale': 128, 'fp16_scale_window': None, 'fp16_scale_tolerance': 0.0, 'min_loss_scale': 0.0001, 'threshold_loss_scale': None, 'user_dir': None, 'empty_cache_freq': 0, 'all_gather_list_size': 16384, 'model_parallel_size': 1, 'quantization_config_path': None, 'profile': False, 'reset_logging': False, 'suppress_crashes': False, 'use_plasma_view': False, 'plasma_path': '/tmp/plasma', 'log_nvidia_smi': False}, 'common_eval': {'_name': None, 'path': None, 'post_process': None, 'quiet': False, 'model_overrides': '{}', 'results_path': None, 'is_moe': False, 'is_model_parallel': False}, 'distributed_training': {'_name': None, 'distributed_world_size': 1, 'distributed_rank': 0, 'distributed_backend': 'nccl', 'distributed_init_method': 'env://', 'distributed_port': -1, 'device_id': 0, 'distributed_no_spawn': True, 'ddp_backend': 'pytorch_ddp', 'bucket_cap_mb': 25, 'fix_batches_to_gpus': False, 'find_unused_parameters': False, 'fast_stat_sync': False, 'heartbeat_timeout': -1, 'broadcast_buffers': False, 'slowmo_momentum': None, 'slowmo_algorithm': 'LocalSGD', 'localsgd_frequency': 3, 'nprocs_per_node': 4, 'pipeline_model_parallel': False, 'pipeline_balance': None, 'pipeline_devices': None, 'pipeline_chunks': 0, 'pipeline_encoder_balance': None, 'pipeline_encoder_devices': None, 'pipeline_decoder_balance': None, 'pipeline_decoder_devices': None, 'pipeline_checkpoint': 'never', 'zero_sharding': 'none', 'zero_group_size': -1, 'save_zero_ckpt_fast': False, 'fp16': True, 'memory_efficient_fp16': True, 'tpu': False, 'no_reshard_after_forward': False, 'fp32_reduce_scatter': False, 'cpu_offload': False, 'use_sharded_state': False}, 'dataset': {'_name': None, 'num_workers': 1, 'num_workers_valid': 0, 'skip_invalid_size_inputs_valid_test': False, 'max_tokens': None, 'batch_size': 32, 'required_batch_size_multiple': 8, 'required_seq_len_multiple': 1, 'dataset_impl': None, 'data_buffer_size': 10, 'train_subset': 'train', 'valid_subset': 'valid', 'combine_valid_subsets': None, 'ignore_unused_valid_subsets': False, 'validate_interval': 1, 'validate_interval_updates': 20, 'validate_after_updates': 0, 'fixed_validation_seed': None, 'disable_validation': False, 'max_tokens_valid': None, 'batch_size_valid': 32, 'max_valid_steps': None, 'curriculum': 0, 'gen_subset': 'test', 'num_shards': 1, 'shard_id': 0}, 'optimization': {'_name': None, 'max_epoch': 0, 'max_update': 100, 'stop_time_hours': 0.0, 'clip_norm': 2.0, 'sentence_avg': False, 'update_freq': [2], 'lr': [0.00015], 'stop_min_lr': -1.0, 'use_bmuf': False}, 'checkpoint': {'_name': None, 'save_dir': 'checkpoints', 'restore_file': 'checkpoint_last.pt', 'finetune_from_model': None, 'reset_dataloader': False, 'reset_lr_scheduler': False, 'reset_meters': False, 'reset_optimizer': False, 'optimizer_overrides': '{}', 'save_interval': 1, 'save_interval_updates': 1000, 'keep_interval_updates': -1, 'keep_last_epochs': -1, 'keep_best_checkpoints': -1, 'no_save': True, 'no_epoch_checkpoints': True, 'no_last_checkpoints': False, 'no_best_checkpoints': False, 'no_save_optimizer_state': False, 'no_save_optimizer_state_on_training_finished': False, 'symlink_best_and_last_checkpoints': False, 'best_checkpoint_metric': 'loss_valid', 'maximize_best_checkpoint_metric': False, 'patience': -1, 'checkpoint_suffix': '', 'checkpoint_shard_count': 1, 'load_checkpoint_on_all_dp_ranks': False, 'write_checkpoints_asynchronously': False, 's3_upload_path': None, 'model_parallel_size': 1}, 'bmuf': {'_name': None, 'block_lr': 1.0, 'block_momentum': 0.875, 'global_sync_iter': 50, 'warmup_iterations': 500, 'use_nbm': False, 'average_sync': False, 'distributed_world_size': 4}, 'generation': {'_name': None, 'beam': 5, 'nbest': 1, 'max_len_a': 0.0, 'max_len_b': 200, 'min_len': 1, 'match_source_len': False, 'unnormalized': False, 'no_early_stop': False, 'no_beamable_mm': False, 'lenpen': 1.0, 'unkpen': 0.0, 'replace_unk': None, 'sacrebleu': False, 'score_reference': False, 'prefix_size': 0, 'no_repeat_ngram_size': 0, 'sampling': False, 'sampling_topk': -1, 'sampling_topp': -1.0, 'constraints': None, 'temperature': 1.0, 'diverse_beam_groups': -1, 'diverse_beam_strength': 0.5, 'diversity_rate': -1.0, 'print_alignment': None, 'print_step': False, 'lm_path': None, 'lm_weight': 0.0, 'iter_decode_eos_penalty': 0.0, 'iter_decode_max_iter': 10, 'iter_decode_force_max_iter': False, 'iter_decode_with_beam': 1, 'iter_decode_with_external_reranker': False, 'retain_iter_history': False, 'retain_dropout': False, 'retain_dropout_modules': None, 'decoding_format': None, 'no_seed_provided': False}, 'eval_lm': {'_name': None, 'input_quant_method': '', 'input_bits': -1, 'weight_quant_method': '', 'weight_bits': -1, 'smoothquant': False, 'smoothquant_alpha': 0.5, 'smoothquant_bitnet': False, 'input_bits_post': 8, 'hadamard_group': -1, 'cal_input_stat': 'none', 'output_word_probs': False, 'output_word_stats': False, 'context_window': 0, 'softmax_batch': 9223372036854775807, 'stats_path': None, 'max_valid_steps': None}, 'interactive': {'_name': None, 'buffer_size': 0, 'input': '-'}, 'model': {'_name': 'llama_for_layer_wise_qat', 'load_ckpt': None, 'batch_size': 32, 'share_input_output_embed': False, 'sliding_window': None, 'rope_theta': 10000.0, 'checkpoint_activations': False, 'tokens_per_sample': 512, 'model_parallel_size': 1}, 'task': {'_name': 'kd', 'path_to_labels': None, 'data': '/data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b', 'tokens_per_sample': 512, 'batch_size_in_quant': 8, 'max_target_positions': None, 'llama_model': None, 'quant_acts_when_training': True, 'tiktoken_model': 'cl100k_base', 'batch_read_ahead': 1, 'pad_to_max_len': True, 'absolute_path': False, 'tokenizer_pad_to_multiple': 1, 'seed': 1, 'batch_size': 32}, 'criterion': {'_name': 'kl_divergence', 'sentence_avg': False}, 'optimizer': {'_name': 'adam', 'adam_betas': '(0.9, 0.95)', 'adam_eps': 1e-06, 'weight_decay': 0.05, 'use_old_adam': False, 'fp16_adam_stats': False, 'tpu': False, 'bf16': False, 'lr': [0.00015], 'block_wise': False}, 'lr_scheduler': {'_name': 'polynomial_decay', 'warmup_updates': 50, 'force_anneal': None, 'end_learning_rate': 0.0, 'power': 1.0, 'total_num_update': 300000.0, 'lr': [0.00015]}, 'scoring': {'_name': 'bleu', 'pad': 1, 'eos': 2, 'unk': 3}, 'bpe': None, 'tokenizer': None}
25-01-14 00:49:00 | I | LlamaModelDecoderLayer(
  (decoder): LlamaDecoderLayerInFairseq(
    (model): LlamaDecoderLayer(
      (self_attn): LlamaSdpaAttention(
        (q_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (k_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (v_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (o_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (rotary_emb): LlamaRotaryEmbedding()
        (q_rotary_emb): RotaryEmbedding()
        (k_rotary_emb): RotaryEmbedding()
      )
      (mlp): LlamaMLP(
        (gate_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (up_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (down_proj): Linear(in_features=11008, out_features=4096, bias=False)
        (act_fn): SiLU()
      )
      (input_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
      (post_attention_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
    )
  )
  (model): LlamaDecoderLayerInFairseq(
    (model): LlamaDecoderLayer(
      (self_attn): LlamaSdpaAttention(
        (q_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (k_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (v_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (o_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (rotary_emb): LlamaRotaryEmbedding()
        (q_rotary_emb): RotaryEmbedding()
        (k_rotary_emb): RotaryEmbedding()
      )
      (mlp): LlamaMLP(
        (gate_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (up_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (down_proj): Linear(in_features=11008, out_features=4096, bias=False)
        (act_fn): SiLU()
      )
      (input_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
      (post_attention_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
    )
  )
)
25-01-14 00:49:00 | I | task: KDTask
25-01-14 00:49:00 | I | model: LlamaModelDecoderLayer
25-01-14 00:49:00 | I | criterion: KLDivergenceCriterion
25-01-14 00:49:00 | I | num. non-expert model params: 202,383,360 (num. trained: 202,383,360)
25-01-14 00:49:00 | I | num. expert model params: 0 (num. trained: 0)
25-01-14 00:49:00 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 2.490234375, 'gpu_3_mem_used_gb': 0.0, 'gpu_4_mem_used_gb': 6.150390625, 'gpu_5_mem_used_gb': 7.0859375, 'gpu_6_mem_used_gb': 7.0859375, 'gpu_7_mem_used_gb': 6.06640625}
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.weight <- model.model.self_attn.q_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.self_attn.k_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.self_attn.v_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.self_attn.o_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.mlp.gate_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.mlp.up_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.mlp.down_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.q_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.k_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.v_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.o_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.mlp.gate_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.mlp.up_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.mlp.down_proj.bias
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.k_proj.weight <- model.model.self_attn.k_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.v_proj.weight <- model.model.self_attn.v_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.self_attn.o_proj.weight <- model.model.self_attn.o_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.mlp.gate_proj.weight <- model.model.mlp.gate_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.mlp.up_proj.weight <- model.model.mlp.up_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.mlp.down_proj.weight <- model.model.mlp.down_proj.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.input_layernorm.weight <- model.model.input_layernorm.weight
25-01-14 00:49:00 | I | detected shared parameter: decoder.model.post_attention_layernorm.weight <- model.model.post_attention_layernorm.weight
25-01-14 00:49:00 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 2.490234375, 'gpu_3_mem_used_gb': 0.0, 'gpu_4_mem_used_gb': 6.19140625, 'gpu_5_mem_used_gb': 7.126953125, 'gpu_6_mem_used_gb': 7.126953125, 'gpu_7_mem_used_gb': 6.107421875}
25-01-14 00:49:00 | I | ***********************CUDA enviroments for all 1 workers***********************
25-01-14 00:49:00 | I | rank   0: capabilities =  8.6  ; total memory = 23.691 GB ; name = NVIDIA GeForce RTX 3090                 
25-01-14 00:49:00 | I | ***********************CUDA enviroments for all 1 workers***********************
25-01-14 00:49:00 | I | training on 1 devices (GPUs/TPUs)
25-01-14 00:49:00 | I | max tokens per GPU = None and batch size per GPU = 32
25-01-14 00:49:00 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 2.490234375, 'gpu_3_mem_used_gb': 0.0, 'gpu_4_mem_used_gb': 6.19140625, 'gpu_5_mem_used_gb': 7.126953125, 'gpu_6_mem_used_gb': 7.126953125, 'gpu_7_mem_used_gb': 6.107421875}
25-01-14 00:49:00 | I | loading train data for epoch 1
25-01-14 00:49:03 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/0.jsonl 
 ***
25-01-14 00:49:03 | I | *** 
 total_rows = 700 
 ***
25-01-14 00:49:03 | I | current row num = 0
25-01-14 00:49:03 | I | in forward_and_gen_teacher_outputs, Start iterating over samples
25-01-14 00:49:03 | I | loading train data for epoch 1
25-01-14 00:49:05 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/0.jsonl 
 ***
25-01-14 00:49:05 | I | *** 
 total_rows = 700 
 ***
25-01-14 00:49:05 | I | current row num = 0
25-01-14 00:49:05 | I | in forward_and_gen_args_and_kwargs, Start iterating over samples
25-01-14 00:49:05 | I | No existing checkpoint found checkpoints/checkpoint_last.pt
25-01-14 00:49:05 | I | loading train data for epoch 1
25-01-14 00:49:05 | I | loading valid data for epoch 1
25-01-14 00:49:08 | I | begin training epoch 1
25-01-14 00:49:08 | I | Start iterating over samples
25-01-14 00:49:09 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:49:09 | I | in layer model.layers.0
25-01-14 00:49:09 | I | quantizing weights for layer model.layers.0
25-01-14 00:49:09 | I | collecting info in model.layers.0
25-01-14 00:49:09 | I | collecting info in model.layers.0
25-01-14 00:49:09 | I | collecting info in model.layers.0
25-01-14 00:49:09 | I | collecting info in model.layers.0
25-01-14 00:49:09 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:10 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:10 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:10 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:10 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:49:10 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:49:12 | I |       - range scale = [    1.0000]
25-01-14 00:49:12 | I |         sum  error  = [    0.0574]
25-01-14 00:49:12 | I |         best error  = [    0.0574]
25-01-14 00:49:12 | I |     + error = [0.0574]
25-01-14 00:49:13 | I |       - range scale = [    1.0000]
25-01-14 00:49:13 | I |         sum  error  = [    0.8980]
25-01-14 00:49:13 | I |         best error  = [    0.8980]
25-01-14 00:49:13 | I |     + error = [0.8980]
25-01-14 00:49:13 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:49:14 | I |       - range scale = [    1.0000]
25-01-14 00:49:14 | I |         sum  error  = [    0.0697]
25-01-14 00:49:14 | I |         best error  = [    0.0697]
25-01-14 00:49:14 | I |     + error = [0.0697]
25-01-14 00:49:14 | I |       - range scale = [    1.0000]
25-01-14 00:49:14 | I |         sum  error  = [    1.3617]
25-01-14 00:49:14 | I |         best error  = [    1.3617]
25-01-14 00:49:14 | I |     + error = [1.3617]
25-01-14 00:49:15 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:49:15 | I |       - range scale = [    1.0000]
25-01-14 00:49:15 | I |         sum  error  = [    0.6796]
25-01-14 00:49:15 | I |         best error  = [    0.6796]
25-01-14 00:49:15 | I |     + error = [0.6796]
25-01-14 00:49:16 | I |       - range scale = [    1.0000]
25-01-14 00:49:16 | I |         sum  error  = [    6.0981]
25-01-14 00:49:16 | I |         best error  = [    6.0981]
25-01-14 00:49:16 | I |     + error = [6.0981]
25-01-14 00:49:16 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:49:17 | I |       - range scale = [    1.0000]
25-01-14 00:49:17 | I |         sum  error  = [    0.1924]
25-01-14 00:49:17 | I |         best error  = [    0.1924]
25-01-14 00:49:17 | I |     + error = [0.1924]
25-01-14 00:49:18 | I |       - range scale = [    1.0000]
25-01-14 00:49:18 | I |         sum  error  = [    1.5800]
25-01-14 00:49:18 | I |         best error  = [    1.5800]
25-01-14 00:49:18 | I |     + error = [1.5800]
25-01-14 00:49:18 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:49:19 | I |       - range scale = [    1.0000]
25-01-14 00:49:19 | I |         sum  error  = [    1.1093]
25-01-14 00:49:19 | I |         best error  = [    1.1093]
25-01-14 00:49:19 | I |     + error = [1.1093]
25-01-14 00:49:20 | I |       - range scale = [    1.0000]
25-01-14 00:49:20 | I |         sum  error  = [   11.8188]
25-01-14 00:49:20 | I |         best error  = [   11.8188]
25-01-14 00:49:20 | I |     + error = [11.8188]
25-01-14 00:49:20 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:49:21 | I |       - range scale = [    1.0000]
25-01-14 00:49:21 | I |         sum  error  = [    1.1681]
25-01-14 00:49:21 | I |         best error  = [    1.1681]
25-01-14 00:49:21 | I |     + error = [1.1681]
25-01-14 00:49:22 | I |       - range scale = [    1.0000]
25-01-14 00:49:22 | I |         sum  error  = [   12.1525]
25-01-14 00:49:22 | I |         best error  = [   12.1525]
25-01-14 00:49:22 | I |     + error = [12.1525]
25-01-14 00:49:22 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:49:23 | I |       - range scale = [    1.0000]
25-01-14 00:49:23 | I |         sum  error  = [    0.1711]
25-01-14 00:49:23 | I |         best error  = [    0.1711]
25-01-14 00:49:23 | I |     + error = [0.1711]
25-01-14 00:49:24 | I |       - range scale = [    1.0000]
25-01-14 00:49:24 | I |         sum  error  = [    1.6681]
25-01-14 00:49:24 | I |         best error  = [    1.6681]
25-01-14 00:49:24 | I |     + error = [1.6681]
25-01-14 00:49:24 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:49:27 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:49:29 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:49:32 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:49:34 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:49:37 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:49:39 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:49:45 | I | quantizing activations for layer model.layers.0
25-01-14 00:49:45 | I | collecting info in model.layers.0
25-01-14 00:49:45 | I | collecting info in model.layers.0
25-01-14 00:49:45 | I | collecting info in model.layers.0
25-01-14 00:49:45 | I | collecting info in model.layers.0
25-01-14 00:49:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:47 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:49 | I | forward this layer
25-01-14 00:49:49 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/00.pt
25-01-14 00:49:49 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/00.pt
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.q_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.q_proj has inf: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.k_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.k_proj has inf: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.v_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.v_proj has inf: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.o_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.self_attn.o_proj has inf: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.mlp.up_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.mlp.up_proj has inf: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.mlp.gate_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.mlp.gate_proj has inf: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.mlp.down_proj has nan: False
25-01-14 00:49:49 | I | In layer model.layers.0, gradient of model.layers.0.mlp.down_proj has inf: False
25-01-14 00:49:50 | I | in layer model.layers.0
25-01-14 00:49:50 | I | quantizing weights for layer model.layers.0
25-01-14 00:49:50 | I | collecting info in model.layers.0
25-01-14 00:49:50 | I | collecting info in model.layers.0
25-01-14 00:49:50 | I | collecting info in model.layers.0
25-01-14 00:49:50 | I | collecting info in model.layers.0
25-01-14 00:49:50 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:50 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:50 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:51 | I | collecting calibration activations in model.layers.0
25-01-14 00:49:51 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:49:51 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:49:52 | I |       - range scale = [    1.0000]
25-01-14 00:49:52 | I |         sum  error  = [    0.0583]
25-01-14 00:49:52 | I |         best error  = [    0.0583]
25-01-14 00:49:52 | I |     + error = [0.0583]
25-01-14 00:49:53 | I |       - range scale = [    1.0000]
25-01-14 00:49:53 | I |         sum  error  = [    0.8998]
25-01-14 00:49:53 | I |         best error  = [    0.8998]
25-01-14 00:49:53 | I |     + error = [0.8998]
25-01-14 00:49:53 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:49:53 | I |       - range scale = [    1.0000]
25-01-14 00:49:53 | I |         sum  error  = [    0.0705]
25-01-14 00:49:53 | I |         best error  = [    0.0705]
25-01-14 00:49:53 | I |     + error = [0.0705]
25-01-14 00:49:54 | I |       - range scale = [    1.0000]
25-01-14 00:49:54 | I |         sum  error  = [    1.3389]
25-01-14 00:49:54 | I |         best error  = [    1.3389]
25-01-14 00:49:54 | I |     + error = [1.3389]
25-01-14 00:49:54 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:49:55 | I |       - range scale = [    1.0000]
25-01-14 00:49:55 | I |         sum  error  = [    0.6895]
25-01-14 00:49:55 | I |         best error  = [    0.6895]
25-01-14 00:49:55 | I |     + error = [0.6895]
25-01-14 00:49:56 | I |       - range scale = [    1.0000]
25-01-14 00:49:56 | I |         sum  error  = [    6.1986]
25-01-14 00:49:56 | I |         best error  = [    6.1986]
25-01-14 00:49:56 | I |     + error = [6.1986]
25-01-14 00:49:56 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:49:57 | I |       - range scale = [    1.0000]
25-01-14 00:49:57 | I |         sum  error  = [    0.1944]
25-01-14 00:49:57 | I |         best error  = [    0.1944]
25-01-14 00:49:57 | I |     + error = [0.1944]
25-01-14 00:49:58 | I |       - range scale = [    1.0000]
25-01-14 00:49:58 | I |         sum  error  = [    1.6058]
25-01-14 00:49:58 | I |         best error  = [    1.6058]
25-01-14 00:49:58 | I |     + error = [1.6058]
25-01-14 00:49:58 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:49:59 | I |       - range scale = [    1.0000]
25-01-14 00:49:59 | I |         sum  error  = [    1.1007]
25-01-14 00:49:59 | I |         best error  = [    1.1007]
25-01-14 00:49:59 | I |     + error = [1.1007]
25-01-14 00:50:00 | I |       - range scale = [    1.0000]
25-01-14 00:50:00 | I |         sum  error  = [   11.7393]
25-01-14 00:50:00 | I |         best error  = [   11.7393]
25-01-14 00:50:00 | I |     + error = [11.7393]
25-01-14 00:50:00 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:50:01 | I |       - range scale = [    1.0000]
25-01-14 00:50:01 | I |         sum  error  = [    1.1598]
25-01-14 00:50:01 | I |         best error  = [    1.1598]
25-01-14 00:50:01 | I |     + error = [1.1598]
25-01-14 00:50:02 | I |       - range scale = [    1.0000]
25-01-14 00:50:02 | I |         sum  error  = [   12.0722]
25-01-14 00:50:02 | I |         best error  = [   12.0722]
25-01-14 00:50:02 | I |     + error = [12.0722]
25-01-14 00:50:02 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:50:03 | I |       - range scale = [    1.0000]
25-01-14 00:50:03 | I |         sum  error  = [    0.1754]
25-01-14 00:50:03 | I |         best error  = [    0.1754]
25-01-14 00:50:03 | I |     + error = [0.1754]
25-01-14 00:50:04 | I |       - range scale = [    1.0000]
25-01-14 00:50:04 | I |         sum  error  = [    1.7139]
25-01-14 00:50:04 | I |         best error  = [    1.7139]
25-01-14 00:50:04 | I |     + error = [1.7139]
25-01-14 00:50:04 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:50:07 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:50:09 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:50:11 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:50:14 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:50:16 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:50:19 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:50:25 | I | quantizing activations for layer model.layers.0
25-01-14 00:50:25 | I | collecting info in model.layers.0
25-01-14 00:50:25 | I | collecting info in model.layers.0
25-01-14 00:50:25 | I | collecting info in model.layers.0
25-01-14 00:50:25 | I | collecting info in model.layers.0
25-01-14 00:50:26 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:26 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:26 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:26 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:28 | I | forward this layer
25-01-14 00:50:28 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/01.pt
25-01-14 00:50:28 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/01.pt
25-01-14 00:50:28 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 172.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 120.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.69 GiB is allocated by PyTorch, and 414.61 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:50:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 1            |        cudaMalloc retries: 4         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22545 MiB |  23233 MiB |   1111 GiB |   1089 GiB |
|       from large pool |  22542 MiB |  23230 MiB |   1092 GiB |   1070 GiB |
|       from small pool |      3 MiB |      5 MiB |     18 GiB |     18 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22545 MiB |  23233 MiB |   1111 GiB |   1089 GiB |
|       from large pool |  22542 MiB |  23230 MiB |   1092 GiB |   1070 GiB |
|       from small pool |      3 MiB |      5 MiB |     18 GiB |     18 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22545 MiB |  23233 MiB |   1101 GiB |   1079 GiB |
|       from large pool |  22542 MiB |  23230 MiB |   1083 GiB |   1061 GiB |
|       from small pool |      3 MiB |      5 MiB |     18 GiB |     18 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23648 MiB |  23672 MiB | 159468 MiB | 135820 MiB |
|       from large pool |  23644 MiB |  23668 MiB | 159372 MiB | 135728 MiB |
|       from small pool |      4 MiB |      6 MiB |     96 MiB |     92 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 424558 KiB |   1573 MiB | 277996 MiB | 277581 MiB |
|       from large pool | 423680 KiB |   1571 MiB | 257399 MiB | 256986 MiB |
|       from small pool |    878 KiB |      3 MiB |  20596 MiB |  20595 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     279    |     283    |  366761    |  366482    |
|       from large pool |     192    |     193    |   47408    |   47216    |
|       from small pool |      87    |      91    |  319353    |  319266    |
|---------------------------------------------------------------------------|
| Active allocs         |     279    |     283    |  366761    |  366482    |
|       from large pool |     192    |     193    |   47408    |   47216    |
|       from small pool |      87    |      91    |  319353    |  319266    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     165    |     168    |     569    |     404    |
|       from large pool |     163    |     166    |     521    |     358    |
|       from small pool |       2    |       3    |      48    |      46    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      19    |      24    |  173124    |  173105    |
|       from large pool |      11    |      18    |   29093    |   29082    |
|       from small pool |       8    |      10    |  144031    |  144023    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:50:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   7621 MiB | 688901 KiB |
|       from large pool |   6948 MiB |   7036 MiB |   7614 MiB | 682752 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6149 KiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   7621 MiB | 688901 KiB |
|       from large pool |   6948 MiB |   7036 MiB |   7614 MiB | 682752 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6149 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   7609 MiB | 676608 KiB |
|       from large pool |   6948 MiB |   7034 MiB |   7602 MiB | 670464 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6144 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   7688 MiB | 755712 KiB |
|       from large pool |   6948 MiB |   7036 MiB |   7684 MiB | 753664 KiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |   2048 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |  92156 KiB |  90405 KiB |
|       from large pool |      0 KiB |  19104 KiB |  81920 KiB |  81920 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  10236 KiB |   8485 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     230    |      50    |
|       from large pool |     126    |     128    |     154    |      28    |
|       from small pool |      54    |      56    |      76    |      22    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     230    |      50    |
|       from large pool |     126    |     128    |     154    |      28    |
|       from small pool |      54    |      56    |      76    |      22    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     152    |      25    |
|       from large pool |     126    |     128    |     150    |      24    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |       6    |       5    |
|       from large pool |       0    |       1    |       4    |       4    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:50:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   7621 MiB | 688901 KiB |
|       from large pool |   6948 MiB |   7036 MiB |   7614 MiB | 682752 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6149 KiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   7621 MiB | 688901 KiB |
|       from large pool |   6948 MiB |   7036 MiB |   7614 MiB | 682752 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6149 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   7609 MiB | 676608 KiB |
|       from large pool |   6948 MiB |   7034 MiB |   7602 MiB | 670464 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6144 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   7688 MiB | 755712 KiB |
|       from large pool |   6948 MiB |   7036 MiB |   7684 MiB | 753664 KiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |   2048 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |  92156 KiB |  90405 KiB |
|       from large pool |      0 KiB |  19104 KiB |  81920 KiB |  81920 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  10236 KiB |   8485 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     230    |      50    |
|       from large pool |     126    |     128    |     154    |      28    |
|       from small pool |      54    |      56    |      76    |      22    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     230    |      50    |
|       from large pool |     126    |     128    |     154    |      28    |
|       from small pool |      54    |      56    |      76    |      22    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     152    |      25    |
|       from large pool |     126    |     128    |     150    |      24    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |       6    |       5    |
|       from large pool |       0    |       1    |       4    |       4    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:50:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   6577 MiB | 688900 KiB |
|       from large pool |   5904 MiB |   5992 MiB |   6570 MiB | 682752 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6148 KiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   6577 MiB | 688900 KiB |
|       from large pool |   5904 MiB |   5992 MiB |   6570 MiB | 682752 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6148 KiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   6565 MiB | 676608 KiB |
|       from large pool |   5904 MiB |   5990 MiB |   6558 MiB | 670464 KiB |
|       from small pool |      0 MiB |      1 MiB |      6 MiB |   6144 KiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   6644 MiB | 755712 KiB |
|       from large pool |   5904 MiB |   5992 MiB |   6640 MiB | 753664 KiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |   2048 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |  92155 KiB |  90611 KiB |
|       from large pool |      0 KiB |  19104 KiB |  81920 KiB |  81920 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  10235 KiB |   8691 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     197    |      49    |
|       from large pool |     100    |     102    |     128    |      28    |
|       from small pool |      48    |      50    |      69    |      21    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     197    |      49    |
|       from large pool |     100    |     102    |     128    |      28    |
|       from small pool |      48    |      50    |      69    |      21    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     126    |      25    |
|       from large pool |     100    |     102    |     124    |      24    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |       6    |       5    |
|       from large pool |       0    |       1    |       4    |       4    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:50:29 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:50:29 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:50:29 | I | in layer model.layers.0
25-01-14 00:50:29 | I | quantizing weights for layer model.layers.0
25-01-14 00:50:29 | I | collecting info in model.layers.0
25-01-14 00:50:29 | I | collecting info in model.layers.0
25-01-14 00:50:29 | I | collecting info in model.layers.0
25-01-14 00:50:29 | I | collecting info in model.layers.0
25-01-14 00:50:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:50:31 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:50:31 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:50:32 | I |       - range scale = [    1.0000]
25-01-14 00:50:32 | I |         sum  error  = [    0.4934]
25-01-14 00:50:32 | I |         best error  = [    0.4934]
25-01-14 00:50:32 | I |     + error = [0.4934]
25-01-14 00:50:33 | I |       - range scale = [    1.0000]
25-01-14 00:50:33 | I |         sum  error  = [    1.0562]
25-01-14 00:50:33 | I |         best error  = [    1.0562]
25-01-14 00:50:33 | I |     + error = [1.0562]
25-01-14 00:50:33 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:50:34 | I |       - range scale = [    1.0000]
25-01-14 00:50:34 | I |         sum  error  = [    1.6978]
25-01-14 00:50:34 | I |         best error  = [    1.6978]
25-01-14 00:50:34 | I |     + error = [1.6978]
25-01-14 00:50:34 | I |       - range scale = [    1.0000]
25-01-14 00:50:34 | I |         sum  error  = [    3.2315]
25-01-14 00:50:34 | I |         best error  = [    3.2315]
25-01-14 00:50:34 | I |     + error = [3.2315]
25-01-14 00:50:35 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:50:35 | I |       - range scale = [    1.0000]
25-01-14 00:50:35 | I |         sum  error  = [    0.2879]
25-01-14 00:50:35 | I |         best error  = [    0.2879]
25-01-14 00:50:35 | I |     + error = [0.2879]
25-01-14 00:50:36 | I |       - range scale = [    1.0000]
25-01-14 00:50:36 | I |         sum  error  = [    1.0427]
25-01-14 00:50:36 | I |         best error  = [    1.0427]
25-01-14 00:50:36 | I |     + error = [1.0427]
25-01-14 00:50:36 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:50:37 | I |       - range scale = [    1.0000]
25-01-14 00:50:37 | I |         sum  error  = [    0.1620]
25-01-14 00:50:37 | I |         best error  = [    0.1620]
25-01-14 00:50:37 | I |     + error = [0.1620]
25-01-14 00:50:38 | I |       - range scale = [    1.0000]
25-01-14 00:50:38 | I |         sum  error  = [    0.7904]
25-01-14 00:50:38 | I |         best error  = [    0.7904]
25-01-14 00:50:38 | I |     + error = [0.7904]
25-01-14 00:50:38 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:50:39 | I |       - range scale = [    1.0000]
25-01-14 00:50:39 | I |         sum  error  = [    0.9780]
25-01-14 00:50:39 | I |         best error  = [    0.9780]
25-01-14 00:50:39 | I |     + error = [0.9780]
25-01-14 00:50:40 | I |       - range scale = [    1.0000]
25-01-14 00:50:40 | I |         sum  error  = [    4.4002]
25-01-14 00:50:40 | I |         best error  = [    4.4002]
25-01-14 00:50:40 | I |     + error = [4.4002]
25-01-14 00:50:40 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:50:41 | I |       - range scale = [    1.0000]
25-01-14 00:50:41 | I |         sum  error  = [    1.0954]
25-01-14 00:50:41 | I |         best error  = [    1.0954]
25-01-14 00:50:41 | I |     + error = [1.0954]
25-01-14 00:50:42 | I |       - range scale = [    1.0000]
25-01-14 00:50:42 | I |         sum  error  = [    4.7734]
25-01-14 00:50:42 | I |         best error  = [    4.7734]
25-01-14 00:50:42 | I |     + error = [4.7734]
25-01-14 00:50:42 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:50:43 | I |       - range scale = [    1.0000]
25-01-14 00:50:43 | I |         sum  error  = [    0.1683]
25-01-14 00:50:43 | I |         best error  = [    0.1683]
25-01-14 00:50:43 | I |     + error = [0.1683]
25-01-14 00:50:44 | I |       - range scale = [    1.0000]
25-01-14 00:50:44 | I |         sum  error  = [    0.6840]
25-01-14 00:50:44 | I |         best error  = [    0.6840]
25-01-14 00:50:44 | I |     + error = [0.6840]
25-01-14 00:50:44 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:50:47 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:50:49 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:50:51 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:50:54 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:50:56 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:50:59 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:51:05 | I | quantizing activations for layer model.layers.0
25-01-14 00:51:05 | I | collecting info in model.layers.0
25-01-14 00:51:05 | I | collecting info in model.layers.0
25-01-14 00:51:05 | I | collecting info in model.layers.0
25-01-14 00:51:05 | I | collecting info in model.layers.0
25-01-14 00:51:06 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:06 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:06 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:06 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:08 | I | forward this layer
25-01-14 00:51:08 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/02.pt
25-01-14 00:51:08 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/02.pt
25-01-14 00:51:09 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 234.94 MiB is free. Process 46094 has 23.46 GiB memory in use. Of the allocated memory 22.21 GiB is allocated by PyTorch, and 791.01 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:51:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 2            |        cudaMalloc retries: 5         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22742 MiB |  23233 MiB |   1720 GiB |   1697 GiB |
|       from large pool |  22738 MiB |  23230 MiB |   1691 GiB |   1669 GiB |
|       from small pool |      4 MiB |      5 MiB |     28 GiB |     28 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22742 MiB |  23233 MiB |   1720 GiB |   1697 GiB |
|       from large pool |  22738 MiB |  23230 MiB |   1691 GiB |   1669 GiB |
|       from small pool |      4 MiB |      5 MiB |     28 GiB |     28 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22742 MiB |  23233 MiB |   1707 GiB |   1685 GiB |
|       from large pool |  22738 MiB |  23230 MiB |   1679 GiB |   1657 GiB |
|       from small pool |      4 MiB |      5 MiB |     28 GiB |     28 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23534 MiB |  23672 MiB | 228616 MiB | 205082 MiB |
|       from large pool |  23528 MiB |  23668 MiB | 228448 MiB | 204920 MiB |
|       from small pool |      6 MiB |      6 MiB |    168 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    791 MiB |   1573 MiB | 500058 MiB | 499267 MiB |
|       from large pool |    789 MiB |   1571 MiB | 468103 MiB | 467313 MiB |
|       from small pool |      1 MiB |      4 MiB |  31954 MiB |  31953 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     310    |     312    |  557173    |  556863    |
|       from large pool |     212    |     212    |   72205    |   71993    |
|       from small pool |      98    |     100    |  484968    |  484870    |
|---------------------------------------------------------------------------|
| Active allocs         |     310    |     312    |  557173    |  556863    |
|       from large pool |     212    |     212    |   72205    |   71993    |
|       from small pool |      98    |     100    |  484968    |  484870    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     175    |     726    |     551    |
|       from large pool |     172    |     172    |     642    |     470    |
|       from small pool |       3    |       3    |      84    |      81    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      24    |      29    |  262149    |  262125    |
|       from large pool |      16    |      22    |   40720    |   40704    |
|       from small pool |       8    |      10    |  221429    |  221421    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   7957 MiB |   1009 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   7948 MiB |   1000 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   7957 MiB |   1009 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   7948 MiB |   1000 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   7939 MiB |    991 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   7930 MiB |    982 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   8056 MiB |   1106 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8052 MiB |   1104 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 136188 KiB | 134437 KiB |
|       from large pool |      0 KiB |  19104 KiB | 122880 KiB | 122880 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  13308 KiB |  11557 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     250    |      70    |
|       from large pool |     126    |     128    |     168    |      42    |
|       from small pool |      54    |      56    |      82    |      28    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     250    |      70    |
|       from large pool |     126    |     128    |     168    |      42    |
|       from small pool |      54    |      56    |      82    |      28    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     164    |      37    |
|       from large pool |     126    |     128    |     162    |      36    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |       8    |       7    |
|       from large pool |       0    |       1    |       6    |       6    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   7957 MiB |   1009 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   7948 MiB |   1000 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   7957 MiB |   1009 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   7948 MiB |   1000 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   7939 MiB |    991 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   7930 MiB |    982 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   8056 MiB |   1106 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8052 MiB |   1104 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 136188 KiB | 134437 KiB |
|       from large pool |      0 KiB |  19104 KiB | 122880 KiB | 122880 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  13308 KiB |  11557 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     250    |      70    |
|       from large pool |     126    |     128    |     168    |      42    |
|       from small pool |      54    |      56    |      82    |      28    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     250    |      70    |
|       from large pool |     126    |     128    |     168    |      42    |
|       from small pool |      54    |      56    |      82    |      28    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     164    |      37    |
|       from large pool |     126    |     128    |     162    |      36    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |       8    |       7    |
|       from large pool |       0    |       1    |       6    |       6    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   6913 MiB |   1009 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   6904 MiB |   1000 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   6913 MiB |   1009 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   6904 MiB |   1000 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   6895 MiB |    991 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   6886 MiB |    982 MiB |
|       from small pool |      0 MiB |      1 MiB |      9 MiB |      9 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   7012 MiB |   1106 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7008 MiB |   1104 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 136187 KiB | 134643 KiB |
|       from large pool |      0 KiB |  19104 KiB | 122880 KiB | 122880 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  13307 KiB |  11763 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     217    |      69    |
|       from large pool |     100    |     102    |     142    |      42    |
|       from small pool |      48    |      50    |      75    |      27    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     217    |      69    |
|       from large pool |     100    |     102    |     142    |      42    |
|       from small pool |      48    |      50    |      75    |      27    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     138    |      37    |
|       from large pool |     100    |     102    |     136    |      36    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |       8    |       7    |
|       from large pool |       0    |       1    |       6    |       6    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:09 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:51:09 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:51:09 | I | in layer model.layers.0
25-01-14 00:51:09 | I | quantizing weights for layer model.layers.0
25-01-14 00:51:09 | I | collecting info in model.layers.0
25-01-14 00:51:09 | I | collecting info in model.layers.0
25-01-14 00:51:09 | I | collecting info in model.layers.0
25-01-14 00:51:09 | I | collecting info in model.layers.0
25-01-14 00:51:10 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:10 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:10 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:11 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:11 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:51:11 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:51:12 | I |       - range scale = [    1.0000]
25-01-14 00:51:12 | I |         sum  error  = [    0.4848]
25-01-14 00:51:12 | I |         best error  = [    0.4848]
25-01-14 00:51:12 | I |     + error = [0.4848]
25-01-14 00:51:13 | I |       - range scale = [    1.0000]
25-01-14 00:51:13 | I |         sum  error  = [    0.9784]
25-01-14 00:51:13 | I |         best error  = [    0.9784]
25-01-14 00:51:13 | I |     + error = [0.9784]
25-01-14 00:51:13 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:51:14 | I |       - range scale = [    1.0000]
25-01-14 00:51:14 | I |         sum  error  = [    1.6776]
25-01-14 00:51:14 | I |         best error  = [    1.6776]
25-01-14 00:51:14 | I |     + error = [1.6776]
25-01-14 00:51:15 | I |       - range scale = [    1.0000]
25-01-14 00:51:15 | I |         sum  error  = [    3.3638]
25-01-14 00:51:15 | I |         best error  = [    3.3638]
25-01-14 00:51:15 | I |     + error = [3.3638]
25-01-14 00:51:15 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:51:16 | I |       - range scale = [    1.0000]
25-01-14 00:51:16 | I |         sum  error  = [    0.2538]
25-01-14 00:51:16 | I |         best error  = [    0.2538]
25-01-14 00:51:16 | I |     + error = [0.2538]
25-01-14 00:51:17 | I |       - range scale = [    1.0000]
25-01-14 00:51:17 | I |         sum  error  = [    0.5789]
25-01-14 00:51:17 | I |         best error  = [    0.5789]
25-01-14 00:51:17 | I |     + error = [0.5789]
25-01-14 00:51:17 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:51:18 | I |       - range scale = [    1.0000]
25-01-14 00:51:18 | I |         sum  error  = [    0.1470]
25-01-14 00:51:18 | I |         best error  = [    0.1470]
25-01-14 00:51:18 | I |     + error = [0.1470]
25-01-14 00:51:19 | I |       - range scale = [    1.0000]
25-01-14 00:51:19 | I |         sum  error  = [    0.5250]
25-01-14 00:51:19 | I |         best error  = [    0.5250]
25-01-14 00:51:19 | I |     + error = [0.5250]
25-01-14 00:51:19 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:51:20 | I |       - range scale = [    1.0000]
25-01-14 00:51:20 | I |         sum  error  = [    0.9447]
25-01-14 00:51:20 | I |         best error  = [    0.9447]
25-01-14 00:51:20 | I |     + error = [0.9447]
25-01-14 00:51:21 | I |       - range scale = [    1.0000]
25-01-14 00:51:21 | I |         sum  error  = [    2.2777]
25-01-14 00:51:21 | I |         best error  = [    2.2777]
25-01-14 00:51:21 | I |     + error = [2.2777]
25-01-14 00:51:21 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:51:22 | I |       - range scale = [    1.0000]
25-01-14 00:51:22 | I |         sum  error  = [    1.0598]
25-01-14 00:51:22 | I |         best error  = [    1.0598]
25-01-14 00:51:22 | I |     + error = [1.0598]
25-01-14 00:51:23 | I |       - range scale = [    1.0000]
25-01-14 00:51:23 | I |         sum  error  = [    2.5177]
25-01-14 00:51:23 | I |         best error  = [    2.5177]
25-01-14 00:51:23 | I |     + error = [2.5177]
25-01-14 00:51:23 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:51:24 | I |       - range scale = [    1.0000]
25-01-14 00:51:24 | I |         sum  error  = [    0.1626]
25-01-14 00:51:24 | I |         best error  = [    0.1626]
25-01-14 00:51:24 | I |     + error = [0.1626]
25-01-14 00:51:25 | I |       - range scale = [    1.0000]
25-01-14 00:51:25 | I |         sum  error  = [    0.3702]
25-01-14 00:51:25 | I |         best error  = [    0.3702]
25-01-14 00:51:25 | I |     + error = [0.3702]
25-01-14 00:51:25 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:51:28 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:51:30 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:51:33 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:51:35 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:51:38 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:51:40 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:51:47 | I | quantizing activations for layer model.layers.0
25-01-14 00:51:47 | I | collecting info in model.layers.0
25-01-14 00:51:47 | I | collecting info in model.layers.0
25-01-14 00:51:47 | I | collecting info in model.layers.0
25-01-14 00:51:47 | I | collecting info in model.layers.0
25-01-14 00:51:47 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:48 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:48 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:48 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:50 | I | forward this layer
25-01-14 00:51:50 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/04.pt
25-01-14 00:51:50 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/04.pt
25-01-14 00:51:50 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 142.94 MiB is free. Process 46094 has 23.55 GiB memory in use. Of the allocated memory 22.36 GiB is allocated by PyTorch, and 734.28 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:51:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 3            |        cudaMalloc retries: 6         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22891 MiB |  23233 MiB |   2414 GiB |   2391 GiB |
|       from large pool |  22886 MiB |  23230 MiB |   2375 GiB |   2353 GiB |
|       from small pool |      5 MiB |      5 MiB |     38 GiB |     38 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22891 MiB |  23233 MiB |   2414 GiB |   2391 GiB |
|       from large pool |  22886 MiB |  23230 MiB |   2375 GiB |   2353 GiB |
|       from small pool |      5 MiB |      5 MiB |     38 GiB |     38 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22891 MiB |  23233 MiB |   2398 GiB |   2376 GiB |
|       from large pool |  22886 MiB |  23230 MiB |   2360 GiB |   2338 GiB |
|       from small pool |      5 MiB |      5 MiB |     38 GiB |     38 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23626 MiB |  23672 MiB | 301604 MiB | 277978 MiB |
|       from large pool |  23620 MiB |  23668 MiB | 301364 MiB | 277744 MiB |
|       from small pool |      6 MiB |      8 MiB |    240 MiB |    234 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 751903 KiB |   1645 MiB | 765793 MiB | 765059 MiB |
|       from large pool | 751360 KiB |   1643 MiB | 722086 MiB | 721352 MiB |
|       from small pool |    543 KiB |      4 MiB |  43707 MiB |  43706 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     315    |     320    |     754 K  |     754 K  |
|       from large pool |     221    |     223    |      98 K  |      98 K  |
|       from small pool |      94    |     100    |     656 K  |     656 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     315    |     320    |     754 K  |     754 K  |
|       from large pool |     221    |     223    |      98 K  |      98 K  |
|       from small pool |      94    |     100    |     656 K  |     656 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     177    |     178    |     902    |     725    |
|       from large pool |     174    |     174    |     782    |     608    |
|       from small pool |       3    |       4    |     120    |     117    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      23    |      32    |  351885    |  351862    |
|       from large pool |      15    |      24    |   50963    |   50948    |
|       from small pool |       8    |      10    |  300922    |  300914    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   8293 MiB |   1345 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8281 MiB |   1333 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   8293 MiB |   1345 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8281 MiB |   1333 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   8269 MiB |   1321 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   8257 MiB |   1309 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   8424 MiB |   1474 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8420 MiB |   1472 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 180220 KiB | 178469 KiB |
|       from large pool |      0 KiB |  19104 KiB | 163840 KiB | 163840 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  16380 KiB |  14629 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     270    |      90    |
|       from large pool |     126    |     128    |     182    |      56    |
|       from small pool |      54    |      56    |      88    |      34    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     270    |      90    |
|       from large pool |     126    |     128    |     182    |      56    |
|       from small pool |      54    |      56    |      88    |      34    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     176    |      49    |
|       from large pool |     126    |     128    |     174    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      10    |       9    |
|       from large pool |       0    |       1    |       8    |       8    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   8293 MiB |   1345 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8281 MiB |   1333 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   8293 MiB |   1345 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8281 MiB |   1333 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   8269 MiB |   1321 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   8257 MiB |   1309 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   8424 MiB |   1474 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8420 MiB |   1472 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 180220 KiB | 178469 KiB |
|       from large pool |      0 KiB |  19104 KiB | 163840 KiB | 163840 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  16380 KiB |  14629 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     270    |      90    |
|       from large pool |     126    |     128    |     182    |      56    |
|       from small pool |      54    |      56    |      88    |      34    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     270    |      90    |
|       from large pool |     126    |     128    |     182    |      56    |
|       from small pool |      54    |      56    |      88    |      34    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     176    |      49    |
|       from large pool |     126    |     128    |     174    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      10    |       9    |
|       from large pool |       0    |       1    |       8    |       8    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   7249 MiB |   1345 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7237 MiB |   1333 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   7249 MiB |   1345 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7237 MiB |   1333 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   7225 MiB |   1321 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   7213 MiB |   1309 MiB |
|       from small pool |      0 MiB |      1 MiB |     12 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   7380 MiB |   1474 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7376 MiB |   1472 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 180219 KiB | 178675 KiB |
|       from large pool |      0 KiB |  19104 KiB | 163840 KiB | 163840 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  16379 KiB |  14835 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     237    |      89    |
|       from large pool |     100    |     102    |     156    |      56    |
|       from small pool |      48    |      50    |      81    |      33    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     237    |      89    |
|       from large pool |     100    |     102    |     156    |      56    |
|       from small pool |      48    |      50    |      81    |      33    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     150    |      49    |
|       from large pool |     100    |     102    |     148    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      10    |       9    |
|       from large pool |       0    |       1    |       8    |       8    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:51:50 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:51:51 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:51:51 | I | in layer model.layers.0
25-01-14 00:51:51 | I | quantizing weights for layer model.layers.0
25-01-14 00:51:51 | I | collecting info in model.layers.0
25-01-14 00:51:51 | I | collecting info in model.layers.0
25-01-14 00:51:51 | I | collecting info in model.layers.0
25-01-14 00:51:51 | I | collecting info in model.layers.0
25-01-14 00:51:52 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:52 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:52 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:53 | I | collecting calibration activations in model.layers.0
25-01-14 00:51:53 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:51:53 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:51:54 | I |       - range scale = [    1.0000]
25-01-14 00:51:54 | I |         sum  error  = [    0.5048]
25-01-14 00:51:54 | I |         best error  = [    0.5048]
25-01-14 00:51:54 | I |     + error = [0.5048]
25-01-14 00:51:55 | I |       - range scale = [    1.0000]
25-01-14 00:51:55 | I |         sum  error  = [    1.0186]
25-01-14 00:51:55 | I |         best error  = [    1.0186]
25-01-14 00:51:55 | I |     + error = [1.0186]
25-01-14 00:51:55 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:51:57 | I |       - range scale = [    1.0000]
25-01-14 00:51:57 | I |         sum  error  = [    1.8267]
25-01-14 00:51:57 | I |         best error  = [    1.8267]
25-01-14 00:51:57 | I |     + error = [1.8267]
25-01-14 00:51:58 | I |       - range scale = [    1.0000]
25-01-14 00:51:58 | I |         sum  error  = [    3.4644]
25-01-14 00:51:58 | I |         best error  = [    3.4644]
25-01-14 00:51:58 | I |     + error = [3.4644]
25-01-14 00:51:58 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:51:59 | I |       - range scale = [    1.0000]
25-01-14 00:51:59 | I |         sum  error  = [    0.2574]
25-01-14 00:51:59 | I |         best error  = [    0.2574]
25-01-14 00:51:59 | I |     + error = [0.2574]
25-01-14 00:51:59 | I |       - range scale = [    1.0000]
25-01-14 00:51:59 | I |         sum  error  = [    0.4306]
25-01-14 00:51:59 | I |         best error  = [    0.4306]
25-01-14 00:51:59 | I |     + error = [0.4306]
25-01-14 00:52:00 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:52:00 | I |       - range scale = [    1.0000]
25-01-14 00:52:00 | I |         sum  error  = [    0.1381]
25-01-14 00:52:00 | I |         best error  = [    0.1381]
25-01-14 00:52:00 | I |     + error = [0.1381]
25-01-14 00:52:01 | I |       - range scale = [    1.0000]
25-01-14 00:52:01 | I |         sum  error  = [    0.4294]
25-01-14 00:52:01 | I |         best error  = [    0.4294]
25-01-14 00:52:01 | I |     + error = [0.4294]
25-01-14 00:52:01 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:52:02 | I |       - range scale = [    1.0000]
25-01-14 00:52:02 | I |         sum  error  = [    0.9404]
25-01-14 00:52:02 | I |         best error  = [    0.9404]
25-01-14 00:52:02 | I |     + error = [0.9404]
25-01-14 00:52:03 | I |       - range scale = [    1.0000]
25-01-14 00:52:03 | I |         sum  error  = [    1.5629]
25-01-14 00:52:03 | I |         best error  = [    1.5629]
25-01-14 00:52:03 | I |     + error = [1.5629]
25-01-14 00:52:03 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:52:04 | I |       - range scale = [    1.0000]
25-01-14 00:52:04 | I |         sum  error  = [    1.0717]
25-01-14 00:52:04 | I |         best error  = [    1.0717]
25-01-14 00:52:04 | I |     + error = [1.0717]
25-01-14 00:52:05 | I |       - range scale = [    1.0000]
25-01-14 00:52:05 | I |         sum  error  = [    1.7782]
25-01-14 00:52:05 | I |         best error  = [    1.7782]
25-01-14 00:52:05 | I |     + error = [1.7782]
25-01-14 00:52:05 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:52:06 | I |       - range scale = [    1.0000]
25-01-14 00:52:06 | I |         sum  error  = [    0.1590]
25-01-14 00:52:06 | I |         best error  = [    0.1590]
25-01-14 00:52:06 | I |     + error = [0.1590]
25-01-14 00:52:07 | I |       - range scale = [    1.0000]
25-01-14 00:52:07 | I |         sum  error  = [    0.2554]
25-01-14 00:52:07 | I |         best error  = [    0.2554]
25-01-14 00:52:07 | I |     + error = [0.2554]
25-01-14 00:52:07 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:52:10 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:52:12 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:52:15 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:52:17 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:52:20 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:52:22 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:52:29 | I | quantizing activations for layer model.layers.0
25-01-14 00:52:29 | I | collecting info in model.layers.0
25-01-14 00:52:29 | I | collecting info in model.layers.0
25-01-14 00:52:29 | I | collecting info in model.layers.0
25-01-14 00:52:29 | I | collecting info in model.layers.0
25-01-14 00:52:29 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:33 | I | forward this layer
25-01-14 00:52:33 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/06.pt
25-01-14 00:52:33 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/06.pt
25-01-14 00:52:33 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 154.94 MiB is free. Process 46094 has 23.54 GiB memory in use. Of the allocated memory 22.31 GiB is allocated by PyTorch, and 763.67 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:52:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 4            |        cudaMalloc retries: 7         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22850 MiB |  23233 MiB |   3191 GiB |   3168 GiB |
|       from large pool |  22846 MiB |  23230 MiB |   3142 GiB |   3120 GiB |
|       from small pool |      4 MiB |      5 MiB |     48 GiB |     48 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22850 MiB |  23233 MiB |   3191 GiB |   3168 GiB |
|       from large pool |  22846 MiB |  23230 MiB |   3142 GiB |   3120 GiB |
|       from small pool |      4 MiB |      5 MiB |     48 GiB |     48 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22850 MiB |  23233 MiB |   3173 GiB |   3151 GiB |
|       from large pool |  22846 MiB |  23230 MiB |   3125 GiB |   3103 GiB |
|       from small pool |      4 MiB |      5 MiB |     48 GiB |     48 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23614 MiB |  23672 MiB | 368982 MiB | 345368 MiB |
|       from large pool |  23608 MiB |  23668 MiB | 368672 MiB | 345064 MiB |
|       from small pool |      6 MiB |      8 MiB |    310 MiB |    304 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 781999 KiB |   1645 MiB |   1098 GiB |   1097 GiB |
|       from large pool | 780032 KiB |   1643 MiB |   1043 GiB |   1043 GiB |
|       from small pool |   1967 KiB |      4 MiB |     54 GiB |     54 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     302    |     320    |     959 K  |     959 K  |
|       from large pool |     200    |     223    |     125 K  |     125 K  |
|       from small pool |     102    |     106    |     833 K  |     833 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     302    |     320    |     959 K  |     959 K  |
|       from large pool |     200    |     223    |     125 K  |     125 K  |
|       from small pool |     102    |     106    |     833 K  |     833 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     178    |    1049    |     874    |
|       from large pool |     172    |     174    |     894    |     722    |
|       from small pool |       3    |       4    |     155    |     152    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |  444512    |  444484    |
|       from large pool |      18    |      24    |   62010    |   61992    |
|       from small pool |      10    |      16    |  382502    |  382492    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:52:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   8630 MiB |   1681 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8614 MiB |   1666 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   8630 MiB |   1681 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8614 MiB |   1666 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   8600 MiB |   1651 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   8584 MiB |   1636 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   8792 MiB |   1842 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8788 MiB |   1840 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 224252 KiB | 222501 KiB |
|       from large pool |      0 KiB |  19104 KiB | 204800 KiB | 204800 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  19452 KiB |  17701 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     290    |     110    |
|       from large pool |     126    |     128    |     196    |      70    |
|       from small pool |      54    |      56    |      94    |      40    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     290    |     110    |
|       from large pool |     126    |     128    |     196    |      70    |
|       from small pool |      54    |      56    |      94    |      40    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     188    |      61    |
|       from large pool |     126    |     128    |     186    |      60    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      12    |      11    |
|       from large pool |       0    |       1    |      10    |      10    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:52:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   8630 MiB |   1681 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8614 MiB |   1666 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   8630 MiB |   1681 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8614 MiB |   1666 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   8600 MiB |   1651 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   8584 MiB |   1636 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   8792 MiB |   1842 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8788 MiB |   1840 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 224252 KiB | 222501 KiB |
|       from large pool |      0 KiB |  19104 KiB | 204800 KiB | 204800 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  19452 KiB |  17701 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     290    |     110    |
|       from large pool |     126    |     128    |     196    |      70    |
|       from small pool |      54    |      56    |      94    |      40    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     290    |     110    |
|       from large pool |     126    |     128    |     196    |      70    |
|       from small pool |      54    |      56    |      94    |      40    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     188    |      61    |
|       from large pool |     126    |     128    |     186    |      60    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      12    |      11    |
|       from large pool |       0    |       1    |      10    |      10    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:52:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   7586 MiB |   1681 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7570 MiB |   1666 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   7586 MiB |   1681 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7570 MiB |   1666 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   7556 MiB |   1651 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   7540 MiB |   1636 MiB |
|       from small pool |      0 MiB |      1 MiB |     15 MiB |     15 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   7748 MiB |   1842 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7744 MiB |   1840 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 224251 KiB | 222707 KiB |
|       from large pool |      0 KiB |  19104 KiB | 204800 KiB | 204800 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  19451 KiB |  17907 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     257    |     109    |
|       from large pool |     100    |     102    |     170    |      70    |
|       from small pool |      48    |      50    |      87    |      39    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     257    |     109    |
|       from large pool |     100    |     102    |     170    |      70    |
|       from small pool |      48    |      50    |      87    |      39    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     162    |      61    |
|       from large pool |     100    |     102    |     160    |      60    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      12    |      11    |
|       from large pool |       0    |       1    |      10    |      10    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:52:33 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:52:33 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:52:33 | I | in layer model.layers.0
25-01-14 00:52:33 | I | quantizing weights for layer model.layers.0
25-01-14 00:52:33 | I | collecting info in model.layers.0
25-01-14 00:52:33 | I | collecting info in model.layers.0
25-01-14 00:52:33 | I | collecting info in model.layers.0
25-01-14 00:52:33 | I | collecting info in model.layers.0
25-01-14 00:52:34 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:34 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:35 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:35 | I | collecting calibration activations in model.layers.0
25-01-14 00:52:36 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:52:36 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:52:37 | I |       - range scale = [    1.0000]
25-01-14 00:52:37 | I |         sum  error  = [    0.4863]
25-01-14 00:52:37 | I |         best error  = [    0.4863]
25-01-14 00:52:37 | I |     + error = [0.4863]
25-01-14 00:52:38 | I |       - range scale = [    1.0000]
25-01-14 00:52:38 | I |         sum  error  = [    0.9443]
25-01-14 00:52:38 | I |         best error  = [    0.9443]
25-01-14 00:52:38 | I |     + error = [0.9443]
25-01-14 00:52:38 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:52:39 | I |       - range scale = [    1.0000]
25-01-14 00:52:39 | I |         sum  error  = [    1.6950]
25-01-14 00:52:39 | I |         best error  = [    1.6950]
25-01-14 00:52:39 | I |     + error = [1.6950]
25-01-14 00:52:40 | I |       - range scale = [    1.0000]
25-01-14 00:52:40 | I |         sum  error  = [    3.8392]
25-01-14 00:52:40 | I |         best error  = [    3.8392]
25-01-14 00:52:40 | I |     + error = [3.8392]
25-01-14 00:52:41 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:52:41 | I |       - range scale = [    1.0000]
25-01-14 00:52:41 | I |         sum  error  = [    0.2571]
25-01-14 00:52:41 | I |         best error  = [    0.2571]
25-01-14 00:52:41 | I |     + error = [0.2571]
25-01-14 00:52:42 | I |       - range scale = [    1.0000]
25-01-14 00:52:42 | I |         sum  error  = [    0.3976]
25-01-14 00:52:42 | I |         best error  = [    0.3976]
25-01-14 00:52:42 | I |     + error = [0.3976]
25-01-14 00:52:42 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:52:43 | I |       - range scale = [    1.0000]
25-01-14 00:52:43 | I |         sum  error  = [    0.1415]
25-01-14 00:52:43 | I |         best error  = [    0.1415]
25-01-14 00:52:43 | I |     + error = [0.1415]
25-01-14 00:52:44 | I |       - range scale = [    1.0000]
25-01-14 00:52:44 | I |         sum  error  = [    0.3527]
25-01-14 00:52:44 | I |         best error  = [    0.3527]
25-01-14 00:52:44 | I |     + error = [0.3527]
25-01-14 00:52:44 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:52:45 | I |       - range scale = [    1.0000]
25-01-14 00:52:45 | I |         sum  error  = [    0.9701]
25-01-14 00:52:45 | I |         best error  = [    0.9701]
25-01-14 00:52:45 | I |     + error = [0.9701]
25-01-14 00:52:46 | I |       - range scale = [    1.0000]
25-01-14 00:52:46 | I |         sum  error  = [    1.4298]
25-01-14 00:52:46 | I |         best error  = [    1.4298]
25-01-14 00:52:46 | I |     + error = [1.4298]
25-01-14 00:52:46 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:52:47 | I |       - range scale = [    1.0000]
25-01-14 00:52:47 | I |         sum  error  = [    1.0915]
25-01-14 00:52:47 | I |         best error  = [    1.0915]
25-01-14 00:52:47 | I |     + error = [1.0915]
25-01-14 00:52:48 | I |       - range scale = [    1.0000]
25-01-14 00:52:48 | I |         sum  error  = [    1.6434]
25-01-14 00:52:48 | I |         best error  = [    1.6434]
25-01-14 00:52:48 | I |     + error = [1.6434]
25-01-14 00:52:48 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:52:49 | I |       - range scale = [    1.0000]
25-01-14 00:52:49 | I |         sum  error  = [    0.1623]
25-01-14 00:52:49 | I |         best error  = [    0.1623]
25-01-14 00:52:49 | I |     + error = [0.1623]
25-01-14 00:52:50 | I |       - range scale = [    1.0000]
25-01-14 00:52:50 | I |         sum  error  = [    0.2329]
25-01-14 00:52:50 | I |         best error  = [    0.2329]
25-01-14 00:52:50 | I |     + error = [0.2329]
25-01-14 00:52:50 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:52:52 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:52:55 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:52:57 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:53:00 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:53:02 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:53:05 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:53:11 | I | quantizing activations for layer model.layers.0
25-01-14 00:53:11 | I | collecting info in model.layers.0
25-01-14 00:53:11 | I | collecting info in model.layers.0
25-01-14 00:53:12 | I | collecting info in model.layers.0
25-01-14 00:53:12 | I | collecting info in model.layers.0
25-01-14 00:53:12 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:13 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:13 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:13 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:16 | I | forward this layer
25-01-14 00:53:16 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/08.pt
25-01-14 00:53:16 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/08.pt
25-01-14 00:53:16 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 156.94 MiB is free. Process 46094 has 23.54 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 912.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:53:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 5            |        cudaMalloc retries: 8         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |   4053 GiB |   4030 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   3994 GiB |   3971 GiB |
|       from small pool |      3 MiB |      5 MiB |     58 GiB |     58 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |   4053 GiB |   4030 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   3994 GiB |   3971 GiB |
|       from small pool |      3 MiB |      5 MiB |     58 GiB |     58 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |   4033 GiB |   4011 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   3975 GiB |   3952 GiB |
|       from small pool |      3 MiB |      5 MiB |     58 GiB |     58 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23612 MiB |  23672 MiB | 435398 MiB | 411786 MiB |
|       from large pool |  23608 MiB |  23668 MiB | 435020 MiB | 411412 MiB |
|       from small pool |      4 MiB |      8 MiB |    378 MiB |    374 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    912 MiB |   1691 MiB |   1535 GiB |   1534 GiB |
|       from large pool |    911 MiB |   1689 MiB |   1469 GiB |   1468 GiB |
|       from small pool |      0 MiB |      4 MiB |     66 GiB |     66 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     297    |     320    |    1171 K  |    1171 K  |
|       from large pool |     188    |     223    |     154 K  |     154 K  |
|       from small pool |     109    |     111    |    1017 K  |    1017 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     297    |     320    |    1171 K  |    1171 K  |
|       from large pool |     188    |     223    |     154 K  |     154 K  |
|       from small pool |     109    |     111    |    1017 K  |    1017 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     174    |     178    |    1192    |    1018    |
|       from large pool |     172    |     174    |    1003    |     831    |
|       from small pool |       2    |       4    |     189    |     187    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |  538314    |  538286    |
|       from large pool |      20    |      24    |   72145    |   72125    |
|       from small pool |       8    |      16    |  466169    |  466161    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:53:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   8966 MiB |   2018 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8948 MiB |   2000 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   8966 MiB |   2018 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8948 MiB |   2000 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   8930 MiB |   1982 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   8912 MiB |   1964 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   9160 MiB |   2210 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9156 MiB |   2208 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 268284 KiB | 266533 KiB |
|       from large pool |      0 KiB |  19104 KiB | 245760 KiB | 245760 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  22524 KiB |  20773 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     310    |     130    |
|       from large pool |     126    |     128    |     210    |      84    |
|       from small pool |      54    |      56    |     100    |      46    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     310    |     130    |
|       from large pool |     126    |     128    |     210    |      84    |
|       from small pool |      54    |      56    |     100    |      46    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     200    |      73    |
|       from large pool |     126    |     128    |     198    |      72    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      14    |      13    |
|       from large pool |       0    |       1    |      12    |      12    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:53:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   8966 MiB |   2018 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8948 MiB |   2000 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   8966 MiB |   2018 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   8948 MiB |   2000 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   8930 MiB |   1982 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   8912 MiB |   1964 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   9160 MiB |   2210 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9156 MiB |   2208 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 268284 KiB | 266533 KiB |
|       from large pool |      0 KiB |  19104 KiB | 245760 KiB | 245760 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  22524 KiB |  20773 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     310    |     130    |
|       from large pool |     126    |     128    |     210    |      84    |
|       from small pool |      54    |      56    |     100    |      46    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     310    |     130    |
|       from large pool |     126    |     128    |     210    |      84    |
|       from small pool |      54    |      56    |     100    |      46    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     200    |      73    |
|       from large pool |     126    |     128    |     198    |      72    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      14    |      13    |
|       from large pool |       0    |       1    |      12    |      12    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:53:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   7922 MiB |   2018 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7904 MiB |   2000 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   7922 MiB |   2018 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   7904 MiB |   2000 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   7886 MiB |   1982 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   7868 MiB |   1964 MiB |
|       from small pool |      0 MiB |      1 MiB |     18 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   8116 MiB |   2210 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8112 MiB |   2208 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 268283 KiB | 266739 KiB |
|       from large pool |      0 KiB |  19104 KiB | 245760 KiB | 245760 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  22523 KiB |  20979 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     277    |     129    |
|       from large pool |     100    |     102    |     184    |      84    |
|       from small pool |      48    |      50    |      93    |      45    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     277    |     129    |
|       from large pool |     100    |     102    |     184    |      84    |
|       from small pool |      48    |      50    |      93    |      45    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     174    |      73    |
|       from large pool |     100    |     102    |     172    |      72    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      14    |      13    |
|       from large pool |       0    |       1    |      12    |      12    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:53:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:53:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:53:16 | I | in layer model.layers.0
25-01-14 00:53:16 | I | quantizing weights for layer model.layers.0
25-01-14 00:53:16 | I | collecting info in model.layers.0
25-01-14 00:53:16 | I | collecting info in model.layers.0
25-01-14 00:53:16 | I | collecting info in model.layers.0
25-01-14 00:53:17 | I | collecting info in model.layers.0
25-01-14 00:53:17 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:18 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:18 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:18 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:19 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:53:19 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:53:20 | I |       - range scale = [    1.0000]
25-01-14 00:53:20 | I |         sum  error  = [    0.4770]
25-01-14 00:53:20 | I |         best error  = [    0.4770]
25-01-14 00:53:20 | I |     + error = [0.4770]
25-01-14 00:53:21 | I |       - range scale = [    1.0000]
25-01-14 00:53:21 | I |         sum  error  = [    0.9919]
25-01-14 00:53:21 | I |         best error  = [    0.9919]
25-01-14 00:53:21 | I |     + error = [0.9919]
25-01-14 00:53:22 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:53:23 | I |       - range scale = [    1.0000]
25-01-14 00:53:23 | I |         sum  error  = [    1.6796]
25-01-14 00:53:23 | I |         best error  = [    1.6796]
25-01-14 00:53:23 | I |     + error = [1.6796]
25-01-14 00:53:24 | I |       - range scale = [    1.0000]
25-01-14 00:53:24 | I |         sum  error  = [    3.0073]
25-01-14 00:53:24 | I |         best error  = [    3.0073]
25-01-14 00:53:24 | I |     + error = [3.0073]
25-01-14 00:53:24 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:53:25 | I |       - range scale = [    1.0000]
25-01-14 00:53:25 | I |         sum  error  = [    0.2459]
25-01-14 00:53:25 | I |         best error  = [    0.2459]
25-01-14 00:53:25 | I |     + error = [0.2459]
25-01-14 00:53:26 | I |       - range scale = [    1.0000]
25-01-14 00:53:26 | I |         sum  error  = [    0.4033]
25-01-14 00:53:26 | I |         best error  = [    0.4033]
25-01-14 00:53:26 | I |     + error = [0.4033]
25-01-14 00:53:26 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:53:27 | I |       - range scale = [    1.0000]
25-01-14 00:53:27 | I |         sum  error  = [    0.1404]
25-01-14 00:53:27 | I |         best error  = [    0.1404]
25-01-14 00:53:27 | I |     + error = [0.1404]
25-01-14 00:53:27 | I |       - range scale = [    1.0000]
25-01-14 00:53:27 | I |         sum  error  = [    0.3193]
25-01-14 00:53:27 | I |         best error  = [    0.3193]
25-01-14 00:53:27 | I |     + error = [0.3193]
25-01-14 00:53:28 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:53:28 | I |       - range scale = [    1.0000]
25-01-14 00:53:28 | I |         sum  error  = [    0.9673]
25-01-14 00:53:28 | I |         best error  = [    0.9673]
25-01-14 00:53:28 | I |     + error = [0.9673]
25-01-14 00:53:29 | I |       - range scale = [    1.0000]
25-01-14 00:53:29 | I |         sum  error  = [    1.4173]
25-01-14 00:53:29 | I |         best error  = [    1.4173]
25-01-14 00:53:29 | I |     + error = [1.4173]
25-01-14 00:53:30 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:53:30 | I |       - range scale = [    1.0000]
25-01-14 00:53:30 | I |         sum  error  = [    1.0870]
25-01-14 00:53:30 | I |         best error  = [    1.0870]
25-01-14 00:53:30 | I |     + error = [1.0870]
25-01-14 00:53:32 | I |       - range scale = [    1.0000]
25-01-14 00:53:32 | I |         sum  error  = [    1.6083]
25-01-14 00:53:32 | I |         best error  = [    1.6083]
25-01-14 00:53:32 | I |     + error = [1.6083]
25-01-14 00:53:32 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:53:32 | I |       - range scale = [    1.0000]
25-01-14 00:53:32 | I |         sum  error  = [    0.1623]
25-01-14 00:53:32 | I |         best error  = [    0.1623]
25-01-14 00:53:32 | I |     + error = [0.1623]
25-01-14 00:53:34 | I |       - range scale = [    1.0000]
25-01-14 00:53:34 | I |         sum  error  = [    0.2322]
25-01-14 00:53:34 | I |         best error  = [    0.2322]
25-01-14 00:53:34 | I |     + error = [0.2322]
25-01-14 00:53:34 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:53:36 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:53:39 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:53:41 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:53:44 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:53:46 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:53:49 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:53:55 | I | quantizing activations for layer model.layers.0
25-01-14 00:53:55 | I | collecting info in model.layers.0
25-01-14 00:53:55 | I | collecting info in model.layers.0
25-01-14 00:53:55 | I | collecting info in model.layers.0
25-01-14 00:53:56 | I | collecting info in model.layers.0
25-01-14 00:53:56 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:56 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:57 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:57 | I | collecting calibration activations in model.layers.0
25-01-14 00:53:59 | I | forward this layer
25-01-14 00:53:59 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/10.pt
25-01-14 00:53:59 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/10.pt
25-01-14 00:54:00 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 164.94 MiB is free. Process 46094 has 23.53 GiB memory in use. Of the allocated memory 22.42 GiB is allocated by PyTorch, and 648.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:54:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 6            |        cudaMalloc retries: 9         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22955 MiB |  23233 MiB |   5000 GiB |   4978 GiB |
|       from large pool |  22952 MiB |  23230 MiB |   4930 GiB |   4908 GiB |
|       from small pool |      3 MiB |      5 MiB |     69 GiB |     69 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22955 MiB |  23233 MiB |   5000 GiB |   4978 GiB |
|       from large pool |  22952 MiB |  23230 MiB |   4930 GiB |   4908 GiB |
|       from small pool |      3 MiB |      5 MiB |     69 GiB |     69 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22955 MiB |  23233 MiB |   4979 GiB |   4957 GiB |
|       from large pool |  22952 MiB |  23230 MiB |   4910 GiB |   4887 GiB |
|       from small pool |      3 MiB |      5 MiB |     69 GiB |     69 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23604 MiB |  23672 MiB | 503584 MiB | 479980 MiB |
|       from large pool |  23600 MiB |  23668 MiB | 503136 MiB | 479536 MiB |
|       from small pool |      4 MiB |      8 MiB |    448 MiB |    444 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 663822 KiB |   1691 MiB |   1951 GiB |   1951 GiB |
|       from large pool | 663296 KiB |   1689 MiB |   1872 GiB |   1871 GiB |
|       from small pool |    526 KiB |      4 MiB |     79 GiB |     79 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     298    |     320    |    1390 K  |    1390 K  |
|       from large pool |     189    |     223    |     184 K  |     183 K  |
|       from small pool |     109    |     111    |    1206 K  |    1206 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     298    |     320    |    1390 K  |    1390 K  |
|       from large pool |     189    |     223    |     184 K  |     183 K  |
|       from small pool |     109    |     111    |    1206 K  |    1206 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     174    |     178    |    1343    |    1169    |
|       from large pool |     172    |     174    |    1119    |     947    |
|       from small pool |       2    |       4    |     224    |     222    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      35    |  634614    |  634588    |
|       from large pool |      18    |      24    |   82688    |   82670    |
|       from small pool |       8    |      16    |  551926    |  551918    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   9302 MiB |   2354 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9281 MiB |   2333 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   9302 MiB |   2354 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9281 MiB |   2333 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   9260 MiB |   2312 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   9239 MiB |   2291 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   9528 MiB |   2578 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9524 MiB |   2576 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 312316 KiB | 310565 KiB |
|       from large pool |      0 KiB |  19104 KiB | 286720 KiB | 286720 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  25596 KiB |  23845 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     330    |     150    |
|       from large pool |     126    |     128    |     224    |      98    |
|       from small pool |      54    |      56    |     106    |      52    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     330    |     150    |
|       from large pool |     126    |     128    |     224    |      98    |
|       from small pool |      54    |      56    |     106    |      52    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     212    |      85    |
|       from large pool |     126    |     128    |     210    |      84    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      16    |      15    |
|       from large pool |       0    |       1    |      14    |      14    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   9302 MiB |   2354 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9281 MiB |   2333 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   9302 MiB |   2354 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9281 MiB |   2333 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   9260 MiB |   2312 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   9239 MiB |   2291 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   9528 MiB |   2578 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9524 MiB |   2576 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 312316 KiB | 310565 KiB |
|       from large pool |      0 KiB |  19104 KiB | 286720 KiB | 286720 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  25596 KiB |  23845 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     330    |     150    |
|       from large pool |     126    |     128    |     224    |      98    |
|       from small pool |      54    |      56    |     106    |      52    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     330    |     150    |
|       from large pool |     126    |     128    |     224    |      98    |
|       from small pool |      54    |      56    |     106    |      52    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     212    |      85    |
|       from large pool |     126    |     128    |     210    |      84    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      16    |      15    |
|       from large pool |       0    |       1    |      14    |      14    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   8259 MiB |   2354 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8237 MiB |   2333 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   8259 MiB |   2354 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8237 MiB |   2333 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   8217 MiB |   2312 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   8195 MiB |   2291 MiB |
|       from small pool |      0 MiB |      1 MiB |     21 MiB |     21 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   8484 MiB |   2578 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8480 MiB |   2576 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 312315 KiB | 310771 KiB |
|       from large pool |      0 KiB |  19104 KiB | 286720 KiB | 286720 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  25595 KiB |  24051 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     297    |     149    |
|       from large pool |     100    |     102    |     198    |      98    |
|       from small pool |      48    |      50    |      99    |      51    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     297    |     149    |
|       from large pool |     100    |     102    |     198    |      98    |
|       from small pool |      48    |      50    |      99    |      51    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     186    |      85    |
|       from large pool |     100    |     102    |     184    |      84    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      16    |      15    |
|       from large pool |       0    |       1    |      14    |      14    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:00 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:54:00 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:54:00 | I | in layer model.layers.0
25-01-14 00:54:00 | I | quantizing weights for layer model.layers.0
25-01-14 00:54:00 | I | collecting info in model.layers.0
25-01-14 00:54:00 | I | collecting info in model.layers.0
25-01-14 00:54:00 | I | collecting info in model.layers.0
25-01-14 00:54:00 | I | collecting info in model.layers.0
25-01-14 00:54:01 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:02 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:02 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:02 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:03 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:54:03 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:54:04 | I |       - range scale = [    1.0000]
25-01-14 00:54:04 | I |         sum  error  = [    0.5080]
25-01-14 00:54:04 | I |         best error  = [    0.5080]
25-01-14 00:54:04 | I |     + error = [0.5080]
25-01-14 00:54:05 | I |       - range scale = [    1.0000]
25-01-14 00:54:05 | I |         sum  error  = [    1.0407]
25-01-14 00:54:05 | I |         best error  = [    1.0407]
25-01-14 00:54:05 | I |     + error = [1.0407]
25-01-14 00:54:06 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:54:07 | I |       - range scale = [    1.0000]
25-01-14 00:54:07 | I |         sum  error  = [    1.7883]
25-01-14 00:54:07 | I |         best error  = [    1.7883]
25-01-14 00:54:07 | I |     + error = [1.7883]
25-01-14 00:54:08 | I |       - range scale = [    1.0000]
25-01-14 00:54:08 | I |         sum  error  = [    3.7829]
25-01-14 00:54:08 | I |         best error  = [    3.7829]
25-01-14 00:54:08 | I |     + error = [3.7829]
25-01-14 00:54:09 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:54:09 | I |       - range scale = [    1.0000]
25-01-14 00:54:09 | I |         sum  error  = [    0.2611]
25-01-14 00:54:09 | I |         best error  = [    0.2611]
25-01-14 00:54:09 | I |     + error = [0.2611]
25-01-14 00:54:10 | I |       - range scale = [    1.0000]
25-01-14 00:54:10 | I |         sum  error  = [    0.4004]
25-01-14 00:54:10 | I |         best error  = [    0.4004]
25-01-14 00:54:10 | I |     + error = [0.4004]
25-01-14 00:54:10 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:54:11 | I |       - range scale = [    1.0000]
25-01-14 00:54:11 | I |         sum  error  = [    0.1426]
25-01-14 00:54:11 | I |         best error  = [    0.1426]
25-01-14 00:54:11 | I |     + error = [0.1426]
25-01-14 00:54:12 | I |       - range scale = [    1.0000]
25-01-14 00:54:12 | I |         sum  error  = [    0.3020]
25-01-14 00:54:12 | I |         best error  = [    0.3020]
25-01-14 00:54:12 | I |     + error = [0.3020]
25-01-14 00:54:12 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:54:13 | I |       - range scale = [    1.0000]
25-01-14 00:54:13 | I |         sum  error  = [    1.0011]
25-01-14 00:54:13 | I |         best error  = [    1.0011]
25-01-14 00:54:13 | I |     + error = [1.0011]
25-01-14 00:54:14 | I |       - range scale = [    1.0000]
25-01-14 00:54:14 | I |         sum  error  = [    1.4147]
25-01-14 00:54:14 | I |         best error  = [    1.4147]
25-01-14 00:54:14 | I |     + error = [1.4147]
25-01-14 00:54:14 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:54:15 | I |       - range scale = [    1.0000]
25-01-14 00:54:15 | I |         sum  error  = [    1.1351]
25-01-14 00:54:15 | I |         best error  = [    1.1351]
25-01-14 00:54:15 | I |     + error = [1.1351]
25-01-14 00:54:16 | I |       - range scale = [    1.0000]
25-01-14 00:54:16 | I |         sum  error  = [    1.6206]
25-01-14 00:54:16 | I |         best error  = [    1.6206]
25-01-14 00:54:16 | I |     + error = [1.6206]
25-01-14 00:54:16 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:54:17 | I |       - range scale = [    1.0000]
25-01-14 00:54:17 | I |         sum  error  = [    0.1676]
25-01-14 00:54:17 | I |         best error  = [    0.1676]
25-01-14 00:54:17 | I |     + error = [0.1676]
25-01-14 00:54:18 | I |       - range scale = [    1.0000]
25-01-14 00:54:18 | I |         sum  error  = [    0.2261]
25-01-14 00:54:18 | I |         best error  = [    0.2261]
25-01-14 00:54:18 | I |     + error = [0.2261]
25-01-14 00:54:18 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:54:21 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:54:23 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:54:26 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:54:28 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:54:30 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:54:33 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:54:40 | I | quantizing activations for layer model.layers.0
25-01-14 00:54:40 | I | collecting info in model.layers.0
25-01-14 00:54:40 | I | collecting info in model.layers.0
25-01-14 00:54:40 | I | collecting info in model.layers.0
25-01-14 00:54:40 | I | collecting info in model.layers.0
25-01-14 00:54:41 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:41 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:42 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:42 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:44 | I | forward this layer
25-01-14 00:54:44 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/12.pt
25-01-14 00:54:44 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/12.pt
25-01-14 00:54:44 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 116.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 952.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:54:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 7            |        cudaMalloc retries: 10        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |   6033 GiB |   6011 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   5952 GiB |   5930 GiB |
|       from small pool |      3 MiB |      5 MiB |     80 GiB |     80 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |   6033 GiB |   6011 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   5952 GiB |   5930 GiB |
|       from small pool |      3 MiB |      5 MiB |     80 GiB |     80 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |   6010 GiB |   5988 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   5930 GiB |   5907 GiB |
|       from small pool |      3 MiB |      5 MiB |     80 GiB |     80 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23652 MiB |  23672 MiB | 576914 MiB | 553262 MiB |
|       from large pool |  23648 MiB |  23668 MiB | 576396 MiB | 552748 MiB |
|       from small pool |      4 MiB |      8 MiB |    518 MiB |    514 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    952 MiB |   1691 MiB |   2416 GiB |   2415 GiB |
|       from large pool |    951 MiB |   1689 MiB |   2324 GiB |   2323 GiB |
|       from small pool |      0 MiB |      4 MiB |     92 GiB |     92 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     320    |    1616 K  |    1616 K  |
|       from large pool |     187    |     223    |     215 K  |     214 K  |
|       from small pool |     109    |     111    |    1401 K  |    1401 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     320    |    1616 K  |    1616 K  |
|       from large pool |     187    |     223    |     215 K  |     214 K  |
|       from small pool |     109    |     111    |    1401 K  |    1401 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    1520    |    1344    |
|       from large pool |     174    |     174    |    1261    |    1087    |
|       from small pool |       2    |       4    |     259    |     257    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |  733446    |  733418    |
|       from large pool |      20    |      24    |   93677    |   93657    |
|       from small pool |       8    |      16    |  639769    |  639761    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   9639 MiB |   2691 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9615 MiB |   2667 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   9639 MiB |   2691 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9615 MiB |   2667 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   9591 MiB |   2643 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   9567 MiB |   2619 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   9896 MiB |   2946 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9892 MiB |   2944 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 356348 KiB | 354597 KiB |
|       from large pool |      0 KiB |  19104 KiB | 327680 KiB | 327680 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  28668 KiB |  26917 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     350    |     170    |
|       from large pool |     126    |     128    |     238    |     112    |
|       from small pool |      54    |      56    |     112    |      58    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     350    |     170    |
|       from large pool |     126    |     128    |     238    |     112    |
|       from small pool |      54    |      56    |     112    |      58    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     224    |      97    |
|       from large pool |     126    |     128    |     222    |      96    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      18    |      17    |
|       from large pool |       0    |       1    |      16    |      16    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   9639 MiB |   2691 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9615 MiB |   2667 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   9639 MiB |   2691 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9615 MiB |   2667 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   9591 MiB |   2643 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   9567 MiB |   2619 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |   9896 MiB |   2946 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9892 MiB |   2944 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 356348 KiB | 354597 KiB |
|       from large pool |      0 KiB |  19104 KiB | 327680 KiB | 327680 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  28668 KiB |  26917 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     350    |     170    |
|       from large pool |     126    |     128    |     238    |     112    |
|       from small pool |      54    |      56    |     112    |      58    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     350    |     170    |
|       from large pool |     126    |     128    |     238    |     112    |
|       from small pool |      54    |      56    |     112    |      58    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     224    |      97    |
|       from large pool |     126    |     128    |     222    |      96    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      18    |      17    |
|       from large pool |       0    |       1    |      16    |      16    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   8595 MiB |   2691 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8571 MiB |   2667 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   8595 MiB |   2691 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8571 MiB |   2667 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   8547 MiB |   2643 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   8523 MiB |   2619 MiB |
|       from small pool |      0 MiB |      1 MiB |     24 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   8852 MiB |   2946 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8848 MiB |   2944 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 356347 KiB | 354803 KiB |
|       from large pool |      0 KiB |  19104 KiB | 327680 KiB | 327680 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  28667 KiB |  27123 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     317    |     169    |
|       from large pool |     100    |     102    |     212    |     112    |
|       from small pool |      48    |      50    |     105    |      57    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     317    |     169    |
|       from large pool |     100    |     102    |     212    |     112    |
|       from small pool |      48    |      50    |     105    |      57    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     198    |      97    |
|       from large pool |     100    |     102    |     196    |      96    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      18    |      17    |
|       from large pool |       0    |       1    |      16    |      16    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:54:44 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:54:45 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:54:45 | I | in layer model.layers.0
25-01-14 00:54:45 | I | quantizing weights for layer model.layers.0
25-01-14 00:54:45 | I | collecting info in model.layers.0
25-01-14 00:54:45 | I | collecting info in model.layers.0
25-01-14 00:54:45 | I | collecting info in model.layers.0
25-01-14 00:54:45 | I | collecting info in model.layers.0
25-01-14 00:54:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:47 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:47 | I | collecting calibration activations in model.layers.0
25-01-14 00:54:48 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:54:48 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:54:49 | I |       - range scale = [    1.0000]
25-01-14 00:54:49 | I |         sum  error  = [    0.5108]
25-01-14 00:54:49 | I |         best error  = [    0.5108]
25-01-14 00:54:49 | I |     + error = [0.5108]
25-01-14 00:54:51 | I |       - range scale = [    1.0000]
25-01-14 00:54:51 | I |         sum  error  = [    1.0855]
25-01-14 00:54:51 | I |         best error  = [    1.0855]
25-01-14 00:54:51 | I |     + error = [1.0855]
25-01-14 00:54:51 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:54:52 | I |       - range scale = [    1.0000]
25-01-14 00:54:52 | I |         sum  error  = [    1.7486]
25-01-14 00:54:52 | I |         best error  = [    1.7486]
25-01-14 00:54:52 | I |     + error = [1.7486]
25-01-14 00:54:54 | I |       - range scale = [    1.0000]
25-01-14 00:54:54 | I |         sum  error  = [    3.2785]
25-01-14 00:54:54 | I |         best error  = [    3.2785]
25-01-14 00:54:54 | I |     + error = [3.2785]
25-01-14 00:54:54 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:54:55 | I |       - range scale = [    1.0000]
25-01-14 00:54:55 | I |         sum  error  = [    0.2631]
25-01-14 00:54:55 | I |         best error  = [    0.2631]
25-01-14 00:54:55 | I |     + error = [0.2631]
25-01-14 00:54:56 | I |       - range scale = [    1.0000]
25-01-14 00:54:56 | I |         sum  error  = [    0.3719]
25-01-14 00:54:56 | I |         best error  = [    0.3719]
25-01-14 00:54:56 | I |     + error = [0.3719]
25-01-14 00:54:56 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:54:56 | I |       - range scale = [    1.0000]
25-01-14 00:54:56 | I |         sum  error  = [    0.1419]
25-01-14 00:54:56 | I |         best error  = [    0.1419]
25-01-14 00:54:56 | I |     + error = [0.1419]
25-01-14 00:54:57 | I |       - range scale = [    1.0000]
25-01-14 00:54:57 | I |         sum  error  = [    0.2621]
25-01-14 00:54:57 | I |         best error  = [    0.2621]
25-01-14 00:54:57 | I |     + error = [0.2621]
25-01-14 00:54:57 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:54:58 | I |       - range scale = [    1.0000]
25-01-14 00:54:58 | I |         sum  error  = [    0.9844]
25-01-14 00:54:58 | I |         best error  = [    0.9844]
25-01-14 00:54:58 | I |     + error = [0.9844]
25-01-14 00:54:59 | I |       - range scale = [    1.0000]
25-01-14 00:54:59 | I |         sum  error  = [    1.3815]
25-01-14 00:54:59 | I |         best error  = [    1.3815]
25-01-14 00:54:59 | I |     + error = [1.3815]
25-01-14 00:54:59 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:55:00 | I |       - range scale = [    1.0000]
25-01-14 00:55:00 | I |         sum  error  = [    1.1210]
25-01-14 00:55:00 | I |         best error  = [    1.1210]
25-01-14 00:55:00 | I |     + error = [1.1210]
25-01-14 00:55:01 | I |       - range scale = [    1.0000]
25-01-14 00:55:01 | I |         sum  error  = [    1.5759]
25-01-14 00:55:01 | I |         best error  = [    1.5759]
25-01-14 00:55:01 | I |     + error = [1.5759]
25-01-14 00:55:02 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:55:02 | I |       - range scale = [    1.0000]
25-01-14 00:55:02 | I |         sum  error  = [    0.1651]
25-01-14 00:55:02 | I |         best error  = [    0.1651]
25-01-14 00:55:02 | I |     + error = [0.1651]
25-01-14 00:55:03 | I |       - range scale = [    1.0000]
25-01-14 00:55:03 | I |         sum  error  = [    0.2240]
25-01-14 00:55:03 | I |         best error  = [    0.2240]
25-01-14 00:55:03 | I |     + error = [0.2240]
25-01-14 00:55:04 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:55:06 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:55:09 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:55:11 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:55:14 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:55:16 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:55:18 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:55:25 | I | quantizing activations for layer model.layers.0
25-01-14 00:55:25 | I | collecting info in model.layers.0
25-01-14 00:55:25 | I | collecting info in model.layers.0
25-01-14 00:55:25 | I | collecting info in model.layers.0
25-01-14 00:55:25 | I | collecting info in model.layers.0
25-01-14 00:55:26 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:27 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:27 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:27 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:30 | I | forward this layer
25-01-14 00:55:30 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/14.pt
25-01-14 00:55:30 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/14.pt
25-01-14 00:55:30 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 120.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 948.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:55:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 8            |        cudaMalloc retries: 11        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |   7151 GiB |   7129 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   7059 GiB |   7037 GiB |
|       from small pool |      3 MiB |      5 MiB |     92 GiB |     92 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |   7151 GiB |   7129 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   7059 GiB |   7037 GiB |
|       from small pool |      3 MiB |      5 MiB |     92 GiB |     92 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |   7127 GiB |   7104 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   7035 GiB |   7012 GiB |
|       from small pool |      3 MiB |      5 MiB |     92 GiB |     92 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23648 MiB |  23672 MiB | 647564 MiB | 623916 MiB |
|       from large pool |  23644 MiB |  23668 MiB | 646976 MiB | 623332 MiB |
|       from small pool |      4 MiB |      8 MiB |    588 MiB |    584 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    948 MiB |   1691 MiB |   2922 GiB |   2921 GiB |
|       from large pool |    947 MiB |   1689 MiB |   2816 GiB |   2815 GiB |
|       from small pool |      0 MiB |      4 MiB |    105 GiB |    105 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     320    |    1850 K  |    1850 K  |
|       from large pool |     187    |     223    |     247 K  |     247 K  |
|       from small pool |     109    |     111    |    1602 K  |    1602 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     320    |    1850 K  |    1850 K  |
|       from large pool |     187    |     223    |     247 K  |     247 K  |
|       from small pool |     109    |     111    |    1602 K  |    1602 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    1684    |    1508    |
|       from large pool |     174    |     174    |    1390    |    1216    |
|       from small pool |       2    |       4    |     294    |     292    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |     835 K  |     835 K  |
|       from large pool |      20    |      24    |     105 K  |     105 K  |
|       from small pool |       8    |      16    |     729 K  |     729 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:55:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   9975 MiB |   3027 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9948 MiB |   3000 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   9975 MiB |   3027 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9948 MiB |   3000 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   9921 MiB |   2973 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   9894 MiB |   2946 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  10264 MiB |   3314 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10260 MiB |   3312 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 400380 KiB | 398629 KiB |
|       from large pool |      0 KiB |  19104 KiB | 368640 KiB | 368640 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  31740 KiB |  29989 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     370    |     190    |
|       from large pool |     126    |     128    |     252    |     126    |
|       from small pool |      54    |      56    |     118    |      64    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     370    |     190    |
|       from large pool |     126    |     128    |     252    |     126    |
|       from small pool |      54    |      56    |     118    |      64    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     236    |     109    |
|       from large pool |     126    |     128    |     234    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      20    |      19    |
|       from large pool |       0    |       1    |      18    |      18    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:55:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |   9975 MiB |   3027 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9948 MiB |   3000 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |   9975 MiB |   3027 MiB |
|       from large pool |   6948 MiB |   7036 MiB |   9948 MiB |   3000 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |   9921 MiB |   2973 MiB |
|       from large pool |   6948 MiB |   7034 MiB |   9894 MiB |   2946 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  10264 MiB |   3314 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10260 MiB |   3312 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 400380 KiB | 398629 KiB |
|       from large pool |      0 KiB |  19104 KiB | 368640 KiB | 368640 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  31740 KiB |  29989 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     370    |     190    |
|       from large pool |     126    |     128    |     252    |     126    |
|       from small pool |      54    |      56    |     118    |      64    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     370    |     190    |
|       from large pool |     126    |     128    |     252    |     126    |
|       from small pool |      54    |      56    |     118    |      64    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     236    |     109    |
|       from large pool |     126    |     128    |     234    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      20    |      19    |
|       from large pool |       0    |       1    |      18    |      18    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:55:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   8931 MiB |   3027 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8904 MiB |   3000 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   8931 MiB |   3027 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   8904 MiB |   3000 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   8877 MiB |   2973 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   8850 MiB |   2946 MiB |
|       from small pool |      0 MiB |      1 MiB |     27 MiB |     27 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   9220 MiB |   3314 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9216 MiB |   3312 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 400379 KiB | 398835 KiB |
|       from large pool |      0 KiB |  19104 KiB | 368640 KiB | 368640 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  31739 KiB |  30195 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     337    |     189    |
|       from large pool |     100    |     102    |     226    |     126    |
|       from small pool |      48    |      50    |     111    |      63    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     337    |     189    |
|       from large pool |     100    |     102    |     226    |     126    |
|       from small pool |      48    |      50    |     111    |      63    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     210    |     109    |
|       from large pool |     100    |     102    |     208    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      20    |      19    |
|       from large pool |       0    |       1    |      18    |      18    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:55:30 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:55:30 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:55:30 | I | in layer model.layers.0
25-01-14 00:55:30 | I | quantizing weights for layer model.layers.0
25-01-14 00:55:30 | I | collecting info in model.layers.0
25-01-14 00:55:30 | I | collecting info in model.layers.0
25-01-14 00:55:31 | I | collecting info in model.layers.0
25-01-14 00:55:31 | I | collecting info in model.layers.0
25-01-14 00:55:32 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:32 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:32 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:33 | I | collecting calibration activations in model.layers.0
25-01-14 00:55:33 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:55:33 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:55:35 | I |       - range scale = [    1.0000]
25-01-14 00:55:35 | I |         sum  error  = [    0.5115]
25-01-14 00:55:35 | I |         best error  = [    0.5115]
25-01-14 00:55:35 | I |     + error = [0.5115]
25-01-14 00:55:36 | I |       - range scale = [    1.0000]
25-01-14 00:55:36 | I |         sum  error  = [    1.0907]
25-01-14 00:55:36 | I |         best error  = [    1.0907]
25-01-14 00:55:36 | I |     + error = [1.0907]
25-01-14 00:55:37 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:55:38 | I |       - range scale = [    1.0000]
25-01-14 00:55:38 | I |         sum  error  = [    1.7551]
25-01-14 00:55:38 | I |         best error  = [    1.7551]
25-01-14 00:55:38 | I |     + error = [1.7551]
25-01-14 00:55:40 | I |       - range scale = [    1.0000]
25-01-14 00:55:40 | I |         sum  error  = [    3.5351]
25-01-14 00:55:40 | I |         best error  = [    3.5351]
25-01-14 00:55:40 | I |     + error = [3.5351]
25-01-14 00:55:40 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:55:41 | I |       - range scale = [    1.0000]
25-01-14 00:55:41 | I |         sum  error  = [    0.2569]
25-01-14 00:55:41 | I |         best error  = [    0.2569]
25-01-14 00:55:41 | I |     + error = [0.2569]
25-01-14 00:55:41 | I |       - range scale = [    1.0000]
25-01-14 00:55:41 | I |         sum  error  = [    0.3835]
25-01-14 00:55:41 | I |         best error  = [    0.3835]
25-01-14 00:55:41 | I |     + error = [0.3835]
25-01-14 00:55:42 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:55:42 | I |       - range scale = [    1.0000]
25-01-14 00:55:42 | I |         sum  error  = [    0.1464]
25-01-14 00:55:42 | I |         best error  = [    0.1464]
25-01-14 00:55:42 | I |     + error = [0.1464]
25-01-14 00:55:43 | I |       - range scale = [    1.0000]
25-01-14 00:55:43 | I |         sum  error  = [    0.2568]
25-01-14 00:55:43 | I |         best error  = [    0.2568]
25-01-14 00:55:43 | I |     + error = [0.2568]
25-01-14 00:55:43 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:55:44 | I |       - range scale = [    1.0000]
25-01-14 00:55:44 | I |         sum  error  = [    0.9788]
25-01-14 00:55:44 | I |         best error  = [    0.9788]
25-01-14 00:55:44 | I |     + error = [0.9788]
25-01-14 00:55:45 | I |       - range scale = [    1.0000]
25-01-14 00:55:45 | I |         sum  error  = [    1.3475]
25-01-14 00:55:45 | I |         best error  = [    1.3475]
25-01-14 00:55:45 | I |     + error = [1.3475]
25-01-14 00:55:45 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:55:46 | I |       - range scale = [    1.0000]
25-01-14 00:55:46 | I |         sum  error  = [    1.1156]
25-01-14 00:55:46 | I |         best error  = [    1.1156]
25-01-14 00:55:46 | I |     + error = [1.1156]
25-01-14 00:55:47 | I |       - range scale = [    1.0000]
25-01-14 00:55:47 | I |         sum  error  = [    1.5292]
25-01-14 00:55:47 | I |         best error  = [    1.5292]
25-01-14 00:55:47 | I |     + error = [1.5292]
25-01-14 00:55:47 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:55:48 | I |       - range scale = [    1.0000]
25-01-14 00:55:48 | I |         sum  error  = [    0.1672]
25-01-14 00:55:48 | I |         best error  = [    0.1672]
25-01-14 00:55:48 | I |     + error = [0.1672]
25-01-14 00:55:49 | I |       - range scale = [    1.0000]
25-01-14 00:55:49 | I |         sum  error  = [    0.2185]
25-01-14 00:55:49 | I |         best error  = [    0.2185]
25-01-14 00:55:49 | I |     + error = [0.2185]
25-01-14 00:55:49 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:55:52 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:55:54 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:55:57 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:55:59 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:56:02 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:56:04 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:56:10 | I | quantizing activations for layer model.layers.0
25-01-14 00:56:10 | I | collecting info in model.layers.0
25-01-14 00:56:11 | I | collecting info in model.layers.0
25-01-14 00:56:11 | I | collecting info in model.layers.0
25-01-14 00:56:11 | I | collecting info in model.layers.0
25-01-14 00:56:12 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:12 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:13 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:13 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:15 | I | forward this layer
25-01-14 00:56:15 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/16.pt
25-01-14 00:56:15 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/16.pt
25-01-14 00:56:16 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:56:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 9            |        cudaMalloc retries: 12        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |   8355 GiB |   8333 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   8251 GiB |   8228 GiB |
|       from small pool |      3 MiB |      5 MiB |    104 GiB |    104 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |   8355 GiB |   8333 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   8251 GiB |   8228 GiB |
|       from small pool |      3 MiB |      5 MiB |    104 GiB |    104 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |   8328 GiB |   8306 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   8225 GiB |   8202 GiB |
|       from small pool |      3 MiB |      5 MiB |    103 GiB |    103 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB | 716954 MiB | 693310 MiB |
|       from large pool |  23640 MiB |  23668 MiB | 716296 MiB | 692656 MiB |
|       from small pool |      4 MiB |      8 MiB |    658 MiB |    654 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   3484 GiB |   3483 GiB |
|       from large pool |    943 MiB |   1689 MiB |   3365 GiB |   3364 GiB |
|       from small pool |      0 MiB |      4 MiB |    119 GiB |    119 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     320    |    2091 K  |    2090 K  |
|       from large pool |     187    |     223    |     281 K  |     281 K  |
|       from small pool |     109    |     111    |    1809 K  |    1809 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     320    |    2091 K  |    2090 K  |
|       from large pool |     187    |     223    |     281 K  |     281 K  |
|       from small pool |     109    |     111    |    1809 K  |    1809 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    1842    |    1666    |
|       from large pool |     174    |     174    |    1513    |    1339    |
|       from small pool |       2    |       4    |     329    |     327    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |     938 K  |     938 K  |
|       from large pool |      21    |      24    |     117 K  |     117 K  |
|       from small pool |       8    |      16    |     821 K  |     821 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:56:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  10312 MiB |   3363 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10281 MiB |   3333 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  10312 MiB |   3363 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10281 MiB |   3333 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  10252 MiB |   3303 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  10221 MiB |   3273 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  10632 MiB |   3682 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10628 MiB |   3680 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 444412 KiB | 442661 KiB |
|       from large pool |      0 KiB |  19104 KiB | 409600 KiB | 409600 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  34812 KiB |  33061 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     390    |     210    |
|       from large pool |     126    |     128    |     266    |     140    |
|       from small pool |      54    |      56    |     124    |      70    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     390    |     210    |
|       from large pool |     126    |     128    |     266    |     140    |
|       from small pool |      54    |      56    |     124    |      70    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     248    |     121    |
|       from large pool |     126    |     128    |     246    |     120    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      22    |      21    |
|       from large pool |       0    |       1    |      20    |      20    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:56:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  10312 MiB |   3363 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10281 MiB |   3333 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  10312 MiB |   3363 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10281 MiB |   3333 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  10252 MiB |   3303 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  10221 MiB |   3273 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  10632 MiB |   3682 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10628 MiB |   3680 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 444412 KiB | 442661 KiB |
|       from large pool |      0 KiB |  19104 KiB | 409600 KiB | 409600 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  34812 KiB |  33061 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     390    |     210    |
|       from large pool |     126    |     128    |     266    |     140    |
|       from small pool |      54    |      56    |     124    |      70    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     390    |     210    |
|       from large pool |     126    |     128    |     266    |     140    |
|       from small pool |      54    |      56    |     124    |      70    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     248    |     121    |
|       from large pool |     126    |     128    |     246    |     120    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      22    |      21    |
|       from large pool |       0    |       1    |      20    |      20    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:56:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   9268 MiB |   3363 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9237 MiB |   3333 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   9268 MiB |   3363 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9237 MiB |   3333 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   9208 MiB |   3303 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   9177 MiB |   3273 MiB |
|       from small pool |      0 MiB |      1 MiB |     30 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   9588 MiB |   3682 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9584 MiB |   3680 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 444411 KiB | 442867 KiB |
|       from large pool |      0 KiB |  19104 KiB | 409600 KiB | 409600 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  34811 KiB |  33267 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     357    |     209    |
|       from large pool |     100    |     102    |     240    |     140    |
|       from small pool |      48    |      50    |     117    |      69    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     357    |     209    |
|       from large pool |     100    |     102    |     240    |     140    |
|       from small pool |      48    |      50    |     117    |      69    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     222    |     121    |
|       from large pool |     100    |     102    |     220    |     120    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      22    |      21    |
|       from large pool |       0    |       1    |      20    |      20    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:56:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:56:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:56:16 | I | in layer model.layers.0
25-01-14 00:56:16 | I | quantizing weights for layer model.layers.0
25-01-14 00:56:16 | I | collecting info in model.layers.0
25-01-14 00:56:16 | I | collecting info in model.layers.0
25-01-14 00:56:17 | I | collecting info in model.layers.0
25-01-14 00:56:17 | I | collecting info in model.layers.0
25-01-14 00:56:18 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:18 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:18 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:19 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:19 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:56:19 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:56:21 | I |       - range scale = [    1.0000]
25-01-14 00:56:21 | I |         sum  error  = [    0.5547]
25-01-14 00:56:21 | I |         best error  = [    0.5547]
25-01-14 00:56:21 | I |     + error = [0.5547]
25-01-14 00:56:23 | I |       - range scale = [    1.0000]
25-01-14 00:56:23 | I |         sum  error  = [    1.1734]
25-01-14 00:56:23 | I |         best error  = [    1.1734]
25-01-14 00:56:23 | I |     + error = [1.1734]
25-01-14 00:56:23 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:56:24 | I |       - range scale = [    1.0000]
25-01-14 00:56:24 | I |         sum  error  = [    1.7193]
25-01-14 00:56:24 | I |         best error  = [    1.7193]
25-01-14 00:56:25 | I |     + error = [1.7193]
25-01-14 00:56:26 | I |       - range scale = [    1.0000]
25-01-14 00:56:26 | I |         sum  error  = [    3.3343]
25-01-14 00:56:26 | I |         best error  = [    3.3343]
25-01-14 00:56:26 | I |     + error = [3.3343]
25-01-14 00:56:26 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:56:27 | I |       - range scale = [    1.0000]
25-01-14 00:56:27 | I |         sum  error  = [    0.2368]
25-01-14 00:56:27 | I |         best error  = [    0.2368]
25-01-14 00:56:27 | I |     + error = [0.2368]
25-01-14 00:56:28 | I |       - range scale = [    1.0000]
25-01-14 00:56:28 | I |         sum  error  = [    0.3225]
25-01-14 00:56:28 | I |         best error  = [    0.3225]
25-01-14 00:56:28 | I |     + error = [0.3225]
25-01-14 00:56:28 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:56:29 | I |       - range scale = [    1.0000]
25-01-14 00:56:29 | I |         sum  error  = [    0.1415]
25-01-14 00:56:29 | I |         best error  = [    0.1415]
25-01-14 00:56:29 | I |     + error = [0.1415]
25-01-14 00:56:30 | I |       - range scale = [    1.0000]
25-01-14 00:56:30 | I |         sum  error  = [    0.2467]
25-01-14 00:56:30 | I |         best error  = [    0.2467]
25-01-14 00:56:30 | I |     + error = [0.2467]
25-01-14 00:56:30 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:56:31 | I |       - range scale = [    1.0000]
25-01-14 00:56:31 | I |         sum  error  = [    0.9050]
25-01-14 00:56:31 | I |         best error  = [    0.9050]
25-01-14 00:56:31 | I |     + error = [0.9050]
25-01-14 00:56:32 | I |       - range scale = [    1.0000]
25-01-14 00:56:32 | I |         sum  error  = [    1.2493]
25-01-14 00:56:32 | I |         best error  = [    1.2493]
25-01-14 00:56:32 | I |     + error = [1.2493]
25-01-14 00:56:32 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:56:33 | I |       - range scale = [    1.0000]
25-01-14 00:56:33 | I |         sum  error  = [    1.0361]
25-01-14 00:56:33 | I |         best error  = [    1.0361]
25-01-14 00:56:33 | I |     + error = [1.0361]
25-01-14 00:56:34 | I |       - range scale = [    1.0000]
25-01-14 00:56:34 | I |         sum  error  = [    1.4209]
25-01-14 00:56:34 | I |         best error  = [    1.4209]
25-01-14 00:56:34 | I |     + error = [1.4209]
25-01-14 00:56:34 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:56:35 | I |       - range scale = [    1.0000]
25-01-14 00:56:35 | I |         sum  error  = [    0.1668]
25-01-14 00:56:35 | I |         best error  = [    0.1668]
25-01-14 00:56:35 | I |     + error = [0.1668]
25-01-14 00:56:36 | I |       - range scale = [    1.0000]
25-01-14 00:56:36 | I |         sum  error  = [    0.2023]
25-01-14 00:56:36 | I |         best error  = [    0.2023]
25-01-14 00:56:36 | I |     + error = [0.2023]
25-01-14 00:56:36 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:56:38 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:56:41 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:56:43 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:56:46 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:56:48 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:56:50 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:56:57 | I | quantizing activations for layer model.layers.0
25-01-14 00:56:57 | I | collecting info in model.layers.0
25-01-14 00:56:57 | I | collecting info in model.layers.0
25-01-14 00:56:57 | I | collecting info in model.layers.0
25-01-14 00:56:57 | I | collecting info in model.layers.0
25-01-14 00:56:58 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:59 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:59 | I | collecting calibration activations in model.layers.0
25-01-14 00:56:59 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:02 | I | forward this layer
25-01-14 00:57:02 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/18.pt
25-01-14 00:57:02 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/18.pt
25-01-14 00:57:02 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:57:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 10           |        cudaMalloc retries: 13        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |   9644 GiB |   9622 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   9527 GiB |   9505 GiB |
|       from small pool |      3 MiB |      5 MiB |    116 GiB |    116 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |   9644 GiB |   9622 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   9527 GiB |   9505 GiB |
|       from small pool |      3 MiB |      5 MiB |    116 GiB |    116 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |   9616 GiB |   9594 GiB |
|       from large pool |  22696 MiB |  23230 MiB |   9500 GiB |   9478 GiB |
|       from small pool |      3 MiB |      5 MiB |    115 GiB |    115 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |    769 GiB | 763960 MiB |
|       from large pool |  23640 MiB |  23668 MiB |    768 GiB | 763236 MiB |
|       from small pool |      4 MiB |      8 MiB |      0 GiB |    724 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   4090 GiB |   4089 GiB |
|       from large pool |    943 MiB |   1689 MiB |   3957 GiB |   3956 GiB |
|       from small pool |      0 MiB |      4 MiB |    133 GiB |    133 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     320    |    2339 K  |    2338 K  |
|       from large pool |     187    |     223    |     316 K  |     316 K  |
|       from small pool |     109    |     111    |    2022 K  |    2022 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     320    |    2339 K  |    2338 K  |
|       from large pool |     187    |     223    |     316 K  |     316 K  |
|       from small pool |     109    |     111    |    2022 K  |    2022 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2006    |    1830    |
|       from large pool |     174    |     174    |    1642    |    1468    |
|       from small pool |       2    |       4    |     364    |     362    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    1044 K  |    1044 K  |
|       from large pool |      20    |      24    |     128 K  |     128 K  |
|       from small pool |       8    |      16    |     915 K  |     915 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  10648 MiB |   3700 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10615 MiB |   3667 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  10648 MiB |   3700 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10615 MiB |   3667 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  10582 MiB |   3634 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  10549 MiB |   3601 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  11000 MiB |   4050 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10996 MiB |   4048 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 488444 KiB | 486693 KiB |
|       from large pool |      0 KiB |  19104 KiB | 450560 KiB | 450560 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  37884 KiB |  36133 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     410    |     230    |
|       from large pool |     126    |     128    |     280    |     154    |
|       from small pool |      54    |      56    |     130    |      76    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     410    |     230    |
|       from large pool |     126    |     128    |     280    |     154    |
|       from small pool |      54    |      56    |     130    |      76    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     260    |     133    |
|       from large pool |     126    |     128    |     258    |     132    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      24    |      23    |
|       from large pool |       0    |       1    |      22    |      22    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  10648 MiB |   3700 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10615 MiB |   3667 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  10648 MiB |   3700 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10615 MiB |   3667 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  10582 MiB |   3634 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  10549 MiB |   3601 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  11000 MiB |   4050 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10996 MiB |   4048 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 488444 KiB | 486693 KiB |
|       from large pool |      0 KiB |  19104 KiB | 450560 KiB | 450560 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  37884 KiB |  36133 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     410    |     230    |
|       from large pool |     126    |     128    |     280    |     154    |
|       from small pool |      54    |      56    |     130    |      76    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     410    |     230    |
|       from large pool |     126    |     128    |     280    |     154    |
|       from small pool |      54    |      56    |     130    |      76    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     260    |     133    |
|       from large pool |     126    |     128    |     258    |     132    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      24    |      23    |
|       from large pool |       0    |       1    |      22    |      22    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   9604 MiB |   3700 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9571 MiB |   3667 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   9604 MiB |   3700 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9571 MiB |   3667 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   9538 MiB |   3634 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   9505 MiB |   3601 MiB |
|       from small pool |      0 MiB |      1 MiB |     33 MiB |     33 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |   9956 MiB |   4050 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9952 MiB |   4048 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 488443 KiB | 486899 KiB |
|       from large pool |      0 KiB |  19104 KiB | 450560 KiB | 450560 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  37883 KiB |  36339 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     377    |     229    |
|       from large pool |     100    |     102    |     254    |     154    |
|       from small pool |      48    |      50    |     123    |      75    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     377    |     229    |
|       from large pool |     100    |     102    |     254    |     154    |
|       from small pool |      48    |      50    |     123    |      75    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     234    |     133    |
|       from large pool |     100    |     102    |     232    |     132    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      24    |      23    |
|       from large pool |       0    |       1    |      22    |      22    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:02 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:57:02 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:57:02 | I | in layer model.layers.0
25-01-14 00:57:02 | I | quantizing weights for layer model.layers.0
25-01-14 00:57:02 | I | collecting info in model.layers.0
25-01-14 00:57:03 | I | collecting info in model.layers.0
25-01-14 00:57:03 | I | collecting info in model.layers.0
25-01-14 00:57:03 | I | collecting info in model.layers.0
25-01-14 00:57:04 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:04 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:05 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:05 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:06 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:57:06 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:57:07 | I |       - range scale = [    1.0000]
25-01-14 00:57:07 | I |         sum  error  = [    0.5080]
25-01-14 00:57:07 | I |         best error  = [    0.5080]
25-01-14 00:57:07 | I |     + error = [0.5080]
25-01-14 00:57:09 | I |       - range scale = [    1.0000]
25-01-14 00:57:09 | I |         sum  error  = [    1.1527]
25-01-14 00:57:09 | I |         best error  = [    1.1527]
25-01-14 00:57:09 | I |     + error = [1.1527]
25-01-14 00:57:09 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:57:11 | I |       - range scale = [    1.0000]
25-01-14 00:57:11 | I |         sum  error  = [    1.8170]
25-01-14 00:57:11 | I |         best error  = [    1.8170]
25-01-14 00:57:11 | I |     + error = [1.8170]
25-01-14 00:57:13 | I |       - range scale = [    1.0000]
25-01-14 00:57:13 | I |         sum  error  = [    3.4909]
25-01-14 00:57:13 | I |         best error  = [    3.4909]
25-01-14 00:57:13 | I |     + error = [3.4909]
25-01-14 00:57:13 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:57:14 | I |       - range scale = [    1.0000]
25-01-14 00:57:14 | I |         sum  error  = [    0.2535]
25-01-14 00:57:14 | I |         best error  = [    0.2535]
25-01-14 00:57:14 | I |     + error = [0.2535]
25-01-14 00:57:14 | I |       - range scale = [    1.0000]
25-01-14 00:57:14 | I |         sum  error  = [    0.3493]
25-01-14 00:57:14 | I |         best error  = [    0.3493]
25-01-14 00:57:14 | I |     + error = [0.3493]
25-01-14 00:57:15 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:57:15 | I |       - range scale = [    1.0000]
25-01-14 00:57:15 | I |         sum  error  = [    0.1415]
25-01-14 00:57:15 | I |         best error  = [    0.1415]
25-01-14 00:57:15 | I |     + error = [0.1415]
25-01-14 00:57:16 | I |       - range scale = [    1.0000]
25-01-14 00:57:16 | I |         sum  error  = [    0.2442]
25-01-14 00:57:16 | I |         best error  = [    0.2442]
25-01-14 00:57:16 | I |     + error = [0.2442]
25-01-14 00:57:16 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:57:17 | I |       - range scale = [    1.0000]
25-01-14 00:57:17 | I |         sum  error  = [    0.9686]
25-01-14 00:57:17 | I |         best error  = [    0.9686]
25-01-14 00:57:17 | I |     + error = [0.9686]
25-01-14 00:57:18 | I |       - range scale = [    1.0000]
25-01-14 00:57:18 | I |         sum  error  = [    1.3576]
25-01-14 00:57:18 | I |         best error  = [    1.3576]
25-01-14 00:57:18 | I |     + error = [1.3576]
25-01-14 00:57:18 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:57:19 | I |       - range scale = [    1.0000]
25-01-14 00:57:19 | I |         sum  error  = [    1.0921]
25-01-14 00:57:19 | I |         best error  = [    1.0921]
25-01-14 00:57:19 | I |     + error = [1.0921]
25-01-14 00:57:20 | I |       - range scale = [    1.0000]
25-01-14 00:57:20 | I |         sum  error  = [    1.5321]
25-01-14 00:57:20 | I |         best error  = [    1.5321]
25-01-14 00:57:20 | I |     + error = [1.5321]
25-01-14 00:57:20 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:57:21 | I |       - range scale = [    1.0000]
25-01-14 00:57:21 | I |         sum  error  = [    0.1694]
25-01-14 00:57:21 | I |         best error  = [    0.1694]
25-01-14 00:57:21 | I |     + error = [0.1694]
25-01-14 00:57:22 | I |       - range scale = [    1.0000]
25-01-14 00:57:22 | I |         sum  error  = [    0.2268]
25-01-14 00:57:22 | I |         best error  = [    0.2268]
25-01-14 00:57:22 | I |     + error = [0.2268]
25-01-14 00:57:22 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:57:25 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:57:27 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:57:30 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:57:32 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:57:35 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:57:37 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:57:43 | I | quantizing activations for layer model.layers.0
25-01-14 00:57:43 | I | collecting info in model.layers.0
25-01-14 00:57:44 | I | collecting info in model.layers.0
25-01-14 00:57:44 | I | collecting info in model.layers.0
25-01-14 00:57:44 | I | collecting info in model.layers.0
25-01-14 00:57:45 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:45 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:46 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:49 | I | forward this layer
25-01-14 00:57:49 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/20.pt
25-01-14 00:57:49 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/20.pt
25-01-14 00:57:49 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:57:49 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 11           |        cudaMalloc retries: 14        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  11018 GiB |  10996 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  10889 GiB |  10867 GiB |
|       from small pool |      3 MiB |      5 MiB |    128 GiB |    128 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  11018 GiB |  10996 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  10889 GiB |  10867 GiB |
|       from small pool |      3 MiB |      5 MiB |    128 GiB |    128 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  10988 GiB |  10966 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  10860 GiB |  10838 GiB |
|       from small pool |      3 MiB |      5 MiB |    128 GiB |    128 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |    836 GiB |    813 GiB |
|       from large pool |  23640 MiB |  23668 MiB |    836 GiB |    813 GiB |
|       from small pool |      4 MiB |      8 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   4754 GiB |   4753 GiB |
|       from large pool |    943 MiB |   1689 MiB |   4606 GiB |   4605 GiB |
|       from small pool |      0 MiB |      4 MiB |    147 GiB |    147 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     320    |    2594 K  |    2593 K  |
|       from large pool |     187    |     223    |     352 K  |     352 K  |
|       from small pool |     109    |     111    |    2241 K  |    2241 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     320    |    2594 K  |    2593 K  |
|       from large pool |     187    |     223    |     352 K  |     352 K  |
|       from small pool |     109    |     111    |    2241 K  |    2241 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2164    |    1988    |
|       from large pool |     174    |     174    |    1765    |    1591    |
|       from small pool |       2    |       4    |     399    |     397    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    1153 K  |    1153 K  |
|       from large pool |      21    |      24    |     141 K  |     141 K  |
|       from small pool |       8    |      16    |    1011 K  |    1011 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:49 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  10984 MiB |   4036 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10948 MiB |   4000 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  10984 MiB |   4036 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10948 MiB |   4000 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  10912 MiB |   3964 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  10876 MiB |   3928 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  11368 MiB |   4418 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11364 MiB |   4416 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 532476 KiB | 530725 KiB |
|       from large pool |      0 KiB |  19104 KiB | 491520 KiB | 491520 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  40956 KiB |  39205 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     430    |     250    |
|       from large pool |     126    |     128    |     294    |     168    |
|       from small pool |      54    |      56    |     136    |      82    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     430    |     250    |
|       from large pool |     126    |     128    |     294    |     168    |
|       from small pool |      54    |      56    |     136    |      82    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     272    |     145    |
|       from large pool |     126    |     128    |     270    |     144    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      26    |      25    |
|       from large pool |       0    |       1    |      24    |      24    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:49 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  10984 MiB |   4036 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10948 MiB |   4000 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  10984 MiB |   4036 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  10948 MiB |   4000 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  10912 MiB |   3964 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  10876 MiB |   3928 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  11368 MiB |   4418 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11364 MiB |   4416 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 532476 KiB | 530725 KiB |
|       from large pool |      0 KiB |  19104 KiB | 491520 KiB | 491520 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  40956 KiB |  39205 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     430    |     250    |
|       from large pool |     126    |     128    |     294    |     168    |
|       from small pool |      54    |      56    |     136    |      82    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     430    |     250    |
|       from large pool |     126    |     128    |     294    |     168    |
|       from small pool |      54    |      56    |     136    |      82    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     272    |     145    |
|       from large pool |     126    |     128    |     270    |     144    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      26    |      25    |
|       from large pool |       0    |       1    |      24    |      24    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:49 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |   9940 MiB |   4036 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9904 MiB |   4000 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |   9940 MiB |   4036 MiB |
|       from large pool |   5904 MiB |   5992 MiB |   9904 MiB |   4000 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |   9868 MiB |   3964 MiB |
|       from large pool |   5904 MiB |   5990 MiB |   9832 MiB |   3928 MiB |
|       from small pool |      0 MiB |      1 MiB |     36 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  10324 MiB |   4418 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10320 MiB |   4416 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 532475 KiB | 530931 KiB |
|       from large pool |      0 KiB |  19104 KiB | 491520 KiB | 491520 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  40955 KiB |  39411 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     397    |     249    |
|       from large pool |     100    |     102    |     268    |     168    |
|       from small pool |      48    |      50    |     129    |      81    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     397    |     249    |
|       from large pool |     100    |     102    |     268    |     168    |
|       from small pool |      48    |      50    |     129    |      81    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     246    |     145    |
|       from large pool |     100    |     102    |     244    |     144    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      26    |      25    |
|       from large pool |       0    |       1    |      24    |      24    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:57:49 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:57:49 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:57:49 | I | in layer model.layers.0
25-01-14 00:57:49 | I | quantizing weights for layer model.layers.0
25-01-14 00:57:49 | I | collecting info in model.layers.0
25-01-14 00:57:49 | I | collecting info in model.layers.0
25-01-14 00:57:50 | I | collecting info in model.layers.0
25-01-14 00:57:50 | I | collecting info in model.layers.0
25-01-14 00:57:51 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:51 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:52 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:52 | I | collecting calibration activations in model.layers.0
25-01-14 00:57:53 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:57:53 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:57:55 | I |       - range scale = [    1.0000]
25-01-14 00:57:55 | I |         sum  error  = [    0.5046]
25-01-14 00:57:55 | I |         best error  = [    0.5046]
25-01-14 00:57:55 | I |     + error = [0.5046]
25-01-14 00:57:57 | I |       - range scale = [    1.0000]
25-01-14 00:57:57 | I |         sum  error  = [    1.1298]
25-01-14 00:57:57 | I |         best error  = [    1.1298]
25-01-14 00:57:57 | I |     + error = [1.1298]
25-01-14 00:57:57 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:57:59 | I |       - range scale = [    1.0000]
25-01-14 00:57:59 | I |         sum  error  = [    1.9096]
25-01-14 00:57:59 | I |         best error  = [    1.9096]
25-01-14 00:57:59 | I |     + error = [1.9096]
25-01-14 00:58:00 | I |       - range scale = [    1.0000]
25-01-14 00:58:00 | I |         sum  error  = [    3.4034]
25-01-14 00:58:00 | I |         best error  = [    3.4034]
25-01-14 00:58:00 | I |     + error = [3.4034]
25-01-14 00:58:01 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:58:01 | I |       - range scale = [    1.0000]
25-01-14 00:58:01 | I |         sum  error  = [    0.2501]
25-01-14 00:58:01 | I |         best error  = [    0.2501]
25-01-14 00:58:01 | I |     + error = [0.2501]
25-01-14 00:58:02 | I |       - range scale = [    1.0000]
25-01-14 00:58:02 | I |         sum  error  = [    0.3766]
25-01-14 00:58:02 | I |         best error  = [    0.3766]
25-01-14 00:58:02 | I |     + error = [0.3766]
25-01-14 00:58:02 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:58:03 | I |       - range scale = [    1.0000]
25-01-14 00:58:03 | I |         sum  error  = [    0.1418]
25-01-14 00:58:03 | I |         best error  = [    0.1418]
25-01-14 00:58:03 | I |     + error = [0.1418]
25-01-14 00:58:04 | I |       - range scale = [    1.0000]
25-01-14 00:58:04 | I |         sum  error  = [    0.2611]
25-01-14 00:58:04 | I |         best error  = [    0.2611]
25-01-14 00:58:04 | I |     + error = [0.2611]
25-01-14 00:58:04 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:58:05 | I |       - range scale = [    1.0000]
25-01-14 00:58:05 | I |         sum  error  = [    0.9734]
25-01-14 00:58:05 | I |         best error  = [    0.9734]
25-01-14 00:58:05 | I |     + error = [0.9734]
25-01-14 00:58:06 | I |       - range scale = [    1.0000]
25-01-14 00:58:06 | I |         sum  error  = [    1.3263]
25-01-14 00:58:06 | I |         best error  = [    1.3263]
25-01-14 00:58:06 | I |     + error = [1.3263]
25-01-14 00:58:06 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:58:07 | I |       - range scale = [    1.0000]
25-01-14 00:58:07 | I |         sum  error  = [    1.1071]
25-01-14 00:58:07 | I |         best error  = [    1.1071]
25-01-14 00:58:07 | I |     + error = [1.1071]
25-01-14 00:58:08 | I |       - range scale = [    1.0000]
25-01-14 00:58:08 | I |         sum  error  = [    1.5389]
25-01-14 00:58:08 | I |         best error  = [    1.5389]
25-01-14 00:58:08 | I |     + error = [1.5389]
25-01-14 00:58:08 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:58:09 | I |       - range scale = [    1.0000]
25-01-14 00:58:09 | I |         sum  error  = [    0.1675]
25-01-14 00:58:09 | I |         best error  = [    0.1675]
25-01-14 00:58:09 | I |     + error = [0.1675]
25-01-14 00:58:10 | I |       - range scale = [    1.0000]
25-01-14 00:58:10 | I |         sum  error  = [    0.2225]
25-01-14 00:58:10 | I |         best error  = [    0.2225]
25-01-14 00:58:10 | I |     + error = [0.2225]
25-01-14 00:58:10 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:58:12 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:58:15 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:58:17 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:58:20 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:58:22 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:58:24 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:58:31 | I | quantizing activations for layer model.layers.0
25-01-14 00:58:31 | I | collecting info in model.layers.0
25-01-14 00:58:31 | I | collecting info in model.layers.0
25-01-14 00:58:32 | I | collecting info in model.layers.0
25-01-14 00:58:32 | I | collecting info in model.layers.0
25-01-14 00:58:33 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:33 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:34 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:34 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:37 | I | forward this layer
25-01-14 00:58:37 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/22.pt
25-01-14 00:58:37 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/22.pt
25-01-14 00:58:37 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.42 GiB is allocated by PyTorch, and 688.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:58:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 12           |        cudaMalloc retries: 15        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22955 MiB |  23233 MiB |  12478 GiB |  12455 GiB |
|       from large pool |  22952 MiB |  23230 MiB |  12337 GiB |  12314 GiB |
|       from small pool |      3 MiB |      5 MiB |    141 GiB |    141 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22955 MiB |  23233 MiB |  12478 GiB |  12455 GiB |
|       from large pool |  22952 MiB |  23230 MiB |  12337 GiB |  12314 GiB |
|       from small pool |      3 MiB |      5 MiB |    141 GiB |    141 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22955 MiB |  23233 MiB |  12447 GiB |  12424 GiB |
|       from large pool |  22952 MiB |  23230 MiB |  12306 GiB |  12283 GiB |
|       from small pool |      3 MiB |      5 MiB |    140 GiB |    140 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |    905 GiB |    882 GiB |
|       from large pool |  23640 MiB |  23668 MiB |    905 GiB |    881 GiB |
|       from small pool |      4 MiB |      8 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 704782 KiB |   1691 MiB |   5460 GiB |   5459 GiB |
|       from large pool | 704256 KiB |   1689 MiB |   5298 GiB |   5297 GiB |
|       from small pool |    526 KiB |      4 MiB |    162 GiB |    162 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     297    |     320    |    2856 K  |    2856 K  |
|       from large pool |     188    |     223    |     390 K  |     389 K  |
|       from small pool |     109    |     111    |    2466 K  |    2466 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     297    |     320    |    2856 K  |    2856 K  |
|       from large pool |     188    |     223    |     390 K  |     389 K  |
|       from small pool |     109    |     111    |    2466 K  |    2466 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2328    |    2152    |
|       from large pool |     174    |     174    |    1894    |    1720    |
|       from small pool |       2    |       4    |     434    |     432    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      27    |      35    |    1264 K  |    1264 K  |
|       from large pool |      19    |      24    |     153 K  |     153 K  |
|       from small pool |       8    |      16    |    1110 K  |    1110 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:58:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  11321 MiB |   4372 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11281 MiB |   4333 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  11321 MiB |   4372 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11281 MiB |   4333 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  11243 MiB |   4294 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  11203 MiB |   4255 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  11736 MiB |   4786 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11732 MiB |   4784 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 576508 KiB | 574757 KiB |
|       from large pool |      0 KiB |  19104 KiB | 532480 KiB | 532480 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  44028 KiB |  42277 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     450    |     270    |
|       from large pool |     126    |     128    |     308    |     182    |
|       from small pool |      54    |      56    |     142    |      88    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     450    |     270    |
|       from large pool |     126    |     128    |     308    |     182    |
|       from small pool |      54    |      56    |     142    |      88    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     284    |     157    |
|       from large pool |     126    |     128    |     282    |     156    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      28    |      27    |
|       from large pool |       0    |       1    |      26    |      26    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:58:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  11321 MiB |   4372 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11281 MiB |   4333 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  11321 MiB |   4372 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11281 MiB |   4333 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  11243 MiB |   4294 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  11203 MiB |   4255 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  11736 MiB |   4786 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11732 MiB |   4784 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 576508 KiB | 574757 KiB |
|       from large pool |      0 KiB |  19104 KiB | 532480 KiB | 532480 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  44028 KiB |  42277 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     450    |     270    |
|       from large pool |     126    |     128    |     308    |     182    |
|       from small pool |      54    |      56    |     142    |      88    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     450    |     270    |
|       from large pool |     126    |     128    |     308    |     182    |
|       from small pool |      54    |      56    |     142    |      88    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     284    |     157    |
|       from large pool |     126    |     128    |     282    |     156    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      28    |      27    |
|       from large pool |       0    |       1    |      26    |      26    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:58:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  10277 MiB |   4372 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10237 MiB |   4333 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  10277 MiB |   4372 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10237 MiB |   4333 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  10199 MiB |   4294 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  10159 MiB |   4255 MiB |
|       from small pool |      0 MiB |      1 MiB |     39 MiB |     39 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  10692 MiB |   4786 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10688 MiB |   4784 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 576507 KiB | 574963 KiB |
|       from large pool |      0 KiB |  19104 KiB | 532480 KiB | 532480 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  44027 KiB |  42483 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     417    |     269    |
|       from large pool |     100    |     102    |     282    |     182    |
|       from small pool |      48    |      50    |     135    |      87    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     417    |     269    |
|       from large pool |     100    |     102    |     282    |     182    |
|       from small pool |      48    |      50    |     135    |      87    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     258    |     157    |
|       from large pool |     100    |     102    |     256    |     156    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      28    |      27    |
|       from large pool |       0    |       1    |      26    |      26    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:58:37 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:58:37 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:58:37 | I | in layer model.layers.0
25-01-14 00:58:37 | I | quantizing weights for layer model.layers.0
25-01-14 00:58:37 | I | collecting info in model.layers.0
25-01-14 00:58:37 | I | collecting info in model.layers.0
25-01-14 00:58:38 | I | collecting info in model.layers.0
25-01-14 00:58:38 | I | collecting info in model.layers.0
25-01-14 00:58:39 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:39 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:40 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:40 | I | collecting calibration activations in model.layers.0
25-01-14 00:58:41 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:58:41 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:58:43 | I |       - range scale = [    1.0000]
25-01-14 00:58:43 | I |         sum  error  = [    0.5300]
25-01-14 00:58:43 | I |         best error  = [    0.5300]
25-01-14 00:58:43 | I |     + error = [0.5300]
25-01-14 00:58:45 | I |       - range scale = [    1.0000]
25-01-14 00:58:45 | I |         sum  error  = [    1.1525]
25-01-14 00:58:45 | I |         best error  = [    1.1525]
25-01-14 00:58:45 | I |     + error = [1.1525]
25-01-14 00:58:45 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:58:47 | I |       - range scale = [    1.0000]
25-01-14 00:58:47 | I |         sum  error  = [    1.7693]
25-01-14 00:58:47 | I |         best error  = [    1.7693]
25-01-14 00:58:47 | I |     + error = [1.7693]
25-01-14 00:58:49 | I |       - range scale = [    1.0000]
25-01-14 00:58:49 | I |         sum  error  = [    3.4495]
25-01-14 00:58:49 | I |         best error  = [    3.4495]
25-01-14 00:58:49 | I |     + error = [3.4495]
25-01-14 00:58:49 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:58:50 | I |       - range scale = [    1.0000]
25-01-14 00:58:50 | I |         sum  error  = [    0.2541]
25-01-14 00:58:50 | I |         best error  = [    0.2541]
25-01-14 00:58:50 | I |     + error = [0.2541]
25-01-14 00:58:51 | I |       - range scale = [    1.0000]
25-01-14 00:58:51 | I |         sum  error  = [    0.3664]
25-01-14 00:58:51 | I |         best error  = [    0.3664]
25-01-14 00:58:51 | I |     + error = [0.3664]
25-01-14 00:58:51 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:58:52 | I |       - range scale = [    1.0000]
25-01-14 00:58:52 | I |         sum  error  = [    0.1420]
25-01-14 00:58:52 | I |         best error  = [    0.1420]
25-01-14 00:58:52 | I |     + error = [0.1420]
25-01-14 00:58:52 | I |       - range scale = [    1.0000]
25-01-14 00:58:52 | I |         sum  error  = [    0.2554]
25-01-14 00:58:52 | I |         best error  = [    0.2554]
25-01-14 00:58:52 | I |     + error = [0.2554]
25-01-14 00:58:53 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:58:53 | I |       - range scale = [    1.0000]
25-01-14 00:58:53 | I |         sum  error  = [    0.9951]
25-01-14 00:58:53 | I |         best error  = [    0.9951]
25-01-14 00:58:53 | I |     + error = [0.9951]
25-01-14 00:58:54 | I |       - range scale = [    1.0000]
25-01-14 00:58:54 | I |         sum  error  = [    1.3454]
25-01-14 00:58:54 | I |         best error  = [    1.3454]
25-01-14 00:58:54 | I |     + error = [1.3454]
25-01-14 00:58:55 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:58:55 | I |       - range scale = [    1.0000]
25-01-14 00:58:55 | I |         sum  error  = [    1.1318]
25-01-14 00:58:55 | I |         best error  = [    1.1318]
25-01-14 00:58:55 | I |     + error = [1.1318]
25-01-14 00:58:56 | I |       - range scale = [    1.0000]
25-01-14 00:58:56 | I |         sum  error  = [    1.5144]
25-01-14 00:58:56 | I |         best error  = [    1.5144]
25-01-14 00:58:56 | I |     + error = [1.5144]
25-01-14 00:58:57 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:58:57 | I |       - range scale = [    1.0000]
25-01-14 00:58:57 | I |         sum  error  = [    0.1725]
25-01-14 00:58:57 | I |         best error  = [    0.1725]
25-01-14 00:58:57 | I |     + error = [0.1725]
25-01-14 00:58:58 | I |       - range scale = [    1.0000]
25-01-14 00:58:58 | I |         sum  error  = [    0.2258]
25-01-14 00:58:58 | I |         best error  = [    0.2258]
25-01-14 00:58:58 | I |     + error = [0.2258]
25-01-14 00:58:59 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:59:01 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:59:04 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:59:06 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:59:08 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 00:59:11 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 00:59:13 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 00:59:20 | I | quantizing activations for layer model.layers.0
25-01-14 00:59:20 | I | collecting info in model.layers.0
25-01-14 00:59:20 | I | collecting info in model.layers.0
25-01-14 00:59:21 | I | collecting info in model.layers.0
25-01-14 00:59:21 | I | collecting info in model.layers.0
25-01-14 00:59:22 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:22 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:23 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:23 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:26 | I | forward this layer
25-01-14 00:59:26 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/24.pt
25-01-14 00:59:26 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/24.pt
25-01-14 00:59:26 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.29 GiB is allocated by PyTorch, and 816.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 00:59:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 13           |        cudaMalloc retries: 16        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22827 MiB |  23233 MiB |  14023 GiB |  14001 GiB |
|       from large pool |  22824 MiB |  23230 MiB |  13869 GiB |  13847 GiB |
|       from small pool |      3 MiB |      5 MiB |    154 GiB |    154 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22827 MiB |  23233 MiB |  14023 GiB |  14001 GiB |
|       from large pool |  22824 MiB |  23230 MiB |  13869 GiB |  13847 GiB |
|       from small pool |      3 MiB |      5 MiB |    154 GiB |    154 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22827 MiB |  23233 MiB |  13990 GiB |  13968 GiB |
|       from large pool |  22824 MiB |  23230 MiB |  13836 GiB |  13814 GiB |
|       from small pool |      3 MiB |      5 MiB |    153 GiB |    153 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |    973 GiB |    950 GiB |
|       from large pool |  23640 MiB |  23668 MiB |    972 GiB |    949 GiB |
|       from small pool |      4 MiB |      8 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    816 MiB |   1691 MiB |   6226 GiB |   6225 GiB |
|       from large pool |    815 MiB |   1689 MiB |   6048 GiB |   6047 GiB |
|       from small pool |      0 MiB |      4 MiB |    177 GiB |    177 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     320    |    3126 K  |    3125 K  |
|       from large pool |     187    |     223    |     428 K  |     428 K  |
|       from small pool |     109    |     111    |    2697 K  |    2697 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     320    |    3126 K  |    3125 K  |
|       from large pool |     187    |     223    |     428 K  |     428 K  |
|       from small pool |     109    |     111    |    2697 K  |    2697 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2486    |    2310    |
|       from large pool |     174    |     174    |    2017    |    1843    |
|       from small pool |       2    |       4    |     469    |     467    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    1377 K  |    1377 K  |
|       from large pool |      20    |      24    |     166 K  |     166 K  |
|       from small pool |       8    |      16    |    1210 K  |    1210 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:59:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  11657 MiB |   4709 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11615 MiB |   4667 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  11657 MiB |   4709 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11615 MiB |   4667 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  11573 MiB |   4625 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  11531 MiB |   4583 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  12104 MiB |   5154 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12100 MiB |   5152 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 620540 KiB | 618789 KiB |
|       from large pool |      0 KiB |  19104 KiB | 573440 KiB | 573440 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  47100 KiB |  45349 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     470    |     290    |
|       from large pool |     126    |     128    |     322    |     196    |
|       from small pool |      54    |      56    |     148    |      94    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     470    |     290    |
|       from large pool |     126    |     128    |     322    |     196    |
|       from small pool |      54    |      56    |     148    |      94    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     296    |     169    |
|       from large pool |     126    |     128    |     294    |     168    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      30    |      29    |
|       from large pool |       0    |       1    |      28    |      28    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:59:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  11657 MiB |   4709 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11615 MiB |   4667 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  11657 MiB |   4709 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11615 MiB |   4667 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  11573 MiB |   4625 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  11531 MiB |   4583 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  12104 MiB |   5154 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12100 MiB |   5152 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 620540 KiB | 618789 KiB |
|       from large pool |      0 KiB |  19104 KiB | 573440 KiB | 573440 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  47100 KiB |  45349 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     470    |     290    |
|       from large pool |     126    |     128    |     322    |     196    |
|       from small pool |      54    |      56    |     148    |      94    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     470    |     290    |
|       from large pool |     126    |     128    |     322    |     196    |
|       from small pool |      54    |      56    |     148    |      94    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     296    |     169    |
|       from large pool |     126    |     128    |     294    |     168    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      30    |      29    |
|       from large pool |       0    |       1    |      28    |      28    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:59:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  10613 MiB |   4709 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10571 MiB |   4667 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  10613 MiB |   4709 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10571 MiB |   4667 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  10529 MiB |   4625 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  10487 MiB |   4583 MiB |
|       from small pool |      0 MiB |      1 MiB |     42 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  11060 MiB |   5154 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11056 MiB |   5152 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 620539 KiB | 618995 KiB |
|       from large pool |      0 KiB |  19104 KiB | 573440 KiB | 573440 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  47099 KiB |  45555 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     437    |     289    |
|       from large pool |     100    |     102    |     296    |     196    |
|       from small pool |      48    |      50    |     141    |      93    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     437    |     289    |
|       from large pool |     100    |     102    |     296    |     196    |
|       from small pool |      48    |      50    |     141    |      93    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     270    |     169    |
|       from large pool |     100    |     102    |     268    |     168    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      30    |      29    |
|       from large pool |       0    |       1    |      28    |      28    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 00:59:26 | W | attempting to recover from OOM in forward/backward pass
25-01-14 00:59:26 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 00:59:26 | I | in layer model.layers.0
25-01-14 00:59:26 | I | quantizing weights for layer model.layers.0
25-01-14 00:59:26 | I | collecting info in model.layers.0
25-01-14 00:59:26 | I | collecting info in model.layers.0
25-01-14 00:59:27 | I | collecting info in model.layers.0
25-01-14 00:59:27 | I | collecting info in model.layers.0
25-01-14 00:59:28 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:29 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:29 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:30 | I | collecting calibration activations in model.layers.0
25-01-14 00:59:30 | I | - Quantizing decoder layer model.layers.0
25-01-14 00:59:30 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 00:59:32 | I |       - range scale = [    1.0000]
25-01-14 00:59:32 | I |         sum  error  = [    0.5048]
25-01-14 00:59:32 | I |         best error  = [    0.5048]
25-01-14 00:59:32 | I |     + error = [0.5048]
25-01-14 00:59:34 | I |       - range scale = [    1.0000]
25-01-14 00:59:34 | I |         sum  error  = [    1.1481]
25-01-14 00:59:34 | I |         best error  = [    1.1481]
25-01-14 00:59:34 | I |     + error = [1.1481]
25-01-14 00:59:35 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 00:59:37 | I |       - range scale = [    1.0000]
25-01-14 00:59:37 | I |         sum  error  = [    1.7058]
25-01-14 00:59:37 | I |         best error  = [    1.7058]
25-01-14 00:59:37 | I |     + error = [1.7058]
25-01-14 00:59:39 | I |       - range scale = [    1.0000]
25-01-14 00:59:39 | I |         sum  error  = [    3.3123]
25-01-14 00:59:39 | I |         best error  = [    3.3123]
25-01-14 00:59:39 | I |     + error = [3.3123]
25-01-14 00:59:39 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 00:59:39 | I |       - range scale = [    1.0000]
25-01-14 00:59:39 | I |         sum  error  = [    0.2476]
25-01-14 00:59:39 | I |         best error  = [    0.2476]
25-01-14 00:59:39 | I |     + error = [0.2476]
25-01-14 00:59:40 | I |       - range scale = [    1.0000]
25-01-14 00:59:40 | I |         sum  error  = [    0.3401]
25-01-14 00:59:40 | I |         best error  = [    0.3401]
25-01-14 00:59:40 | I |     + error = [0.3401]
25-01-14 00:59:41 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 00:59:41 | I |       - range scale = [    1.0000]
25-01-14 00:59:41 | I |         sum  error  = [    0.1441]
25-01-14 00:59:41 | I |         best error  = [    0.1441]
25-01-14 00:59:41 | I |     + error = [0.1441]
25-01-14 00:59:42 | I |       - range scale = [    1.0000]
25-01-14 00:59:42 | I |         sum  error  = [    0.2623]
25-01-14 00:59:42 | I |         best error  = [    0.2623]
25-01-14 00:59:42 | I |     + error = [0.2623]
25-01-14 00:59:42 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 00:59:43 | I |       - range scale = [    1.0000]
25-01-14 00:59:43 | I |         sum  error  = [    0.9977]
25-01-14 00:59:43 | I |         best error  = [    0.9977]
25-01-14 00:59:43 | I |     + error = [0.9977]
25-01-14 00:59:44 | I |       - range scale = [    1.0000]
25-01-14 00:59:44 | I |         sum  error  = [    1.3419]
25-01-14 00:59:44 | I |         best error  = [    1.3419]
25-01-14 00:59:44 | I |     + error = [1.3419]
25-01-14 00:59:44 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 00:59:45 | I |       - range scale = [    1.0000]
25-01-14 00:59:45 | I |         sum  error  = [    1.1250]
25-01-14 00:59:45 | I |         best error  = [    1.1250]
25-01-14 00:59:45 | I |     + error = [1.1250]
25-01-14 00:59:46 | I |       - range scale = [    1.0000]
25-01-14 00:59:46 | I |         sum  error  = [    1.5218]
25-01-14 00:59:46 | I |         best error  = [    1.5218]
25-01-14 00:59:46 | I |     + error = [1.5218]
25-01-14 00:59:46 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 00:59:47 | I |       - range scale = [    1.0000]
25-01-14 00:59:47 | I |         sum  error  = [    0.1724]
25-01-14 00:59:47 | I |         best error  = [    0.1724]
25-01-14 00:59:47 | I |     + error = [0.1724]
25-01-14 00:59:48 | I |       - range scale = [    1.0000]
25-01-14 00:59:48 | I |         sum  error  = [    0.2240]
25-01-14 00:59:48 | I |         best error  = [    0.2240]
25-01-14 00:59:48 | I |     + error = [0.2240]
25-01-14 00:59:48 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 00:59:51 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 00:59:53 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 00:59:56 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 00:59:58 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:00:01 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:00:03 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:00:10 | I | quantizing activations for layer model.layers.0
25-01-14 01:00:10 | I | collecting info in model.layers.0
25-01-14 01:00:10 | I | collecting info in model.layers.0
25-01-14 01:00:10 | I | collecting info in model.layers.0
25-01-14 01:00:11 | I | collecting info in model.layers.0
25-01-14 01:00:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:16 | I | forward this layer
25-01-14 01:00:16 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/26.pt
25-01-14 01:00:16 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/26.pt
25-01-14 01:00:16 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:00:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 14           |        cudaMalloc retries: 17        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  15654 GiB |  15632 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  15486 GiB |  15464 GiB |
|       from small pool |      3 MiB |      5 MiB |    167 GiB |    167 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  15654 GiB |  15632 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  15486 GiB |  15464 GiB |
|       from small pool |      3 MiB |      5 MiB |    167 GiB |    167 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  15619 GiB |  15597 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  15452 GiB |  15430 GiB |
|       from small pool |      3 MiB |      5 MiB |    167 GiB |    167 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1042 GiB |   1019 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1041 GiB |   1018 GiB |
|       from small pool |      4 MiB |      8 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   7032 GiB |   7031 GiB |
|       from large pool |    943 MiB |   1689 MiB |   6839 GiB |   6838 GiB |
|       from small pool |      0 MiB |      4 MiB |    192 GiB |    192 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    3402 K  |    3402 K  |
|       from large pool |     186    |     223    |     468 K  |     468 K  |
|       from small pool |     109    |     111    |    2933 K  |    2933 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    3402 K  |    3402 K  |
|       from large pool |     186    |     223    |     468 K  |     468 K  |
|       from small pool |     109    |     111    |    2933 K  |    2933 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2650    |    2474    |
|       from large pool |     174    |     174    |    2146    |    1972    |
|       from small pool |       2    |       4    |     504    |     502    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    1493 K  |    1493 K  |
|       from large pool |      20    |      24    |     180 K  |     179 K  |
|       from small pool |       8    |      16    |    1313 K  |    1313 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:00:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  11993 MiB |   5045 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11948 MiB |   5000 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  11993 MiB |   5045 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11948 MiB |   5000 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  11903 MiB |   4955 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  11858 MiB |   4910 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  12472 MiB |   5522 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12468 MiB |   5520 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 664572 KiB | 662821 KiB |
|       from large pool |      0 KiB |  19104 KiB | 614400 KiB | 614400 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  50172 KiB |  48421 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     490    |     310    |
|       from large pool |     126    |     128    |     336    |     210    |
|       from small pool |      54    |      56    |     154    |     100    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     490    |     310    |
|       from large pool |     126    |     128    |     336    |     210    |
|       from small pool |      54    |      56    |     154    |     100    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     308    |     181    |
|       from large pool |     126    |     128    |     306    |     180    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      32    |      31    |
|       from large pool |       0    |       1    |      30    |      30    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:00:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  11993 MiB |   5045 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11948 MiB |   5000 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  11993 MiB |   5045 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  11948 MiB |   5000 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  11903 MiB |   4955 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  11858 MiB |   4910 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  12472 MiB |   5522 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12468 MiB |   5520 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 664572 KiB | 662821 KiB |
|       from large pool |      0 KiB |  19104 KiB | 614400 KiB | 614400 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  50172 KiB |  48421 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     490    |     310    |
|       from large pool |     126    |     128    |     336    |     210    |
|       from small pool |      54    |      56    |     154    |     100    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     490    |     310    |
|       from large pool |     126    |     128    |     336    |     210    |
|       from small pool |      54    |      56    |     154    |     100    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     308    |     181    |
|       from large pool |     126    |     128    |     306    |     180    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      32    |      31    |
|       from large pool |       0    |       1    |      30    |      30    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:00:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  10950 MiB |   5045 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10904 MiB |   5000 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  10950 MiB |   5045 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  10904 MiB |   5000 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  10860 MiB |   4955 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  10814 MiB |   4910 MiB |
|       from small pool |      0 MiB |      1 MiB |     45 MiB |     45 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  11428 MiB |   5522 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11424 MiB |   5520 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 664571 KiB | 663027 KiB |
|       from large pool |      0 KiB |  19104 KiB | 614400 KiB | 614400 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  50171 KiB |  48627 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     457    |     309    |
|       from large pool |     100    |     102    |     310    |     210    |
|       from small pool |      48    |      50    |     147    |      99    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     457    |     309    |
|       from large pool |     100    |     102    |     310    |     210    |
|       from small pool |      48    |      50    |     147    |      99    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     282    |     181    |
|       from large pool |     100    |     102    |     280    |     180    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      32    |      31    |
|       from large pool |       0    |       1    |      30    |      30    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:00:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:00:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:00:16 | I | in layer model.layers.0
25-01-14 01:00:16 | I | quantizing weights for layer model.layers.0
25-01-14 01:00:16 | I | collecting info in model.layers.0
25-01-14 01:00:17 | I | collecting info in model.layers.0
25-01-14 01:00:17 | I | collecting info in model.layers.0
25-01-14 01:00:17 | I | collecting info in model.layers.0
25-01-14 01:00:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:00:21 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:00:21 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:00:23 | I |       - range scale = [    1.0000]
25-01-14 01:00:23 | I |         sum  error  = [    0.5292]
25-01-14 01:00:23 | I |         best error  = [    0.5292]
25-01-14 01:00:23 | I |     + error = [0.5292]
25-01-14 01:00:25 | I |       - range scale = [    1.0000]
25-01-14 01:00:25 | I |         sum  error  = [    1.1708]
25-01-14 01:00:25 | I |         best error  = [    1.1708]
25-01-14 01:00:25 | I |     + error = [1.1708]
25-01-14 01:00:25 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:00:27 | I |       - range scale = [    1.0000]
25-01-14 01:00:27 | I |         sum  error  = [    1.7227]
25-01-14 01:00:27 | I |         best error  = [    1.7227]
25-01-14 01:00:27 | I |     + error = [1.7227]
25-01-14 01:00:29 | I |       - range scale = [    1.0000]
25-01-14 01:00:29 | I |         sum  error  = [    3.3628]
25-01-14 01:00:29 | I |         best error  = [    3.3628]
25-01-14 01:00:29 | I |     + error = [3.3628]
25-01-14 01:00:29 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:00:30 | I |       - range scale = [    1.0000]
25-01-14 01:00:30 | I |         sum  error  = [    0.2500]
25-01-14 01:00:30 | I |         best error  = [    0.2500]
25-01-14 01:00:30 | I |     + error = [0.2500]
25-01-14 01:00:31 | I |       - range scale = [    1.0000]
25-01-14 01:00:31 | I |         sum  error  = [    0.3435]
25-01-14 01:00:31 | I |         best error  = [    0.3435]
25-01-14 01:00:31 | I |     + error = [0.3435]
25-01-14 01:00:31 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:00:32 | I |       - range scale = [    1.0000]
25-01-14 01:00:32 | I |         sum  error  = [    0.1448]
25-01-14 01:00:32 | I |         best error  = [    0.1448]
25-01-14 01:00:32 | I |     + error = [0.1448]
25-01-14 01:00:33 | I |       - range scale = [    1.0000]
25-01-14 01:00:33 | I |         sum  error  = [    0.2672]
25-01-14 01:00:33 | I |         best error  = [    0.2672]
25-01-14 01:00:33 | I |     + error = [0.2672]
25-01-14 01:00:33 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:00:34 | I |       - range scale = [    1.0000]
25-01-14 01:00:34 | I |         sum  error  = [    1.0098]
25-01-14 01:00:34 | I |         best error  = [    1.0098]
25-01-14 01:00:34 | I |     + error = [1.0098]
25-01-14 01:00:35 | I |       - range scale = [    1.0000]
25-01-14 01:00:35 | I |         sum  error  = [    1.3238]
25-01-14 01:00:35 | I |         best error  = [    1.3238]
25-01-14 01:00:35 | I |     + error = [1.3238]
25-01-14 01:00:35 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:00:36 | I |       - range scale = [    1.0000]
25-01-14 01:00:36 | I |         sum  error  = [    1.1400]
25-01-14 01:00:36 | I |         best error  = [    1.1400]
25-01-14 01:00:36 | I |     + error = [1.1400]
25-01-14 01:00:37 | I |       - range scale = [    1.0000]
25-01-14 01:00:37 | I |         sum  error  = [    1.5074]
25-01-14 01:00:37 | I |         best error  = [    1.5074]
25-01-14 01:00:37 | I |     + error = [1.5074]
25-01-14 01:00:37 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:00:38 | I |       - range scale = [    1.0000]
25-01-14 01:00:38 | I |         sum  error  = [    0.1737]
25-01-14 01:00:38 | I |         best error  = [    0.1737]
25-01-14 01:00:38 | I |     + error = [0.1737]
25-01-14 01:00:39 | I |       - range scale = [    1.0000]
25-01-14 01:00:39 | I |         sum  error  = [    0.2324]
25-01-14 01:00:39 | I |         best error  = [    0.2324]
25-01-14 01:00:39 | I |     + error = [0.2324]
25-01-14 01:00:39 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:00:41 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:00:44 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:00:46 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:00:49 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:00:51 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:00:54 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:01:00 | I | quantizing activations for layer model.layers.0
25-01-14 01:01:00 | I | collecting info in model.layers.0
25-01-14 01:01:01 | I | collecting info in model.layers.0
25-01-14 01:01:01 | I | collecting info in model.layers.0
25-01-14 01:01:01 | I | collecting info in model.layers.0
25-01-14 01:01:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:04 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:06 | I | forward this layer
25-01-14 01:01:06 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/28.pt
25-01-14 01:01:06 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/28.pt
25-01-14 01:01:07 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:01:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 15           |        cudaMalloc retries: 18        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  17370 GiB |  17348 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  17189 GiB |  17166 GiB |
|       from small pool |      3 MiB |      5 MiB |    181 GiB |    181 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  17370 GiB |  17348 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  17189 GiB |  17166 GiB |
|       from small pool |      3 MiB |      5 MiB |    181 GiB |    181 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  17333 GiB |  17311 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  17153 GiB |  17131 GiB |
|       from small pool |      3 MiB |      5 MiB |    180 GiB |    180 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1110 GiB |   1087 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1109 GiB |   1086 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   7899 GiB |   7899 GiB |
|       from large pool |    943 MiB |   1689 MiB |   7691 GiB |   7690 GiB |
|       from small pool |      0 MiB |      4 MiB |    208 GiB |    208 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    3686 K  |    3686 K  |
|       from large pool |     186    |     223    |     510 K  |     510 K  |
|       from small pool |     109    |     111    |    3176 K  |    3176 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    3686 K  |    3686 K  |
|       from large pool |     186    |     223    |     510 K  |     510 K  |
|       from small pool |     109    |     111    |    3176 K  |    3176 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2808    |    2632    |
|       from large pool |     174    |     174    |    2269    |    2095    |
|       from small pool |       2    |       4    |     539    |     537    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    1610 K  |    1610 K  |
|       from large pool |      21    |      24    |     193 K  |     193 K  |
|       from small pool |       8    |      16    |    1417 K  |    1417 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  12330 MiB |   5382 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12282 MiB |   5334 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  12330 MiB |   5382 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12282 MiB |   5334 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  12234 MiB |   5286 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  12186 MiB |   5238 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  12840 MiB |   5890 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12836 MiB |   5888 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 708604 KiB | 706853 KiB |
|       from large pool |      0 KiB |  19104 KiB | 655360 KiB | 655360 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  53244 KiB |  51493 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     510    |     330    |
|       from large pool |     126    |     128    |     350    |     224    |
|       from small pool |      54    |      56    |     160    |     106    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     510    |     330    |
|       from large pool |     126    |     128    |     350    |     224    |
|       from small pool |      54    |      56    |     160    |     106    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     320    |     193    |
|       from large pool |     126    |     128    |     318    |     192    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      34    |      33    |
|       from large pool |       0    |       1    |      32    |      32    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  12330 MiB |   5382 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12282 MiB |   5334 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  12330 MiB |   5382 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12282 MiB |   5334 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  12234 MiB |   5286 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  12186 MiB |   5238 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  12840 MiB |   5890 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12836 MiB |   5888 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 708604 KiB | 706853 KiB |
|       from large pool |      0 KiB |  19104 KiB | 655360 KiB | 655360 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  53244 KiB |  51493 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     510    |     330    |
|       from large pool |     126    |     128    |     350    |     224    |
|       from small pool |      54    |      56    |     160    |     106    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     510    |     330    |
|       from large pool |     126    |     128    |     350    |     224    |
|       from small pool |      54    |      56    |     160    |     106    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     320    |     193    |
|       from large pool |     126    |     128    |     318    |     192    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      34    |      33    |
|       from large pool |       0    |       1    |      32    |      32    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  11286 MiB |   5382 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11238 MiB |   5334 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  11286 MiB |   5382 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11238 MiB |   5334 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  11190 MiB |   5286 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  11142 MiB |   5238 MiB |
|       from small pool |      0 MiB |      1 MiB |     48 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  11796 MiB |   5890 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11792 MiB |   5888 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 708603 KiB | 707059 KiB |
|       from large pool |      0 KiB |  19104 KiB | 655360 KiB | 655360 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  53243 KiB |  51699 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     477    |     329    |
|       from large pool |     100    |     102    |     324    |     224    |
|       from small pool |      48    |      50    |     153    |     105    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     477    |     329    |
|       from large pool |     100    |     102    |     324    |     224    |
|       from small pool |      48    |      50    |     153    |     105    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     294    |     193    |
|       from large pool |     100    |     102    |     292    |     192    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      34    |      33    |
|       from large pool |       0    |       1    |      32    |      32    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:07 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:01:07 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:01:07 | I | in layer model.layers.0
25-01-14 01:01:07 | I | quantizing weights for layer model.layers.0
25-01-14 01:01:07 | I | collecting info in model.layers.0
25-01-14 01:01:07 | I | collecting info in model.layers.0
25-01-14 01:01:08 | I | collecting info in model.layers.0
25-01-14 01:01:08 | I | collecting info in model.layers.0
25-01-14 01:01:09 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:12 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:01:12 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:01:14 | I |       - range scale = [    1.0000]
25-01-14 01:01:14 | I |         sum  error  = [    0.5544]
25-01-14 01:01:14 | I |         best error  = [    0.5544]
25-01-14 01:01:14 | I |     + error = [0.5544]
25-01-14 01:01:16 | I |       - range scale = [    1.0000]
25-01-14 01:01:16 | I |         sum  error  = [    1.1939]
25-01-14 01:01:16 | I |         best error  = [    1.1939]
25-01-14 01:01:16 | I |     + error = [1.1939]
25-01-14 01:01:16 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:01:18 | I |       - range scale = [    1.0000]
25-01-14 01:01:18 | I |         sum  error  = [    1.7542]
25-01-14 01:01:18 | I |         best error  = [    1.7542]
25-01-14 01:01:18 | I |     + error = [1.7542]
25-01-14 01:01:21 | I |       - range scale = [    1.0000]
25-01-14 01:01:21 | I |         sum  error  = [    3.2499]
25-01-14 01:01:21 | I |         best error  = [    3.2499]
25-01-14 01:01:21 | I |     + error = [3.2499]
25-01-14 01:01:21 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:01:22 | I |       - range scale = [    1.0000]
25-01-14 01:01:22 | I |         sum  error  = [    0.2484]
25-01-14 01:01:22 | I |         best error  = [    0.2484]
25-01-14 01:01:22 | I |     + error = [0.2484]
25-01-14 01:01:22 | I |       - range scale = [    1.0000]
25-01-14 01:01:22 | I |         sum  error  = [    0.3289]
25-01-14 01:01:22 | I |         best error  = [    0.3289]
25-01-14 01:01:22 | I |     + error = [0.3289]
25-01-14 01:01:23 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:01:23 | I |       - range scale = [    1.0000]
25-01-14 01:01:23 | I |         sum  error  = [    0.1445]
25-01-14 01:01:23 | I |         best error  = [    0.1445]
25-01-14 01:01:23 | I |     + error = [0.1445]
25-01-14 01:01:24 | I |       - range scale = [    1.0000]
25-01-14 01:01:24 | I |         sum  error  = [    0.2700]
25-01-14 01:01:24 | I |         best error  = [    0.2700]
25-01-14 01:01:24 | I |     + error = [0.2700]
25-01-14 01:01:24 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:01:25 | I |       - range scale = [    1.0000]
25-01-14 01:01:25 | I |         sum  error  = [    1.0054]
25-01-14 01:01:25 | I |         best error  = [    1.0054]
25-01-14 01:01:25 | I |     + error = [1.0054]
25-01-14 01:01:26 | I |       - range scale = [    1.0000]
25-01-14 01:01:26 | I |         sum  error  = [    1.3553]
25-01-14 01:01:26 | I |         best error  = [    1.3553]
25-01-14 01:01:26 | I |     + error = [1.3553]
25-01-14 01:01:27 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:01:27 | I |       - range scale = [    1.0000]
25-01-14 01:01:27 | I |         sum  error  = [    1.1401]
25-01-14 01:01:27 | I |         best error  = [    1.1401]
25-01-14 01:01:27 | I |     + error = [1.1401]
25-01-14 01:01:28 | I |       - range scale = [    1.0000]
25-01-14 01:01:28 | I |         sum  error  = [    1.5277]
25-01-14 01:01:28 | I |         best error  = [    1.5277]
25-01-14 01:01:28 | I |     + error = [1.5277]
25-01-14 01:01:29 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:01:29 | I |       - range scale = [    1.0000]
25-01-14 01:01:29 | I |         sum  error  = [    0.1705]
25-01-14 01:01:29 | I |         best error  = [    0.1705]
25-01-14 01:01:29 | I |     + error = [0.1705]
25-01-14 01:01:30 | I |       - range scale = [    1.0000]
25-01-14 01:01:30 | I |         sum  error  = [    0.2278]
25-01-14 01:01:30 | I |         best error  = [    0.2278]
25-01-14 01:01:30 | I |     + error = [0.2278]
25-01-14 01:01:31 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:01:33 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:01:36 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:01:38 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:01:41 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:01:43 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:01:46 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:01:52 | I | quantizing activations for layer model.layers.0
25-01-14 01:01:52 | I | collecting info in model.layers.0
25-01-14 01:01:52 | I | collecting info in model.layers.0
25-01-14 01:01:53 | I | collecting info in model.layers.0
25-01-14 01:01:53 | I | collecting info in model.layers.0
25-01-14 01:01:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:55 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:55 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:56 | I | collecting calibration activations in model.layers.0
25-01-14 01:01:58 | I | forward this layer
25-01-14 01:01:58 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/30.pt
25-01-14 01:01:58 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/30.pt
25-01-14 01:01:59 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:01:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 16           |        cudaMalloc retries: 19        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  19171 GiB |  19149 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  18976 GiB |  18954 GiB |
|       from small pool |      3 MiB |      5 MiB |    195 GiB |    195 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  19171 GiB |  19149 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  18976 GiB |  18954 GiB |
|       from small pool |      3 MiB |      5 MiB |    195 GiB |    195 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  19133 GiB |  19111 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  18939 GiB |  18917 GiB |
|       from small pool |      3 MiB |      5 MiB |    194 GiB |    194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1179 GiB |   1156 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1178 GiB |   1155 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   8807 GiB |   8806 GiB |
|       from large pool |    943 MiB |   1689 MiB |   8581 GiB |   8581 GiB |
|       from small pool |      0 MiB |      4 MiB |    225 GiB |    225 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    3977 K  |    3977 K  |
|       from large pool |     186    |     223    |     552 K  |     552 K  |
|       from small pool |     109    |     111    |    3424 K  |    3424 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    3977 K  |    3977 K  |
|       from large pool |     186    |     223    |     552 K  |     552 K  |
|       from small pool |     109    |     111    |    3424 K  |    3424 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    2972    |    2796    |
|       from large pool |     174    |     174    |    2398    |    2224    |
|       from small pool |       2    |       4    |     574    |     572    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    1731 K  |    1731 K  |
|       from large pool |      20    |      24    |     206 K  |     206 K  |
|       from small pool |       8    |      16    |    1524 K  |    1524 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  12666 MiB |   5718 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12615 MiB |   5667 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  12666 MiB |   5718 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12615 MiB |   5667 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  12564 MiB |   5616 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  12513 MiB |   5565 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  13208 MiB |   6258 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13204 MiB |   6256 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 752636 KiB | 750885 KiB |
|       from large pool |      0 KiB |  19104 KiB | 696320 KiB | 696320 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  56316 KiB |  54565 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     530    |     350    |
|       from large pool |     126    |     128    |     364    |     238    |
|       from small pool |      54    |      56    |     166    |     112    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     530    |     350    |
|       from large pool |     126    |     128    |     364    |     238    |
|       from small pool |      54    |      56    |     166    |     112    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     332    |     205    |
|       from large pool |     126    |     128    |     330    |     204    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      36    |      35    |
|       from large pool |       0    |       1    |      34    |      34    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  12666 MiB |   5718 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12615 MiB |   5667 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  12666 MiB |   5718 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12615 MiB |   5667 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  12564 MiB |   5616 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  12513 MiB |   5565 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  13208 MiB |   6258 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13204 MiB |   6256 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB | 752636 KiB | 750885 KiB |
|       from large pool |      0 KiB |  19104 KiB | 696320 KiB | 696320 KiB |
|       from small pool |   1751 KiB |   2047 KiB |  56316 KiB |  54565 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     530    |     350    |
|       from large pool |     126    |     128    |     364    |     238    |
|       from small pool |      54    |      56    |     166    |     112    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     530    |     350    |
|       from large pool |     126    |     128    |     364    |     238    |
|       from small pool |      54    |      56    |     166    |     112    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     332    |     205    |
|       from large pool |     126    |     128    |     330    |     204    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      36    |      35    |
|       from large pool |       0    |       1    |      34    |      34    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  11622 MiB |   5718 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11571 MiB |   5667 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  11622 MiB |   5718 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11571 MiB |   5667 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  11520 MiB |   5616 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  11469 MiB |   5565 MiB |
|       from small pool |      0 MiB |      1 MiB |     51 MiB |     51 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  12164 MiB |   6258 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12160 MiB |   6256 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB | 752635 KiB | 751091 KiB |
|       from large pool |      0 KiB |  19104 KiB | 696320 KiB | 696320 KiB |
|       from small pool |   1544 KiB |   2047 KiB |  56315 KiB |  54771 KiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     497    |     349    |
|       from large pool |     100    |     102    |     338    |     238    |
|       from small pool |      48    |      50    |     159    |     111    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     497    |     349    |
|       from large pool |     100    |     102    |     338    |     238    |
|       from small pool |      48    |      50    |     159    |     111    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     306    |     205    |
|       from large pool |     100    |     102    |     304    |     204    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      36    |      35    |
|       from large pool |       0    |       1    |      34    |      34    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:01:59 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:01:59 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:01:59 | I | in layer model.layers.0
25-01-14 01:01:59 | I | quantizing weights for layer model.layers.0
25-01-14 01:01:59 | I | collecting info in model.layers.0
25-01-14 01:01:59 | I | collecting info in model.layers.0
25-01-14 01:02:00 | I | collecting info in model.layers.0
25-01-14 01:02:00 | I | collecting info in model.layers.0
25-01-14 01:02:01 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:04 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:02:04 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:02:06 | I |       - range scale = [    1.0000]
25-01-14 01:02:06 | I |         sum  error  = [    0.5175]
25-01-14 01:02:06 | I |         best error  = [    0.5175]
25-01-14 01:02:06 | I |     + error = [0.5175]
25-01-14 01:02:08 | I |       - range scale = [    1.0000]
25-01-14 01:02:08 | I |         sum  error  = [    1.1914]
25-01-14 01:02:08 | I |         best error  = [    1.1914]
25-01-14 01:02:08 | I |     + error = [1.1914]
25-01-14 01:02:09 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:02:11 | I |       - range scale = [    1.0000]
25-01-14 01:02:11 | I |         sum  error  = [    1.8147]
25-01-14 01:02:11 | I |         best error  = [    1.8147]
25-01-14 01:02:11 | I |     + error = [1.8147]
25-01-14 01:02:13 | I |       - range scale = [    1.0000]
25-01-14 01:02:13 | I |         sum  error  = [    3.3825]
25-01-14 01:02:13 | I |         best error  = [    3.3825]
25-01-14 01:02:13 | I |     + error = [3.3825]
25-01-14 01:02:13 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:02:14 | I |       - range scale = [    1.0000]
25-01-14 01:02:14 | I |         sum  error  = [    0.2508]
25-01-14 01:02:14 | I |         best error  = [    0.2508]
25-01-14 01:02:14 | I |     + error = [0.2508]
25-01-14 01:02:15 | I |       - range scale = [    1.0000]
25-01-14 01:02:15 | I |         sum  error  = [    0.3339]
25-01-14 01:02:15 | I |         best error  = [    0.3339]
25-01-14 01:02:15 | I |     + error = [0.3339]
25-01-14 01:02:15 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:02:16 | I |       - range scale = [    1.0000]
25-01-14 01:02:16 | I |         sum  error  = [    0.1490]
25-01-14 01:02:16 | I |         best error  = [    0.1490]
25-01-14 01:02:16 | I |     + error = [0.1490]
25-01-14 01:02:17 | I |       - range scale = [    1.0000]
25-01-14 01:02:17 | I |         sum  error  = [    0.2529]
25-01-14 01:02:17 | I |         best error  = [    0.2529]
25-01-14 01:02:17 | I |     + error = [0.2529]
25-01-14 01:02:17 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:02:18 | I |       - range scale = [    1.0000]
25-01-14 01:02:18 | I |         sum  error  = [    0.9595]
25-01-14 01:02:18 | I |         best error  = [    0.9595]
25-01-14 01:02:18 | I |     + error = [0.9595]
25-01-14 01:02:19 | I |       - range scale = [    1.0000]
25-01-14 01:02:19 | I |         sum  error  = [    1.2888]
25-01-14 01:02:19 | I |         best error  = [    1.2888]
25-01-14 01:02:19 | I |     + error = [1.2888]
25-01-14 01:02:19 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:02:20 | I |       - range scale = [    1.0000]
25-01-14 01:02:20 | I |         sum  error  = [    1.0944]
25-01-14 01:02:20 | I |         best error  = [    1.0944]
25-01-14 01:02:20 | I |     + error = [1.0944]
25-01-14 01:02:21 | I |       - range scale = [    1.0000]
25-01-14 01:02:21 | I |         sum  error  = [    1.4694]
25-01-14 01:02:21 | I |         best error  = [    1.4694]
25-01-14 01:02:21 | I |     + error = [1.4694]
25-01-14 01:02:21 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:02:22 | I |       - range scale = [    1.0000]
25-01-14 01:02:22 | I |         sum  error  = [    0.1645]
25-01-14 01:02:22 | I |         best error  = [    0.1645]
25-01-14 01:02:22 | I |     + error = [0.1645]
25-01-14 01:02:23 | I |       - range scale = [    1.0000]
25-01-14 01:02:23 | I |         sum  error  = [    0.2244]
25-01-14 01:02:23 | I |         best error  = [    0.2244]
25-01-14 01:02:23 | I |     + error = [0.2244]
25-01-14 01:02:23 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:02:25 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:02:28 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:02:30 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:02:33 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:02:35 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:02:38 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:02:44 | I | quantizing activations for layer model.layers.0
25-01-14 01:02:44 | I | collecting info in model.layers.0
25-01-14 01:02:45 | I | collecting info in model.layers.0
25-01-14 01:02:45 | I | collecting info in model.layers.0
25-01-14 01:02:45 | I | collecting info in model.layers.0
25-01-14 01:02:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:51 | I | forward this layer
25-01-14 01:02:51 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/32.pt
25-01-14 01:02:51 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/32.pt
25-01-14 01:02:51 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:02:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 17           |        cudaMalloc retries: 20        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  21058 GiB |  21036 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  20849 GiB |  20827 GiB |
|       from small pool |      3 MiB |      5 MiB |    209 GiB |    209 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  21058 GiB |  21036 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  20849 GiB |  20827 GiB |
|       from small pool |      3 MiB |      5 MiB |    209 GiB |    209 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  21018 GiB |  20996 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  20810 GiB |  20788 GiB |
|       from small pool |      3 MiB |      5 MiB |    208 GiB |    208 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1247 GiB |   1224 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1245 GiB |   1222 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |   9775 GiB |   9775 GiB |
|       from large pool |    943 MiB |   1689 MiB |   9534 GiB |   9533 GiB |
|       from small pool |      0 MiB |      4 MiB |    241 GiB |    241 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    4276 K  |    4275 K  |
|       from large pool |     186    |     223    |     596 K  |     596 K  |
|       from small pool |     109    |     111    |    3679 K  |    3679 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    4276 K  |    4275 K  |
|       from large pool |     186    |     223    |     596 K  |     596 K  |
|       from small pool |     109    |     111    |    3679 K  |    3679 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    3130    |    2954    |
|       from large pool |     174    |     174    |    2521    |    2347    |
|       from small pool |       2    |       4    |     609    |     607    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    1853 K  |    1853 K  |
|       from large pool |      21    |      24    |     221 K  |     220 K  |
|       from small pool |       8    |      16    |    1632 K  |    1632 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:02:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  13003 MiB |   6054 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12948 MiB |   6000 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  13003 MiB |   6054 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12948 MiB |   6000 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  12895 MiB |   5946 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  12840 MiB |   5892 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  13576 MiB |   6626 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13572 MiB |   6624 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    777 MiB |    776 MiB |
|       from large pool |      0 KiB |  19104 KiB |    720 MiB |    720 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     57 MiB |     56 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     550    |     370    |
|       from large pool |     126    |     128    |     378    |     252    |
|       from small pool |      54    |      56    |     172    |     118    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     550    |     370    |
|       from large pool |     126    |     128    |     378    |     252    |
|       from small pool |      54    |      56    |     172    |     118    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     344    |     217    |
|       from large pool |     126    |     128    |     342    |     216    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      38    |      37    |
|       from large pool |       0    |       1    |      36    |      36    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:02:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  13003 MiB |   6054 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12948 MiB |   6000 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  13003 MiB |   6054 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  12948 MiB |   6000 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  12895 MiB |   5946 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  12840 MiB |   5892 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  13576 MiB |   6626 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13572 MiB |   6624 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    777 MiB |    776 MiB |
|       from large pool |      0 KiB |  19104 KiB |    720 MiB |    720 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     57 MiB |     56 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     550    |     370    |
|       from large pool |     126    |     128    |     378    |     252    |
|       from small pool |      54    |      56    |     172    |     118    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     550    |     370    |
|       from large pool |     126    |     128    |     378    |     252    |
|       from small pool |      54    |      56    |     172    |     118    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     344    |     217    |
|       from large pool |     126    |     128    |     342    |     216    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      38    |      37    |
|       from large pool |       0    |       1    |      36    |      36    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:02:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  11959 MiB |   6054 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11904 MiB |   6000 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  11959 MiB |   6054 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  11904 MiB |   6000 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  11851 MiB |   5946 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  11796 MiB |   5892 MiB |
|       from small pool |      0 MiB |      1 MiB |     54 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  12532 MiB |   6626 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12528 MiB |   6624 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |    777 MiB |    776 MiB |
|       from large pool |      0 KiB |  19104 KiB |    720 MiB |    720 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     57 MiB |     56 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     517    |     369    |
|       from large pool |     100    |     102    |     352    |     252    |
|       from small pool |      48    |      50    |     165    |     117    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     517    |     369    |
|       from large pool |     100    |     102    |     352    |     252    |
|       from small pool |      48    |      50    |     165    |     117    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     318    |     217    |
|       from large pool |     100    |     102    |     316    |     216    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      38    |      37    |
|       from large pool |       0    |       1    |      36    |      36    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:02:51 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:02:51 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:02:51 | I | in layer model.layers.0
25-01-14 01:02:51 | I | quantizing weights for layer model.layers.0
25-01-14 01:02:51 | I | collecting info in model.layers.0
25-01-14 01:02:52 | I | collecting info in model.layers.0
25-01-14 01:02:52 | I | collecting info in model.layers.0
25-01-14 01:02:53 | I | collecting info in model.layers.0
25-01-14 01:02:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:55 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:56 | I | collecting calibration activations in model.layers.0
25-01-14 01:02:56 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:02:56 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:02:59 | I |       - range scale = [    1.0000]
25-01-14 01:02:59 | I |         sum  error  = [    0.5191]
25-01-14 01:02:59 | I |         best error  = [    0.5191]
25-01-14 01:02:59 | I |     + error = [0.5191]
25-01-14 01:03:01 | I |       - range scale = [    1.0000]
25-01-14 01:03:01 | I |         sum  error  = [    1.2259]
25-01-14 01:03:01 | I |         best error  = [    1.2259]
25-01-14 01:03:01 | I |     + error = [1.2259]
25-01-14 01:03:01 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:03:04 | I |       - range scale = [    1.0000]
25-01-14 01:03:04 | I |         sum  error  = [    1.8934]
25-01-14 01:03:04 | I |         best error  = [    1.8934]
25-01-14 01:03:04 | I |     + error = [1.8934]
25-01-14 01:03:06 | I |       - range scale = [    1.0000]
25-01-14 01:03:06 | I |         sum  error  = [    3.4076]
25-01-14 01:03:06 | I |         best error  = [    3.4076]
25-01-14 01:03:06 | I |     + error = [3.4076]
25-01-14 01:03:06 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:03:07 | I |       - range scale = [    1.0000]
25-01-14 01:03:07 | I |         sum  error  = [    0.2526]
25-01-14 01:03:07 | I |         best error  = [    0.2526]
25-01-14 01:03:07 | I |     + error = [0.2526]
25-01-14 01:03:08 | I |       - range scale = [    1.0000]
25-01-14 01:03:08 | I |         sum  error  = [    0.3292]
25-01-14 01:03:08 | I |         best error  = [    0.3292]
25-01-14 01:03:08 | I |     + error = [0.3292]
25-01-14 01:03:08 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:03:09 | I |       - range scale = [    1.0000]
25-01-14 01:03:09 | I |         sum  error  = [    0.1484]
25-01-14 01:03:09 | I |         best error  = [    0.1484]
25-01-14 01:03:09 | I |     + error = [0.1484]
25-01-14 01:03:10 | I |       - range scale = [    1.0000]
25-01-14 01:03:10 | I |         sum  error  = [    0.2548]
25-01-14 01:03:10 | I |         best error  = [    0.2548]
25-01-14 01:03:10 | I |     + error = [0.2548]
25-01-14 01:03:10 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:03:11 | I |       - range scale = [    1.0000]
25-01-14 01:03:11 | I |         sum  error  = [    0.9581]
25-01-14 01:03:11 | I |         best error  = [    0.9581]
25-01-14 01:03:11 | I |     + error = [0.9581]
25-01-14 01:03:12 | I |       - range scale = [    1.0000]
25-01-14 01:03:12 | I |         sum  error  = [    1.2648]
25-01-14 01:03:12 | I |         best error  = [    1.2648]
25-01-14 01:03:12 | I |     + error = [1.2648]
25-01-14 01:03:12 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:03:13 | I |       - range scale = [    1.0000]
25-01-14 01:03:13 | I |         sum  error  = [    1.0967]
25-01-14 01:03:13 | I |         best error  = [    1.0967]
25-01-14 01:03:13 | I |     + error = [1.0967]
25-01-14 01:03:14 | I |       - range scale = [    1.0000]
25-01-14 01:03:14 | I |         sum  error  = [    1.4423]
25-01-14 01:03:14 | I |         best error  = [    1.4423]
25-01-14 01:03:14 | I |     + error = [1.4423]
25-01-14 01:03:14 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:03:15 | I |       - range scale = [    1.0000]
25-01-14 01:03:15 | I |         sum  error  = [    0.1603]
25-01-14 01:03:15 | I |         best error  = [    0.1603]
25-01-14 01:03:15 | I |     + error = [0.1603]
25-01-14 01:03:16 | I |       - range scale = [    1.0000]
25-01-14 01:03:16 | I |         sum  error  = [    0.2191]
25-01-14 01:03:16 | I |         best error  = [    0.2191]
25-01-14 01:03:16 | I |     + error = [0.2191]
25-01-14 01:03:16 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:03:19 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:03:21 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:03:23 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:03:26 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:03:28 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:03:31 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:03:37 | I | quantizing activations for layer model.layers.0
25-01-14 01:03:37 | I | collecting info in model.layers.0
25-01-14 01:03:38 | I | collecting info in model.layers.0
25-01-14 01:03:38 | I | collecting info in model.layers.0
25-01-14 01:03:39 | I | collecting info in model.layers.0
25-01-14 01:03:39 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:40 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:41 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:41 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:44 | I | forward this layer
25-01-14 01:03:44 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/34.pt
25-01-14 01:03:44 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/34.pt
25-01-14 01:03:44 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:03:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 18           |        cudaMalloc retries: 21        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  23030 GiB |  23008 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  22806 GiB |  22784 GiB |
|       from small pool |      3 MiB |      5 MiB |    223 GiB |    223 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  23030 GiB |  23008 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  22806 GiB |  22784 GiB |
|       from small pool |      3 MiB |      5 MiB |    223 GiB |    223 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  22989 GiB |  22967 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  22766 GiB |  22744 GiB |
|       from small pool |      3 MiB |      5 MiB |    223 GiB |    223 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1316 GiB |   1293 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1314 GiB |   1291 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  10783 GiB |  10782 GiB |
|       from large pool |    943 MiB |   1689 MiB |  10524 GiB |  10523 GiB |
|       from small pool |      0 MiB |      4 MiB |    258 GiB |    258 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    4581 K  |    4581 K  |
|       from large pool |     186    |     223    |     642 K  |     641 K  |
|       from small pool |     109    |     111    |    3939 K  |    3939 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    4581 K  |    4581 K  |
|       from large pool |     186    |     223    |     642 K  |     641 K  |
|       from small pool |     109    |     111    |    3939 K  |    3939 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    3294    |    3118    |
|       from large pool |     174    |     174    |    2650    |    2476    |
|       from small pool |       2    |       4    |     644    |     642    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    1978 K  |    1978 K  |
|       from large pool |      20    |      24    |     235 K  |     235 K  |
|       from small pool |       8    |      16    |    1743 K  |    1743 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:03:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  13339 MiB |   6391 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13282 MiB |   6334 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  13339 MiB |   6391 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13282 MiB |   6334 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  13225 MiB |   6277 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  13168 MiB |   6220 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  13944 MiB |   6994 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13940 MiB |   6992 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    820 MiB |    819 MiB |
|       from large pool |      0 KiB |  19104 KiB |    760 MiB |    760 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     60 MiB |     59 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     570    |     390    |
|       from large pool |     126    |     128    |     392    |     266    |
|       from small pool |      54    |      56    |     178    |     124    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     570    |     390    |
|       from large pool |     126    |     128    |     392    |     266    |
|       from small pool |      54    |      56    |     178    |     124    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     356    |     229    |
|       from large pool |     126    |     128    |     354    |     228    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      40    |      39    |
|       from large pool |       0    |       1    |      38    |      38    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:03:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  13339 MiB |   6391 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13282 MiB |   6334 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  13339 MiB |   6391 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13282 MiB |   6334 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  13225 MiB |   6277 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  13168 MiB |   6220 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  13944 MiB |   6994 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13940 MiB |   6992 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    820 MiB |    819 MiB |
|       from large pool |      0 KiB |  19104 KiB |    760 MiB |    760 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     60 MiB |     59 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     570    |     390    |
|       from large pool |     126    |     128    |     392    |     266    |
|       from small pool |      54    |      56    |     178    |     124    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     570    |     390    |
|       from large pool |     126    |     128    |     392    |     266    |
|       from small pool |      54    |      56    |     178    |     124    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     356    |     229    |
|       from large pool |     126    |     128    |     354    |     228    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      40    |      39    |
|       from large pool |       0    |       1    |      38    |      38    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:03:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  12295 MiB |   6391 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12238 MiB |   6334 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  12295 MiB |   6391 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12238 MiB |   6334 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  12181 MiB |   6277 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  12124 MiB |   6220 MiB |
|       from small pool |      0 MiB |      1 MiB |     57 MiB |     57 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  12900 MiB |   6994 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12896 MiB |   6992 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |    820 MiB |    819 MiB |
|       from large pool |      0 KiB |  19104 KiB |    760 MiB |    760 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     60 MiB |     59 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     537    |     389    |
|       from large pool |     100    |     102    |     366    |     266    |
|       from small pool |      48    |      50    |     171    |     123    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     537    |     389    |
|       from large pool |     100    |     102    |     366    |     266    |
|       from small pool |      48    |      50    |     171    |     123    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     330    |     229    |
|       from large pool |     100    |     102    |     328    |     228    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      40    |      39    |
|       from large pool |       0    |       1    |      38    |      38    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:03:44 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:03:45 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:03:45 | I | in layer model.layers.0
25-01-14 01:03:45 | I | quantizing weights for layer model.layers.0
25-01-14 01:03:45 | I | collecting info in model.layers.0
25-01-14 01:03:45 | I | collecting info in model.layers.0
25-01-14 01:03:45 | I | collecting info in model.layers.0
25-01-14 01:03:46 | I | collecting info in model.layers.0
25-01-14 01:03:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:03:50 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:03:50 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:03:52 | I |       - range scale = [    1.0000]
25-01-14 01:03:52 | I |         sum  error  = [    0.5252]
25-01-14 01:03:52 | I |         best error  = [    0.5252]
25-01-14 01:03:52 | I |     + error = [0.5252]
25-01-14 01:03:55 | I |       - range scale = [    1.0000]
25-01-14 01:03:55 | I |         sum  error  = [    1.2337]
25-01-14 01:03:55 | I |         best error  = [    1.2337]
25-01-14 01:03:55 | I |     + error = [1.2337]
25-01-14 01:03:55 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:03:57 | I |       - range scale = [    1.0000]
25-01-14 01:03:57 | I |         sum  error  = [    1.8524]
25-01-14 01:03:57 | I |         best error  = [    1.8524]
25-01-14 01:03:57 | I |     + error = [1.8524]
25-01-14 01:04:00 | I |       - range scale = [    1.0000]
25-01-14 01:04:00 | I |         sum  error  = [    3.4742]
25-01-14 01:04:00 | I |         best error  = [    3.4742]
25-01-14 01:04:00 | I |     + error = [3.4742]
25-01-14 01:04:00 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:04:01 | I |       - range scale = [    1.0000]
25-01-14 01:04:01 | I |         sum  error  = [    0.2582]
25-01-14 01:04:01 | I |         best error  = [    0.2582]
25-01-14 01:04:01 | I |     + error = [0.2582]
25-01-14 01:04:02 | I |       - range scale = [    1.0000]
25-01-14 01:04:02 | I |         sum  error  = [    0.3197]
25-01-14 01:04:02 | I |         best error  = [    0.3197]
25-01-14 01:04:02 | I |     + error = [0.3197]
25-01-14 01:04:02 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:04:02 | I |       - range scale = [    1.0000]
25-01-14 01:04:02 | I |         sum  error  = [    0.1495]
25-01-14 01:04:02 | I |         best error  = [    0.1495]
25-01-14 01:04:02 | I |     + error = [0.1495]
25-01-14 01:04:03 | I |       - range scale = [    1.0000]
25-01-14 01:04:03 | I |         sum  error  = [    0.2499]
25-01-14 01:04:03 | I |         best error  = [    0.2499]
25-01-14 01:04:03 | I |     + error = [0.2499]
25-01-14 01:04:03 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:04:04 | I |       - range scale = [    1.0000]
25-01-14 01:04:04 | I |         sum  error  = [    0.9644]
25-01-14 01:04:04 | I |         best error  = [    0.9644]
25-01-14 01:04:04 | I |     + error = [0.9644]
25-01-14 01:04:05 | I |       - range scale = [    1.0000]
25-01-14 01:04:05 | I |         sum  error  = [    1.2487]
25-01-14 01:04:05 | I |         best error  = [    1.2487]
25-01-14 01:04:05 | I |     + error = [1.2487]
25-01-14 01:04:05 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:04:06 | I |       - range scale = [    1.0000]
25-01-14 01:04:06 | I |         sum  error  = [    1.1038]
25-01-14 01:04:06 | I |         best error  = [    1.1038]
25-01-14 01:04:06 | I |     + error = [1.1038]
25-01-14 01:04:07 | I |       - range scale = [    1.0000]
25-01-14 01:04:07 | I |         sum  error  = [    1.4588]
25-01-14 01:04:07 | I |         best error  = [    1.4588]
25-01-14 01:04:07 | I |     + error = [1.4588]
25-01-14 01:04:08 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:04:08 | I |       - range scale = [    1.0000]
25-01-14 01:04:08 | I |         sum  error  = [    0.1602]
25-01-14 01:04:08 | I |         best error  = [    0.1602]
25-01-14 01:04:08 | I |     + error = [0.1602]
25-01-14 01:04:09 | I |       - range scale = [    1.0000]
25-01-14 01:04:09 | I |         sum  error  = [    0.2165]
25-01-14 01:04:09 | I |         best error  = [    0.2165]
25-01-14 01:04:09 | I |     + error = [0.2165]
25-01-14 01:04:10 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:04:12 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:04:14 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:04:17 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:04:19 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:04:22 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:04:24 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:04:31 | I | quantizing activations for layer model.layers.0
25-01-14 01:04:31 | I | collecting info in model.layers.0
25-01-14 01:04:31 | I | collecting info in model.layers.0
25-01-14 01:04:31 | I | collecting info in model.layers.0
25-01-14 01:04:32 | I | collecting info in model.layers.0
25-01-14 01:04:33 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:35 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:37 | I | forward this layer
25-01-14 01:04:37 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/36.pt
25-01-14 01:04:37 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/36.pt
25-01-14 01:04:38 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:04:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 19           |        cudaMalloc retries: 22        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  25088 GiB |  25066 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  24849 GiB |  24827 GiB |
|       from small pool |      3 MiB |      5 MiB |    238 GiB |    238 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  25088 GiB |  25066 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  24849 GiB |  24827 GiB |
|       from small pool |      3 MiB |      5 MiB |    238 GiB |    238 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  25045 GiB |  25023 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  24807 GiB |  24785 GiB |
|       from small pool |      3 MiB |      5 MiB |    237 GiB |    237 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1383 GiB |   1360 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1382 GiB |   1359 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  11854 GiB |  11853 GiB |
|       from large pool |    943 MiB |   1689 MiB |  11578 GiB |  11577 GiB |
|       from small pool |      0 MiB |      4 MiB |    276 GiB |    276 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    4894 K  |    4894 K  |
|       from large pool |     186    |     223    |     688 K  |     688 K  |
|       from small pool |     109    |     111    |    4205 K  |    4205 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    4894 K  |    4894 K  |
|       from large pool |     186    |     223    |     688 K  |     688 K  |
|       from small pool |     109    |     111    |    4205 K  |    4205 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    3452    |    3276    |
|       from large pool |     174    |     174    |    2773    |    2599    |
|       from small pool |       2    |       4    |     679    |     677    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    2106 K  |    2106 K  |
|       from large pool |      21    |      24    |     249 K  |     249 K  |
|       from small pool |       8    |      16    |    1856 K  |    1856 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:04:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  13675 MiB |   6727 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13615 MiB |   6667 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  13675 MiB |   6727 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13615 MiB |   6667 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  13555 MiB |   6607 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  13495 MiB |   6547 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  14312 MiB |   7362 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14308 MiB |   7360 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    863 MiB |    862 MiB |
|       from large pool |      0 KiB |  19104 KiB |    800 MiB |    800 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     63 MiB |     62 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     590    |     410    |
|       from large pool |     126    |     128    |     406    |     280    |
|       from small pool |      54    |      56    |     184    |     130    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     590    |     410    |
|       from large pool |     126    |     128    |     406    |     280    |
|       from small pool |      54    |      56    |     184    |     130    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     368    |     241    |
|       from large pool |     126    |     128    |     366    |     240    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      42    |      41    |
|       from large pool |       0    |       1    |      40    |      40    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:04:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  13675 MiB |   6727 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13615 MiB |   6667 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  13675 MiB |   6727 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13615 MiB |   6667 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  13555 MiB |   6607 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  13495 MiB |   6547 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  14312 MiB |   7362 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14308 MiB |   7360 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    863 MiB |    862 MiB |
|       from large pool |      0 KiB |  19104 KiB |    800 MiB |    800 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     63 MiB |     62 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     590    |     410    |
|       from large pool |     126    |     128    |     406    |     280    |
|       from small pool |      54    |      56    |     184    |     130    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     590    |     410    |
|       from large pool |     126    |     128    |     406    |     280    |
|       from small pool |      54    |      56    |     184    |     130    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     368    |     241    |
|       from large pool |     126    |     128    |     366    |     240    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      42    |      41    |
|       from large pool |       0    |       1    |      40    |      40    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:04:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  12631 MiB |   6727 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12571 MiB |   6667 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  12631 MiB |   6727 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12571 MiB |   6667 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  12511 MiB |   6607 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  12451 MiB |   6547 MiB |
|       from small pool |      0 MiB |      1 MiB |     60 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  13268 MiB |   7362 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13264 MiB |   7360 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |    863 MiB |    862 MiB |
|       from large pool |      0 KiB |  19104 KiB |    800 MiB |    800 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     63 MiB |     62 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     557    |     409    |
|       from large pool |     100    |     102    |     380    |     280    |
|       from small pool |      48    |      50    |     177    |     129    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     557    |     409    |
|       from large pool |     100    |     102    |     380    |     280    |
|       from small pool |      48    |      50    |     177    |     129    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     342    |     241    |
|       from large pool |     100    |     102    |     340    |     240    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      42    |      41    |
|       from large pool |       0    |       1    |      40    |      40    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:04:38 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:04:38 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:04:38 | I | in layer model.layers.0
25-01-14 01:04:38 | I | quantizing weights for layer model.layers.0
25-01-14 01:04:38 | I | collecting info in model.layers.0
25-01-14 01:04:38 | I | collecting info in model.layers.0
25-01-14 01:04:39 | I | collecting info in model.layers.0
25-01-14 01:04:39 | I | collecting info in model.layers.0
25-01-14 01:04:40 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:41 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:42 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:42 | I | collecting calibration activations in model.layers.0
25-01-14 01:04:43 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:04:43 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:04:46 | I |       - range scale = [    1.0000]
25-01-14 01:04:46 | I |         sum  error  = [    0.5253]
25-01-14 01:04:46 | I |         best error  = [    0.5253]
25-01-14 01:04:46 | I |     + error = [0.5253]
25-01-14 01:04:48 | I |       - range scale = [    1.0000]
25-01-14 01:04:48 | I |         sum  error  = [    1.2087]
25-01-14 01:04:48 | I |         best error  = [    1.2087]
25-01-14 01:04:48 | I |     + error = [1.2087]
25-01-14 01:04:49 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:04:51 | I |       - range scale = [    1.0000]
25-01-14 01:04:51 | I |         sum  error  = [    1.7842]
25-01-14 01:04:51 | I |         best error  = [    1.7842]
25-01-14 01:04:51 | I |     + error = [1.7842]
25-01-14 01:04:54 | I |       - range scale = [    1.0000]
25-01-14 01:04:54 | I |         sum  error  = [    3.2991]
25-01-14 01:04:54 | I |         best error  = [    3.2991]
25-01-14 01:04:54 | I |     + error = [3.2991]
25-01-14 01:04:54 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:04:55 | I |       - range scale = [    1.0000]
25-01-14 01:04:55 | I |         sum  error  = [    0.2503]
25-01-14 01:04:55 | I |         best error  = [    0.2503]
25-01-14 01:04:55 | I |     + error = [0.2503]
25-01-14 01:04:55 | I |       - range scale = [    1.0000]
25-01-14 01:04:55 | I |         sum  error  = [    0.3070]
25-01-14 01:04:55 | I |         best error  = [    0.3070]
25-01-14 01:04:55 | I |     + error = [0.3070]
25-01-14 01:04:56 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:04:56 | I |       - range scale = [    1.0000]
25-01-14 01:04:56 | I |         sum  error  = [    0.1477]
25-01-14 01:04:56 | I |         best error  = [    0.1477]
25-01-14 01:04:56 | I |     + error = [0.1477]
25-01-14 01:04:57 | I |       - range scale = [    1.0000]
25-01-14 01:04:57 | I |         sum  error  = [    0.2432]
25-01-14 01:04:57 | I |         best error  = [    0.2432]
25-01-14 01:04:57 | I |     + error = [0.2432]
25-01-14 01:04:57 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:04:58 | I |       - range scale = [    1.0000]
25-01-14 01:04:58 | I |         sum  error  = [    0.9645]
25-01-14 01:04:58 | I |         best error  = [    0.9645]
25-01-14 01:04:58 | I |     + error = [0.9645]
25-01-14 01:04:59 | I |       - range scale = [    1.0000]
25-01-14 01:04:59 | I |         sum  error  = [    1.2491]
25-01-14 01:04:59 | I |         best error  = [    1.2491]
25-01-14 01:04:59 | I |     + error = [1.2491]
25-01-14 01:04:59 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:05:00 | I |       - range scale = [    1.0000]
25-01-14 01:05:00 | I |         sum  error  = [    1.0956]
25-01-14 01:05:00 | I |         best error  = [    1.0956]
25-01-14 01:05:00 | I |     + error = [1.0956]
25-01-14 01:05:01 | I |       - range scale = [    1.0000]
25-01-14 01:05:01 | I |         sum  error  = [    1.4131]
25-01-14 01:05:01 | I |         best error  = [    1.4131]
25-01-14 01:05:01 | I |     + error = [1.4131]
25-01-14 01:05:01 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:05:02 | I |       - range scale = [    1.0000]
25-01-14 01:05:02 | I |         sum  error  = [    0.1654]
25-01-14 01:05:02 | I |         best error  = [    0.1654]
25-01-14 01:05:02 | I |     + error = [0.1654]
25-01-14 01:05:03 | I |       - range scale = [    1.0000]
25-01-14 01:05:03 | I |         sum  error  = [    0.2163]
25-01-14 01:05:03 | I |         best error  = [    0.2163]
25-01-14 01:05:03 | I |     + error = [0.2163]
25-01-14 01:05:03 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:05:06 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:05:08 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:05:11 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:05:13 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:05:16 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:05:18 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:05:25 | I | quantizing activations for layer model.layers.0
25-01-14 01:05:25 | I | collecting info in model.layers.0
25-01-14 01:05:25 | I | collecting info in model.layers.0
25-01-14 01:05:26 | I | collecting info in model.layers.0
25-01-14 01:05:26 | I | collecting info in model.layers.0
25-01-14 01:05:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:32 | I | forward this layer
25-01-14 01:05:32 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/38.pt
25-01-14 01:05:32 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/38.pt
25-01-14 01:05:32 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:05:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 20           |        cudaMalloc retries: 23        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  27231 GiB |  27209 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  26977 GiB |  26955 GiB |
|       from small pool |      3 MiB |      5 MiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  27231 GiB |  27209 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  26977 GiB |  26955 GiB |
|       from small pool |      3 MiB |      5 MiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  27186 GiB |  27164 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  26933 GiB |  26911 GiB |
|       from small pool |      3 MiB |      5 MiB |    252 GiB |    252 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1452 GiB |   1429 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1451 GiB |   1428 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  12961 GiB |  12961 GiB |
|       from large pool |    943 MiB |   1689 MiB |  12668 GiB |  12667 GiB |
|       from small pool |      0 MiB |      4 MiB |    293 GiB |    293 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    5214 K  |    5214 K  |
|       from large pool |     186    |     223    |     736 K  |     736 K  |
|       from small pool |     109    |     111    |    4478 K  |    4477 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    5214 K  |    5214 K  |
|       from large pool |     186    |     223    |     736 K  |     736 K  |
|       from small pool |     109    |     111    |    4478 K  |    4477 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    3616    |    3440    |
|       from large pool |     174    |     174    |    2902    |    2728    |
|       from small pool |       2    |       4    |     714    |     712    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    2236 K  |    2236 K  |
|       from large pool |      20    |      24    |     265 K  |     265 K  |
|       from small pool |       8    |      16    |    1971 K  |    1971 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:05:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  14012 MiB |   7063 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13948 MiB |   7000 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  14012 MiB |   7063 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13948 MiB |   7000 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  13886 MiB |   6937 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  13822 MiB |   6874 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  14680 MiB |   7730 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14676 MiB |   7728 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    906 MiB |    905 MiB |
|       from large pool |      0 KiB |  19104 KiB |    840 MiB |    840 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     66 MiB |     65 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     610    |     430    |
|       from large pool |     126    |     128    |     420    |     294    |
|       from small pool |      54    |      56    |     190    |     136    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     610    |     430    |
|       from large pool |     126    |     128    |     420    |     294    |
|       from small pool |      54    |      56    |     190    |     136    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     380    |     253    |
|       from large pool |     126    |     128    |     378    |     252    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      44    |      43    |
|       from large pool |       0    |       1    |      42    |      42    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:05:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  14012 MiB |   7063 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13948 MiB |   7000 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  14012 MiB |   7063 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  13948 MiB |   7000 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  13886 MiB |   6937 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  13822 MiB |   6874 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  14680 MiB |   7730 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14676 MiB |   7728 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    906 MiB |    905 MiB |
|       from large pool |      0 KiB |  19104 KiB |    840 MiB |    840 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     66 MiB |     65 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     610    |     430    |
|       from large pool |     126    |     128    |     420    |     294    |
|       from small pool |      54    |      56    |     190    |     136    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     610    |     430    |
|       from large pool |     126    |     128    |     420    |     294    |
|       from small pool |      54    |      56    |     190    |     136    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     380    |     253    |
|       from large pool |     126    |     128    |     378    |     252    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      44    |      43    |
|       from large pool |       0    |       1    |      42    |      42    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:05:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  12968 MiB |   7063 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12904 MiB |   7000 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  12968 MiB |   7063 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  12904 MiB |   7000 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  12842 MiB |   6937 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  12778 MiB |   6874 MiB |
|       from small pool |      0 MiB |      1 MiB |     63 MiB |     63 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  13636 MiB |   7730 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13632 MiB |   7728 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |    906 MiB |    905 MiB |
|       from large pool |      0 KiB |  19104 KiB |    840 MiB |    840 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     66 MiB |     65 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     577    |     429    |
|       from large pool |     100    |     102    |     394    |     294    |
|       from small pool |      48    |      50    |     183    |     135    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     577    |     429    |
|       from large pool |     100    |     102    |     394    |     294    |
|       from small pool |      48    |      50    |     183    |     135    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     354    |     253    |
|       from large pool |     100    |     102    |     352    |     252    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      44    |      43    |
|       from large pool |       0    |       1    |      42    |      42    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:05:32 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:05:32 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:05:32 | I | in layer model.layers.0
25-01-14 01:05:32 | I | quantizing weights for layer model.layers.0
25-01-14 01:05:32 | I | collecting info in model.layers.0
25-01-14 01:05:33 | I | collecting info in model.layers.0
25-01-14 01:05:33 | I | collecting info in model.layers.0
25-01-14 01:05:34 | I | collecting info in model.layers.0
25-01-14 01:05:35 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:37 | I | collecting calibration activations in model.layers.0
25-01-14 01:05:38 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:05:38 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:05:40 | I |       - range scale = [    1.0000]
25-01-14 01:05:40 | I |         sum  error  = [    0.5282]
25-01-14 01:05:40 | I |         best error  = [    0.5282]
25-01-14 01:05:40 | I |     + error = [0.5282]
25-01-14 01:05:43 | I |       - range scale = [    1.0000]
25-01-14 01:05:43 | I |         sum  error  = [    1.2444]
25-01-14 01:05:43 | I |         best error  = [    1.2444]
25-01-14 01:05:43 | I |     + error = [1.2444]
25-01-14 01:05:43 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:05:46 | I |       - range scale = [    1.0000]
25-01-14 01:05:46 | I |         sum  error  = [    1.8425]
25-01-14 01:05:46 | I |         best error  = [    1.8425]
25-01-14 01:05:46 | I |     + error = [1.8425]
25-01-14 01:05:49 | I |       - range scale = [    1.0000]
25-01-14 01:05:49 | I |         sum  error  = [    3.2531]
25-01-14 01:05:49 | I |         best error  = [    3.2531]
25-01-14 01:05:49 | I |     + error = [3.2531]
25-01-14 01:05:49 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:05:50 | I |       - range scale = [    1.0000]
25-01-14 01:05:50 | I |         sum  error  = [    0.2494]
25-01-14 01:05:50 | I |         best error  = [    0.2494]
25-01-14 01:05:50 | I |     + error = [0.2494]
25-01-14 01:05:50 | I |       - range scale = [    1.0000]
25-01-14 01:05:50 | I |         sum  error  = [    0.3165]
25-01-14 01:05:50 | I |         best error  = [    0.3165]
25-01-14 01:05:50 | I |     + error = [0.3165]
25-01-14 01:05:51 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:05:51 | I |       - range scale = [    1.0000]
25-01-14 01:05:51 | I |         sum  error  = [    0.1489]
25-01-14 01:05:51 | I |         best error  = [    0.1489]
25-01-14 01:05:51 | I |     + error = [0.1489]
25-01-14 01:05:52 | I |       - range scale = [    1.0000]
25-01-14 01:05:52 | I |         sum  error  = [    0.2444]
25-01-14 01:05:52 | I |         best error  = [    0.2444]
25-01-14 01:05:52 | I |     + error = [0.2444]
25-01-14 01:05:52 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:05:53 | I |       - range scale = [    1.0000]
25-01-14 01:05:53 | I |         sum  error  = [    1.0475]
25-01-14 01:05:53 | I |         best error  = [    1.0475]
25-01-14 01:05:53 | I |     + error = [1.0475]
25-01-14 01:05:54 | I |       - range scale = [    1.0000]
25-01-14 01:05:54 | I |         sum  error  = [    1.3318]
25-01-14 01:05:54 | I |         best error  = [    1.3318]
25-01-14 01:05:54 | I |     + error = [1.3318]
25-01-14 01:05:54 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:05:55 | I |       - range scale = [    1.0000]
25-01-14 01:05:55 | I |         sum  error  = [    1.1698]
25-01-14 01:05:55 | I |         best error  = [    1.1698]
25-01-14 01:05:55 | I |     + error = [1.1698]
25-01-14 01:05:56 | I |       - range scale = [    1.0000]
25-01-14 01:05:56 | I |         sum  error  = [    1.4990]
25-01-14 01:05:56 | I |         best error  = [    1.4990]
25-01-14 01:05:56 | I |     + error = [1.4990]
25-01-14 01:05:56 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:05:57 | I |       - range scale = [    1.0000]
25-01-14 01:05:57 | I |         sum  error  = [    0.1806]
25-01-14 01:05:57 | I |         best error  = [    0.1806]
25-01-14 01:05:57 | I |     + error = [0.1806]
25-01-14 01:05:58 | I |       - range scale = [    1.0000]
25-01-14 01:05:58 | I |         sum  error  = [    0.2353]
25-01-14 01:05:58 | I |         best error  = [    0.2353]
25-01-14 01:05:58 | I |     + error = [0.2353]
25-01-14 01:05:58 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:06:01 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:06:03 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:06:06 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:06:08 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:06:11 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:06:13 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:06:19 | I | quantizing activations for layer model.layers.0
25-01-14 01:06:19 | I | collecting info in model.layers.0
25-01-14 01:06:20 | I | collecting info in model.layers.0
25-01-14 01:06:20 | I | collecting info in model.layers.0
25-01-14 01:06:21 | I | collecting info in model.layers.0
25-01-14 01:06:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:27 | I | forward this layer
25-01-14 01:06:27 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/40.pt
25-01-14 01:06:27 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/40.pt
25-01-14 01:06:27 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:06:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 21           |        cudaMalloc retries: 24        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  29459 GiB |  29437 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  29190 GiB |  29168 GiB |
|       from small pool |      3 MiB |      5 MiB |    269 GiB |    269 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  29459 GiB |  29437 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  29190 GiB |  29168 GiB |
|       from small pool |      3 MiB |      5 MiB |    269 GiB |    269 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  29413 GiB |  29391 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  29145 GiB |  29122 GiB |
|       from small pool |      3 MiB |      5 MiB |    268 GiB |    268 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1520 GiB |   1497 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1519 GiB |   1496 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  14134 GiB |  14133 GiB |
|       from large pool |    943 MiB |   1689 MiB |  13822 GiB |  13821 GiB |
|       from small pool |      0 MiB |      4 MiB |    311 GiB |    311 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    5541 K  |    5541 K  |
|       from large pool |     186    |     223    |     785 K  |     785 K  |
|       from small pool |     109    |     111    |    4756 K  |    4756 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    5541 K  |    5541 K  |
|       from large pool |     186    |     223    |     785 K  |     785 K  |
|       from small pool |     109    |     111    |    4756 K  |    4756 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    3774    |    3598    |
|       from large pool |     174    |     174    |    3025    |    2851    |
|       from small pool |       2    |       4    |     749    |     747    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    2368 K  |    2368 K  |
|       from large pool |      21    |      24    |     280 K  |     280 K  |
|       from small pool |       8    |      16    |    2088 K  |    2088 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:06:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  14348 MiB |   7400 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14282 MiB |   7334 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  14348 MiB |   7400 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14282 MiB |   7334 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  14216 MiB |   7268 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  14150 MiB |   7202 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  15048 MiB |   8098 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15044 MiB |   8096 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    949 MiB |    948 MiB |
|       from large pool |      0 KiB |  19104 KiB |    880 MiB |    880 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     69 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     630    |     450    |
|       from large pool |     126    |     128    |     434    |     308    |
|       from small pool |      54    |      56    |     196    |     142    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     630    |     450    |
|       from large pool |     126    |     128    |     434    |     308    |
|       from small pool |      54    |      56    |     196    |     142    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     392    |     265    |
|       from large pool |     126    |     128    |     390    |     264    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      46    |      45    |
|       from large pool |       0    |       1    |      44    |      44    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:06:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  14348 MiB |   7400 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14282 MiB |   7334 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  14348 MiB |   7400 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14282 MiB |   7334 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  14216 MiB |   7268 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  14150 MiB |   7202 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  15048 MiB |   8098 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15044 MiB |   8096 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    949 MiB |    948 MiB |
|       from large pool |      0 KiB |  19104 KiB |    880 MiB |    880 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     69 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     630    |     450    |
|       from large pool |     126    |     128    |     434    |     308    |
|       from small pool |      54    |      56    |     196    |     142    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     630    |     450    |
|       from large pool |     126    |     128    |     434    |     308    |
|       from small pool |      54    |      56    |     196    |     142    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     392    |     265    |
|       from large pool |     126    |     128    |     390    |     264    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      46    |      45    |
|       from large pool |       0    |       1    |      44    |      44    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:06:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  13304 MiB |   7400 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13238 MiB |   7334 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  13304 MiB |   7400 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13238 MiB |   7334 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  13172 MiB |   7268 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  13106 MiB |   7202 MiB |
|       from small pool |      0 MiB |      1 MiB |     66 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  14004 MiB |   8098 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14000 MiB |   8096 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |    949 MiB |    948 MiB |
|       from large pool |      0 KiB |  19104 KiB |    880 MiB |    880 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     69 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     597    |     449    |
|       from large pool |     100    |     102    |     408    |     308    |
|       from small pool |      48    |      50    |     189    |     141    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     597    |     449    |
|       from large pool |     100    |     102    |     408    |     308    |
|       from small pool |      48    |      50    |     189    |     141    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     366    |     265    |
|       from large pool |     100    |     102    |     364    |     264    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      46    |      45    |
|       from large pool |       0    |       1    |      44    |      44    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:06:27 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:06:27 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:06:27 | I | in layer model.layers.0
25-01-14 01:06:27 | I | quantizing weights for layer model.layers.0
25-01-14 01:06:27 | I | collecting info in model.layers.0
25-01-14 01:06:28 | I | collecting info in model.layers.0
25-01-14 01:06:28 | I | collecting info in model.layers.0
25-01-14 01:06:29 | I | collecting info in model.layers.0
25-01-14 01:06:30 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:06:33 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:06:33 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:06:36 | I |       - range scale = [    1.0000]
25-01-14 01:06:36 | I |         sum  error  = [    0.5288]
25-01-14 01:06:36 | I |         best error  = [    0.5288]
25-01-14 01:06:36 | I |     + error = [0.5288]
25-01-14 01:06:38 | I |       - range scale = [    1.0000]
25-01-14 01:06:38 | I |         sum  error  = [    1.2337]
25-01-14 01:06:38 | I |         best error  = [    1.2337]
25-01-14 01:06:38 | I |     + error = [1.2337]
25-01-14 01:06:39 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:06:41 | I |       - range scale = [    1.0000]
25-01-14 01:06:41 | I |         sum  error  = [    1.7903]
25-01-14 01:06:41 | I |         best error  = [    1.7903]
25-01-14 01:06:41 | I |     + error = [1.7903]
25-01-14 01:06:44 | I |       - range scale = [    1.0000]
25-01-14 01:06:44 | I |         sum  error  = [    3.1625]
25-01-14 01:06:44 | I |         best error  = [    3.1625]
25-01-14 01:06:44 | I |     + error = [3.1625]
25-01-14 01:06:44 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:06:45 | I |       - range scale = [    1.0000]
25-01-14 01:06:45 | I |         sum  error  = [    0.2495]
25-01-14 01:06:45 | I |         best error  = [    0.2495]
25-01-14 01:06:45 | I |     + error = [0.2495]
25-01-14 01:06:46 | I |       - range scale = [    1.0000]
25-01-14 01:06:46 | I |         sum  error  = [    0.3083]
25-01-14 01:06:46 | I |         best error  = [    0.3083]
25-01-14 01:06:46 | I |     + error = [0.3083]
25-01-14 01:06:46 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:06:47 | I |       - range scale = [    1.0000]
25-01-14 01:06:47 | I |         sum  error  = [    0.1480]
25-01-14 01:06:47 | I |         best error  = [    0.1480]
25-01-14 01:06:47 | I |     + error = [0.1480]
25-01-14 01:06:47 | I |       - range scale = [    1.0000]
25-01-14 01:06:47 | I |         sum  error  = [    0.2492]
25-01-14 01:06:47 | I |         best error  = [    0.2492]
25-01-14 01:06:47 | I |     + error = [0.2492]
25-01-14 01:06:48 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:06:48 | I |       - range scale = [    1.0000]
25-01-14 01:06:48 | I |         sum  error  = [    0.9764]
25-01-14 01:06:48 | I |         best error  = [    0.9764]
25-01-14 01:06:48 | I |     + error = [0.9764]
25-01-14 01:06:49 | I |       - range scale = [    1.0000]
25-01-14 01:06:49 | I |         sum  error  = [    1.2625]
25-01-14 01:06:49 | I |         best error  = [    1.2625]
25-01-14 01:06:49 | I |     + error = [1.2625]
25-01-14 01:06:50 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:06:50 | I |       - range scale = [    1.0000]
25-01-14 01:06:50 | I |         sum  error  = [    1.1045]
25-01-14 01:06:50 | I |         best error  = [    1.1045]
25-01-14 01:06:50 | I |     + error = [1.1045]
25-01-14 01:06:51 | I |       - range scale = [    1.0000]
25-01-14 01:06:51 | I |         sum  error  = [    1.4775]
25-01-14 01:06:51 | I |         best error  = [    1.4775]
25-01-14 01:06:51 | I |     + error = [1.4775]
25-01-14 01:06:52 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:06:52 | I |       - range scale = [    1.0000]
25-01-14 01:06:52 | I |         sum  error  = [    0.1660]
25-01-14 01:06:52 | I |         best error  = [    0.1660]
25-01-14 01:06:52 | I |     + error = [0.1660]
25-01-14 01:06:54 | I |       - range scale = [    1.0000]
25-01-14 01:06:54 | I |         sum  error  = [    0.2159]
25-01-14 01:06:54 | I |         best error  = [    0.2159]
25-01-14 01:06:54 | I |     + error = [0.2159]
25-01-14 01:06:54 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:06:56 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:06:59 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:07:01 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:07:04 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:07:06 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:07:09 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:07:15 | I | quantizing activations for layer model.layers.0
25-01-14 01:07:15 | I | collecting info in model.layers.0
25-01-14 01:07:16 | I | collecting info in model.layers.0
25-01-14 01:07:16 | I | collecting info in model.layers.0
25-01-14 01:07:17 | I | collecting info in model.layers.0
25-01-14 01:07:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:23 | I | forward this layer
25-01-14 01:07:23 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/42.pt
25-01-14 01:07:23 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/42.pt
25-01-14 01:07:23 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:07:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 22           |        cudaMalloc retries: 25        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  31773 GiB |  31751 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  31488 GiB |  31466 GiB |
|       from small pool |      3 MiB |      5 MiB |    285 GiB |    285 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  31773 GiB |  31751 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  31488 GiB |  31466 GiB |
|       from small pool |      3 MiB |      5 MiB |    285 GiB |    285 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  31725 GiB |  31703 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  31441 GiB |  31419 GiB |
|       from small pool |      3 MiB |      5 MiB |    284 GiB |    284 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1589 GiB |   1566 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1588 GiB |   1565 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  15342 GiB |  15341 GiB |
|       from large pool |    943 MiB |   1689 MiB |  15012 GiB |  15011 GiB |
|       from small pool |      0 MiB |      4 MiB |    330 GiB |    330 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    5875 K  |    5875 K  |
|       from large pool |     186    |     223    |     835 K  |     835 K  |
|       from small pool |     109    |     111    |    5040 K  |    5040 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    5875 K  |    5875 K  |
|       from large pool |     186    |     223    |     835 K  |     835 K  |
|       from small pool |     109    |     111    |    5040 K  |    5040 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    3938    |    3762    |
|       from large pool |     174    |     174    |    3154    |    2980    |
|       from small pool |       2    |       4    |     784    |     782    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    2503 K  |    2503 K  |
|       from large pool |      20    |      24    |     295 K  |     295 K  |
|       from small pool |       8    |      16    |    2207 K  |    2207 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:07:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  14684 MiB |   7736 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14615 MiB |   7667 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  14684 MiB |   7736 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14615 MiB |   7667 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  14546 MiB |   7598 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  14477 MiB |   7529 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  15416 MiB |   8466 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15412 MiB |   8464 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    992 MiB |    991 MiB |
|       from large pool |      0 KiB |  19104 KiB |    920 MiB |    920 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     72 MiB |     71 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     650    |     470    |
|       from large pool |     126    |     128    |     448    |     322    |
|       from small pool |      54    |      56    |     202    |     148    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     650    |     470    |
|       from large pool |     126    |     128    |     448    |     322    |
|       from small pool |      54    |      56    |     202    |     148    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     404    |     277    |
|       from large pool |     126    |     128    |     402    |     276    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      48    |      47    |
|       from large pool |       0    |       1    |      46    |      46    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:07:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  14684 MiB |   7736 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14615 MiB |   7667 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  14684 MiB |   7736 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14615 MiB |   7667 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  14546 MiB |   7598 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  14477 MiB |   7529 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  15416 MiB |   8466 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15412 MiB |   8464 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |    992 MiB |    991 MiB |
|       from large pool |      0 KiB |  19104 KiB |    920 MiB |    920 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     72 MiB |     71 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     650    |     470    |
|       from large pool |     126    |     128    |     448    |     322    |
|       from small pool |      54    |      56    |     202    |     148    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     650    |     470    |
|       from large pool |     126    |     128    |     448    |     322    |
|       from small pool |      54    |      56    |     202    |     148    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     404    |     277    |
|       from large pool |     126    |     128    |     402    |     276    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      48    |      47    |
|       from large pool |       0    |       1    |      46    |      46    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:07:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  13641 MiB |   7736 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13571 MiB |   7667 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  13641 MiB |   7736 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13571 MiB |   7667 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  13503 MiB |   7598 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  13433 MiB |   7529 MiB |
|       from small pool |      0 MiB |      1 MiB |     69 MiB |     69 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  14372 MiB |   8466 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14368 MiB |   8464 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |    992 MiB |    991 MiB |
|       from large pool |      0 KiB |  19104 KiB |    920 MiB |    920 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     72 MiB |     71 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     617    |     469    |
|       from large pool |     100    |     102    |     422    |     322    |
|       from small pool |      48    |      50    |     195    |     147    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     617    |     469    |
|       from large pool |     100    |     102    |     422    |     322    |
|       from small pool |      48    |      50    |     195    |     147    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     378    |     277    |
|       from large pool |     100    |     102    |     376    |     276    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      48    |      47    |
|       from large pool |       0    |       1    |      46    |      46    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:07:23 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:07:23 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:07:23 | I | in layer model.layers.0
25-01-14 01:07:23 | I | quantizing weights for layer model.layers.0
25-01-14 01:07:23 | I | collecting info in model.layers.0
25-01-14 01:07:24 | I | collecting info in model.layers.0
25-01-14 01:07:24 | I | collecting info in model.layers.0
25-01-14 01:07:25 | I | collecting info in model.layers.0
25-01-14 01:07:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:07:29 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:07:29 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:07:32 | I |       - range scale = [    1.0000]
25-01-14 01:07:32 | I |         sum  error  = [    0.5234]
25-01-14 01:07:32 | I |         best error  = [    0.5234]
25-01-14 01:07:32 | I |     + error = [0.5234]
25-01-14 01:07:35 | I |       - range scale = [    1.0000]
25-01-14 01:07:35 | I |         sum  error  = [    1.2379]
25-01-14 01:07:35 | I |         best error  = [    1.2379]
25-01-14 01:07:35 | I |     + error = [1.2379]
25-01-14 01:07:35 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:07:38 | I |       - range scale = [    1.0000]
25-01-14 01:07:38 | I |         sum  error  = [    1.8352]
25-01-14 01:07:38 | I |         best error  = [    1.8352]
25-01-14 01:07:38 | I |     + error = [1.8352]
25-01-14 01:07:41 | I |       - range scale = [    1.0000]
25-01-14 01:07:41 | I |         sum  error  = [    3.2488]
25-01-14 01:07:41 | I |         best error  = [    3.2488]
25-01-14 01:07:41 | I |     + error = [3.2488]
25-01-14 01:07:41 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:07:42 | I |       - range scale = [    1.0000]
25-01-14 01:07:42 | I |         sum  error  = [    0.2483]
25-01-14 01:07:42 | I |         best error  = [    0.2483]
25-01-14 01:07:42 | I |     + error = [0.2483]
25-01-14 01:07:42 | I |       - range scale = [    1.0000]
25-01-14 01:07:42 | I |         sum  error  = [    0.3131]
25-01-14 01:07:42 | I |         best error  = [    0.3131]
25-01-14 01:07:42 | I |     + error = [0.3131]
25-01-14 01:07:43 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:07:43 | I |       - range scale = [    1.0000]
25-01-14 01:07:43 | I |         sum  error  = [    0.1541]
25-01-14 01:07:43 | I |         best error  = [    0.1541]
25-01-14 01:07:43 | I |     + error = [0.1541]
25-01-14 01:07:44 | I |       - range scale = [    1.0000]
25-01-14 01:07:44 | I |         sum  error  = [    0.2518]
25-01-14 01:07:44 | I |         best error  = [    0.2518]
25-01-14 01:07:44 | I |     + error = [0.2518]
25-01-14 01:07:44 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:07:45 | I |       - range scale = [    1.0000]
25-01-14 01:07:45 | I |         sum  error  = [    1.0052]
25-01-14 01:07:45 | I |         best error  = [    1.0052]
25-01-14 01:07:45 | I |     + error = [1.0052]
25-01-14 01:07:46 | I |       - range scale = [    1.0000]
25-01-14 01:07:46 | I |         sum  error  = [    1.2850]
25-01-14 01:07:46 | I |         best error  = [    1.2850]
25-01-14 01:07:46 | I |     + error = [1.2850]
25-01-14 01:07:46 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:07:47 | I |       - range scale = [    1.0000]
25-01-14 01:07:47 | I |         sum  error  = [    1.1270]
25-01-14 01:07:47 | I |         best error  = [    1.1270]
25-01-14 01:07:47 | I |     + error = [1.1270]
25-01-14 01:07:48 | I |       - range scale = [    1.0000]
25-01-14 01:07:48 | I |         sum  error  = [    1.5008]
25-01-14 01:07:48 | I |         best error  = [    1.5008]
25-01-14 01:07:48 | I |     + error = [1.5008]
25-01-14 01:07:48 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:07:49 | I |       - range scale = [    1.0000]
25-01-14 01:07:49 | I |         sum  error  = [    0.1691]
25-01-14 01:07:49 | I |         best error  = [    0.1691]
25-01-14 01:07:49 | I |     + error = [0.1691]
25-01-14 01:07:50 | I |       - range scale = [    1.0000]
25-01-14 01:07:50 | I |         sum  error  = [    0.2217]
25-01-14 01:07:50 | I |         best error  = [    0.2217]
25-01-14 01:07:50 | I |     + error = [0.2217]
25-01-14 01:07:51 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:07:53 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:07:56 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:07:58 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:08:00 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:08:03 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:08:05 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:08:12 | I | quantizing activations for layer model.layers.0
25-01-14 01:08:12 | I | collecting info in model.layers.0
25-01-14 01:08:12 | I | collecting info in model.layers.0
25-01-14 01:08:13 | I | collecting info in model.layers.0
25-01-14 01:08:14 | I | collecting info in model.layers.0
25-01-14 01:08:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:20 | I | forward this layer
25-01-14 01:08:20 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/44.pt
25-01-14 01:08:20 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/44.pt
25-01-14 01:08:20 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:08:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 23           |        cudaMalloc retries: 26        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  34172 GiB |  34150 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  33871 GiB |  33849 GiB |
|       from small pool |      3 MiB |      5 MiB |    301 GiB |    301 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  34172 GiB |  34150 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  33871 GiB |  33849 GiB |
|       from small pool |      3 MiB |      5 MiB |    301 GiB |    301 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  34123 GiB |  34100 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  33823 GiB |  33800 GiB |
|       from small pool |      3 MiB |      5 MiB |    300 GiB |    300 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1657 GiB |   1634 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1655 GiB |   1632 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  16616 GiB |  16615 GiB |
|       from large pool |    943 MiB |   1689 MiB |  16267 GiB |  16266 GiB |
|       from small pool |      0 MiB |      4 MiB |    349 GiB |    349 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    6217 K  |    6217 K  |
|       from large pool |     186    |     223    |     887 K  |     887 K  |
|       from small pool |     109    |     111    |    5330 K  |    5329 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    6217 K  |    6217 K  |
|       from large pool |     186    |     223    |     887 K  |     887 K  |
|       from small pool |     109    |     111    |    5330 K  |    5329 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    4096    |    3920    |
|       from large pool |     174    |     174    |    3277    |    3103    |
|       from small pool |       2    |       4    |     819    |     817    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    2640 K  |    2640 K  |
|       from large pool |      21    |      24    |     311 K  |     311 K  |
|       from small pool |       8    |      16    |    2328 K  |    2328 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:08:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  15021 MiB |   8073 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14949 MiB |   8001 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  15021 MiB |   8073 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14949 MiB |   8001 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  14877 MiB |   7929 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  14805 MiB |   7857 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  15784 MiB |   8834 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15780 MiB |   8832 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1035 MiB |   1034 MiB |
|       from large pool |      0 KiB |  19104 KiB |    960 MiB |    960 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     75 MiB |     74 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     670    |     490    |
|       from large pool |     126    |     128    |     462    |     336    |
|       from small pool |      54    |      56    |     208    |     154    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     670    |     490    |
|       from large pool |     126    |     128    |     462    |     336    |
|       from small pool |      54    |      56    |     208    |     154    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     416    |     289    |
|       from large pool |     126    |     128    |     414    |     288    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      50    |      49    |
|       from large pool |       0    |       1    |      48    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:08:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  15021 MiB |   8073 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14949 MiB |   8001 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  15021 MiB |   8073 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  14949 MiB |   8001 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  14877 MiB |   7929 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  14805 MiB |   7857 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  15784 MiB |   8834 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15780 MiB |   8832 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1035 MiB |   1034 MiB |
|       from large pool |      0 KiB |  19104 KiB |    960 MiB |    960 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     75 MiB |     74 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     670    |     490    |
|       from large pool |     126    |     128    |     462    |     336    |
|       from small pool |      54    |      56    |     208    |     154    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     670    |     490    |
|       from large pool |     126    |     128    |     462    |     336    |
|       from small pool |      54    |      56    |     208    |     154    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     416    |     289    |
|       from large pool |     126    |     128    |     414    |     288    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      50    |      49    |
|       from large pool |       0    |       1    |      48    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:08:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  13977 MiB |   8073 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13905 MiB |   8001 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  13977 MiB |   8073 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  13905 MiB |   8001 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  13833 MiB |   7929 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  13761 MiB |   7857 MiB |
|       from small pool |      0 MiB |      1 MiB |     72 MiB |     72 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  14740 MiB |   8834 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14736 MiB |   8832 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1035 MiB |   1034 MiB |
|       from large pool |      0 KiB |  19104 KiB |    960 MiB |    960 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     75 MiB |     74 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     637    |     489    |
|       from large pool |     100    |     102    |     436    |     336    |
|       from small pool |      48    |      50    |     201    |     153    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     637    |     489    |
|       from large pool |     100    |     102    |     436    |     336    |
|       from small pool |      48    |      50    |     201    |     153    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     390    |     289    |
|       from large pool |     100    |     102    |     388    |     288    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      50    |      49    |
|       from large pool |       0    |       1    |      48    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:08:20 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:08:20 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:08:20 | I | in layer model.layers.0
25-01-14 01:08:20 | I | quantizing weights for layer model.layers.0
25-01-14 01:08:20 | I | collecting info in model.layers.0
25-01-14 01:08:21 | I | collecting info in model.layers.0
25-01-14 01:08:21 | I | collecting info in model.layers.0
25-01-14 01:08:22 | I | collecting info in model.layers.0
25-01-14 01:08:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:08:26 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:08:26 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:08:29 | I |       - range scale = [    1.0000]
25-01-14 01:08:29 | I |         sum  error  = [    0.5548]
25-01-14 01:08:29 | I |         best error  = [    0.5548]
25-01-14 01:08:29 | I |     + error = [0.5548]
25-01-14 01:08:32 | I |       - range scale = [    1.0000]
25-01-14 01:08:32 | I |         sum  error  = [    1.2740]
25-01-14 01:08:32 | I |         best error  = [    1.2740]
25-01-14 01:08:32 | I |     + error = [1.2740]
25-01-14 01:08:32 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:08:35 | I |       - range scale = [    1.0000]
25-01-14 01:08:35 | I |         sum  error  = [    1.7955]
25-01-14 01:08:35 | I |         best error  = [    1.7955]
25-01-14 01:08:35 | I |     + error = [1.7955]
25-01-14 01:08:38 | I |       - range scale = [    1.0000]
25-01-14 01:08:38 | I |         sum  error  = [    3.1810]
25-01-14 01:08:38 | I |         best error  = [    3.1810]
25-01-14 01:08:38 | I |     + error = [3.1810]
25-01-14 01:08:39 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:08:39 | I |       - range scale = [    1.0000]
25-01-14 01:08:39 | I |         sum  error  = [    0.2476]
25-01-14 01:08:39 | I |         best error  = [    0.2476]
25-01-14 01:08:39 | I |     + error = [0.2476]
25-01-14 01:08:40 | I |       - range scale = [    1.0000]
25-01-14 01:08:40 | I |         sum  error  = [    0.3215]
25-01-14 01:08:40 | I |         best error  = [    0.3215]
25-01-14 01:08:40 | I |     + error = [0.3215]
25-01-14 01:08:40 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:08:41 | I |       - range scale = [    1.0000]
25-01-14 01:08:41 | I |         sum  error  = [    0.1536]
25-01-14 01:08:41 | I |         best error  = [    0.1536]
25-01-14 01:08:41 | I |     + error = [0.1536]
25-01-14 01:08:42 | I |       - range scale = [    1.0000]
25-01-14 01:08:42 | I |         sum  error  = [    0.2523]
25-01-14 01:08:42 | I |         best error  = [    0.2523]
25-01-14 01:08:42 | I |     + error = [0.2523]
25-01-14 01:08:42 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:08:43 | I |       - range scale = [    1.0000]
25-01-14 01:08:43 | I |         sum  error  = [    0.9911]
25-01-14 01:08:43 | I |         best error  = [    0.9911]
25-01-14 01:08:43 | I |     + error = [0.9911]
25-01-14 01:08:44 | I |       - range scale = [    1.0000]
25-01-14 01:08:44 | I |         sum  error  = [    1.2473]
25-01-14 01:08:44 | I |         best error  = [    1.2473]
25-01-14 01:08:44 | I |     + error = [1.2473]
25-01-14 01:08:44 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:08:45 | I |       - range scale = [    1.0000]
25-01-14 01:08:45 | I |         sum  error  = [    1.1253]
25-01-14 01:08:45 | I |         best error  = [    1.1253]
25-01-14 01:08:45 | I |     + error = [1.1253]
25-01-14 01:08:46 | I |       - range scale = [    1.0000]
25-01-14 01:08:46 | I |         sum  error  = [    1.4154]
25-01-14 01:08:46 | I |         best error  = [    1.4154]
25-01-14 01:08:46 | I |     + error = [1.4154]
25-01-14 01:08:46 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:08:47 | I |       - range scale = [    1.0000]
25-01-14 01:08:47 | I |         sum  error  = [    0.1691]
25-01-14 01:08:47 | I |         best error  = [    0.1691]
25-01-14 01:08:47 | I |     + error = [0.1691]
25-01-14 01:08:48 | I |       - range scale = [    1.0000]
25-01-14 01:08:48 | I |         sum  error  = [    0.2138]
25-01-14 01:08:48 | I |         best error  = [    0.2138]
25-01-14 01:08:48 | I |     + error = [0.2138]
25-01-14 01:08:48 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:08:51 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:08:53 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:08:55 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:08:58 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:09:00 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:09:03 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:09:09 | I | quantizing activations for layer model.layers.0
25-01-14 01:09:09 | I | collecting info in model.layers.0
25-01-14 01:09:10 | I | collecting info in model.layers.0
25-01-14 01:09:10 | I | collecting info in model.layers.0
25-01-14 01:09:11 | I | collecting info in model.layers.0
25-01-14 01:09:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:17 | I | forward this layer
25-01-14 01:09:17 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/46.pt
25-01-14 01:09:17 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/46.pt
25-01-14 01:09:17 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:09:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 24           |        cudaMalloc retries: 27        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  36657 GiB |  36635 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  36340 GiB |  36317 GiB |
|       from small pool |      3 MiB |      5 MiB |    317 GiB |    317 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  36657 GiB |  36635 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  36340 GiB |  36317 GiB |
|       from small pool |      3 MiB |      5 MiB |    317 GiB |    317 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  36606 GiB |  36583 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  36289 GiB |  36267 GiB |
|       from small pool |      3 MiB |      5 MiB |    316 GiB |    316 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1726 GiB |   1703 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1724 GiB |   1701 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  17925 GiB |  17924 GiB |
|       from large pool |    943 MiB |   1689 MiB |  17557 GiB |  17556 GiB |
|       from small pool |      0 MiB |      4 MiB |    368 GiB |    368 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    6566 K  |    6565 K  |
|       from large pool |     186    |     223    |     940 K  |     940 K  |
|       from small pool |     109    |     111    |    5625 K  |    5625 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    6566 K  |    6565 K  |
|       from large pool |     186    |     223    |     940 K  |     940 K  |
|       from small pool |     109    |     111    |    5625 K  |    5625 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    4260    |    4084    |
|       from large pool |     174    |     174    |    3406    |    3232    |
|       from small pool |       2    |       4    |     854    |     852    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    2779 K  |    2779 K  |
|       from large pool |      20    |      24    |     327 K  |     327 K  |
|       from small pool |       8    |      16    |    2452 K  |    2452 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:09:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  15357 MiB |   8409 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15282 MiB |   8334 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  15357 MiB |   8409 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15282 MiB |   8334 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  15207 MiB |   8259 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  15132 MiB |   8184 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  16152 MiB |   9202 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16148 MiB |   9200 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1078 MiB |   1077 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1000 MiB |   1000 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     78 MiB |     77 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     690    |     510    |
|       from large pool |     126    |     128    |     476    |     350    |
|       from small pool |      54    |      56    |     214    |     160    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     690    |     510    |
|       from large pool |     126    |     128    |     476    |     350    |
|       from small pool |      54    |      56    |     214    |     160    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     428    |     301    |
|       from large pool |     126    |     128    |     426    |     300    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      52    |      51    |
|       from large pool |       0    |       1    |      50    |      50    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:09:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  15357 MiB |   8409 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15282 MiB |   8334 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  15357 MiB |   8409 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15282 MiB |   8334 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  15207 MiB |   8259 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  15132 MiB |   8184 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  16152 MiB |   9202 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16148 MiB |   9200 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1078 MiB |   1077 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1000 MiB |   1000 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     78 MiB |     77 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     690    |     510    |
|       from large pool |     126    |     128    |     476    |     350    |
|       from small pool |      54    |      56    |     214    |     160    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     690    |     510    |
|       from large pool |     126    |     128    |     476    |     350    |
|       from small pool |      54    |      56    |     214    |     160    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     428    |     301    |
|       from large pool |     126    |     128    |     426    |     300    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      52    |      51    |
|       from large pool |       0    |       1    |      50    |      50    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:09:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  14313 MiB |   8409 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14238 MiB |   8334 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  14313 MiB |   8409 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14238 MiB |   8334 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  14163 MiB |   8259 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  14088 MiB |   8184 MiB |
|       from small pool |      0 MiB |      1 MiB |     75 MiB |     75 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  15108 MiB |   9202 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15104 MiB |   9200 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1078 MiB |   1077 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1000 MiB |   1000 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     78 MiB |     77 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     657    |     509    |
|       from large pool |     100    |     102    |     450    |     350    |
|       from small pool |      48    |      50    |     207    |     159    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     657    |     509    |
|       from large pool |     100    |     102    |     450    |     350    |
|       from small pool |      48    |      50    |     207    |     159    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     402    |     301    |
|       from large pool |     100    |     102    |     400    |     300    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      52    |      51    |
|       from large pool |       0    |       1    |      50    |      50    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:09:17 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:09:18 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:09:18 | I | in layer model.layers.0
25-01-14 01:09:18 | I | quantizing weights for layer model.layers.0
25-01-14 01:09:18 | I | collecting info in model.layers.0
25-01-14 01:09:18 | I | collecting info in model.layers.0
25-01-14 01:09:19 | I | collecting info in model.layers.0
25-01-14 01:09:19 | I | collecting info in model.layers.0
25-01-14 01:09:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:09:24 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:09:24 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:09:27 | I |       - range scale = [    1.0000]
25-01-14 01:09:27 | I |         sum  error  = [    0.5688]
25-01-14 01:09:27 | I |         best error  = [    0.5688]
25-01-14 01:09:27 | I |     + error = [0.5688]
25-01-14 01:09:30 | I |       - range scale = [    1.0000]
25-01-14 01:09:30 | I |         sum  error  = [    1.3331]
25-01-14 01:09:30 | I |         best error  = [    1.3331]
25-01-14 01:09:30 | I |     + error = [1.3331]
25-01-14 01:09:30 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:09:33 | I |       - range scale = [    1.0000]
25-01-14 01:09:33 | I |         sum  error  = [    1.9762]
25-01-14 01:09:33 | I |         best error  = [    1.9762]
25-01-14 01:09:33 | I |     + error = [1.9762]
25-01-14 01:09:36 | I |       - range scale = [    1.0000]
25-01-14 01:09:36 | I |         sum  error  = [    3.2858]
25-01-14 01:09:36 | I |         best error  = [    3.2858]
25-01-14 01:09:36 | I |     + error = [3.2858]
25-01-14 01:09:36 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:09:37 | I |       - range scale = [    1.0000]
25-01-14 01:09:37 | I |         sum  error  = [    0.2552]
25-01-14 01:09:37 | I |         best error  = [    0.2552]
25-01-14 01:09:37 | I |     + error = [0.2552]
25-01-14 01:09:38 | I |       - range scale = [    1.0000]
25-01-14 01:09:38 | I |         sum  error  = [    0.3326]
25-01-14 01:09:38 | I |         best error  = [    0.3326]
25-01-14 01:09:38 | I |     + error = [0.3326]
25-01-14 01:09:38 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:09:39 | I |       - range scale = [    1.0000]
25-01-14 01:09:39 | I |         sum  error  = [    0.1582]
25-01-14 01:09:39 | I |         best error  = [    0.1582]
25-01-14 01:09:39 | I |     + error = [0.1582]
25-01-14 01:09:40 | I |       - range scale = [    1.0000]
25-01-14 01:09:40 | I |         sum  error  = [    0.2667]
25-01-14 01:09:40 | I |         best error  = [    0.2667]
25-01-14 01:09:40 | I |     + error = [0.2667]
25-01-14 01:09:40 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:09:41 | I |       - range scale = [    1.0000]
25-01-14 01:09:41 | I |         sum  error  = [    1.0753]
25-01-14 01:09:41 | I |         best error  = [    1.0753]
25-01-14 01:09:41 | I |     + error = [1.0753]
25-01-14 01:09:42 | I |       - range scale = [    1.0000]
25-01-14 01:09:42 | I |         sum  error  = [    1.3407]
25-01-14 01:09:42 | I |         best error  = [    1.3407]
25-01-14 01:09:42 | I |     + error = [1.3407]
25-01-14 01:09:42 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:09:43 | I |       - range scale = [    1.0000]
25-01-14 01:09:43 | I |         sum  error  = [    1.2079]
25-01-14 01:09:43 | I |         best error  = [    1.2079]
25-01-14 01:09:43 | I |     + error = [1.2079]
25-01-14 01:09:44 | I |       - range scale = [    1.0000]
25-01-14 01:09:44 | I |         sum  error  = [    1.5119]
25-01-14 01:09:44 | I |         best error  = [    1.5119]
25-01-14 01:09:44 | I |     + error = [1.5119]
25-01-14 01:09:44 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:09:45 | I |       - range scale = [    1.0000]
25-01-14 01:09:45 | I |         sum  error  = [    0.1814]
25-01-14 01:09:45 | I |         best error  = [    0.1814]
25-01-14 01:09:45 | I |     + error = [0.1814]
25-01-14 01:09:46 | I |       - range scale = [    1.0000]
25-01-14 01:09:46 | I |         sum  error  = [    0.2416]
25-01-14 01:09:46 | I |         best error  = [    0.2416]
25-01-14 01:09:46 | I |     + error = [0.2416]
25-01-14 01:09:46 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:09:49 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:09:51 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:09:53 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:09:56 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:09:58 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:10:01 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:10:07 | I | quantizing activations for layer model.layers.0
25-01-14 01:10:07 | I | collecting info in model.layers.0
25-01-14 01:10:08 | I | collecting info in model.layers.0
25-01-14 01:10:08 | I | collecting info in model.layers.0
25-01-14 01:10:09 | I | collecting info in model.layers.0
25-01-14 01:10:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:15 | I | forward this layer
25-01-14 01:10:15 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/48.pt
25-01-14 01:10:15 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/48.pt
25-01-14 01:10:16 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:10:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 25           |        cudaMalloc retries: 28        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  39227 GiB |  39205 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  38893 GiB |  38871 GiB |
|       from small pool |      3 MiB |      5 MiB |    334 GiB |    334 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  39227 GiB |  39205 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  38893 GiB |  38871 GiB |
|       from small pool |      3 MiB |      5 MiB |    334 GiB |    334 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  39174 GiB |  39152 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  38841 GiB |  38819 GiB |
|       from small pool |      3 MiB |      5 MiB |    333 GiB |    333 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1794 GiB |   1771 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1792 GiB |   1769 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  19301 GiB |  19300 GiB |
|       from large pool |    943 MiB |   1689 MiB |  18913 GiB |  18912 GiB |
|       from small pool |      0 MiB |      4 MiB |    387 GiB |    387 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    6922 K  |    6921 K  |
|       from large pool |     186    |     223    |     994 K  |     994 K  |
|       from small pool |     109    |     111    |    5927 K  |    5927 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    6922 K  |    6921 K  |
|       from large pool |     186    |     223    |     994 K  |     994 K  |
|       from small pool |     109    |     111    |    5927 K  |    5927 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    4418    |    4242    |
|       from large pool |     174    |     174    |    3529    |    3355    |
|       from small pool |       2    |       4    |     889    |     887    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    2921 K  |    2921 K  |
|       from large pool |      21    |      24    |     343 K  |     343 K  |
|       from small pool |       8    |      16    |    2577 K  |    2577 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:10:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  15694 MiB |   8745 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15615 MiB |   8667 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  15694 MiB |   8745 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15615 MiB |   8667 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  15538 MiB |   8589 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  15459 MiB |   8511 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  16520 MiB |   9570 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16516 MiB |   9568 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1121 MiB |   1120 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1040 MiB |   1040 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     81 MiB |     80 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     710    |     530    |
|       from large pool |     126    |     128    |     490    |     364    |
|       from small pool |      54    |      56    |     220    |     166    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     710    |     530    |
|       from large pool |     126    |     128    |     490    |     364    |
|       from small pool |      54    |      56    |     220    |     166    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     440    |     313    |
|       from large pool |     126    |     128    |     438    |     312    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      54    |      53    |
|       from large pool |       0    |       1    |      52    |      52    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:10:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  15694 MiB |   8745 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15615 MiB |   8667 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  15694 MiB |   8745 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15615 MiB |   8667 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  15538 MiB |   8589 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  15459 MiB |   8511 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  16520 MiB |   9570 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16516 MiB |   9568 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1121 MiB |   1120 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1040 MiB |   1040 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     81 MiB |     80 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     710    |     530    |
|       from large pool |     126    |     128    |     490    |     364    |
|       from small pool |      54    |      56    |     220    |     166    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     710    |     530    |
|       from large pool |     126    |     128    |     490    |     364    |
|       from small pool |      54    |      56    |     220    |     166    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     440    |     313    |
|       from large pool |     126    |     128    |     438    |     312    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      54    |      53    |
|       from large pool |       0    |       1    |      52    |      52    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:10:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  14650 MiB |   8745 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14571 MiB |   8667 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  14650 MiB |   8745 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14571 MiB |   8667 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  14494 MiB |   8589 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  14415 MiB |   8511 MiB |
|       from small pool |      0 MiB |      1 MiB |     78 MiB |     78 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  15476 MiB |   9570 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15472 MiB |   9568 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1121 MiB |   1120 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1040 MiB |   1040 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     81 MiB |     80 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     677    |     529    |
|       from large pool |     100    |     102    |     464    |     364    |
|       from small pool |      48    |      50    |     213    |     165    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     677    |     529    |
|       from large pool |     100    |     102    |     464    |     364    |
|       from small pool |      48    |      50    |     213    |     165    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     414    |     313    |
|       from large pool |     100    |     102    |     412    |     312    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      54    |      53    |
|       from large pool |       0    |       1    |      52    |      52    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:10:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:10:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:10:16 | I | in layer model.layers.0
25-01-14 01:10:16 | I | quantizing weights for layer model.layers.0
25-01-14 01:10:16 | I | collecting info in model.layers.0
25-01-14 01:10:17 | I | collecting info in model.layers.0
25-01-14 01:10:17 | I | collecting info in model.layers.0
25-01-14 01:10:18 | I | collecting info in model.layers.0
25-01-14 01:10:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:10:23 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:10:23 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:10:26 | I |       - range scale = [    1.0000]
25-01-14 01:10:26 | I |         sum  error  = [    0.6056]
25-01-14 01:10:26 | I |         best error  = [    0.6056]
25-01-14 01:10:26 | I |     + error = [0.6056]
25-01-14 01:10:29 | I |       - range scale = [    1.0000]
25-01-14 01:10:29 | I |         sum  error  = [    1.4000]
25-01-14 01:10:29 | I |         best error  = [    1.4000]
25-01-14 01:10:29 | I |     + error = [1.4000]
25-01-14 01:10:29 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:10:32 | I |       - range scale = [    1.0000]
25-01-14 01:10:32 | I |         sum  error  = [    2.1498]
25-01-14 01:10:32 | I |         best error  = [    2.1498]
25-01-14 01:10:32 | I |     + error = [2.1498]
25-01-14 01:10:35 | I |       - range scale = [    1.0000]
25-01-14 01:10:35 | I |         sum  error  = [    3.5416]
25-01-14 01:10:35 | I |         best error  = [    3.5416]
25-01-14 01:10:35 | I |     + error = [3.5416]
25-01-14 01:10:36 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:10:36 | I |       - range scale = [    1.0000]
25-01-14 01:10:36 | I |         sum  error  = [    0.2648]
25-01-14 01:10:36 | I |         best error  = [    0.2648]
25-01-14 01:10:36 | I |     + error = [0.2648]
25-01-14 01:10:37 | I |       - range scale = [    1.0000]
25-01-14 01:10:37 | I |         sum  error  = [    0.3390]
25-01-14 01:10:37 | I |         best error  = [    0.3390]
25-01-14 01:10:37 | I |     + error = [0.3390]
25-01-14 01:10:37 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:10:38 | I |       - range scale = [    1.0000]
25-01-14 01:10:38 | I |         sum  error  = [    0.1594]
25-01-14 01:10:38 | I |         best error  = [    0.1594]
25-01-14 01:10:38 | I |     + error = [0.1594]
25-01-14 01:10:39 | I |       - range scale = [    1.0000]
25-01-14 01:10:39 | I |         sum  error  = [    0.2615]
25-01-14 01:10:39 | I |         best error  = [    0.2615]
25-01-14 01:10:39 | I |     + error = [0.2615]
25-01-14 01:10:39 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:10:40 | I |       - range scale = [    1.0000]
25-01-14 01:10:40 | I |         sum  error  = [    1.1789]
25-01-14 01:10:40 | I |         best error  = [    1.1789]
25-01-14 01:10:40 | I |     + error = [1.1789]
25-01-14 01:10:41 | I |       - range scale = [    1.0000]
25-01-14 01:10:41 | I |         sum  error  = [    1.4207]
25-01-14 01:10:41 | I |         best error  = [    1.4207]
25-01-14 01:10:41 | I |     + error = [1.4207]
25-01-14 01:10:41 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:10:42 | I |       - range scale = [    1.0000]
25-01-14 01:10:42 | I |         sum  error  = [    1.3101]
25-01-14 01:10:42 | I |         best error  = [    1.3101]
25-01-14 01:10:42 | I |     + error = [1.3101]
25-01-14 01:10:43 | I |       - range scale = [    1.0000]
25-01-14 01:10:43 | I |         sum  error  = [    1.6761]
25-01-14 01:10:43 | I |         best error  = [    1.6761]
25-01-14 01:10:43 | I |     + error = [1.6761]
25-01-14 01:10:43 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:10:44 | I |       - range scale = [    1.0000]
25-01-14 01:10:44 | I |         sum  error  = [    0.1988]
25-01-14 01:10:44 | I |         best error  = [    0.1988]
25-01-14 01:10:44 | I |     + error = [0.1988]
25-01-14 01:10:45 | I |       - range scale = [    1.0000]
25-01-14 01:10:45 | I |         sum  error  = [    0.2732]
25-01-14 01:10:45 | I |         best error  = [    0.2732]
25-01-14 01:10:45 | I |     + error = [0.2732]
25-01-14 01:10:45 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:10:47 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:10:50 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:10:52 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:10:55 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:10:57 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:11:00 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:11:06 | I | quantizing activations for layer model.layers.0
25-01-14 01:11:06 | I | collecting info in model.layers.0
25-01-14 01:11:07 | I | collecting info in model.layers.0
25-01-14 01:11:07 | I | collecting info in model.layers.0
25-01-14 01:11:08 | I | collecting info in model.layers.0
25-01-14 01:11:09 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:14 | I | forward this layer
25-01-14 01:11:14 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/50.pt
25-01-14 01:11:14 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/50.pt
25-01-14 01:11:14 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:11:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 26           |        cudaMalloc retries: 29        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  41882 GiB |  41860 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  41531 GiB |  41509 GiB |
|       from small pool |      3 MiB |      5 MiB |    351 GiB |    351 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  41882 GiB |  41860 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  41531 GiB |  41509 GiB |
|       from small pool |      3 MiB |      5 MiB |    351 GiB |    351 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  41828 GiB |  41805 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  41478 GiB |  41455 GiB |
|       from small pool |      3 MiB |      5 MiB |    349 GiB |    349 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1863 GiB |   1840 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1861 GiB |   1838 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  20710 GiB |  20709 GiB |
|       from large pool |    943 MiB |   1689 MiB |  20302 GiB |  20301 GiB |
|       from small pool |      0 MiB |      4 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    7285 K  |    7284 K  |
|       from large pool |     186    |     223    |    1049 K  |    1049 K  |
|       from small pool |     109    |     111    |    6235 K  |    6235 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    7285 K  |    7284 K  |
|       from large pool |     186    |     223    |    1049 K  |    1049 K  |
|       from small pool |     109    |     111    |    6235 K  |    6235 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    4582    |    4406    |
|       from large pool |     174    |     174    |    3658    |    3484    |
|       from small pool |       2    |       4    |     924    |     922    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    3066 K  |    3066 K  |
|       from large pool |      20    |      24    |     361 K  |     361 K  |
|       from small pool |       8    |      16    |    2705 K  |    2705 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:11:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  16030 MiB |   9082 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15949 MiB |   9001 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  16030 MiB |   9082 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15949 MiB |   9001 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  15868 MiB |   8920 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  15787 MiB |   8839 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  16888 MiB |   9938 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16884 MiB |   9936 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1164 MiB |   1163 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1080 MiB |   1080 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     84 MiB |     83 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     730    |     550    |
|       from large pool |     126    |     128    |     504    |     378    |
|       from small pool |      54    |      56    |     226    |     172    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     730    |     550    |
|       from large pool |     126    |     128    |     504    |     378    |
|       from small pool |      54    |      56    |     226    |     172    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     452    |     325    |
|       from large pool |     126    |     128    |     450    |     324    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      56    |      55    |
|       from large pool |       0    |       1    |      54    |      54    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:11:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  16030 MiB |   9082 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15949 MiB |   9001 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  16030 MiB |   9082 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  15949 MiB |   9001 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  15868 MiB |   8920 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  15787 MiB |   8839 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  16888 MiB |   9938 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16884 MiB |   9936 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1164 MiB |   1163 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1080 MiB |   1080 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     84 MiB |     83 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     730    |     550    |
|       from large pool |     126    |     128    |     504    |     378    |
|       from small pool |      54    |      56    |     226    |     172    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     730    |     550    |
|       from large pool |     126    |     128    |     504    |     378    |
|       from small pool |      54    |      56    |     226    |     172    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     452    |     325    |
|       from large pool |     126    |     128    |     450    |     324    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      56    |      55    |
|       from large pool |       0    |       1    |      54    |      54    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:11:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  14986 MiB |   9082 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14905 MiB |   9001 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  14986 MiB |   9082 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  14905 MiB |   9001 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  14824 MiB |   8920 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  14743 MiB |   8839 MiB |
|       from small pool |      0 MiB |      1 MiB |     81 MiB |     81 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  15844 MiB |   9938 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15840 MiB |   9936 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1164 MiB |   1163 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1080 MiB |   1080 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     84 MiB |     83 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     697    |     549    |
|       from large pool |     100    |     102    |     478    |     378    |
|       from small pool |      48    |      50    |     219    |     171    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     697    |     549    |
|       from large pool |     100    |     102    |     478    |     378    |
|       from small pool |      48    |      50    |     219    |     171    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     426    |     325    |
|       from large pool |     100    |     102    |     424    |     324    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      56    |      55    |
|       from large pool |       0    |       1    |      54    |      54    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:11:14 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:11:15 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:11:15 | I | in layer model.layers.0
25-01-14 01:11:15 | I | quantizing weights for layer model.layers.0
25-01-14 01:11:15 | I | collecting info in model.layers.0
25-01-14 01:11:16 | I | collecting info in model.layers.0
25-01-14 01:11:16 | I | collecting info in model.layers.0
25-01-14 01:11:17 | I | collecting info in model.layers.0
25-01-14 01:11:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:11:22 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:11:22 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:11:25 | I |       - range scale = [    1.0000]
25-01-14 01:11:25 | I |         sum  error  = [    0.5601]
25-01-14 01:11:25 | I |         best error  = [    0.5601]
25-01-14 01:11:25 | I |     + error = [0.5601]
25-01-14 01:11:28 | I |       - range scale = [    1.0000]
25-01-14 01:11:28 | I |         sum  error  = [    1.3167]
25-01-14 01:11:28 | I |         best error  = [    1.3167]
25-01-14 01:11:28 | I |     + error = [1.3167]
25-01-14 01:11:28 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:11:31 | I |       - range scale = [    1.0000]
25-01-14 01:11:31 | I |         sum  error  = [    1.9755]
25-01-14 01:11:31 | I |         best error  = [    1.9755]
25-01-14 01:11:31 | I |     + error = [1.9755]
25-01-14 01:11:35 | I |       - range scale = [    1.0000]
25-01-14 01:11:35 | I |         sum  error  = [    3.2720]
25-01-14 01:11:35 | I |         best error  = [    3.2720]
25-01-14 01:11:35 | I |     + error = [3.2720]
25-01-14 01:11:35 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:11:36 | I |       - range scale = [    1.0000]
25-01-14 01:11:36 | I |         sum  error  = [    0.2586]
25-01-14 01:11:36 | I |         best error  = [    0.2586]
25-01-14 01:11:36 | I |     + error = [0.2586]
25-01-14 01:11:36 | I |       - range scale = [    1.0000]
25-01-14 01:11:36 | I |         sum  error  = [    0.3173]
25-01-14 01:11:36 | I |         best error  = [    0.3173]
25-01-14 01:11:36 | I |     + error = [0.3173]
25-01-14 01:11:37 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:11:37 | I |       - range scale = [    1.0000]
25-01-14 01:11:37 | I |         sum  error  = [    0.1553]
25-01-14 01:11:37 | I |         best error  = [    0.1553]
25-01-14 01:11:37 | I |     + error = [0.1553]
25-01-14 01:11:38 | I |       - range scale = [    1.0000]
25-01-14 01:11:38 | I |         sum  error  = [    0.2530]
25-01-14 01:11:38 | I |         best error  = [    0.2530]
25-01-14 01:11:38 | I |     + error = [0.2530]
25-01-14 01:11:39 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:11:39 | I |       - range scale = [    1.0000]
25-01-14 01:11:39 | I |         sum  error  = [    1.1274]
25-01-14 01:11:39 | I |         best error  = [    1.1274]
25-01-14 01:11:39 | I |     + error = [1.1274]
25-01-14 01:11:40 | I |       - range scale = [    1.0000]
25-01-14 01:11:40 | I |         sum  error  = [    1.4129]
25-01-14 01:11:40 | I |         best error  = [    1.4129]
25-01-14 01:11:40 | I |     + error = [1.4129]
25-01-14 01:11:41 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:11:41 | I |       - range scale = [    1.0000]
25-01-14 01:11:41 | I |         sum  error  = [    1.2573]
25-01-14 01:11:41 | I |         best error  = [    1.2573]
25-01-14 01:11:41 | I |     + error = [1.2573]
25-01-14 01:11:42 | I |       - range scale = [    1.0000]
25-01-14 01:11:42 | I |         sum  error  = [    1.5973]
25-01-14 01:11:42 | I |         best error  = [    1.5973]
25-01-14 01:11:42 | I |     + error = [1.5973]
25-01-14 01:11:43 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:11:43 | I |       - range scale = [    1.0000]
25-01-14 01:11:43 | I |         sum  error  = [    0.1818]
25-01-14 01:11:43 | I |         best error  = [    0.1818]
25-01-14 01:11:43 | I |     + error = [0.1818]
25-01-14 01:11:44 | I |       - range scale = [    1.0000]
25-01-14 01:11:44 | I |         sum  error  = [    0.2562]
25-01-14 01:11:44 | I |         best error  = [    0.2562]
25-01-14 01:11:44 | I |     + error = [0.2562]
25-01-14 01:11:45 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:11:47 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:11:49 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:11:52 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:11:54 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:11:57 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:11:59 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:12:06 | I | quantizing activations for layer model.layers.0
25-01-14 01:12:06 | I | collecting info in model.layers.0
25-01-14 01:12:06 | I | collecting info in model.layers.0
25-01-14 01:12:07 | I | collecting info in model.layers.0
25-01-14 01:12:08 | I | collecting info in model.layers.0
25-01-14 01:12:09 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:14 | I | forward this layer
25-01-14 01:12:14 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/52.pt
25-01-14 01:12:14 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/52.pt
25-01-14 01:12:14 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:12:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 27           |        cudaMalloc retries: 30        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  44623 GiB |  44601 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  44255 GiB |  44233 GiB |
|       from small pool |      3 MiB |      5 MiB |    368 GiB |    368 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  44623 GiB |  44601 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  44255 GiB |  44233 GiB |
|       from small pool |      3 MiB |      5 MiB |    368 GiB |    368 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  44567 GiB |  44545 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  44200 GiB |  44177 GiB |
|       from small pool |      3 MiB |      5 MiB |    367 GiB |    367 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1930 GiB |   1907 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1929 GiB |   1906 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  22188 GiB |  22187 GiB |
|       from large pool |    943 MiB |   1689 MiB |  21759 GiB |  21758 GiB |
|       from small pool |      0 MiB |      4 MiB |    428 GiB |    428 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    7655 K  |    7655 K  |
|       from large pool |     186    |     223    |    1106 K  |    1106 K  |
|       from small pool |     109    |     111    |    6548 K  |    6548 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    7655 K  |    7655 K  |
|       from large pool |     186    |     223    |    1106 K  |    1106 K  |
|       from small pool |     109    |     111    |    6548 K  |    6548 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    4740    |    4564    |
|       from large pool |     174    |     174    |    3781    |    3607    |
|       from small pool |       2    |       4    |     959    |     957    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    3212 K  |    3212 K  |
|       from large pool |      21    |      24    |     378 K  |     378 K  |
|       from small pool |       8    |      16    |    2834 K  |    2834 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:12:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  16366 MiB |   9418 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16282 MiB |   9334 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  16366 MiB |   9418 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16282 MiB |   9334 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  16198 MiB |   9250 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  16114 MiB |   9166 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  17256 MiB |  10306 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17252 MiB |  10304 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1207 MiB |   1206 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1120 MiB |   1120 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     87 MiB |     86 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     750    |     570    |
|       from large pool |     126    |     128    |     518    |     392    |
|       from small pool |      54    |      56    |     232    |     178    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     750    |     570    |
|       from large pool |     126    |     128    |     518    |     392    |
|       from small pool |      54    |      56    |     232    |     178    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     464    |     337    |
|       from large pool |     126    |     128    |     462    |     336    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      58    |      57    |
|       from large pool |       0    |       1    |      56    |      56    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:12:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  16366 MiB |   9418 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16282 MiB |   9334 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  16366 MiB |   9418 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16282 MiB |   9334 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  16198 MiB |   9250 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  16114 MiB |   9166 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  17256 MiB |  10306 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17252 MiB |  10304 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1207 MiB |   1206 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1120 MiB |   1120 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     87 MiB |     86 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     750    |     570    |
|       from large pool |     126    |     128    |     518    |     392    |
|       from small pool |      54    |      56    |     232    |     178    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     750    |     570    |
|       from large pool |     126    |     128    |     518    |     392    |
|       from small pool |      54    |      56    |     232    |     178    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     464    |     337    |
|       from large pool |     126    |     128    |     462    |     336    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      58    |      57    |
|       from large pool |       0    |       1    |      56    |      56    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:12:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  15322 MiB |   9418 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15238 MiB |   9334 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  15322 MiB |   9418 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15238 MiB |   9334 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  15154 MiB |   9250 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  15070 MiB |   9166 MiB |
|       from small pool |      0 MiB |      1 MiB |     84 MiB |     84 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  16212 MiB |  10306 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16208 MiB |  10304 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1207 MiB |   1206 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1120 MiB |   1120 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     87 MiB |     86 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     717    |     569    |
|       from large pool |     100    |     102    |     492    |     392    |
|       from small pool |      48    |      50    |     225    |     177    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     717    |     569    |
|       from large pool |     100    |     102    |     492    |     392    |
|       from small pool |      48    |      50    |     225    |     177    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     438    |     337    |
|       from large pool |     100    |     102    |     436    |     336    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      58    |      57    |
|       from large pool |       0    |       1    |      56    |      56    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:12:14 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:12:15 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:12:15 | I | in layer model.layers.0
25-01-14 01:12:15 | I | quantizing weights for layer model.layers.0
25-01-14 01:12:15 | I | collecting info in model.layers.0
25-01-14 01:12:15 | I | collecting info in model.layers.0
25-01-14 01:12:16 | I | collecting info in model.layers.0
25-01-14 01:12:17 | I | collecting info in model.layers.0
25-01-14 01:12:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:12:22 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:12:22 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:12:25 | I |       - range scale = [    1.0000]
25-01-14 01:12:25 | I |         sum  error  = [    0.5257]
25-01-14 01:12:25 | I |         best error  = [    0.5257]
25-01-14 01:12:25 | I |     + error = [0.5257]
25-01-14 01:12:28 | I |       - range scale = [    1.0000]
25-01-14 01:12:28 | I |         sum  error  = [    1.2940]
25-01-14 01:12:28 | I |         best error  = [    1.2940]
25-01-14 01:12:28 | I |     + error = [1.2940]
25-01-14 01:12:28 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:12:32 | I |       - range scale = [    1.0000]
25-01-14 01:12:32 | I |         sum  error  = [    1.9232]
25-01-14 01:12:32 | I |         best error  = [    1.9232]
25-01-14 01:12:32 | I |     + error = [1.9232]
25-01-14 01:12:35 | I |       - range scale = [    1.0000]
25-01-14 01:12:35 | I |         sum  error  = [    3.2377]
25-01-14 01:12:35 | I |         best error  = [    3.2377]
25-01-14 01:12:35 | I |     + error = [3.2377]
25-01-14 01:12:35 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:12:36 | I |       - range scale = [    1.0000]
25-01-14 01:12:36 | I |         sum  error  = [    0.2494]
25-01-14 01:12:36 | I |         best error  = [    0.2494]
25-01-14 01:12:36 | I |     + error = [0.2494]
25-01-14 01:12:37 | I |       - range scale = [    1.0000]
25-01-14 01:12:37 | I |         sum  error  = [    0.3019]
25-01-14 01:12:37 | I |         best error  = [    0.3019]
25-01-14 01:12:37 | I |     + error = [0.3019]
25-01-14 01:12:37 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:12:38 | I |       - range scale = [    1.0000]
25-01-14 01:12:38 | I |         sum  error  = [    0.1547]
25-01-14 01:12:38 | I |         best error  = [    0.1547]
25-01-14 01:12:38 | I |     + error = [0.1547]
25-01-14 01:12:38 | I |       - range scale = [    1.0000]
25-01-14 01:12:38 | I |         sum  error  = [    0.2551]
25-01-14 01:12:38 | I |         best error  = [    0.2551]
25-01-14 01:12:38 | I |     + error = [0.2551]
25-01-14 01:12:39 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:12:39 | I |       - range scale = [    1.0000]
25-01-14 01:12:39 | I |         sum  error  = [    1.0279]
25-01-14 01:12:39 | I |         best error  = [    1.0279]
25-01-14 01:12:39 | I |     + error = [1.0279]
25-01-14 01:12:40 | I |       - range scale = [    1.0000]
25-01-14 01:12:40 | I |         sum  error  = [    1.3027]
25-01-14 01:12:40 | I |         best error  = [    1.3027]
25-01-14 01:12:40 | I |     + error = [1.3027]
25-01-14 01:12:41 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:12:41 | I |       - range scale = [    1.0000]
25-01-14 01:12:41 | I |         sum  error  = [    1.1538]
25-01-14 01:12:41 | I |         best error  = [    1.1538]
25-01-14 01:12:41 | I |     + error = [1.1538]
25-01-14 01:12:42 | I |       - range scale = [    1.0000]
25-01-14 01:12:42 | I |         sum  error  = [    1.4715]
25-01-14 01:12:42 | I |         best error  = [    1.4715]
25-01-14 01:12:42 | I |     + error = [1.4715]
25-01-14 01:12:43 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:12:43 | I |       - range scale = [    1.0000]
25-01-14 01:12:43 | I |         sum  error  = [    0.1702]
25-01-14 01:12:43 | I |         best error  = [    0.1702]
25-01-14 01:12:43 | I |     + error = [0.1702]
25-01-14 01:12:44 | I |       - range scale = [    1.0000]
25-01-14 01:12:44 | I |         sum  error  = [    0.2388]
25-01-14 01:12:44 | I |         best error  = [    0.2388]
25-01-14 01:12:44 | I |     + error = [0.2388]
25-01-14 01:12:45 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:12:47 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:12:50 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:12:52 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:12:55 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:12:57 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:13:00 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:13:06 | I | quantizing activations for layer model.layers.0
25-01-14 01:13:06 | I | collecting info in model.layers.0
25-01-14 01:13:07 | I | collecting info in model.layers.0
25-01-14 01:13:08 | I | collecting info in model.layers.0
25-01-14 01:13:08 | I | collecting info in model.layers.0
25-01-14 01:13:09 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:15 | I | forward this layer
25-01-14 01:13:15 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/54.pt
25-01-14 01:13:15 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/54.pt
25-01-14 01:13:15 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:13:15 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 28           |        cudaMalloc retries: 31        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  47449 GiB |  47427 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  47063 GiB |  47041 GiB |
|       from small pool |      3 MiB |      5 MiB |    386 GiB |    386 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  47449 GiB |  47427 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  47063 GiB |  47041 GiB |
|       from small pool |      3 MiB |      5 MiB |    386 GiB |    386 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  47391 GiB |  47369 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  47007 GiB |  46984 GiB |
|       from small pool |      3 MiB |      5 MiB |    384 GiB |    384 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   1999 GiB |   1976 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   1998 GiB |   1974 GiB |
|       from small pool |      4 MiB |      8 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  23697 GiB |  23696 GiB |
|       from large pool |    943 MiB |   1689 MiB |  23248 GiB |  23247 GiB |
|       from small pool |      0 MiB |      4 MiB |    448 GiB |    448 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    8033 K  |    8032 K  |
|       from large pool |     186    |     223    |    1164 K  |    1164 K  |
|       from small pool |     109    |     111    |    6868 K  |    6868 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    8033 K  |    8032 K  |
|       from large pool |     186    |     223    |    1164 K  |    1164 K  |
|       from small pool |     109    |     111    |    6868 K  |    6868 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    4904    |    4728    |
|       from large pool |     174    |     174    |    3910    |    3736    |
|       from small pool |       2    |       4    |     994    |     992    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    3361 K  |    3361 K  |
|       from large pool |      20    |      24    |     395 K  |     395 K  |
|       from small pool |       8    |      16    |    2966 K  |    2966 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:13:15 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  16703 MiB |   9754 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16615 MiB |   9667 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  16703 MiB |   9754 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16615 MiB |   9667 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  16529 MiB |   9580 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  16441 MiB |   9493 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  17624 MiB |  10674 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17620 MiB |  10672 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1250 MiB |   1249 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1160 MiB |   1160 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     90 MiB |     89 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     770    |     590    |
|       from large pool |     126    |     128    |     532    |     406    |
|       from small pool |      54    |      56    |     238    |     184    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     770    |     590    |
|       from large pool |     126    |     128    |     532    |     406    |
|       from small pool |      54    |      56    |     238    |     184    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     476    |     349    |
|       from large pool |     126    |     128    |     474    |     348    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      60    |      59    |
|       from large pool |       0    |       1    |      58    |      58    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:13:15 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  16703 MiB |   9754 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16615 MiB |   9667 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  16703 MiB |   9754 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16615 MiB |   9667 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  16529 MiB |   9580 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  16441 MiB |   9493 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  17624 MiB |  10674 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17620 MiB |  10672 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1250 MiB |   1249 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1160 MiB |   1160 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     90 MiB |     89 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     770    |     590    |
|       from large pool |     126    |     128    |     532    |     406    |
|       from small pool |      54    |      56    |     238    |     184    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     770    |     590    |
|       from large pool |     126    |     128    |     532    |     406    |
|       from small pool |      54    |      56    |     238    |     184    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     476    |     349    |
|       from large pool |     126    |     128    |     474    |     348    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      60    |      59    |
|       from large pool |       0    |       1    |      58    |      58    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:13:15 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  15659 MiB |   9754 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15571 MiB |   9667 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  15659 MiB |   9754 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15571 MiB |   9667 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  15485 MiB |   9580 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  15397 MiB |   9493 MiB |
|       from small pool |      0 MiB |      1 MiB |     87 MiB |     87 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  16580 MiB |  10674 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16576 MiB |  10672 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1250 MiB |   1249 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1160 MiB |   1160 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     90 MiB |     89 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     737    |     589    |
|       from large pool |     100    |     102    |     506    |     406    |
|       from small pool |      48    |      50    |     231    |     183    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     737    |     589    |
|       from large pool |     100    |     102    |     506    |     406    |
|       from small pool |      48    |      50    |     231    |     183    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     450    |     349    |
|       from large pool |     100    |     102    |     448    |     348    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      60    |      59    |
|       from large pool |       0    |       1    |      58    |      58    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:13:15 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:13:15 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:13:15 | I | in layer model.layers.0
25-01-14 01:13:15 | I | quantizing weights for layer model.layers.0
25-01-14 01:13:15 | I | collecting info in model.layers.0
25-01-14 01:13:16 | I | collecting info in model.layers.0
25-01-14 01:13:17 | I | collecting info in model.layers.0
25-01-14 01:13:18 | I | collecting info in model.layers.0
25-01-14 01:13:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:13:23 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:13:23 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:13:26 | I |       - range scale = [    1.0000]
25-01-14 01:13:26 | I |         sum  error  = [    0.5729]
25-01-14 01:13:26 | I |         best error  = [    0.5729]
25-01-14 01:13:26 | I |     + error = [0.5729]
25-01-14 01:13:29 | I |       - range scale = [    1.0000]
25-01-14 01:13:29 | I |         sum  error  = [    1.3670]
25-01-14 01:13:29 | I |         best error  = [    1.3670]
25-01-14 01:13:29 | I |     + error = [1.3670]
25-01-14 01:13:30 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:13:33 | I |       - range scale = [    1.0000]
25-01-14 01:13:33 | I |         sum  error  = [    2.0035]
25-01-14 01:13:33 | I |         best error  = [    2.0035]
25-01-14 01:13:33 | I |     + error = [2.0035]
25-01-14 01:13:36 | I |       - range scale = [    1.0000]
25-01-14 01:13:36 | I |         sum  error  = [    3.2680]
25-01-14 01:13:36 | I |         best error  = [    3.2680]
25-01-14 01:13:36 | I |     + error = [3.2680]
25-01-14 01:13:37 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:13:37 | I |       - range scale = [    1.0000]
25-01-14 01:13:37 | I |         sum  error  = [    0.2601]
25-01-14 01:13:37 | I |         best error  = [    0.2601]
25-01-14 01:13:37 | I |     + error = [0.2601]
25-01-14 01:13:38 | I |       - range scale = [    1.0000]
25-01-14 01:13:38 | I |         sum  error  = [    0.3187]
25-01-14 01:13:38 | I |         best error  = [    0.3187]
25-01-14 01:13:38 | I |     + error = [0.3187]
25-01-14 01:13:38 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:13:39 | I |       - range scale = [    1.0000]
25-01-14 01:13:39 | I |         sum  error  = [    0.1559]
25-01-14 01:13:39 | I |         best error  = [    0.1559]
25-01-14 01:13:39 | I |     + error = [0.1559]
25-01-14 01:13:40 | I |       - range scale = [    1.0000]
25-01-14 01:13:40 | I |         sum  error  = [    0.2599]
25-01-14 01:13:40 | I |         best error  = [    0.2599]
25-01-14 01:13:40 | I |     + error = [0.2599]
25-01-14 01:13:40 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:13:41 | I |       - range scale = [    1.0000]
25-01-14 01:13:41 | I |         sum  error  = [    1.0926]
25-01-14 01:13:41 | I |         best error  = [    1.0926]
25-01-14 01:13:41 | I |     + error = [1.0926]
25-01-14 01:13:42 | I |       - range scale = [    1.0000]
25-01-14 01:13:42 | I |         sum  error  = [    1.3212]
25-01-14 01:13:42 | I |         best error  = [    1.3212]
25-01-14 01:13:42 | I |     + error = [1.3212]
25-01-14 01:13:42 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:13:43 | I |       - range scale = [    1.0000]
25-01-14 01:13:43 | I |         sum  error  = [    1.2257]
25-01-14 01:13:43 | I |         best error  = [    1.2257]
25-01-14 01:13:43 | I |     + error = [1.2257]
25-01-14 01:13:44 | I |       - range scale = [    1.0000]
25-01-14 01:13:44 | I |         sum  error  = [    1.5031]
25-01-14 01:13:44 | I |         best error  = [    1.5031]
25-01-14 01:13:44 | I |     + error = [1.5031]
25-01-14 01:13:44 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:13:45 | I |       - range scale = [    1.0000]
25-01-14 01:13:45 | I |         sum  error  = [    0.1783]
25-01-14 01:13:45 | I |         best error  = [    0.1783]
25-01-14 01:13:45 | I |     + error = [0.1783]
25-01-14 01:13:46 | I |       - range scale = [    1.0000]
25-01-14 01:13:46 | I |         sum  error  = [    0.2633]
25-01-14 01:13:46 | I |         best error  = [    0.2633]
25-01-14 01:13:46 | I |     + error = [0.2633]
25-01-14 01:13:46 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:13:49 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:13:51 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:13:53 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:13:56 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:13:58 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:14:01 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:14:07 | I | quantizing activations for layer model.layers.0
25-01-14 01:14:07 | I | collecting info in model.layers.0
25-01-14 01:14:08 | I | collecting info in model.layers.0
25-01-14 01:14:08 | I | collecting info in model.layers.0
25-01-14 01:14:09 | I | collecting info in model.layers.0
25-01-14 01:14:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:16 | I | forward this layer
25-01-14 01:14:16 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/56.pt
25-01-14 01:14:16 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/56.pt
25-01-14 01:14:16 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:14:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 29           |        cudaMalloc retries: 32        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  50361 GiB |  50339 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  49957 GiB |  49935 GiB |
|       from small pool |      3 MiB |      5 MiB |    403 GiB |    403 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  50361 GiB |  50339 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  49957 GiB |  49935 GiB |
|       from small pool |      3 MiB |      5 MiB |    403 GiB |    403 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  50301 GiB |  50279 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  49899 GiB |  49876 GiB |
|       from small pool |      3 MiB |      5 MiB |    402 GiB |    402 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2067 GiB |   2044 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2065 GiB |   2042 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  25276 GiB |  25275 GiB |
|       from large pool |    943 MiB |   1689 MiB |  24806 GiB |  24805 GiB |
|       from small pool |      0 MiB |      4 MiB |    469 GiB |    469 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    8417 K  |    8417 K  |
|       from large pool |     186    |     223    |    1223 K  |    1223 K  |
|       from small pool |     109    |     111    |    7193 K  |    7193 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    8417 K  |    8417 K  |
|       from large pool |     186    |     223    |    1223 K  |    1223 K  |
|       from small pool |     109    |     111    |    7193 K  |    7193 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    5062    |    4886    |
|       from large pool |     174    |     174    |    4033    |    3859    |
|       from small pool |       2    |       4    |    1029    |    1027    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    3513 K  |    3513 K  |
|       from large pool |      21    |      24    |     413 K  |     413 K  |
|       from small pool |       8    |      16    |    3100 K  |    3100 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:14:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  17039 MiB |  10091 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16949 MiB |  10001 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  17039 MiB |  10091 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16949 MiB |  10001 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  16859 MiB |   9911 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  16769 MiB |   9821 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  17992 MiB |  11042 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17988 MiB |  11040 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1293 MiB |   1292 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1200 MiB |   1200 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     93 MiB |     92 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     790    |     610    |
|       from large pool |     126    |     128    |     546    |     420    |
|       from small pool |      54    |      56    |     244    |     190    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     790    |     610    |
|       from large pool |     126    |     128    |     546    |     420    |
|       from small pool |      54    |      56    |     244    |     190    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     488    |     361    |
|       from large pool |     126    |     128    |     486    |     360    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      62    |      61    |
|       from large pool |       0    |       1    |      60    |      60    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:14:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  17039 MiB |  10091 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16949 MiB |  10001 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  17039 MiB |  10091 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  16949 MiB |  10001 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  16859 MiB |   9911 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  16769 MiB |   9821 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  17992 MiB |  11042 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17988 MiB |  11040 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1293 MiB |   1292 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1200 MiB |   1200 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     93 MiB |     92 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     790    |     610    |
|       from large pool |     126    |     128    |     546    |     420    |
|       from small pool |      54    |      56    |     244    |     190    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     790    |     610    |
|       from large pool |     126    |     128    |     546    |     420    |
|       from small pool |      54    |      56    |     244    |     190    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     488    |     361    |
|       from large pool |     126    |     128    |     486    |     360    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      62    |      61    |
|       from large pool |       0    |       1    |      60    |      60    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:14:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  15995 MiB |  10091 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15905 MiB |  10001 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  15995 MiB |  10091 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  15905 MiB |  10001 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  15815 MiB |   9911 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  15725 MiB |   9821 MiB |
|       from small pool |      0 MiB |      1 MiB |     90 MiB |     90 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  16948 MiB |  11042 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16944 MiB |  11040 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1293 MiB |   1292 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1200 MiB |   1200 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     93 MiB |     92 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     757    |     609    |
|       from large pool |     100    |     102    |     520    |     420    |
|       from small pool |      48    |      50    |     237    |     189    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     757    |     609    |
|       from large pool |     100    |     102    |     520    |     420    |
|       from small pool |      48    |      50    |     237    |     189    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     462    |     361    |
|       from large pool |     100    |     102    |     460    |     360    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      62    |      61    |
|       from large pool |       0    |       1    |      60    |      60    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:14:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:14:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:14:16 | I | in layer model.layers.0
25-01-14 01:14:16 | I | quantizing weights for layer model.layers.0
25-01-14 01:14:16 | I | collecting info in model.layers.0
25-01-14 01:14:17 | I | collecting info in model.layers.0
25-01-14 01:14:18 | I | collecting info in model.layers.0
25-01-14 01:14:18 | I | collecting info in model.layers.0
25-01-14 01:14:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:14:23 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:14:23 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:14:27 | I |       - range scale = [    1.0000]
25-01-14 01:14:27 | I |         sum  error  = [    0.5486]
25-01-14 01:14:27 | I |         best error  = [    0.5486]
25-01-14 01:14:27 | I |     + error = [0.5486]
25-01-14 01:14:30 | I |       - range scale = [    1.0000]
25-01-14 01:14:30 | I |         sum  error  = [    1.3401]
25-01-14 01:14:30 | I |         best error  = [    1.3401]
25-01-14 01:14:30 | I |     + error = [1.3401]
25-01-14 01:14:31 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:14:34 | I |       - range scale = [    1.0000]
25-01-14 01:14:34 | I |         sum  error  = [    1.9439]
25-01-14 01:14:34 | I |         best error  = [    1.9439]
25-01-14 01:14:34 | I |     + error = [1.9439]
25-01-14 01:14:38 | I |       - range scale = [    1.0000]
25-01-14 01:14:38 | I |         sum  error  = [    3.2121]
25-01-14 01:14:38 | I |         best error  = [    3.2121]
25-01-14 01:14:38 | I |     + error = [3.2121]
25-01-14 01:14:38 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:14:38 | I |       - range scale = [    1.0000]
25-01-14 01:14:38 | I |         sum  error  = [    0.2524]
25-01-14 01:14:38 | I |         best error  = [    0.2524]
25-01-14 01:14:38 | I |     + error = [0.2524]
25-01-14 01:14:39 | I |       - range scale = [    1.0000]
25-01-14 01:14:39 | I |         sum  error  = [    0.3131]
25-01-14 01:14:39 | I |         best error  = [    0.3131]
25-01-14 01:14:39 | I |     + error = [0.3131]
25-01-14 01:14:40 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:14:40 | I |       - range scale = [    1.0000]
25-01-14 01:14:40 | I |         sum  error  = [    0.1624]
25-01-14 01:14:40 | I |         best error  = [    0.1624]
25-01-14 01:14:40 | I |     + error = [0.1624]
25-01-14 01:14:41 | I |       - range scale = [    1.0000]
25-01-14 01:14:41 | I |         sum  error  = [    0.2643]
25-01-14 01:14:41 | I |         best error  = [    0.2643]
25-01-14 01:14:41 | I |     + error = [0.2643]
25-01-14 01:14:41 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:14:42 | I |       - range scale = [    1.0000]
25-01-14 01:14:42 | I |         sum  error  = [    1.0556]
25-01-14 01:14:42 | I |         best error  = [    1.0556]
25-01-14 01:14:42 | I |     + error = [1.0556]
25-01-14 01:14:43 | I |       - range scale = [    1.0000]
25-01-14 01:14:43 | I |         sum  error  = [    1.2684]
25-01-14 01:14:43 | I |         best error  = [    1.2684]
25-01-14 01:14:43 | I |     + error = [1.2684]
25-01-14 01:14:43 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:14:44 | I |       - range scale = [    1.0000]
25-01-14 01:14:44 | I |         sum  error  = [    1.1929]
25-01-14 01:14:44 | I |         best error  = [    1.1929]
25-01-14 01:14:44 | I |     + error = [1.1929]
25-01-14 01:14:45 | I |       - range scale = [    1.0000]
25-01-14 01:14:45 | I |         sum  error  = [    1.4606]
25-01-14 01:14:45 | I |         best error  = [    1.4606]
25-01-14 01:14:45 | I |     + error = [1.4606]
25-01-14 01:14:45 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:14:46 | I |       - range scale = [    1.0000]
25-01-14 01:14:46 | I |         sum  error  = [    0.1699]
25-01-14 01:14:46 | I |         best error  = [    0.1699]
25-01-14 01:14:46 | I |     + error = [0.1699]
25-01-14 01:14:47 | I |       - range scale = [    1.0000]
25-01-14 01:14:47 | I |         sum  error  = [    0.3208]
25-01-14 01:14:47 | I |         best error  = [    0.3208]
25-01-14 01:14:47 | I |     + error = [0.3208]
25-01-14 01:14:47 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:14:50 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:14:52 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:14:55 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:14:57 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:14:59 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:15:02 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:15:08 | I | quantizing activations for layer model.layers.0
25-01-14 01:15:08 | I | collecting info in model.layers.0
25-01-14 01:15:09 | I | collecting info in model.layers.0
25-01-14 01:15:10 | I | collecting info in model.layers.0
25-01-14 01:15:10 | I | collecting info in model.layers.0
25-01-14 01:15:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:17 | I | forward this layer
25-01-14 01:15:17 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/58.pt
25-01-14 01:15:17 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/58.pt
25-01-14 01:15:17 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:15:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 30           |        cudaMalloc retries: 33        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  53358 GiB |  53336 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  52936 GiB |  52914 GiB |
|       from small pool |      3 MiB |      5 MiB |    422 GiB |    422 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  53358 GiB |  53336 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  52936 GiB |  52914 GiB |
|       from small pool |      3 MiB |      5 MiB |    422 GiB |    422 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  53297 GiB |  53274 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  52876 GiB |  52854 GiB |
|       from small pool |      3 MiB |      5 MiB |    420 GiB |    420 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2136 GiB |   2113 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2134 GiB |   2111 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  26886 GiB |  26885 GiB |
|       from large pool |    943 MiB |   1689 MiB |  26395 GiB |  26394 GiB |
|       from small pool |      0 MiB |      4 MiB |    491 GiB |    491 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    8809 K  |    8809 K  |
|       from large pool |     186    |     223    |    1284 K  |    1284 K  |
|       from small pool |     109    |     111    |    7525 K  |    7525 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    8809 K  |    8809 K  |
|       from large pool |     186    |     223    |    1284 K  |    1284 K  |
|       from small pool |     109    |     111    |    7525 K  |    7525 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    5226    |    5050    |
|       from large pool |     174    |     174    |    4162    |    3988    |
|       from small pool |       2    |       4    |    1064    |    1062    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    3666 K  |    3666 K  |
|       from large pool |      20    |      24    |     430 K  |     430 K  |
|       from small pool |       8    |      16    |    3235 K  |    3235 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:15:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  17375 MiB |  10427 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17282 MiB |  10334 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  17375 MiB |  10427 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17282 MiB |  10334 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  17189 MiB |  10241 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  17096 MiB |  10148 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  18360 MiB |  11410 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18356 MiB |  11408 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1336 MiB |   1335 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1240 MiB |   1240 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     96 MiB |     95 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     810    |     630    |
|       from large pool |     126    |     128    |     560    |     434    |
|       from small pool |      54    |      56    |     250    |     196    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     810    |     630    |
|       from large pool |     126    |     128    |     560    |     434    |
|       from small pool |      54    |      56    |     250    |     196    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     500    |     373    |
|       from large pool |     126    |     128    |     498    |     372    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      64    |      63    |
|       from large pool |       0    |       1    |      62    |      62    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:15:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  17375 MiB |  10427 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17282 MiB |  10334 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  17375 MiB |  10427 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17282 MiB |  10334 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  17189 MiB |  10241 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  17096 MiB |  10148 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  18360 MiB |  11410 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18356 MiB |  11408 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1336 MiB |   1335 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1240 MiB |   1240 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     96 MiB |     95 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     810    |     630    |
|       from large pool |     126    |     128    |     560    |     434    |
|       from small pool |      54    |      56    |     250    |     196    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     810    |     630    |
|       from large pool |     126    |     128    |     560    |     434    |
|       from small pool |      54    |      56    |     250    |     196    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     500    |     373    |
|       from large pool |     126    |     128    |     498    |     372    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      64    |      63    |
|       from large pool |       0    |       1    |      62    |      62    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:15:17 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  16332 MiB |  10427 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16238 MiB |  10334 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  16332 MiB |  10427 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16238 MiB |  10334 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  16146 MiB |  10241 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  16052 MiB |  10148 MiB |
|       from small pool |      0 MiB |      1 MiB |     93 MiB |     93 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  17316 MiB |  11410 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17312 MiB |  11408 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1336 MiB |   1335 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1240 MiB |   1240 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     96 MiB |     95 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     777    |     629    |
|       from large pool |     100    |     102    |     534    |     434    |
|       from small pool |      48    |      50    |     243    |     195    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     777    |     629    |
|       from large pool |     100    |     102    |     534    |     434    |
|       from small pool |      48    |      50    |     243    |     195    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     474    |     373    |
|       from large pool |     100    |     102    |     472    |     372    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      64    |      63    |
|       from large pool |       0    |       1    |      62    |      62    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:15:17 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:15:18 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:15:18 | I | in layer model.layers.0
25-01-14 01:15:18 | I | quantizing weights for layer model.layers.0
25-01-14 01:15:18 | I | collecting info in model.layers.0
25-01-14 01:15:19 | I | collecting info in model.layers.0
25-01-14 01:15:19 | I | collecting info in model.layers.0
25-01-14 01:15:20 | I | collecting info in model.layers.0
25-01-14 01:15:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:15:25 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:15:25 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:15:29 | I |       - range scale = [    1.0000]
25-01-14 01:15:29 | I |         sum  error  = [    0.5630]
25-01-14 01:15:29 | I |         best error  = [    0.5630]
25-01-14 01:15:29 | I |     + error = [0.5630]
25-01-14 01:15:33 | I |       - range scale = [    1.0000]
25-01-14 01:15:33 | I |         sum  error  = [    1.3557]
25-01-14 01:15:33 | I |         best error  = [    1.3557]
25-01-14 01:15:33 | I |     + error = [1.3557]
25-01-14 01:15:33 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:15:36 | I |       - range scale = [    1.0000]
25-01-14 01:15:36 | I |         sum  error  = [    1.9356]
25-01-14 01:15:36 | I |         best error  = [    1.9356]
25-01-14 01:15:36 | I |     + error = [1.9356]
25-01-14 01:15:40 | I |       - range scale = [    1.0000]
25-01-14 01:15:40 | I |         sum  error  = [    3.2320]
25-01-14 01:15:40 | I |         best error  = [    3.2320]
25-01-14 01:15:40 | I |     + error = [3.2320]
25-01-14 01:15:40 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:15:41 | I |       - range scale = [    1.0000]
25-01-14 01:15:41 | I |         sum  error  = [    0.2516]
25-01-14 01:15:41 | I |         best error  = [    0.2516]
25-01-14 01:15:41 | I |     + error = [0.2516]
25-01-14 01:15:42 | I |       - range scale = [    1.0000]
25-01-14 01:15:42 | I |         sum  error  = [    0.3120]
25-01-14 01:15:42 | I |         best error  = [    0.3120]
25-01-14 01:15:42 | I |     + error = [0.3120]
25-01-14 01:15:42 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:15:43 | I |       - range scale = [    1.0000]
25-01-14 01:15:43 | I |         sum  error  = [    0.1596]
25-01-14 01:15:43 | I |         best error  = [    0.1596]
25-01-14 01:15:43 | I |     + error = [0.1596]
25-01-14 01:15:43 | I |       - range scale = [    1.0000]
25-01-14 01:15:43 | I |         sum  error  = [    0.2585]
25-01-14 01:15:43 | I |         best error  = [    0.2585]
25-01-14 01:15:43 | I |     + error = [0.2585]
25-01-14 01:15:44 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:15:44 | I |       - range scale = [    1.0000]
25-01-14 01:15:44 | I |         sum  error  = [    1.0245]
25-01-14 01:15:44 | I |         best error  = [    1.0245]
25-01-14 01:15:44 | I |     + error = [1.0245]
25-01-14 01:15:45 | I |       - range scale = [    1.0000]
25-01-14 01:15:45 | I |         sum  error  = [    1.2371]
25-01-14 01:15:45 | I |         best error  = [    1.2371]
25-01-14 01:15:45 | I |     + error = [1.2371]
25-01-14 01:15:46 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:15:46 | I |       - range scale = [    1.0000]
25-01-14 01:15:46 | I |         sum  error  = [    1.1581]
25-01-14 01:15:46 | I |         best error  = [    1.1581]
25-01-14 01:15:46 | I |     + error = [1.1581]
25-01-14 01:15:47 | I |       - range scale = [    1.0000]
25-01-14 01:15:47 | I |         sum  error  = [    1.4268]
25-01-14 01:15:47 | I |         best error  = [    1.4268]
25-01-14 01:15:47 | I |     + error = [1.4268]
25-01-14 01:15:48 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:15:48 | I |       - range scale = [    1.0000]
25-01-14 01:15:48 | I |         sum  error  = [    0.1631]
25-01-14 01:15:48 | I |         best error  = [    0.1631]
25-01-14 01:15:48 | I |     + error = [0.1631]
25-01-14 01:15:49 | I |       - range scale = [    1.0000]
25-01-14 01:15:49 | I |         sum  error  = [    0.2561]
25-01-14 01:15:49 | I |         best error  = [    0.2561]
25-01-14 01:15:49 | I |     + error = [0.2561]
25-01-14 01:15:50 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:15:52 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:15:55 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:15:57 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:15:59 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:16:02 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:16:04 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:16:10 | I | quantizing activations for layer model.layers.0
25-01-14 01:16:10 | I | collecting info in model.layers.0
25-01-14 01:16:11 | I | collecting info in model.layers.0
25-01-14 01:16:12 | I | collecting info in model.layers.0
25-01-14 01:16:13 | I | collecting info in model.layers.0
25-01-14 01:16:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:20 | I | forward this layer
25-01-14 01:16:20 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/60.pt
25-01-14 01:16:20 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/60.pt
25-01-14 01:16:20 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:16:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 31           |        cudaMalloc retries: 34        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  56441 GiB |  56418 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  56000 GiB |  55978 GiB |
|       from small pool |      3 MiB |      5 MiB |    440 GiB |    440 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  56441 GiB |  56418 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  56000 GiB |  55978 GiB |
|       from small pool |      3 MiB |      5 MiB |    440 GiB |    440 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  56377 GiB |  56355 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  55938 GiB |  55916 GiB |
|       from small pool |      3 MiB |      5 MiB |    439 GiB |    439 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2204 GiB |   2181 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2202 GiB |   2179 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  28567 GiB |  28566 GiB |
|       from large pool |    943 MiB |   1689 MiB |  28054 GiB |  28053 GiB |
|       from small pool |      0 MiB |      4 MiB |    513 GiB |    513 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    9208 K  |    9208 K  |
|       from large pool |     186    |     223    |    1346 K  |    1346 K  |
|       from small pool |     109    |     111    |    7862 K  |    7862 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    9208 K  |    9208 K  |
|       from large pool |     186    |     223    |    1346 K  |    1346 K  |
|       from small pool |     109    |     111    |    7862 K  |    7862 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    5384    |    5208    |
|       from large pool |     174    |     174    |    4285    |    4111    |
|       from small pool |       2    |       4    |    1099    |    1097    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    3823 K  |    3823 K  |
|       from large pool |      21    |      24    |     449 K  |     449 K  |
|       from small pool |       8    |      16    |    3373 K  |    3373 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:16:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  17712 MiB |  10764 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17616 MiB |  10668 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  17712 MiB |  10764 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17616 MiB |  10668 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  17520 MiB |  10572 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  17424 MiB |  10476 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  18728 MiB |  11778 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18724 MiB |  11776 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1379 MiB |   1378 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1280 MiB |   1280 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     99 MiB |     98 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     830    |     650    |
|       from large pool |     126    |     128    |     574    |     448    |
|       from small pool |      54    |      56    |     256    |     202    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     830    |     650    |
|       from large pool |     126    |     128    |     574    |     448    |
|       from small pool |      54    |      56    |     256    |     202    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     512    |     385    |
|       from large pool |     126    |     128    |     510    |     384    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      66    |      65    |
|       from large pool |       0    |       1    |      64    |      64    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:16:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  17712 MiB |  10764 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17616 MiB |  10668 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  17712 MiB |  10764 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17616 MiB |  10668 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  17520 MiB |  10572 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  17424 MiB |  10476 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  18728 MiB |  11778 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18724 MiB |  11776 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1379 MiB |   1378 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1280 MiB |   1280 MiB |
|       from small pool |   1751 KiB |   2047 KiB |     99 MiB |     98 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     830    |     650    |
|       from large pool |     126    |     128    |     574    |     448    |
|       from small pool |      54    |      56    |     256    |     202    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     830    |     650    |
|       from large pool |     126    |     128    |     574    |     448    |
|       from small pool |      54    |      56    |     256    |     202    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     512    |     385    |
|       from large pool |     126    |     128    |     510    |     384    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      66    |      65    |
|       from large pool |       0    |       1    |      64    |      64    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:16:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  16668 MiB |  10764 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16572 MiB |  10668 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  16668 MiB |  10764 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16572 MiB |  10668 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  16476 MiB |  10572 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  16380 MiB |  10476 MiB |
|       from small pool |      0 MiB |      1 MiB |     96 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  17684 MiB |  11778 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17680 MiB |  11776 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1379 MiB |   1378 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1280 MiB |   1280 MiB |
|       from small pool |   1544 KiB |   2047 KiB |     99 MiB |     98 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     797    |     649    |
|       from large pool |     100    |     102    |     548    |     448    |
|       from small pool |      48    |      50    |     249    |     201    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     797    |     649    |
|       from large pool |     100    |     102    |     548    |     448    |
|       from small pool |      48    |      50    |     249    |     201    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     486    |     385    |
|       from large pool |     100    |     102    |     484    |     384    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      66    |      65    |
|       from large pool |       0    |       1    |      64    |      64    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:16:20 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:16:20 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:16:20 | I | in layer model.layers.0
25-01-14 01:16:20 | I | quantizing weights for layer model.layers.0
25-01-14 01:16:20 | I | collecting info in model.layers.0
25-01-14 01:16:21 | I | collecting info in model.layers.0
25-01-14 01:16:22 | I | collecting info in model.layers.0
25-01-14 01:16:23 | I | collecting info in model.layers.0
25-01-14 01:16:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:16:28 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:16:28 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:16:32 | I |       - range scale = [    1.0000]
25-01-14 01:16:32 | I |         sum  error  = [    0.5706]
25-01-14 01:16:32 | I |         best error  = [    0.5706]
25-01-14 01:16:32 | I |     + error = [0.5706]
25-01-14 01:16:35 | I |       - range scale = [    1.0000]
25-01-14 01:16:35 | I |         sum  error  = [    1.3399]
25-01-14 01:16:35 | I |         best error  = [    1.3399]
25-01-14 01:16:35 | I |     + error = [1.3399]
25-01-14 01:16:35 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:16:39 | I |       - range scale = [    1.0000]
25-01-14 01:16:39 | I |         sum  error  = [    1.9911]
25-01-14 01:16:39 | I |         best error  = [    1.9911]
25-01-14 01:16:39 | I |     + error = [1.9911]
25-01-14 01:16:43 | I |       - range scale = [    1.0000]
25-01-14 01:16:43 | I |         sum  error  = [    3.1291]
25-01-14 01:16:43 | I |         best error  = [    3.1291]
25-01-14 01:16:43 | I |     + error = [3.1291]
25-01-14 01:16:43 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:16:44 | I |       - range scale = [    1.0000]
25-01-14 01:16:44 | I |         sum  error  = [    0.2567]
25-01-14 01:16:44 | I |         best error  = [    0.2567]
25-01-14 01:16:44 | I |     + error = [0.2567]
25-01-14 01:16:44 | I |       - range scale = [    1.0000]
25-01-14 01:16:44 | I |         sum  error  = [    0.3067]
25-01-14 01:16:44 | I |         best error  = [    0.3067]
25-01-14 01:16:44 | I |     + error = [0.3067]
25-01-14 01:16:45 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:16:45 | I |       - range scale = [    1.0000]
25-01-14 01:16:45 | I |         sum  error  = [    0.1628]
25-01-14 01:16:45 | I |         best error  = [    0.1628]
25-01-14 01:16:45 | I |     + error = [0.1628]
25-01-14 01:16:46 | I |       - range scale = [    1.0000]
25-01-14 01:16:46 | I |         sum  error  = [    0.2610]
25-01-14 01:16:46 | I |         best error  = [    0.2610]
25-01-14 01:16:46 | I |     + error = [0.2610]
25-01-14 01:16:46 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:16:47 | I |       - range scale = [    1.0000]
25-01-14 01:16:47 | I |         sum  error  = [    1.2347]
25-01-14 01:16:47 | I |         best error  = [    1.2347]
25-01-14 01:16:47 | I |     + error = [1.2347]
25-01-14 01:16:48 | I |       - range scale = [    1.0000]
25-01-14 01:16:48 | I |         sum  error  = [    1.4076]
25-01-14 01:16:48 | I |         best error  = [    1.4076]
25-01-14 01:16:48 | I |     + error = [1.4076]
25-01-14 01:16:48 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:16:49 | I |       - range scale = [    1.0000]
25-01-14 01:16:49 | I |         sum  error  = [    1.3494]
25-01-14 01:16:49 | I |         best error  = [    1.3494]
25-01-14 01:16:49 | I |     + error = [1.3494]
25-01-14 01:16:50 | I |       - range scale = [    1.0000]
25-01-14 01:16:50 | I |         sum  error  = [    1.5731]
25-01-14 01:16:50 | I |         best error  = [    1.5731]
25-01-14 01:16:50 | I |     + error = [1.5731]
25-01-14 01:16:50 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:16:51 | I |       - range scale = [    1.0000]
25-01-14 01:16:51 | I |         sum  error  = [    0.2101]
25-01-14 01:16:51 | I |         best error  = [    0.2101]
25-01-14 01:16:51 | I |     + error = [0.2101]
25-01-14 01:16:52 | I |       - range scale = [    1.0000]
25-01-14 01:16:52 | I |         sum  error  = [    0.3055]
25-01-14 01:16:52 | I |         best error  = [    0.3055]
25-01-14 01:16:52 | I |     + error = [0.3055]
25-01-14 01:16:52 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:16:55 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:16:57 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:17:00 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:17:02 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:17:04 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:17:07 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:17:13 | I | quantizing activations for layer model.layers.0
25-01-14 01:17:13 | I | collecting info in model.layers.0
25-01-14 01:17:14 | I | collecting info in model.layers.0
25-01-14 01:17:15 | I | collecting info in model.layers.0
25-01-14 01:17:16 | I | collecting info in model.layers.0
25-01-14 01:17:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:23 | I | forward this layer
25-01-14 01:17:23 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/62.pt
25-01-14 01:17:23 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/62.pt
25-01-14 01:17:23 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:17:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 32           |        cudaMalloc retries: 35        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  59608 GiB |  59586 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  59149 GiB |  59127 GiB |
|       from small pool |      3 MiB |      5 MiB |    459 GiB |    459 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  59608 GiB |  59586 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  59149 GiB |  59127 GiB |
|       from small pool |      3 MiB |      5 MiB |    459 GiB |    459 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  59543 GiB |  59521 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  59086 GiB |  59063 GiB |
|       from small pool |      3 MiB |      5 MiB |    457 GiB |    457 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2273 GiB |   2250 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2271 GiB |   2248 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  30278 GiB |  30277 GiB |
|       from large pool |    943 MiB |   1689 MiB |  29742 GiB |  29741 GiB |
|       from small pool |      0 MiB |      4 MiB |    535 GiB |    535 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |    9615 K  |    9614 K  |
|       from large pool |     186    |     223    |    1409 K  |    1409 K  |
|       from small pool |     109    |     111    |    8205 K  |    8205 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |    9615 K  |    9614 K  |
|       from large pool |     186    |     223    |    1409 K  |    1409 K  |
|       from small pool |     109    |     111    |    8205 K  |    8205 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    5548    |    5372    |
|       from large pool |     174    |     174    |    4414    |    4240    |
|       from small pool |       2    |       4    |    1134    |    1132    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    3981 K  |    3981 K  |
|       from large pool |      20    |      24    |     467 K  |     467 K  |
|       from small pool |       8    |      16    |    3513 K  |    3513 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:17:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  18048 MiB |  11100 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17949 MiB |  11001 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  18048 MiB |  11100 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17949 MiB |  11001 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  17850 MiB |  10902 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  17751 MiB |  10803 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  19096 MiB |  12146 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19092 MiB |  12144 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1422 MiB |   1421 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1320 MiB |   1320 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    102 MiB |    101 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     850    |     670    |
|       from large pool |     126    |     128    |     588    |     462    |
|       from small pool |      54    |      56    |     262    |     208    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     850    |     670    |
|       from large pool |     126    |     128    |     588    |     462    |
|       from small pool |      54    |      56    |     262    |     208    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     524    |     397    |
|       from large pool |     126    |     128    |     522    |     396    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      68    |      67    |
|       from large pool |       0    |       1    |      66    |      66    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:17:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  18048 MiB |  11100 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17949 MiB |  11001 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  18048 MiB |  11100 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  17949 MiB |  11001 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  17850 MiB |  10902 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  17751 MiB |  10803 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  19096 MiB |  12146 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19092 MiB |  12144 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1422 MiB |   1421 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1320 MiB |   1320 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    102 MiB |    101 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     850    |     670    |
|       from large pool |     126    |     128    |     588    |     462    |
|       from small pool |      54    |      56    |     262    |     208    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     850    |     670    |
|       from large pool |     126    |     128    |     588    |     462    |
|       from small pool |      54    |      56    |     262    |     208    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     524    |     397    |
|       from large pool |     126    |     128    |     522    |     396    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      68    |      67    |
|       from large pool |       0    |       1    |      66    |      66    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:17:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  17004 MiB |  11100 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16905 MiB |  11001 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  17004 MiB |  11100 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  16905 MiB |  11001 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  16806 MiB |  10902 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  16707 MiB |  10803 MiB |
|       from small pool |      0 MiB |      1 MiB |     99 MiB |     99 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  18052 MiB |  12146 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18048 MiB |  12144 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1422 MiB |   1421 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1320 MiB |   1320 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    102 MiB |    101 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     817    |     669    |
|       from large pool |     100    |     102    |     562    |     462    |
|       from small pool |      48    |      50    |     255    |     207    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     817    |     669    |
|       from large pool |     100    |     102    |     562    |     462    |
|       from small pool |      48    |      50    |     255    |     207    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     498    |     397    |
|       from large pool |     100    |     102    |     496    |     396    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      68    |      67    |
|       from large pool |       0    |       1    |      66    |      66    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:17:23 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:17:23 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:17:23 | I | in layer model.layers.0
25-01-14 01:17:23 | I | quantizing weights for layer model.layers.0
25-01-14 01:17:23 | I | collecting info in model.layers.0
25-01-14 01:17:24 | I | collecting info in model.layers.0
25-01-14 01:17:25 | I | collecting info in model.layers.0
25-01-14 01:17:26 | I | collecting info in model.layers.0
25-01-14 01:17:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:30 | I | collecting calibration activations in model.layers.0
25-01-14 01:17:31 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:17:31 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:17:35 | I |       - range scale = [    1.0000]
25-01-14 01:17:35 | I |         sum  error  = [    0.5668]
25-01-14 01:17:35 | I |         best error  = [    0.5668]
25-01-14 01:17:35 | I |     + error = [0.5668]
25-01-14 01:17:39 | I |       - range scale = [    1.0000]
25-01-14 01:17:39 | I |         sum  error  = [    1.3679]
25-01-14 01:17:39 | I |         best error  = [    1.3679]
25-01-14 01:17:39 | I |     + error = [1.3679]
25-01-14 01:17:39 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:17:43 | I |       - range scale = [    1.0000]
25-01-14 01:17:43 | I |         sum  error  = [    2.0126]
25-01-14 01:17:43 | I |         best error  = [    2.0126]
25-01-14 01:17:43 | I |     + error = [2.0126]
25-01-14 01:17:46 | I |       - range scale = [    1.0000]
25-01-14 01:17:46 | I |         sum  error  = [    3.3113]
25-01-14 01:17:46 | I |         best error  = [    3.3113]
25-01-14 01:17:46 | I |     + error = [3.3113]
25-01-14 01:17:47 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:17:47 | I |       - range scale = [    1.0000]
25-01-14 01:17:47 | I |         sum  error  = [    0.2567]
25-01-14 01:17:47 | I |         best error  = [    0.2567]
25-01-14 01:17:47 | I |     + error = [0.2567]
25-01-14 01:17:48 | I |       - range scale = [    1.0000]
25-01-14 01:17:48 | I |         sum  error  = [    0.2997]
25-01-14 01:17:48 | I |         best error  = [    0.2997]
25-01-14 01:17:48 | I |     + error = [0.2997]
25-01-14 01:17:48 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:17:49 | I |       - range scale = [    1.0000]
25-01-14 01:17:49 | I |         sum  error  = [    0.1652]
25-01-14 01:17:49 | I |         best error  = [    0.1652]
25-01-14 01:17:49 | I |     + error = [0.1652]
25-01-14 01:17:50 | I |       - range scale = [    1.0000]
25-01-14 01:17:50 | I |         sum  error  = [    0.2697]
25-01-14 01:17:50 | I |         best error  = [    0.2697]
25-01-14 01:17:50 | I |     + error = [0.2697]
25-01-14 01:17:50 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:17:51 | I |       - range scale = [    1.0000]
25-01-14 01:17:51 | I |         sum  error  = [    1.0665]
25-01-14 01:17:51 | I |         best error  = [    1.0665]
25-01-14 01:17:51 | I |     + error = [1.0665]
25-01-14 01:17:52 | I |       - range scale = [    1.0000]
25-01-14 01:17:52 | I |         sum  error  = [    1.2934]
25-01-14 01:17:52 | I |         best error  = [    1.2934]
25-01-14 01:17:52 | I |     + error = [1.2934]
25-01-14 01:17:52 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:17:53 | I |       - range scale = [    1.0000]
25-01-14 01:17:53 | I |         sum  error  = [    1.2079]
25-01-14 01:17:53 | I |         best error  = [    1.2079]
25-01-14 01:17:53 | I |     + error = [1.2079]
25-01-14 01:17:54 | I |       - range scale = [    1.0000]
25-01-14 01:17:54 | I |         sum  error  = [    1.4772]
25-01-14 01:17:54 | I |         best error  = [    1.4772]
25-01-14 01:17:54 | I |     + error = [1.4772]
25-01-14 01:17:54 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:17:55 | I |       - range scale = [    1.0000]
25-01-14 01:17:55 | I |         sum  error  = [    0.1697]
25-01-14 01:17:55 | I |         best error  = [    0.1697]
25-01-14 01:17:55 | I |     + error = [0.1697]
25-01-14 01:17:56 | I |       - range scale = [    1.0000]
25-01-14 01:17:56 | I |         sum  error  = [    0.2609]
25-01-14 01:17:56 | I |         best error  = [    0.2609]
25-01-14 01:17:56 | I |     + error = [0.2609]
25-01-14 01:17:56 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:17:59 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:18:01 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:18:03 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:18:06 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:18:08 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:18:11 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:18:17 | I | quantizing activations for layer model.layers.0
25-01-14 01:18:17 | I | collecting info in model.layers.0
25-01-14 01:18:18 | I | collecting info in model.layers.0
25-01-14 01:18:18 | I | collecting info in model.layers.0
25-01-14 01:18:19 | I | collecting info in model.layers.0
25-01-14 01:18:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:26 | I | forward this layer
25-01-14 01:18:26 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/64.pt
25-01-14 01:18:26 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/64.pt
25-01-14 01:18:27 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:18:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 33           |        cudaMalloc retries: 36        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  62862 GiB |  62839 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  62383 GiB |  62361 GiB |
|       from small pool |      3 MiB |      5 MiB |    478 GiB |    478 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  62862 GiB |  62839 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  62383 GiB |  62361 GiB |
|       from small pool |      3 MiB |      5 MiB |    478 GiB |    478 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  62795 GiB |  62773 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  62318 GiB |  62296 GiB |
|       from small pool |      3 MiB |      5 MiB |    476 GiB |    476 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2341 GiB |   2318 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2338 GiB |   2315 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  32061 GiB |  32060 GiB |
|       from large pool |    943 MiB |   1689 MiB |  31503 GiB |  31502 GiB |
|       from small pool |      0 MiB |      4 MiB |    557 GiB |    557 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   10028 K  |   10028 K  |
|       from large pool |     186    |     223    |    1473 K  |    1473 K  |
|       from small pool |     109    |     111    |    8554 K  |    8554 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   10028 K  |   10028 K  |
|       from large pool |     186    |     223    |    1473 K  |    1473 K  |
|       from small pool |     109    |     111    |    8554 K  |    8554 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    5706    |    5530    |
|       from large pool |     174    |     174    |    4537    |    4363    |
|       from small pool |       2    |       4    |    1169    |    1167    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    4142 K  |    4142 K  |
|       from large pool |      21    |      24    |     486 K  |     486 K  |
|       from small pool |       8    |      16    |    3655 K  |    3655 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:18:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  18385 MiB |  11436 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18282 MiB |  11334 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  18385 MiB |  11436 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18282 MiB |  11334 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  18181 MiB |  11232 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  18078 MiB |  11130 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  19464 MiB |  12514 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19460 MiB |  12512 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1465 MiB |   1464 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1360 MiB |   1360 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    105 MiB |    104 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     870    |     690    |
|       from large pool |     126    |     128    |     602    |     476    |
|       from small pool |      54    |      56    |     268    |     214    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     870    |     690    |
|       from large pool |     126    |     128    |     602    |     476    |
|       from small pool |      54    |      56    |     268    |     214    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     536    |     409    |
|       from large pool |     126    |     128    |     534    |     408    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      70    |      69    |
|       from large pool |       0    |       1    |      68    |      68    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:18:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  18385 MiB |  11436 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18282 MiB |  11334 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  18385 MiB |  11436 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18282 MiB |  11334 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  18181 MiB |  11232 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  18078 MiB |  11130 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  19464 MiB |  12514 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19460 MiB |  12512 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1465 MiB |   1464 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1360 MiB |   1360 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    105 MiB |    104 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     870    |     690    |
|       from large pool |     126    |     128    |     602    |     476    |
|       from small pool |      54    |      56    |     268    |     214    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     870    |     690    |
|       from large pool |     126    |     128    |     602    |     476    |
|       from small pool |      54    |      56    |     268    |     214    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     536    |     409    |
|       from large pool |     126    |     128    |     534    |     408    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      70    |      69    |
|       from large pool |       0    |       1    |      68    |      68    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:18:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  17341 MiB |  11436 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17238 MiB |  11334 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  17341 MiB |  11436 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17238 MiB |  11334 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  17137 MiB |  11232 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  17034 MiB |  11130 MiB |
|       from small pool |      0 MiB |      1 MiB |    102 MiB |    102 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  18420 MiB |  12514 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18416 MiB |  12512 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1465 MiB |   1464 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1360 MiB |   1360 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    105 MiB |    104 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     837    |     689    |
|       from large pool |     100    |     102    |     576    |     476    |
|       from small pool |      48    |      50    |     261    |     213    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     837    |     689    |
|       from large pool |     100    |     102    |     576    |     476    |
|       from small pool |      48    |      50    |     261    |     213    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     510    |     409    |
|       from large pool |     100    |     102    |     508    |     408    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      70    |      69    |
|       from large pool |       0    |       1    |      68    |      68    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:18:27 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:18:27 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:18:27 | I | in layer model.layers.0
25-01-14 01:18:27 | I | quantizing weights for layer model.layers.0
25-01-14 01:18:27 | I | collecting info in model.layers.0
25-01-14 01:18:28 | I | collecting info in model.layers.0
25-01-14 01:18:29 | I | collecting info in model.layers.0
25-01-14 01:18:29 | I | collecting info in model.layers.0
25-01-14 01:18:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:33 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:18:35 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:18:35 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:18:39 | I |       - range scale = [    1.0000]
25-01-14 01:18:39 | I |         sum  error  = [    0.5487]
25-01-14 01:18:39 | I |         best error  = [    0.5487]
25-01-14 01:18:39 | I |     + error = [0.5487]
25-01-14 01:18:43 | I |       - range scale = [    1.0000]
25-01-14 01:18:43 | I |         sum  error  = [    1.3499]
25-01-14 01:18:43 | I |         best error  = [    1.3499]
25-01-14 01:18:43 | I |     + error = [1.3499]
25-01-14 01:18:43 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:18:47 | I |       - range scale = [    1.0000]
25-01-14 01:18:47 | I |         sum  error  = [    1.9634]
25-01-14 01:18:47 | I |         best error  = [    1.9634]
25-01-14 01:18:47 | I |     + error = [1.9634]
25-01-14 01:18:51 | I |       - range scale = [    1.0000]
25-01-14 01:18:51 | I |         sum  error  = [    3.3275]
25-01-14 01:18:51 | I |         best error  = [    3.3275]
25-01-14 01:18:51 | I |     + error = [3.3275]
25-01-14 01:18:51 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:18:52 | I |       - range scale = [    1.0000]
25-01-14 01:18:52 | I |         sum  error  = [    0.2481]
25-01-14 01:18:52 | I |         best error  = [    0.2481]
25-01-14 01:18:52 | I |     + error = [0.2481]
25-01-14 01:18:52 | I |       - range scale = [    1.0000]
25-01-14 01:18:52 | I |         sum  error  = [    0.3249]
25-01-14 01:18:52 | I |         best error  = [    0.3249]
25-01-14 01:18:52 | I |     + error = [0.3249]
25-01-14 01:18:53 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:18:53 | I |       - range scale = [    1.0000]
25-01-14 01:18:53 | I |         sum  error  = [    0.1644]
25-01-14 01:18:53 | I |         best error  = [    0.1644]
25-01-14 01:18:53 | I |     + error = [0.1644]
25-01-14 01:18:54 | I |       - range scale = [    1.0000]
25-01-14 01:18:54 | I |         sum  error  = [    0.2584]
25-01-14 01:18:54 | I |         best error  = [    0.2584]
25-01-14 01:18:54 | I |     + error = [0.2584]
25-01-14 01:18:54 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:18:55 | I |       - range scale = [    1.0000]
25-01-14 01:18:55 | I |         sum  error  = [    1.0550]
25-01-14 01:18:55 | I |         best error  = [    1.0550]
25-01-14 01:18:55 | I |     + error = [1.0550]
25-01-14 01:18:56 | I |       - range scale = [    1.0000]
25-01-14 01:18:56 | I |         sum  error  = [    1.2676]
25-01-14 01:18:56 | I |         best error  = [    1.2676]
25-01-14 01:18:56 | I |     + error = [1.2676]
25-01-14 01:18:56 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:18:57 | I |       - range scale = [    1.0000]
25-01-14 01:18:57 | I |         sum  error  = [    1.1825]
25-01-14 01:18:57 | I |         best error  = [    1.1825]
25-01-14 01:18:57 | I |     + error = [1.1825]
25-01-14 01:18:58 | I |       - range scale = [    1.0000]
25-01-14 01:18:58 | I |         sum  error  = [    1.4524]
25-01-14 01:18:58 | I |         best error  = [    1.4524]
25-01-14 01:18:58 | I |     + error = [1.4524]
25-01-14 01:18:58 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:18:59 | I |       - range scale = [    1.0000]
25-01-14 01:18:59 | I |         sum  error  = [    0.1687]
25-01-14 01:18:59 | I |         best error  = [    0.1687]
25-01-14 01:18:59 | I |     + error = [0.1687]
25-01-14 01:19:00 | I |       - range scale = [    1.0000]
25-01-14 01:19:00 | I |         sum  error  = [    0.2576]
25-01-14 01:19:00 | I |         best error  = [    0.2576]
25-01-14 01:19:00 | I |     + error = [0.2576]
25-01-14 01:19:00 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:19:03 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:19:05 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:19:08 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:19:10 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:19:13 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:19:15 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:19:22 | I | quantizing activations for layer model.layers.0
25-01-14 01:19:22 | I | collecting info in model.layers.0
25-01-14 01:19:23 | I | collecting info in model.layers.0
25-01-14 01:19:23 | I | collecting info in model.layers.0
25-01-14 01:19:24 | I | collecting info in model.layers.0
25-01-14 01:19:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:32 | I | forward this layer
25-01-14 01:19:32 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/66.pt
25-01-14 01:19:32 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/66.pt
25-01-14 01:19:32 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:19:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 34           |        cudaMalloc retries: 37        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  66200 GiB |  66178 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  65702 GiB |  65680 GiB |
|       from small pool |      3 MiB |      5 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  66200 GiB |  66178 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  65702 GiB |  65680 GiB |
|       from small pool |      3 MiB |      5 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  66132 GiB |  66110 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  65636 GiB |  65613 GiB |
|       from small pool |      3 MiB |      5 MiB |    496 GiB |    496 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2410 GiB |   2387 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2407 GiB |   2384 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  33871 GiB |  33870 GiB |
|       from large pool |    943 MiB |   1689 MiB |  33290 GiB |  33289 GiB |
|       from small pool |      0 MiB |      4 MiB |    580 GiB |    580 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   10449 K  |   10449 K  |
|       from large pool |     186    |     223    |    1539 K  |    1539 K  |
|       from small pool |     109    |     111    |    8909 K  |    8909 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   10449 K  |   10449 K  |
|       from large pool |     186    |     223    |    1539 K  |    1539 K  |
|       from small pool |     109    |     111    |    8909 K  |    8909 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    5870    |    5694    |
|       from large pool |     174    |     174    |    4666    |    4492    |
|       from small pool |       2    |       4    |    1204    |    1202    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    4305 K  |    4305 K  |
|       from large pool |      20    |      24    |     505 K  |     505 K  |
|       from small pool |       8    |      16    |    3799 K  |    3799 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:19:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  18721 MiB |  11773 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18616 MiB |  11668 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  18721 MiB |  11773 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18616 MiB |  11668 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  18511 MiB |  11563 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  18406 MiB |  11458 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  19832 MiB |  12882 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19828 MiB |  12880 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1508 MiB |   1507 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1400 MiB |   1400 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    108 MiB |    107 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     890    |     710    |
|       from large pool |     126    |     128    |     616    |     490    |
|       from small pool |      54    |      56    |     274    |     220    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     890    |     710    |
|       from large pool |     126    |     128    |     616    |     490    |
|       from small pool |      54    |      56    |     274    |     220    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     548    |     421    |
|       from large pool |     126    |     128    |     546    |     420    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      72    |      71    |
|       from large pool |       0    |       1    |      70    |      70    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:19:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  18721 MiB |  11773 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18616 MiB |  11668 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  18721 MiB |  11773 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18616 MiB |  11668 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  18511 MiB |  11563 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  18406 MiB |  11458 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  19832 MiB |  12882 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19828 MiB |  12880 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1508 MiB |   1507 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1400 MiB |   1400 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    108 MiB |    107 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     890    |     710    |
|       from large pool |     126    |     128    |     616    |     490    |
|       from small pool |      54    |      56    |     274    |     220    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     890    |     710    |
|       from large pool |     126    |     128    |     616    |     490    |
|       from small pool |      54    |      56    |     274    |     220    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     548    |     421    |
|       from large pool |     126    |     128    |     546    |     420    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      72    |      71    |
|       from large pool |       0    |       1    |      70    |      70    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:19:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  17677 MiB |  11773 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17572 MiB |  11668 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  17677 MiB |  11773 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17572 MiB |  11668 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  17467 MiB |  11563 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  17362 MiB |  11458 MiB |
|       from small pool |      0 MiB |      1 MiB |    105 MiB |    105 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  18788 MiB |  12882 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18784 MiB |  12880 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1508 MiB |   1507 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1400 MiB |   1400 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    108 MiB |    107 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     857    |     709    |
|       from large pool |     100    |     102    |     590    |     490    |
|       from small pool |      48    |      50    |     267    |     219    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     857    |     709    |
|       from large pool |     100    |     102    |     590    |     490    |
|       from small pool |      48    |      50    |     267    |     219    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     522    |     421    |
|       from large pool |     100    |     102    |     520    |     420    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      72    |      71    |
|       from large pool |       0    |       1    |      70    |      70    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:19:32 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:19:32 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:19:32 | I | in layer model.layers.0
25-01-14 01:19:32 | I | quantizing weights for layer model.layers.0
25-01-14 01:19:32 | I | collecting info in model.layers.0
25-01-14 01:19:33 | I | collecting info in model.layers.0
25-01-14 01:19:34 | I | collecting info in model.layers.0
25-01-14 01:19:35 | I | collecting info in model.layers.0
25-01-14 01:19:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:37 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:38 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:39 | I | collecting calibration activations in model.layers.0
25-01-14 01:19:41 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:19:41 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:19:44 | I |       - range scale = [    1.0000]
25-01-14 01:19:44 | I |         sum  error  = [    0.6025]
25-01-14 01:19:44 | I |         best error  = [    0.6025]
25-01-14 01:19:44 | I |     + error = [0.6025]
25-01-14 01:19:48 | I |       - range scale = [    1.0000]
25-01-14 01:19:48 | I |         sum  error  = [    1.4135]
25-01-14 01:19:48 | I |         best error  = [    1.4135]
25-01-14 01:19:48 | I |     + error = [1.4135]
25-01-14 01:19:49 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:19:53 | I |       - range scale = [    1.0000]
25-01-14 01:19:53 | I |         sum  error  = [    2.1169]
25-01-14 01:19:53 | I |         best error  = [    2.1169]
25-01-14 01:19:53 | I |     + error = [2.1169]
25-01-14 01:19:56 | I |       - range scale = [    1.0000]
25-01-14 01:19:56 | I |         sum  error  = [    3.4222]
25-01-14 01:19:56 | I |         best error  = [    3.4222]
25-01-14 01:19:56 | I |     + error = [3.4222]
25-01-14 01:19:57 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:19:57 | I |       - range scale = [    1.0000]
25-01-14 01:19:57 | I |         sum  error  = [    0.2600]
25-01-14 01:19:57 | I |         best error  = [    0.2600]
25-01-14 01:19:57 | I |     + error = [0.2600]
25-01-14 01:19:58 | I |       - range scale = [    1.0000]
25-01-14 01:19:58 | I |         sum  error  = [    0.3263]
25-01-14 01:19:58 | I |         best error  = [    0.3263]
25-01-14 01:19:58 | I |     + error = [0.3263]
25-01-14 01:19:58 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:19:59 | I |       - range scale = [    1.0000]
25-01-14 01:19:59 | I |         sum  error  = [    0.1663]
25-01-14 01:19:59 | I |         best error  = [    0.1663]
25-01-14 01:19:59 | I |     + error = [0.1663]
25-01-14 01:20:00 | I |       - range scale = [    1.0000]
25-01-14 01:20:00 | I |         sum  error  = [    0.2767]
25-01-14 01:20:00 | I |         best error  = [    0.2767]
25-01-14 01:20:00 | I |     + error = [0.2767]
25-01-14 01:20:00 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:20:01 | I |       - range scale = [    1.0000]
25-01-14 01:20:01 | I |         sum  error  = [    1.1036]
25-01-14 01:20:01 | I |         best error  = [    1.1036]
25-01-14 01:20:01 | I |     + error = [1.1036]
25-01-14 01:20:02 | I |       - range scale = [    1.0000]
25-01-14 01:20:02 | I |         sum  error  = [    1.2871]
25-01-14 01:20:02 | I |         best error  = [    1.2871]
25-01-14 01:20:02 | I |     + error = [1.2871]
25-01-14 01:20:02 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:20:03 | I |       - range scale = [    1.0000]
25-01-14 01:20:03 | I |         sum  error  = [    1.2490]
25-01-14 01:20:03 | I |         best error  = [    1.2490]
25-01-14 01:20:03 | I |     + error = [1.2490]
25-01-14 01:20:04 | I |       - range scale = [    1.0000]
25-01-14 01:20:04 | I |         sum  error  = [    1.4741]
25-01-14 01:20:04 | I |         best error  = [    1.4741]
25-01-14 01:20:04 | I |     + error = [1.4741]
25-01-14 01:20:04 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:20:05 | I |       - range scale = [    1.0000]
25-01-14 01:20:05 | I |         sum  error  = [    0.1760]
25-01-14 01:20:05 | I |         best error  = [    0.1760]
25-01-14 01:20:05 | I |     + error = [0.1760]
25-01-14 01:20:06 | I |       - range scale = [    1.0000]
25-01-14 01:20:06 | I |         sum  error  = [    0.2620]
25-01-14 01:20:06 | I |         best error  = [    0.2620]
25-01-14 01:20:06 | I |     + error = [0.2620]
25-01-14 01:20:06 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:20:09 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:20:11 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:20:14 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:20:16 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:20:19 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:20:21 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:20:27 | I | quantizing activations for layer model.layers.0
25-01-14 01:20:27 | I | collecting info in model.layers.0
25-01-14 01:20:28 | I | collecting info in model.layers.0
25-01-14 01:20:29 | I | collecting info in model.layers.0
25-01-14 01:20:30 | I | collecting info in model.layers.0
25-01-14 01:20:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:33 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:35 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:37 | I | forward this layer
25-01-14 01:20:37 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/68.pt
25-01-14 01:20:37 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/68.pt
25-01-14 01:20:38 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:20:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 35           |        cudaMalloc retries: 38        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  69624 GiB |  69602 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  69106 GiB |  69084 GiB |
|       from small pool |      3 MiB |      5 MiB |    517 GiB |    517 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  69624 GiB |  69602 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  69106 GiB |  69084 GiB |
|       from small pool |      3 MiB |      5 MiB |    517 GiB |    517 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  69554 GiB |  69532 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  69038 GiB |  69016 GiB |
|       from small pool |      3 MiB |      5 MiB |    516 GiB |    516 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2478 GiB |   2454 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2475 GiB |   2452 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  35756 GiB |  35755 GiB |
|       from large pool |    943 MiB |   1689 MiB |  35152 GiB |  35151 GiB |
|       from small pool |      0 MiB |      4 MiB |    604 GiB |    604 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   10877 K  |   10877 K  |
|       from large pool |     186    |     223    |    1606 K  |    1606 K  |
|       from small pool |     109    |     111    |    9270 K  |    9270 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   10877 K  |   10877 K  |
|       from large pool |     186    |     223    |    1606 K  |    1606 K  |
|       from small pool |     109    |     111    |    9270 K  |    9270 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6028    |    5852    |
|       from large pool |     174    |     174    |    4789    |    4615    |
|       from small pool |       2    |       4    |    1239    |    1237    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    4471 K  |    4471 K  |
|       from large pool |      21    |      24    |     525 K  |     525 K  |
|       from small pool |       8    |      16    |    3946 K  |    3946 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:20:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  19057 MiB |  12109 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18949 MiB |  12001 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  19057 MiB |  12109 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18949 MiB |  12001 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  18841 MiB |  11893 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  18733 MiB |  11785 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  20200 MiB |  13250 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20196 MiB |  13248 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1551 MiB |   1550 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1440 MiB |   1440 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    111 MiB |    110 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     910    |     730    |
|       from large pool |     126    |     128    |     630    |     504    |
|       from small pool |      54    |      56    |     280    |     226    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     910    |     730    |
|       from large pool |     126    |     128    |     630    |     504    |
|       from small pool |      54    |      56    |     280    |     226    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     560    |     433    |
|       from large pool |     126    |     128    |     558    |     432    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      74    |      73    |
|       from large pool |       0    |       1    |      72    |      72    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:20:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  19057 MiB |  12109 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18949 MiB |  12001 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  19057 MiB |  12109 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  18949 MiB |  12001 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  18841 MiB |  11893 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  18733 MiB |  11785 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  20200 MiB |  13250 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20196 MiB |  13248 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1551 MiB |   1550 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1440 MiB |   1440 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    111 MiB |    110 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     910    |     730    |
|       from large pool |     126    |     128    |     630    |     504    |
|       from small pool |      54    |      56    |     280    |     226    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     910    |     730    |
|       from large pool |     126    |     128    |     630    |     504    |
|       from small pool |      54    |      56    |     280    |     226    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     560    |     433    |
|       from large pool |     126    |     128    |     558    |     432    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      74    |      73    |
|       from large pool |       0    |       1    |      72    |      72    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:20:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  18013 MiB |  12109 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17905 MiB |  12001 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  18013 MiB |  12109 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  17905 MiB |  12001 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  17797 MiB |  11893 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  17689 MiB |  11785 MiB |
|       from small pool |      0 MiB |      1 MiB |    108 MiB |    108 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  19156 MiB |  13250 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19152 MiB |  13248 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1551 MiB |   1550 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1440 MiB |   1440 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    111 MiB |    110 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     877    |     729    |
|       from large pool |     100    |     102    |     604    |     504    |
|       from small pool |      48    |      50    |     273    |     225    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     877    |     729    |
|       from large pool |     100    |     102    |     604    |     504    |
|       from small pool |      48    |      50    |     273    |     225    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     534    |     433    |
|       from large pool |     100    |     102    |     532    |     432    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      74    |      73    |
|       from large pool |       0    |       1    |      72    |      72    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:20:38 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:20:38 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:20:38 | I | in layer model.layers.0
25-01-14 01:20:38 | I | quantizing weights for layer model.layers.0
25-01-14 01:20:38 | I | collecting info in model.layers.0
25-01-14 01:20:39 | I | collecting info in model.layers.0
25-01-14 01:20:40 | I | collecting info in model.layers.0
25-01-14 01:20:41 | I | collecting info in model.layers.0
25-01-14 01:20:42 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:43 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:44 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:20:47 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:20:47 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:20:51 | I |       - range scale = [    1.0000]
25-01-14 01:20:51 | I |         sum  error  = [    0.5709]
25-01-14 01:20:51 | I |         best error  = [    0.5709]
25-01-14 01:20:51 | I |     + error = [0.5709]
25-01-14 01:20:55 | I |       - range scale = [    1.0000]
25-01-14 01:20:55 | I |         sum  error  = [    1.4037]
25-01-14 01:20:55 | I |         best error  = [    1.4037]
25-01-14 01:20:55 | I |     + error = [1.4037]
25-01-14 01:20:55 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:20:59 | I |       - range scale = [    1.0000]
25-01-14 01:20:59 | I |         sum  error  = [    2.1089]
25-01-14 01:20:59 | I |         best error  = [    2.1089]
25-01-14 01:20:59 | I |     + error = [2.1089]
25-01-14 01:21:03 | I |       - range scale = [    1.0000]
25-01-14 01:21:03 | I |         sum  error  = [    3.3663]
25-01-14 01:21:03 | I |         best error  = [    3.3663]
25-01-14 01:21:03 | I |     + error = [3.3663]
25-01-14 01:21:03 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:21:04 | I |       - range scale = [    1.0000]
25-01-14 01:21:04 | I |         sum  error  = [    0.2567]
25-01-14 01:21:04 | I |         best error  = [    0.2567]
25-01-14 01:21:04 | I |     + error = [0.2567]
25-01-14 01:21:05 | I |       - range scale = [    1.0000]
25-01-14 01:21:05 | I |         sum  error  = [    0.3397]
25-01-14 01:21:05 | I |         best error  = [    0.3397]
25-01-14 01:21:05 | I |     + error = [0.3397]
25-01-14 01:21:05 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:21:05 | I |       - range scale = [    1.0000]
25-01-14 01:21:05 | I |         sum  error  = [    0.1718]
25-01-14 01:21:05 | I |         best error  = [    0.1718]
25-01-14 01:21:06 | I |     + error = [0.1718]
25-01-14 01:21:06 | I |       - range scale = [    1.0000]
25-01-14 01:21:06 | I |         sum  error  = [    0.2754]
25-01-14 01:21:06 | I |         best error  = [    0.2754]
25-01-14 01:21:06 | I |     + error = [0.2754]
25-01-14 01:21:07 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:21:07 | I |       - range scale = [    1.0000]
25-01-14 01:21:07 | I |         sum  error  = [    1.0994]
25-01-14 01:21:07 | I |         best error  = [    1.0994]
25-01-14 01:21:07 | I |     + error = [1.0994]
25-01-14 01:21:08 | I |       - range scale = [    1.0000]
25-01-14 01:21:08 | I |         sum  error  = [    1.3015]
25-01-14 01:21:08 | I |         best error  = [    1.3015]
25-01-14 01:21:08 | I |     + error = [1.3015]
25-01-14 01:21:09 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:21:09 | I |       - range scale = [    1.0000]
25-01-14 01:21:09 | I |         sum  error  = [    1.2276]
25-01-14 01:21:09 | I |         best error  = [    1.2276]
25-01-14 01:21:09 | I |     + error = [1.2276]
25-01-14 01:21:10 | I |       - range scale = [    1.0000]
25-01-14 01:21:10 | I |         sum  error  = [    1.4936]
25-01-14 01:21:10 | I |         best error  = [    1.4936]
25-01-14 01:21:10 | I |     + error = [1.4936]
25-01-14 01:21:11 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:21:11 | I |       - range scale = [    1.0000]
25-01-14 01:21:11 | I |         sum  error  = [    0.1754]
25-01-14 01:21:11 | I |         best error  = [    0.1754]
25-01-14 01:21:11 | I |     + error = [0.1754]
25-01-14 01:21:12 | I |       - range scale = [    1.0000]
25-01-14 01:21:12 | I |         sum  error  = [    0.2659]
25-01-14 01:21:12 | I |         best error  = [    0.2659]
25-01-14 01:21:12 | I |     + error = [0.2659]
25-01-14 01:21:13 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:21:15 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:21:18 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:21:20 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:21:22 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:21:25 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:21:27 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:21:34 | I | quantizing activations for layer model.layers.0
25-01-14 01:21:34 | I | collecting info in model.layers.0
25-01-14 01:21:35 | I | collecting info in model.layers.0
25-01-14 01:21:36 | I | collecting info in model.layers.0
25-01-14 01:21:36 | I | collecting info in model.layers.0
25-01-14 01:21:38 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:39 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:40 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:41 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:44 | I | forward this layer
25-01-14 01:21:44 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/70.pt
25-01-14 01:21:44 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/70.pt
25-01-14 01:21:44 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:21:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 36           |        cudaMalloc retries: 39        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  73134 GiB |  73112 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  72596 GiB |  72574 GiB |
|       from small pool |      3 MiB |      5 MiB |    537 GiB |    537 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  73134 GiB |  73112 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  72596 GiB |  72574 GiB |
|       from small pool |      3 MiB |      5 MiB |    537 GiB |    537 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  73062 GiB |  73040 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  72526 GiB |  72504 GiB |
|       from small pool |      3 MiB |      5 MiB |    535 GiB |    535 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2546 GiB |   2523 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2544 GiB |   2521 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  37667 GiB |  37666 GiB |
|       from large pool |    943 MiB |   1689 MiB |  37039 GiB |  37038 GiB |
|       from small pool |      0 MiB |      4 MiB |    627 GiB |    627 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   11312 K  |   11312 K  |
|       from large pool |     186    |     223    |    1674 K  |    1674 K  |
|       from small pool |     109    |     111    |    9637 K  |    9637 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   11312 K  |   11312 K  |
|       from large pool |     186    |     223    |    1674 K  |    1674 K  |
|       from small pool |     109    |     111    |    9637 K  |    9637 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6192    |    6016    |
|       from large pool |     174    |     174    |    4918    |    4744    |
|       from small pool |       2    |       4    |    1274    |    1272    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    4639 K  |    4639 K  |
|       from large pool |      20    |      24    |     544 K  |     544 K  |
|       from small pool |       8    |      16    |    4094 K  |    4094 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:21:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  19394 MiB |  12445 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19282 MiB |  12334 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  19394 MiB |  12445 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19282 MiB |  12334 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  19172 MiB |  12223 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  19060 MiB |  12112 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  20568 MiB |  13618 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20564 MiB |  13616 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1594 MiB |   1593 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1480 MiB |   1480 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    114 MiB |    113 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     930    |     750    |
|       from large pool |     126    |     128    |     644    |     518    |
|       from small pool |      54    |      56    |     286    |     232    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     930    |     750    |
|       from large pool |     126    |     128    |     644    |     518    |
|       from small pool |      54    |      56    |     286    |     232    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     572    |     445    |
|       from large pool |     126    |     128    |     570    |     444    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      76    |      75    |
|       from large pool |       0    |       1    |      74    |      74    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:21:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  19394 MiB |  12445 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19282 MiB |  12334 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  19394 MiB |  12445 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19282 MiB |  12334 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  19172 MiB |  12223 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  19060 MiB |  12112 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  20568 MiB |  13618 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20564 MiB |  13616 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1594 MiB |   1593 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1480 MiB |   1480 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    114 MiB |    113 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     930    |     750    |
|       from large pool |     126    |     128    |     644    |     518    |
|       from small pool |      54    |      56    |     286    |     232    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     930    |     750    |
|       from large pool |     126    |     128    |     644    |     518    |
|       from small pool |      54    |      56    |     286    |     232    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     572    |     445    |
|       from large pool |     126    |     128    |     570    |     444    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      76    |      75    |
|       from large pool |       0    |       1    |      74    |      74    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:21:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  18350 MiB |  12445 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18238 MiB |  12334 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  18350 MiB |  12445 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18238 MiB |  12334 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  18128 MiB |  12223 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  18016 MiB |  12112 MiB |
|       from small pool |      0 MiB |      1 MiB |    111 MiB |    111 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  19524 MiB |  13618 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19520 MiB |  13616 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1594 MiB |   1593 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1480 MiB |   1480 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    114 MiB |    113 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     897    |     749    |
|       from large pool |     100    |     102    |     618    |     518    |
|       from small pool |      48    |      50    |     279    |     231    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     897    |     749    |
|       from large pool |     100    |     102    |     618    |     518    |
|       from small pool |      48    |      50    |     279    |     231    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     546    |     445    |
|       from large pool |     100    |     102    |     544    |     444    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      76    |      75    |
|       from large pool |       0    |       1    |      74    |      74    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:21:44 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:21:45 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:21:45 | I | in layer model.layers.0
25-01-14 01:21:45 | I | quantizing weights for layer model.layers.0
25-01-14 01:21:45 | I | collecting info in model.layers.0
25-01-14 01:21:46 | I | collecting info in model.layers.0
25-01-14 01:21:46 | I | collecting info in model.layers.0
25-01-14 01:21:47 | I | collecting info in model.layers.0
25-01-14 01:21:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:50 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:51 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:52 | I | collecting calibration activations in model.layers.0
25-01-14 01:21:53 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:21:53 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:21:57 | I |       - range scale = [    1.0000]
25-01-14 01:21:57 | I |         sum  error  = [    0.6130]
25-01-14 01:21:57 | I |         best error  = [    0.6130]
25-01-14 01:21:57 | I |     + error = [0.6130]
25-01-14 01:22:02 | I |       - range scale = [    1.0000]
25-01-14 01:22:02 | I |         sum  error  = [    1.4601]
25-01-14 01:22:02 | I |         best error  = [    1.4601]
25-01-14 01:22:02 | I |     + error = [1.4601]
25-01-14 01:22:02 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:22:06 | I |       - range scale = [    1.0000]
25-01-14 01:22:06 | I |         sum  error  = [    2.0921]
25-01-14 01:22:06 | I |         best error  = [    2.0921]
25-01-14 01:22:06 | I |     + error = [2.0921]
25-01-14 01:22:10 | I |       - range scale = [    1.0000]
25-01-14 01:22:10 | I |         sum  error  = [    3.4075]
25-01-14 01:22:10 | I |         best error  = [    3.4075]
25-01-14 01:22:10 | I |     + error = [3.4075]
25-01-14 01:22:10 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:22:11 | I |       - range scale = [    1.0000]
25-01-14 01:22:11 | I |         sum  error  = [    0.2536]
25-01-14 01:22:11 | I |         best error  = [    0.2536]
25-01-14 01:22:11 | I |     + error = [0.2536]
25-01-14 01:22:12 | I |       - range scale = [    1.0000]
25-01-14 01:22:12 | I |         sum  error  = [    0.3019]
25-01-14 01:22:12 | I |         best error  = [    0.3019]
25-01-14 01:22:12 | I |     + error = [0.3019]
25-01-14 01:22:12 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:22:13 | I |       - range scale = [    1.0000]
25-01-14 01:22:13 | I |         sum  error  = [    0.1743]
25-01-14 01:22:13 | I |         best error  = [    0.1743]
25-01-14 01:22:13 | I |     + error = [0.1743]
25-01-14 01:22:14 | I |       - range scale = [    1.0000]
25-01-14 01:22:14 | I |         sum  error  = [    0.2831]
25-01-14 01:22:14 | I |         best error  = [    0.2831]
25-01-14 01:22:14 | I |     + error = [0.2831]
25-01-14 01:22:14 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:22:15 | I |       - range scale = [    1.0000]
25-01-14 01:22:15 | I |         sum  error  = [    1.0946]
25-01-14 01:22:15 | I |         best error  = [    1.0946]
25-01-14 01:22:15 | I |     + error = [1.0946]
25-01-14 01:22:16 | I |       - range scale = [    1.0000]
25-01-14 01:22:16 | I |         sum  error  = [    1.2841]
25-01-14 01:22:16 | I |         best error  = [    1.2841]
25-01-14 01:22:16 | I |     + error = [1.2841]
25-01-14 01:22:16 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:22:17 | I |       - range scale = [    1.0000]
25-01-14 01:22:17 | I |         sum  error  = [    1.2232]
25-01-14 01:22:17 | I |         best error  = [    1.2232]
25-01-14 01:22:17 | I |     + error = [1.2232]
25-01-14 01:22:18 | I |       - range scale = [    1.0000]
25-01-14 01:22:18 | I |         sum  error  = [    1.4624]
25-01-14 01:22:18 | I |         best error  = [    1.4624]
25-01-14 01:22:18 | I |     + error = [1.4624]
25-01-14 01:22:18 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:22:19 | I |       - range scale = [    1.0000]
25-01-14 01:22:19 | I |         sum  error  = [    0.1811]
25-01-14 01:22:19 | I |         best error  = [    0.1811]
25-01-14 01:22:19 | I |     + error = [0.1811]
25-01-14 01:22:20 | I |       - range scale = [    1.0000]
25-01-14 01:22:20 | I |         sum  error  = [    0.2635]
25-01-14 01:22:20 | I |         best error  = [    0.2635]
25-01-14 01:22:20 | I |     + error = [0.2635]
25-01-14 01:22:20 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:22:23 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:22:25 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:22:27 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:22:30 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:22:32 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:22:35 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:22:41 | I | quantizing activations for layer model.layers.0
25-01-14 01:22:41 | I | collecting info in model.layers.0
25-01-14 01:22:42 | I | collecting info in model.layers.0
25-01-14 01:22:43 | I | collecting info in model.layers.0
25-01-14 01:22:44 | I | collecting info in model.layers.0
25-01-14 01:22:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:22:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:22:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:22:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:22:52 | I | forward this layer
25-01-14 01:22:52 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/72.pt
25-01-14 01:22:52 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/72.pt
25-01-14 01:22:52 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:22:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 37           |        cudaMalloc retries: 40        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  76729 GiB |  76706 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  76170 GiB |  76148 GiB |
|       from small pool |      3 MiB |      5 MiB |    558 GiB |    558 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  76729 GiB |  76706 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  76170 GiB |  76148 GiB |
|       from small pool |      3 MiB |      5 MiB |    558 GiB |    558 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  76655 GiB |  76633 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  76099 GiB |  76077 GiB |
|       from small pool |      3 MiB |      5 MiB |    556 GiB |    556 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2614 GiB |   2591 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2612 GiB |   2589 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  39653 GiB |  39652 GiB |
|       from large pool |    943 MiB |   1689 MiB |  39001 GiB |  39001 GiB |
|       from small pool |      0 MiB |      4 MiB |    651 GiB |    651 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   11754 K  |   11754 K  |
|       from large pool |     186    |     223    |    1744 K  |    1744 K  |
|       from small pool |     109    |     111    |   10010 K  |   10010 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   11754 K  |   11754 K  |
|       from large pool |     186    |     223    |    1744 K  |    1744 K  |
|       from small pool |     109    |     111    |   10010 K  |   10010 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6350    |    6174    |
|       from large pool |     174    |     174    |    5041    |    4867    |
|       from small pool |       2    |       4    |    1309    |    1307    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    4809 K  |    4809 K  |
|       from large pool |      21    |      24    |     564 K  |     564 K  |
|       from small pool |       8    |      16    |    4244 K  |    4244 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:22:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  19730 MiB |  12782 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19616 MiB |  12668 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  19730 MiB |  12782 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19616 MiB |  12668 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  19502 MiB |  12554 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  19388 MiB |  12440 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  20936 MiB |  13986 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20932 MiB |  13984 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1637 MiB |   1636 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1520 MiB |   1520 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    117 MiB |    116 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     950    |     770    |
|       from large pool |     126    |     128    |     658    |     532    |
|       from small pool |      54    |      56    |     292    |     238    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     950    |     770    |
|       from large pool |     126    |     128    |     658    |     532    |
|       from small pool |      54    |      56    |     292    |     238    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     584    |     457    |
|       from large pool |     126    |     128    |     582    |     456    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      78    |      77    |
|       from large pool |       0    |       1    |      76    |      76    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:22:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  19730 MiB |  12782 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19616 MiB |  12668 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  19730 MiB |  12782 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19616 MiB |  12668 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  19502 MiB |  12554 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  19388 MiB |  12440 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  20936 MiB |  13986 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20932 MiB |  13984 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1637 MiB |   1636 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1520 MiB |   1520 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    117 MiB |    116 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     950    |     770    |
|       from large pool |     126    |     128    |     658    |     532    |
|       from small pool |      54    |      56    |     292    |     238    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     950    |     770    |
|       from large pool |     126    |     128    |     658    |     532    |
|       from small pool |      54    |      56    |     292    |     238    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     584    |     457    |
|       from large pool |     126    |     128    |     582    |     456    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      78    |      77    |
|       from large pool |       0    |       1    |      76    |      76    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:22:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  18686 MiB |  12782 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18572 MiB |  12668 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  18686 MiB |  12782 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18572 MiB |  12668 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  18458 MiB |  12554 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  18344 MiB |  12440 MiB |
|       from small pool |      0 MiB |      1 MiB |    114 MiB |    114 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  19892 MiB |  13986 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19888 MiB |  13984 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1637 MiB |   1636 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1520 MiB |   1520 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    117 MiB |    116 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     917    |     769    |
|       from large pool |     100    |     102    |     632    |     532    |
|       from small pool |      48    |      50    |     285    |     237    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     917    |     769    |
|       from large pool |     100    |     102    |     632    |     532    |
|       from small pool |      48    |      50    |     285    |     237    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     558    |     457    |
|       from large pool |     100    |     102    |     556    |     456    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      78    |      77    |
|       from large pool |       0    |       1    |      76    |      76    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:22:52 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:22:52 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:22:52 | I | in layer model.layers.0
25-01-14 01:22:52 | I | quantizing weights for layer model.layers.0
25-01-14 01:22:52 | I | collecting info in model.layers.0
25-01-14 01:22:53 | I | collecting info in model.layers.0
25-01-14 01:22:54 | I | collecting info in model.layers.0
25-01-14 01:22:55 | I | collecting info in model.layers.0
25-01-14 01:22:56 | I | collecting calibration activations in model.layers.0
25-01-14 01:22:58 | I | collecting calibration activations in model.layers.0
25-01-14 01:22:59 | I | collecting calibration activations in model.layers.0
25-01-14 01:23:00 | I | collecting calibration activations in model.layers.0
25-01-14 01:23:01 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:23:01 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:23:05 | I |       - range scale = [    1.0000]
25-01-14 01:23:05 | I |         sum  error  = [    0.6568]
25-01-14 01:23:05 | I |         best error  = [    0.6568]
25-01-14 01:23:05 | I |     + error = [0.6568]
25-01-14 01:23:10 | I |       - range scale = [    1.0000]
25-01-14 01:23:10 | I |         sum  error  = [    1.5279]
25-01-14 01:23:10 | I |         best error  = [    1.5279]
25-01-14 01:23:10 | I |     + error = [1.5279]
25-01-14 01:23:10 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:23:14 | I |       - range scale = [    1.0000]
25-01-14 01:23:14 | I |         sum  error  = [    2.2254]
25-01-14 01:23:14 | I |         best error  = [    2.2254]
25-01-14 01:23:14 | I |     + error = [2.2254]
25-01-14 01:23:18 | I |       - range scale = [    1.0000]
25-01-14 01:23:18 | I |         sum  error  = [    3.4915]
25-01-14 01:23:18 | I |         best error  = [    3.4915]
25-01-14 01:23:18 | I |     + error = [3.4915]
25-01-14 01:23:18 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:23:19 | I |       - range scale = [    1.0000]
25-01-14 01:23:19 | I |         sum  error  = [    0.2668]
25-01-14 01:23:19 | I |         best error  = [    0.2668]
25-01-14 01:23:19 | I |     + error = [0.2668]
25-01-14 01:23:20 | I |       - range scale = [    1.0000]
25-01-14 01:23:20 | I |         sum  error  = [    0.3115]
25-01-14 01:23:20 | I |         best error  = [    0.3115]
25-01-14 01:23:20 | I |     + error = [0.3115]
25-01-14 01:23:20 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:23:21 | I |       - range scale = [    1.0000]
25-01-14 01:23:21 | I |         sum  error  = [    0.1794]
25-01-14 01:23:21 | I |         best error  = [    0.1794]
25-01-14 01:23:21 | I |     + error = [0.1794]
25-01-14 01:23:22 | I |       - range scale = [    1.0000]
25-01-14 01:23:22 | I |         sum  error  = [    0.2917]
25-01-14 01:23:22 | I |         best error  = [    0.2917]
25-01-14 01:23:22 | I |     + error = [0.2917]
25-01-14 01:23:22 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:23:23 | I |       - range scale = [    1.0000]
25-01-14 01:23:23 | I |         sum  error  = [    1.1664]
25-01-14 01:23:23 | I |         best error  = [    1.1664]
25-01-14 01:23:23 | I |     + error = [1.1664]
25-01-14 01:23:24 | I |       - range scale = [    1.0000]
25-01-14 01:23:24 | I |         sum  error  = [    1.3385]
25-01-14 01:23:24 | I |         best error  = [    1.3385]
25-01-14 01:23:24 | I |     + error = [1.3385]
25-01-14 01:23:24 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:23:25 | I |       - range scale = [    1.0000]
25-01-14 01:23:25 | I |         sum  error  = [    1.3061]
25-01-14 01:23:25 | I |         best error  = [    1.3061]
25-01-14 01:23:25 | I |     + error = [1.3061]
25-01-14 01:23:26 | I |       - range scale = [    1.0000]
25-01-14 01:23:26 | I |         sum  error  = [    1.5370]
25-01-14 01:23:26 | I |         best error  = [    1.5370]
25-01-14 01:23:26 | I |     + error = [1.5370]
25-01-14 01:23:26 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:23:27 | I |       - range scale = [    1.0000]
25-01-14 01:23:27 | I |         sum  error  = [    0.1985]
25-01-14 01:23:27 | I |         best error  = [    0.1985]
25-01-14 01:23:27 | I |     + error = [0.1985]
25-01-14 01:23:28 | I |       - range scale = [    1.0000]
25-01-14 01:23:28 | I |         sum  error  = [    0.2946]
25-01-14 01:23:28 | I |         best error  = [    0.2946]
25-01-14 01:23:28 | I |     + error = [0.2946]
25-01-14 01:23:28 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:23:31 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:23:33 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:23:35 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:23:38 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:23:40 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:23:43 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:23:49 | I | quantizing activations for layer model.layers.0
25-01-14 01:23:49 | I | collecting info in model.layers.0
25-01-14 01:23:50 | I | collecting info in model.layers.0
25-01-14 01:23:51 | I | collecting info in model.layers.0
25-01-14 01:23:52 | I | collecting info in model.layers.0
25-01-14 01:23:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:23:55 | I | collecting calibration activations in model.layers.0
25-01-14 01:23:56 | I | collecting calibration activations in model.layers.0
25-01-14 01:23:57 | I | collecting calibration activations in model.layers.0
25-01-14 01:24:00 | I | forward this layer
25-01-14 01:24:00 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/74.pt
25-01-14 01:24:00 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/74.pt
25-01-14 01:24:00 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:24:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 38           |        cudaMalloc retries: 41        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  80409 GiB |  80387 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  79830 GiB |  79808 GiB |
|       from small pool |      3 MiB |      5 MiB |    578 GiB |    578 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  80409 GiB |  80387 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  79830 GiB |  79808 GiB |
|       from small pool |      3 MiB |      5 MiB |    578 GiB |    578 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  80334 GiB |  80311 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  79757 GiB |  79735 GiB |
|       from small pool |      3 MiB |      5 MiB |    576 GiB |    576 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2683 GiB |   2660 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2681 GiB |   2658 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  41665 GiB |  41664 GiB |
|       from large pool |    943 MiB |   1689 MiB |  40988 GiB |  40988 GiB |
|       from small pool |      0 MiB |      4 MiB |    676 GiB |    676 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   12204 K  |   12203 K  |
|       from large pool |     186    |     223    |    1815 K  |    1814 K  |
|       from small pool |     109    |     111    |   10389 K  |   10389 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   12204 K  |   12203 K  |
|       from large pool |     186    |     223    |    1815 K  |    1814 K  |
|       from small pool |     109    |     111    |   10389 K  |   10389 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6514    |    6338    |
|       from large pool |     174    |     174    |    5170    |    4996    |
|       from small pool |       2    |       4    |    1344    |    1342    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    4983 K  |    4983 K  |
|       from large pool |      20    |      24    |     586 K  |     586 K  |
|       from small pool |       8    |      16    |    4397 K  |    4397 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:24:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  20066 MiB |  13118 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19949 MiB |  13001 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  20066 MiB |  13118 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19949 MiB |  13001 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  19832 MiB |  12884 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  19715 MiB |  12767 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  21304 MiB |  14354 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21300 MiB |  14352 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1680 MiB |   1679 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1560 MiB |   1560 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    120 MiB |    119 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     970    |     790    |
|       from large pool |     126    |     128    |     672    |     546    |
|       from small pool |      54    |      56    |     298    |     244    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     970    |     790    |
|       from large pool |     126    |     128    |     672    |     546    |
|       from small pool |      54    |      56    |     298    |     244    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     596    |     469    |
|       from large pool |     126    |     128    |     594    |     468    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      80    |      79    |
|       from large pool |       0    |       1    |      78    |      78    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:24:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  20066 MiB |  13118 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19949 MiB |  13001 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  20066 MiB |  13118 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  19949 MiB |  13001 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  19832 MiB |  12884 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  19715 MiB |  12767 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  21304 MiB |  14354 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21300 MiB |  14352 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1680 MiB |   1679 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1560 MiB |   1560 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    120 MiB |    119 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     970    |     790    |
|       from large pool |     126    |     128    |     672    |     546    |
|       from small pool |      54    |      56    |     298    |     244    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     970    |     790    |
|       from large pool |     126    |     128    |     672    |     546    |
|       from small pool |      54    |      56    |     298    |     244    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     596    |     469    |
|       from large pool |     126    |     128    |     594    |     468    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      80    |      79    |
|       from large pool |       0    |       1    |      78    |      78    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:24:00 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  19023 MiB |  13118 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18905 MiB |  13001 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  19023 MiB |  13118 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  18905 MiB |  13001 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  18789 MiB |  12884 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  18671 MiB |  12767 MiB |
|       from small pool |      0 MiB |      1 MiB |    117 MiB |    117 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  20260 MiB |  14354 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20256 MiB |  14352 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1680 MiB |   1679 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1560 MiB |   1560 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    120 MiB |    119 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     937    |     789    |
|       from large pool |     100    |     102    |     646    |     546    |
|       from small pool |      48    |      50    |     291    |     243    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     937    |     789    |
|       from large pool |     100    |     102    |     646    |     546    |
|       from small pool |      48    |      50    |     291    |     243    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     570    |     469    |
|       from large pool |     100    |     102    |     568    |     468    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      80    |      79    |
|       from large pool |       0    |       1    |      78    |      78    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:24:00 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:24:01 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:24:01 | I | in layer model.layers.0
25-01-14 01:24:01 | I | quantizing weights for layer model.layers.0
25-01-14 01:24:01 | I | collecting info in model.layers.0
25-01-14 01:24:01 | I | collecting info in model.layers.0
25-01-14 01:24:02 | I | collecting info in model.layers.0
25-01-14 01:24:03 | I | collecting info in model.layers.0
25-01-14 01:24:05 | I | collecting calibration activations in model.layers.0
25-01-14 01:24:06 | I | collecting calibration activations in model.layers.0
25-01-14 01:24:07 | I | collecting calibration activations in model.layers.0
25-01-14 01:24:08 | I | collecting calibration activations in model.layers.0
25-01-14 01:24:10 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:24:10 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:24:14 | I |       - range scale = [    1.0000]
25-01-14 01:24:14 | I |         sum  error  = [    0.6522]
25-01-14 01:24:14 | I |         best error  = [    0.6522]
25-01-14 01:24:14 | I |     + error = [0.6522]
25-01-14 01:24:18 | I |       - range scale = [    1.0000]
25-01-14 01:24:18 | I |         sum  error  = [    1.5331]
25-01-14 01:24:18 | I |         best error  = [    1.5331]
25-01-14 01:24:18 | I |     + error = [1.5331]
25-01-14 01:24:19 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:24:23 | I |       - range scale = [    1.0000]
25-01-14 01:24:23 | I |         sum  error  = [    2.3437]
25-01-14 01:24:23 | I |         best error  = [    2.3437]
25-01-14 01:24:23 | I |     + error = [2.3437]
25-01-14 01:24:27 | I |       - range scale = [    1.0000]
25-01-14 01:24:27 | I |         sum  error  = [    3.6599]
25-01-14 01:24:27 | I |         best error  = [    3.6599]
25-01-14 01:24:27 | I |     + error = [3.6599]
25-01-14 01:24:27 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:24:28 | I |       - range scale = [    1.0000]
25-01-14 01:24:28 | I |         sum  error  = [    0.2646]
25-01-14 01:24:28 | I |         best error  = [    0.2646]
25-01-14 01:24:28 | I |     + error = [0.2646]
25-01-14 01:24:29 | I |       - range scale = [    1.0000]
25-01-14 01:24:29 | I |         sum  error  = [    0.3073]
25-01-14 01:24:29 | I |         best error  = [    0.3073]
25-01-14 01:24:29 | I |     + error = [0.3073]
25-01-14 01:24:29 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:24:30 | I |       - range scale = [    1.0000]
25-01-14 01:24:30 | I |         sum  error  = [    0.1744]
25-01-14 01:24:30 | I |         best error  = [    0.1744]
25-01-14 01:24:30 | I |     + error = [0.1744]
25-01-14 01:24:31 | I |       - range scale = [    1.0000]
25-01-14 01:24:31 | I |         sum  error  = [    0.2870]
25-01-14 01:24:31 | I |         best error  = [    0.2870]
25-01-14 01:24:31 | I |     + error = [0.2870]
25-01-14 01:24:31 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:24:32 | I |       - range scale = [    1.0000]
25-01-14 01:24:32 | I |         sum  error  = [    1.0956]
25-01-14 01:24:32 | I |         best error  = [    1.0956]
25-01-14 01:24:32 | I |     + error = [1.0956]
25-01-14 01:24:33 | I |       - range scale = [    1.0000]
25-01-14 01:24:33 | I |         sum  error  = [    1.2704]
25-01-14 01:24:33 | I |         best error  = [    1.2704]
25-01-14 01:24:33 | I |     + error = [1.2704]
25-01-14 01:24:33 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:24:34 | I |       - range scale = [    1.0000]
25-01-14 01:24:34 | I |         sum  error  = [    1.2415]
25-01-14 01:24:34 | I |         best error  = [    1.2415]
25-01-14 01:24:34 | I |     + error = [1.2415]
25-01-14 01:24:35 | I |       - range scale = [    1.0000]
25-01-14 01:24:35 | I |         sum  error  = [    1.4622]
25-01-14 01:24:35 | I |         best error  = [    1.4622]
25-01-14 01:24:35 | I |     + error = [1.4622]
25-01-14 01:24:35 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:24:36 | I |       - range scale = [    1.0000]
25-01-14 01:24:36 | I |         sum  error  = [    0.1759]
25-01-14 01:24:36 | I |         best error  = [    0.1759]
25-01-14 01:24:36 | I |     + error = [0.1759]
25-01-14 01:24:37 | I |       - range scale = [    1.0000]
25-01-14 01:24:37 | I |         sum  error  = [    0.2759]
25-01-14 01:24:37 | I |         best error  = [    0.2759]
25-01-14 01:24:37 | I |     + error = [0.2759]
25-01-14 01:24:37 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:24:40 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:24:42 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:24:44 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:24:47 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:24:49 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:24:52 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:24:58 | I | quantizing activations for layer model.layers.0
25-01-14 01:24:58 | I | collecting info in model.layers.0
25-01-14 01:24:59 | I | collecting info in model.layers.0
25-01-14 01:25:00 | I | collecting info in model.layers.0
25-01-14 01:25:01 | I | collecting info in model.layers.0
25-01-14 01:25:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:04 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:05 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:06 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:09 | I | forward this layer
25-01-14 01:25:09 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/76.pt
25-01-14 01:25:09 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/76.pt
25-01-14 01:25:09 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:25:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 39           |        cudaMalloc retries: 42        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  84174 GiB |  84152 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  83574 GiB |  83552 GiB |
|       from small pool |      3 MiB |      5 MiB |    599 GiB |    599 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  84174 GiB |  84152 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  83574 GiB |  83552 GiB |
|       from small pool |      3 MiB |      5 MiB |    599 GiB |    599 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  84098 GiB |  84075 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  83500 GiB |  83478 GiB |
|       from small pool |      3 MiB |      5 MiB |    597 GiB |    597 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2751 GiB |   2728 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2748 GiB |   2725 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  43753 GiB |  43752 GiB |
|       from large pool |    943 MiB |   1689 MiB |  43052 GiB |  43051 GiB |
|       from small pool |      0 MiB |      4 MiB |    700 GiB |    700 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   12661 K  |   12660 K  |
|       from large pool |     186    |     223    |    1887 K  |    1886 K  |
|       from small pool |     109    |     111    |   10773 K  |   10773 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   12661 K  |   12660 K  |
|       from large pool |     186    |     223    |    1887 K  |    1886 K  |
|       from small pool |     109    |     111    |   10773 K  |   10773 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6672    |    6496    |
|       from large pool |     174    |     174    |    5293    |    5119    |
|       from small pool |       2    |       4    |    1379    |    1377    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    5159 K  |    5159 K  |
|       from large pool |      21    |      24    |     607 K  |     607 K  |
|       from small pool |       8    |      16    |    4552 K  |    4552 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:25:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  20403 MiB |  13455 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20283 MiB |  13335 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  20403 MiB |  13455 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20283 MiB |  13335 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  20163 MiB |  13215 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  20043 MiB |  13095 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  21672 MiB |  14722 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21668 MiB |  14720 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1723 MiB |   1722 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1600 MiB |   1600 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    123 MiB |    122 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     990    |     810    |
|       from large pool |     126    |     128    |     686    |     560    |
|       from small pool |      54    |      56    |     304    |     250    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     990    |     810    |
|       from large pool |     126    |     128    |     686    |     560    |
|       from small pool |      54    |      56    |     304    |     250    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     608    |     481    |
|       from large pool |     126    |     128    |     606    |     480    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      82    |      81    |
|       from large pool |       0    |       1    |      80    |      80    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:25:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  20403 MiB |  13455 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20283 MiB |  13335 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  20403 MiB |  13455 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20283 MiB |  13335 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  20163 MiB |  13215 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  20043 MiB |  13095 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  21672 MiB |  14722 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21668 MiB |  14720 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1723 MiB |   1722 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1600 MiB |   1600 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    123 MiB |    122 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |     990    |     810    |
|       from large pool |     126    |     128    |     686    |     560    |
|       from small pool |      54    |      56    |     304    |     250    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |     990    |     810    |
|       from large pool |     126    |     128    |     686    |     560    |
|       from small pool |      54    |      56    |     304    |     250    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     608    |     481    |
|       from large pool |     126    |     128    |     606    |     480    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      82    |      81    |
|       from large pool |       0    |       1    |      80    |      80    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:25:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  19359 MiB |  13455 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19239 MiB |  13335 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  19359 MiB |  13455 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19239 MiB |  13335 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  19119 MiB |  13215 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  18999 MiB |  13095 MiB |
|       from small pool |      0 MiB |      1 MiB |    120 MiB |    120 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  20628 MiB |  14722 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20624 MiB |  14720 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1723 MiB |   1722 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1600 MiB |   1600 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    123 MiB |    122 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     957    |     809    |
|       from large pool |     100    |     102    |     660    |     560    |
|       from small pool |      48    |      50    |     297    |     249    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     957    |     809    |
|       from large pool |     100    |     102    |     660    |     560    |
|       from small pool |      48    |      50    |     297    |     249    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     582    |     481    |
|       from large pool |     100    |     102    |     580    |     480    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      82    |      81    |
|       from large pool |       0    |       1    |      80    |      80    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:25:09 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:25:10 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:25:10 | I | in layer model.layers.0
25-01-14 01:25:10 | I | quantizing weights for layer model.layers.0
25-01-14 01:25:10 | I | collecting info in model.layers.0
25-01-14 01:25:11 | I | collecting info in model.layers.0
25-01-14 01:25:12 | I | collecting info in model.layers.0
25-01-14 01:25:13 | I | collecting info in model.layers.0
25-01-14 01:25:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:18 | I | collecting calibration activations in model.layers.0
25-01-14 01:25:19 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:25:19 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:25:23 | I |       - range scale = [    1.0000]
25-01-14 01:25:23 | I |         sum  error  = [    0.6634]
25-01-14 01:25:23 | I |         best error  = [    0.6634]
25-01-14 01:25:23 | I |     + error = [0.6634]
25-01-14 01:25:28 | I |       - range scale = [    1.0000]
25-01-14 01:25:28 | I |         sum  error  = [    1.5587]
25-01-14 01:25:28 | I |         best error  = [    1.5587]
25-01-14 01:25:28 | I |     + error = [1.5587]
25-01-14 01:25:28 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:25:32 | I |       - range scale = [    1.0000]
25-01-14 01:25:32 | I |         sum  error  = [    2.3257]
25-01-14 01:25:32 | I |         best error  = [    2.3257]
25-01-14 01:25:32 | I |     + error = [2.3257]
25-01-14 01:25:37 | I |       - range scale = [    1.0000]
25-01-14 01:25:37 | I |         sum  error  = [    3.4248]
25-01-14 01:25:37 | I |         best error  = [    3.4248]
25-01-14 01:25:37 | I |     + error = [3.4248]
25-01-14 01:25:37 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:25:38 | I |       - range scale = [    1.0000]
25-01-14 01:25:38 | I |         sum  error  = [    0.2884]
25-01-14 01:25:38 | I |         best error  = [    0.2884]
25-01-14 01:25:38 | I |     + error = [0.2884]
25-01-14 01:25:39 | I |       - range scale = [    1.0000]
25-01-14 01:25:39 | I |         sum  error  = [    0.3290]
25-01-14 01:25:39 | I |         best error  = [    0.3290]
25-01-14 01:25:39 | I |     + error = [0.3290]
25-01-14 01:25:39 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:25:40 | I |       - range scale = [    1.0000]
25-01-14 01:25:40 | I |         sum  error  = [    0.2168]
25-01-14 01:25:40 | I |         best error  = [    0.2168]
25-01-14 01:25:40 | I |     + error = [0.2168]
25-01-14 01:25:40 | I |       - range scale = [    1.0000]
25-01-14 01:25:40 | I |         sum  error  = [    0.3639]
25-01-14 01:25:40 | I |         best error  = [    0.3639]
25-01-14 01:25:40 | I |     + error = [0.3639]
25-01-14 01:25:41 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:25:41 | I |       - range scale = [    1.0000]
25-01-14 01:25:41 | I |         sum  error  = [    1.2482]
25-01-14 01:25:41 | I |         best error  = [    1.2482]
25-01-14 01:25:41 | I |     + error = [1.2482]
25-01-14 01:25:42 | I |       - range scale = [    1.0000]
25-01-14 01:25:42 | I |         sum  error  = [    1.4170]
25-01-14 01:25:42 | I |         best error  = [    1.4170]
25-01-14 01:25:42 | I |     + error = [1.4170]
25-01-14 01:25:43 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:25:43 | I |       - range scale = [    1.0000]
25-01-14 01:25:43 | I |         sum  error  = [    1.4096]
25-01-14 01:25:43 | I |         best error  = [    1.4096]
25-01-14 01:25:43 | I |     + error = [1.4096]
25-01-14 01:25:44 | I |       - range scale = [    1.0000]
25-01-14 01:25:44 | I |         sum  error  = [    1.6380]
25-01-14 01:25:44 | I |         best error  = [    1.6380]
25-01-14 01:25:44 | I |     + error = [1.6380]
25-01-14 01:25:45 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:25:45 | I |       - range scale = [    1.0000]
25-01-14 01:25:45 | I |         sum  error  = [    0.2181]
25-01-14 01:25:45 | I |         best error  = [    0.2181]
25-01-14 01:25:45 | I |     + error = [0.2181]
25-01-14 01:25:47 | I |       - range scale = [    1.0000]
25-01-14 01:25:47 | I |         sum  error  = [    0.3306]
25-01-14 01:25:47 | I |         best error  = [    0.3306]
25-01-14 01:25:47 | I |     + error = [0.3306]
25-01-14 01:25:47 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:25:49 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:25:52 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:25:54 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:25:56 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:25:59 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:26:01 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:26:08 | I | quantizing activations for layer model.layers.0
25-01-14 01:26:08 | I | collecting info in model.layers.0
25-01-14 01:26:09 | I | collecting info in model.layers.0
25-01-14 01:26:10 | I | collecting info in model.layers.0
25-01-14 01:26:11 | I | collecting info in model.layers.0
25-01-14 01:26:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:19 | I | forward this layer
25-01-14 01:26:19 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/78.pt
25-01-14 01:26:19 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/78.pt
25-01-14 01:26:19 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:26:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 40           |        cudaMalloc retries: 43        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  88025 GiB |  88003 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  87404 GiB |  87382 GiB |
|       from small pool |      3 MiB |      5 MiB |    621 GiB |    621 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  88025 GiB |  88003 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  87404 GiB |  87382 GiB |
|       from small pool |      3 MiB |      5 MiB |    621 GiB |    621 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  87947 GiB |  87925 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  87328 GiB |  87306 GiB |
|       from small pool |      3 MiB |      5 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2820 GiB |   2797 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2817 GiB |   2794 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  45865 GiB |  45864 GiB |
|       from large pool |    943 MiB |   1689 MiB |  45139 GiB |  45138 GiB |
|       from small pool |      0 MiB |      4 MiB |    726 GiB |    726 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   13124 K  |   13124 K  |
|       from large pool |     186    |     223    |    1960 K  |    1960 K  |
|       from small pool |     109    |     111    |   11164 K  |   11164 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   13124 K  |   13124 K  |
|       from large pool |     186    |     223    |    1960 K  |    1960 K  |
|       from small pool |     109    |     111    |   11164 K  |   11164 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6836    |    6660    |
|       from large pool |     174    |     174    |    5422    |    5248    |
|       from small pool |       2    |       4    |    1414    |    1412    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    5336 K  |    5336 K  |
|       from large pool |      20    |      24    |     627 K  |     627 K  |
|       from small pool |       8    |      16    |    4708 K  |    4708 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:26:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  20739 MiB |  13791 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20616 MiB |  13668 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  20739 MiB |  13791 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20616 MiB |  13668 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  20493 MiB |  13545 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  20370 MiB |  13422 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  22040 MiB |  15090 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22036 MiB |  15088 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1766 MiB |   1765 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1640 MiB |   1640 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    126 MiB |    125 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1010    |     830    |
|       from large pool |     126    |     128    |     700    |     574    |
|       from small pool |      54    |      56    |     310    |     256    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1010    |     830    |
|       from large pool |     126    |     128    |     700    |     574    |
|       from small pool |      54    |      56    |     310    |     256    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     620    |     493    |
|       from large pool |     126    |     128    |     618    |     492    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      84    |      83    |
|       from large pool |       0    |       1    |      82    |      82    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:26:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  20739 MiB |  13791 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20616 MiB |  13668 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  20739 MiB |  13791 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20616 MiB |  13668 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  20493 MiB |  13545 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  20370 MiB |  13422 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  22040 MiB |  15090 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22036 MiB |  15088 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1766 MiB |   1765 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1640 MiB |   1640 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    126 MiB |    125 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1010    |     830    |
|       from large pool |     126    |     128    |     700    |     574    |
|       from small pool |      54    |      56    |     310    |     256    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1010    |     830    |
|       from large pool |     126    |     128    |     700    |     574    |
|       from small pool |      54    |      56    |     310    |     256    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     620    |     493    |
|       from large pool |     126    |     128    |     618    |     492    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      84    |      83    |
|       from large pool |       0    |       1    |      82    |      82    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:26:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  19695 MiB |  13791 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19572 MiB |  13668 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  19695 MiB |  13791 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19572 MiB |  13668 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  19449 MiB |  13545 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  19326 MiB |  13422 MiB |
|       from small pool |      0 MiB |      1 MiB |    123 MiB |    123 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  20996 MiB |  15090 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20992 MiB |  15088 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1766 MiB |   1765 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1640 MiB |   1640 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    126 MiB |    125 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     977    |     829    |
|       from large pool |     100    |     102    |     674    |     574    |
|       from small pool |      48    |      50    |     303    |     255    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     977    |     829    |
|       from large pool |     100    |     102    |     674    |     574    |
|       from small pool |      48    |      50    |     303    |     255    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     594    |     493    |
|       from large pool |     100    |     102    |     592    |     492    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      84    |      83    |
|       from large pool |       0    |       1    |      82    |      82    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:26:19 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:26:19 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:26:19 | I | in layer model.layers.0
25-01-14 01:26:19 | I | quantizing weights for layer model.layers.0
25-01-14 01:26:19 | I | collecting info in model.layers.0
25-01-14 01:26:20 | I | collecting info in model.layers.0
25-01-14 01:26:21 | I | collecting info in model.layers.0
25-01-14 01:26:22 | I | collecting info in model.layers.0
25-01-14 01:26:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:26:29 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:26:29 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:26:33 | I |       - range scale = [    1.0000]
25-01-14 01:26:33 | I |         sum  error  = [    0.6282]
25-01-14 01:26:33 | I |         best error  = [    0.6282]
25-01-14 01:26:33 | I |     + error = [0.6282]
25-01-14 01:26:38 | I |       - range scale = [    1.0000]
25-01-14 01:26:38 | I |         sum  error  = [    1.5389]
25-01-14 01:26:38 | I |         best error  = [    1.5389]
25-01-14 01:26:38 | I |     + error = [1.5389]
25-01-14 01:26:38 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:26:42 | I |       - range scale = [    1.0000]
25-01-14 01:26:42 | I |         sum  error  = [    2.4577]
25-01-14 01:26:42 | I |         best error  = [    2.4577]
25-01-14 01:26:42 | I |     + error = [2.4577]
25-01-14 01:26:47 | I |       - range scale = [    1.0000]
25-01-14 01:26:47 | I |         sum  error  = [    3.4911]
25-01-14 01:26:47 | I |         best error  = [    3.4911]
25-01-14 01:26:47 | I |     + error = [3.4911]
25-01-14 01:26:47 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:26:48 | I |       - range scale = [    1.0000]
25-01-14 01:26:48 | I |         sum  error  = [    0.2584]
25-01-14 01:26:48 | I |         best error  = [    0.2584]
25-01-14 01:26:48 | I |     + error = [0.2584]
25-01-14 01:26:49 | I |       - range scale = [    1.0000]
25-01-14 01:26:49 | I |         sum  error  = [    0.2980]
25-01-14 01:26:49 | I |         best error  = [    0.2980]
25-01-14 01:26:49 | I |     + error = [0.2980]
25-01-14 01:26:49 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:26:50 | I |       - range scale = [    1.0000]
25-01-14 01:26:50 | I |         sum  error  = [    0.1784]
25-01-14 01:26:50 | I |         best error  = [    0.1784]
25-01-14 01:26:50 | I |     + error = [0.1784]
25-01-14 01:26:51 | I |       - range scale = [    1.0000]
25-01-14 01:26:51 | I |         sum  error  = [    0.2838]
25-01-14 01:26:51 | I |         best error  = [    0.2838]
25-01-14 01:26:51 | I |     + error = [0.2838]
25-01-14 01:26:51 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:26:52 | I |       - range scale = [    1.0000]
25-01-14 01:26:52 | I |         sum  error  = [    1.1144]
25-01-14 01:26:52 | I |         best error  = [    1.1144]
25-01-14 01:26:52 | I |     + error = [1.1144]
25-01-14 01:26:53 | I |       - range scale = [    1.0000]
25-01-14 01:26:53 | I |         sum  error  = [    1.3203]
25-01-14 01:26:53 | I |         best error  = [    1.3203]
25-01-14 01:26:53 | I |     + error = [1.3203]
25-01-14 01:26:53 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:26:54 | I |       - range scale = [    1.0000]
25-01-14 01:26:54 | I |         sum  error  = [    1.2476]
25-01-14 01:26:54 | I |         best error  = [    1.2476]
25-01-14 01:26:54 | I |     + error = [1.2476]
25-01-14 01:26:55 | I |       - range scale = [    1.0000]
25-01-14 01:26:55 | I |         sum  error  = [    1.5382]
25-01-14 01:26:55 | I |         best error  = [    1.5382]
25-01-14 01:26:55 | I |     + error = [1.5382]
25-01-14 01:26:55 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:26:56 | I |       - range scale = [    1.0000]
25-01-14 01:26:56 | I |         sum  error  = [    0.1877]
25-01-14 01:26:56 | I |         best error  = [    0.1877]
25-01-14 01:26:56 | I |     + error = [0.1877]
25-01-14 01:26:57 | I |       - range scale = [    1.0000]
25-01-14 01:26:57 | I |         sum  error  = [    0.2911]
25-01-14 01:26:57 | I |         best error  = [    0.2911]
25-01-14 01:26:57 | I |     + error = [0.2911]
25-01-14 01:26:57 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:27:00 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:27:02 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:27:05 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:27:07 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:27:09 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:27:12 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:27:18 | I | quantizing activations for layer model.layers.0
25-01-14 01:27:18 | I | collecting info in model.layers.0
25-01-14 01:27:19 | I | collecting info in model.layers.0
25-01-14 01:27:20 | I | collecting info in model.layers.0
25-01-14 01:27:21 | I | collecting info in model.layers.0
25-01-14 01:27:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:29 | I | forward this layer
25-01-14 01:27:29 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/80.pt
25-01-14 01:27:29 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/80.pt
25-01-14 01:27:30 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:27:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 41           |        cudaMalloc retries: 44        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  91962 GiB |  91940 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  91319 GiB |  91297 GiB |
|       from small pool |      3 MiB |      5 MiB |    642 GiB |    642 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  91962 GiB |  91940 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  91319 GiB |  91297 GiB |
|       from small pool |      3 MiB |      5 MiB |    642 GiB |    642 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  91882 GiB |  91859 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  91241 GiB |  91219 GiB |
|       from small pool |      3 MiB |      5 MiB |    640 GiB |    640 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2888 GiB |   2865 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2885 GiB |   2862 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  48055 GiB |  48054 GiB |
|       from large pool |    943 MiB |   1689 MiB |  47303 GiB |  47302 GiB |
|       from small pool |      0 MiB |      4 MiB |    751 GiB |    751 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   13596 K  |   13595 K  |
|       from large pool |     186    |     223    |    2035 K  |    2034 K  |
|       from small pool |     109    |     111    |   11560 K  |   11560 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   13596 K  |   13595 K  |
|       from large pool |     186    |     223    |    2035 K  |    2034 K  |
|       from small pool |     109    |     111    |   11560 K  |   11560 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    6994    |    6818    |
|       from large pool |     174    |     174    |    5545    |    5371    |
|       from small pool |       2    |       4    |    1449    |    1447    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    5517 K  |    5517 K  |
|       from large pool |      21    |      24    |     649 K  |     649 K  |
|       from small pool |       8    |      16    |    4867 K  |    4867 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:27:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  21076 MiB |  14127 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20949 MiB |  14001 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  21076 MiB |  14127 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20949 MiB |  14001 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  20824 MiB |  13875 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  20697 MiB |  13749 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  22408 MiB |  15458 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22404 MiB |  15456 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1809 MiB |   1808 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1680 MiB |   1680 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    129 MiB |    128 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1030    |     850    |
|       from large pool |     126    |     128    |     714    |     588    |
|       from small pool |      54    |      56    |     316    |     262    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1030    |     850    |
|       from large pool |     126    |     128    |     714    |     588    |
|       from small pool |      54    |      56    |     316    |     262    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     632    |     505    |
|       from large pool |     126    |     128    |     630    |     504    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      86    |      85    |
|       from large pool |       0    |       1    |      84    |      84    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:27:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  21076 MiB |  14127 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20949 MiB |  14001 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  21076 MiB |  14127 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  20949 MiB |  14001 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  20824 MiB |  13875 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  20697 MiB |  13749 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  22408 MiB |  15458 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22404 MiB |  15456 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1809 MiB |   1808 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1680 MiB |   1680 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    129 MiB |    128 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1030    |     850    |
|       from large pool |     126    |     128    |     714    |     588    |
|       from small pool |      54    |      56    |     316    |     262    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1030    |     850    |
|       from large pool |     126    |     128    |     714    |     588    |
|       from small pool |      54    |      56    |     316    |     262    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     632    |     505    |
|       from large pool |     126    |     128    |     630    |     504    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      86    |      85    |
|       from large pool |       0    |       1    |      84    |      84    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:27:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  20032 MiB |  14127 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19905 MiB |  14001 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  20032 MiB |  14127 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  19905 MiB |  14001 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  19780 MiB |  13875 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  19653 MiB |  13749 MiB |
|       from small pool |      0 MiB |      1 MiB |    126 MiB |    126 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  21364 MiB |  15458 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21360 MiB |  15456 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1809 MiB |   1808 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1680 MiB |   1680 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    129 MiB |    128 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |     997    |     849    |
|       from large pool |     100    |     102    |     688    |     588    |
|       from small pool |      48    |      50    |     309    |     261    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |     997    |     849    |
|       from large pool |     100    |     102    |     688    |     588    |
|       from small pool |      48    |      50    |     309    |     261    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     606    |     505    |
|       from large pool |     100    |     102    |     604    |     504    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      86    |      85    |
|       from large pool |       0    |       1    |      84    |      84    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:27:30 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:27:30 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:27:30 | I | in layer model.layers.0
25-01-14 01:27:30 | I | quantizing weights for layer model.layers.0
25-01-14 01:27:30 | I | collecting info in model.layers.0
25-01-14 01:27:31 | I | collecting info in model.layers.0
25-01-14 01:27:32 | I | collecting info in model.layers.0
25-01-14 01:27:33 | I | collecting info in model.layers.0
25-01-14 01:27:35 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:37 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:38 | I | collecting calibration activations in model.layers.0
25-01-14 01:27:40 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:27:40 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:27:44 | I |       - range scale = [    1.0000]
25-01-14 01:27:44 | I |         sum  error  = [    0.6850]
25-01-14 01:27:44 | I |         best error  = [    0.6850]
25-01-14 01:27:44 | I |     + error = [0.6850]
25-01-14 01:27:49 | I |       - range scale = [    1.0000]
25-01-14 01:27:49 | I |         sum  error  = [    1.6314]
25-01-14 01:27:49 | I |         best error  = [    1.6314]
25-01-14 01:27:49 | I |     + error = [1.6314]
25-01-14 01:27:49 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:27:54 | I |       - range scale = [    1.0000]
25-01-14 01:27:54 | I |         sum  error  = [    2.4301]
25-01-14 01:27:54 | I |         best error  = [    2.4301]
25-01-14 01:27:54 | I |     + error = [2.4301]
25-01-14 01:27:58 | I |       - range scale = [    1.0000]
25-01-14 01:27:58 | I |         sum  error  = [    3.8800]
25-01-14 01:27:58 | I |         best error  = [    3.8800]
25-01-14 01:27:58 | I |     + error = [3.8800]
25-01-14 01:27:59 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:27:59 | I |       - range scale = [    1.0000]
25-01-14 01:27:59 | I |         sum  error  = [    0.2822]
25-01-14 01:27:59 | I |         best error  = [    0.2822]
25-01-14 01:27:59 | I |     + error = [0.2822]
25-01-14 01:28:00 | I |       - range scale = [    1.0000]
25-01-14 01:28:00 | I |         sum  error  = [    0.3248]
25-01-14 01:28:00 | I |         best error  = [    0.3248]
25-01-14 01:28:00 | I |     + error = [0.3248]
25-01-14 01:28:00 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:28:01 | I |       - range scale = [    1.0000]
25-01-14 01:28:01 | I |         sum  error  = [    0.1925]
25-01-14 01:28:01 | I |         best error  = [    0.1925]
25-01-14 01:28:01 | I |     + error = [0.1925]
25-01-14 01:28:02 | I |       - range scale = [    1.0000]
25-01-14 01:28:02 | I |         sum  error  = [    0.3171]
25-01-14 01:28:02 | I |         best error  = [    0.3171]
25-01-14 01:28:02 | I |     + error = [0.3171]
25-01-14 01:28:02 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:28:03 | I |       - range scale = [    1.0000]
25-01-14 01:28:03 | I |         sum  error  = [    1.2314]
25-01-14 01:28:03 | I |         best error  = [    1.2314]
25-01-14 01:28:03 | I |     + error = [1.2314]
25-01-14 01:28:04 | I |       - range scale = [    1.0000]
25-01-14 01:28:04 | I |         sum  error  = [    1.3969]
25-01-14 01:28:04 | I |         best error  = [    1.3969]
25-01-14 01:28:04 | I |     + error = [1.3969]
25-01-14 01:28:04 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:28:05 | I |       - range scale = [    1.0000]
25-01-14 01:28:05 | I |         sum  error  = [    1.3658]
25-01-14 01:28:05 | I |         best error  = [    1.3658]
25-01-14 01:28:05 | I |     + error = [1.3658]
25-01-14 01:28:06 | I |       - range scale = [    1.0000]
25-01-14 01:28:06 | I |         sum  error  = [    1.6424]
25-01-14 01:28:06 | I |         best error  = [    1.6424]
25-01-14 01:28:06 | I |     + error = [1.6424]
25-01-14 01:28:06 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:28:07 | I |       - range scale = [    1.0000]
25-01-14 01:28:07 | I |         sum  error  = [    0.2162]
25-01-14 01:28:07 | I |         best error  = [    0.2162]
25-01-14 01:28:07 | I |     + error = [0.2162]
25-01-14 01:28:08 | I |       - range scale = [    1.0000]
25-01-14 01:28:08 | I |         sum  error  = [    0.3517]
25-01-14 01:28:08 | I |         best error  = [    0.3517]
25-01-14 01:28:08 | I |     + error = [0.3517]
25-01-14 01:28:08 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:28:11 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:28:13 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:28:16 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:28:18 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:28:21 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:28:23 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:28:30 | I | quantizing activations for layer model.layers.0
25-01-14 01:28:30 | I | collecting info in model.layers.0
25-01-14 01:28:31 | I | collecting info in model.layers.0
25-01-14 01:28:32 | I | collecting info in model.layers.0
25-01-14 01:28:33 | I | collecting info in model.layers.0
25-01-14 01:28:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:35 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:37 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:38 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:41 | I | forward this layer
25-01-14 01:28:41 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/82.pt
25-01-14 01:28:41 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/82.pt
25-01-14 01:28:41 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:28:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 42           |        cudaMalloc retries: 45        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB |  95984 GiB |  95962 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  95319 GiB |  95297 GiB |
|       from small pool |      3 MiB |      5 MiB |    664 GiB |    664 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB |  95984 GiB |  95962 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  95319 GiB |  95297 GiB |
|       from small pool |      3 MiB |      5 MiB |    664 GiB |    664 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB |  95902 GiB |  95880 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  95239 GiB |  95217 GiB |
|       from small pool |      3 MiB |      5 MiB |    662 GiB |    662 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   2957 GiB |   2934 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   2954 GiB |   2931 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  50267 GiB |  50266 GiB |
|       from large pool |    943 MiB |   1689 MiB |  49489 GiB |  49488 GiB |
|       from small pool |      0 MiB |      4 MiB |    777 GiB |    777 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   14074 K  |   14074 K  |
|       from large pool |     186    |     223    |    2111 K  |    2110 K  |
|       from small pool |     109    |     111    |   11963 K  |   11963 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   14074 K  |   14074 K  |
|       from large pool |     186    |     223    |    2111 K  |    2110 K  |
|       from small pool |     109    |     111    |   11963 K  |   11963 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    7158    |    6982    |
|       from large pool |     174    |     174    |    5674    |    5500    |
|       from small pool |       2    |       4    |    1484    |    1482    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    5699 K  |    5699 K  |
|       from large pool |      20    |      24    |     671 K  |     671 K  |
|       from small pool |       8    |      16    |    5028 K  |    5028 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:28:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  21412 MiB |  14464 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21283 MiB |  14335 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  21412 MiB |  14464 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21283 MiB |  14335 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  21154 MiB |  14206 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  21025 MiB |  14077 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  22776 MiB |  15826 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22772 MiB |  15824 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1852 MiB |   1851 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1720 MiB |   1720 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    132 MiB |    131 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1050    |     870    |
|       from large pool |     126    |     128    |     728    |     602    |
|       from small pool |      54    |      56    |     322    |     268    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1050    |     870    |
|       from large pool |     126    |     128    |     728    |     602    |
|       from small pool |      54    |      56    |     322    |     268    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     644    |     517    |
|       from large pool |     126    |     128    |     642    |     516    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      88    |      87    |
|       from large pool |       0    |       1    |      86    |      86    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:28:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  21412 MiB |  14464 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21283 MiB |  14335 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  21412 MiB |  14464 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21283 MiB |  14335 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  21154 MiB |  14206 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  21025 MiB |  14077 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  22776 MiB |  15826 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22772 MiB |  15824 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1852 MiB |   1851 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1720 MiB |   1720 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    132 MiB |    131 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1050    |     870    |
|       from large pool |     126    |     128    |     728    |     602    |
|       from small pool |      54    |      56    |     322    |     268    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1050    |     870    |
|       from large pool |     126    |     128    |     728    |     602    |
|       from small pool |      54    |      56    |     322    |     268    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     644    |     517    |
|       from large pool |     126    |     128    |     642    |     516    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      88    |      87    |
|       from large pool |       0    |       1    |      86    |      86    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:28:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  20368 MiB |  14464 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20239 MiB |  14335 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  20368 MiB |  14464 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20239 MiB |  14335 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  20110 MiB |  14206 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  19981 MiB |  14077 MiB |
|       from small pool |      0 MiB |      1 MiB |    129 MiB |    129 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  21732 MiB |  15826 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21728 MiB |  15824 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1852 MiB |   1851 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1720 MiB |   1720 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    132 MiB |    131 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1017    |     869    |
|       from large pool |     100    |     102    |     702    |     602    |
|       from small pool |      48    |      50    |     315    |     267    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1017    |     869    |
|       from large pool |     100    |     102    |     702    |     602    |
|       from small pool |      48    |      50    |     315    |     267    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     618    |     517    |
|       from large pool |     100    |     102    |     616    |     516    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      88    |      87    |
|       from large pool |       0    |       1    |      86    |      86    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:28:41 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:28:42 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:28:42 | I | in layer model.layers.0
25-01-14 01:28:42 | I | quantizing weights for layer model.layers.0
25-01-14 01:28:42 | I | collecting info in model.layers.0
25-01-14 01:28:43 | I | collecting info in model.layers.0
25-01-14 01:28:44 | I | collecting info in model.layers.0
25-01-14 01:28:45 | I | collecting info in model.layers.0
25-01-14 01:28:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:50 | I | collecting calibration activations in model.layers.0
25-01-14 01:28:52 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:28:52 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:28:56 | I |       - range scale = [    1.0000]
25-01-14 01:28:56 | I |         sum  error  = [    0.6728]
25-01-14 01:28:56 | I |         best error  = [    0.6728]
25-01-14 01:28:56 | I |     + error = [0.6728]
25-01-14 01:29:01 | I |       - range scale = [    1.0000]
25-01-14 01:29:01 | I |         sum  error  = [    1.6488]
25-01-14 01:29:01 | I |         best error  = [    1.6488]
25-01-14 01:29:01 | I |     + error = [1.6488]
25-01-14 01:29:01 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:29:06 | I |       - range scale = [    1.0000]
25-01-14 01:29:06 | I |         sum  error  = [    2.5798]
25-01-14 01:29:06 | I |         best error  = [    2.5798]
25-01-14 01:29:06 | I |     + error = [2.5798]
25-01-14 01:29:11 | I |       - range scale = [    1.0000]
25-01-14 01:29:11 | I |         sum  error  = [    3.8932]
25-01-14 01:29:11 | I |         best error  = [    3.8932]
25-01-14 01:29:11 | I |     + error = [3.8932]
25-01-14 01:29:11 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:29:12 | I |       - range scale = [    1.0000]
25-01-14 01:29:12 | I |         sum  error  = [    0.2668]
25-01-14 01:29:12 | I |         best error  = [    0.2668]
25-01-14 01:29:12 | I |     + error = [0.2668]
25-01-14 01:29:12 | I |       - range scale = [    1.0000]
25-01-14 01:29:12 | I |         sum  error  = [    0.3164]
25-01-14 01:29:12 | I |         best error  = [    0.3164]
25-01-14 01:29:12 | I |     + error = [0.3164]
25-01-14 01:29:13 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:29:13 | I |       - range scale = [    1.0000]
25-01-14 01:29:13 | I |         sum  error  = [    0.1805]
25-01-14 01:29:13 | I |         best error  = [    0.1805]
25-01-14 01:29:13 | I |     + error = [0.1805]
25-01-14 01:29:14 | I |       - range scale = [    1.0000]
25-01-14 01:29:14 | I |         sum  error  = [    0.3039]
25-01-14 01:29:14 | I |         best error  = [    0.3039]
25-01-14 01:29:14 | I |     + error = [0.3039]
25-01-14 01:29:14 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:29:15 | I |       - range scale = [    1.0000]
25-01-14 01:29:15 | I |         sum  error  = [    1.1920]
25-01-14 01:29:15 | I |         best error  = [    1.1920]
25-01-14 01:29:15 | I |     + error = [1.1920]
25-01-14 01:29:16 | I |       - range scale = [    1.0000]
25-01-14 01:29:16 | I |         sum  error  = [    1.3423]
25-01-14 01:29:16 | I |         best error  = [    1.3423]
25-01-14 01:29:16 | I |     + error = [1.3423]
25-01-14 01:29:16 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:29:17 | I |       - range scale = [    1.0000]
25-01-14 01:29:17 | I |         sum  error  = [    1.3269]
25-01-14 01:29:17 | I |         best error  = [    1.3269]
25-01-14 01:29:17 | I |     + error = [1.3269]
25-01-14 01:29:18 | I |       - range scale = [    1.0000]
25-01-14 01:29:18 | I |         sum  error  = [    1.5960]
25-01-14 01:29:18 | I |         best error  = [    1.5960]
25-01-14 01:29:18 | I |     + error = [1.5960]
25-01-14 01:29:18 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:29:19 | I |       - range scale = [    1.0000]
25-01-14 01:29:19 | I |         sum  error  = [    0.1988]
25-01-14 01:29:19 | I |         best error  = [    0.1988]
25-01-14 01:29:19 | I |     + error = [0.1988]
25-01-14 01:29:20 | I |       - range scale = [    1.0000]
25-01-14 01:29:20 | I |         sum  error  = [    0.3027]
25-01-14 01:29:20 | I |         best error  = [    0.3027]
25-01-14 01:29:20 | I |     + error = [0.3027]
25-01-14 01:29:20 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:29:23 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:29:25 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:29:28 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:29:30 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:29:33 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:29:35 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:29:42 | I | quantizing activations for layer model.layers.0
25-01-14 01:29:42 | I | collecting info in model.layers.0
25-01-14 01:29:43 | I | collecting info in model.layers.0
25-01-14 01:29:44 | I | collecting info in model.layers.0
25-01-14 01:29:45 | I | collecting info in model.layers.0
25-01-14 01:29:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:29:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:29:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:29:50 | I | collecting calibration activations in model.layers.0
25-01-14 01:29:53 | I | forward this layer
25-01-14 01:29:53 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/84.pt
25-01-14 01:29:53 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/84.pt
25-01-14 01:29:53 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:29:53 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 43           |        cudaMalloc retries: 46        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 100091 GiB | 100069 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  99404 GiB |  99382 GiB |
|       from small pool |      3 MiB |      5 MiB |    686 GiB |    686 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 100091 GiB | 100069 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  99404 GiB |  99382 GiB |
|       from small pool |      3 MiB |      5 MiB |    686 GiB |    686 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 100007 GiB |  99985 GiB |
|       from large pool |  22696 MiB |  23230 MiB |  99323 GiB |  99301 GiB |
|       from small pool |      3 MiB |      5 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3025 GiB |   3001 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3022 GiB |   2998 GiB |
|       from small pool |      4 MiB |      8 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  52558 GiB |  52557 GiB |
|       from large pool |    943 MiB |   1689 MiB |  51755 GiB |  51754 GiB |
|       from small pool |      0 MiB |      4 MiB |    803 GiB |    803 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   14559 K  |   14559 K  |
|       from large pool |     186    |     223    |    2188 K  |    2188 K  |
|       from small pool |     109    |     111    |   12371 K  |   12371 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   14559 K  |   14559 K  |
|       from large pool |     186    |     223    |    2188 K  |    2188 K  |
|       from small pool |     109    |     111    |   12371 K  |   12371 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    7316    |    7140    |
|       from large pool |     174    |     174    |    5797    |    5623    |
|       from small pool |       2    |       4    |    1519    |    1517    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    5883 K  |    5883 K  |
|       from large pool |      21    |      24    |     692 K  |     692 K  |
|       from small pool |       8    |      16    |    5191 K  |    5191 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:29:53 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  21748 MiB |  14800 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21616 MiB |  14668 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  21748 MiB |  14800 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21616 MiB |  14668 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  21484 MiB |  14536 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  21352 MiB |  14404 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  23144 MiB |  16194 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23140 MiB |  16192 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1895 MiB |   1894 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1760 MiB |   1760 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    135 MiB |    134 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1070    |     890    |
|       from large pool |     126    |     128    |     742    |     616    |
|       from small pool |      54    |      56    |     328    |     274    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1070    |     890    |
|       from large pool |     126    |     128    |     742    |     616    |
|       from small pool |      54    |      56    |     328    |     274    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     656    |     529    |
|       from large pool |     126    |     128    |     654    |     528    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      90    |      89    |
|       from large pool |       0    |       1    |      88    |      88    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:29:53 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  21748 MiB |  14800 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21616 MiB |  14668 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  21748 MiB |  14800 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21616 MiB |  14668 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  21484 MiB |  14536 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  21352 MiB |  14404 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  23144 MiB |  16194 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23140 MiB |  16192 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1895 MiB |   1894 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1760 MiB |   1760 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    135 MiB |    134 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1070    |     890    |
|       from large pool |     126    |     128    |     742    |     616    |
|       from small pool |      54    |      56    |     328    |     274    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1070    |     890    |
|       from large pool |     126    |     128    |     742    |     616    |
|       from small pool |      54    |      56    |     328    |     274    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     656    |     529    |
|       from large pool |     126    |     128    |     654    |     528    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      90    |      89    |
|       from large pool |       0    |       1    |      88    |      88    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:29:53 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  20704 MiB |  14800 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20572 MiB |  14668 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  20704 MiB |  14800 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20572 MiB |  14668 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  20440 MiB |  14536 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  20308 MiB |  14404 MiB |
|       from small pool |      0 MiB |      1 MiB |    132 MiB |    132 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  22100 MiB |  16194 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22096 MiB |  16192 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1895 MiB |   1894 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1760 MiB |   1760 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    135 MiB |    134 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1037    |     889    |
|       from large pool |     100    |     102    |     716    |     616    |
|       from small pool |      48    |      50    |     321    |     273    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1037    |     889    |
|       from large pool |     100    |     102    |     716    |     616    |
|       from small pool |      48    |      50    |     321    |     273    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     630    |     529    |
|       from large pool |     100    |     102    |     628    |     528    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      90    |      89    |
|       from large pool |       0    |       1    |      88    |      88    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:29:53 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:29:54 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:29:54 | I | in layer model.layers.0
25-01-14 01:29:54 | I | quantizing weights for layer model.layers.0
25-01-14 01:29:54 | I | collecting info in model.layers.0
25-01-14 01:29:55 | I | collecting info in model.layers.0
25-01-14 01:29:56 | I | collecting info in model.layers.0
25-01-14 01:29:57 | I | collecting info in model.layers.0
25-01-14 01:29:59 | I | collecting calibration activations in model.layers.0
25-01-14 01:30:00 | I | collecting calibration activations in model.layers.0
25-01-14 01:30:01 | I | collecting calibration activations in model.layers.0
25-01-14 01:30:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:30:04 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:30:04 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:30:09 | I |       - range scale = [    1.0000]
25-01-14 01:30:09 | I |         sum  error  = [    0.6780]
25-01-14 01:30:09 | I |         best error  = [    0.6780]
25-01-14 01:30:09 | I |     + error = [0.6780]
25-01-14 01:30:13 | I |       - range scale = [    1.0000]
25-01-14 01:30:13 | I |         sum  error  = [    1.6161]
25-01-14 01:30:13 | I |         best error  = [    1.6161]
25-01-14 01:30:13 | I |     + error = [1.6161]
25-01-14 01:30:14 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:30:18 | I |       - range scale = [    1.0000]
25-01-14 01:30:18 | I |         sum  error  = [    2.4152]
25-01-14 01:30:18 | I |         best error  = [    2.4152]
25-01-14 01:30:18 | I |     + error = [2.4152]
25-01-14 01:30:23 | I |       - range scale = [    1.0000]
25-01-14 01:30:23 | I |         sum  error  = [    3.8398]
25-01-14 01:30:23 | I |         best error  = [    3.8398]
25-01-14 01:30:23 | I |     + error = [3.8398]
25-01-14 01:30:23 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:30:24 | I |       - range scale = [    1.0000]
25-01-14 01:30:24 | I |         sum  error  = [    0.2682]
25-01-14 01:30:24 | I |         best error  = [    0.2682]
25-01-14 01:30:24 | I |     + error = [0.2682]
25-01-14 01:30:25 | I |       - range scale = [    1.0000]
25-01-14 01:30:25 | I |         sum  error  = [    0.3296]
25-01-14 01:30:25 | I |         best error  = [    0.3296]
25-01-14 01:30:25 | I |     + error = [0.3296]
25-01-14 01:30:25 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:30:26 | I |       - range scale = [    1.0000]
25-01-14 01:30:26 | I |         sum  error  = [    0.2018]
25-01-14 01:30:26 | I |         best error  = [    0.2018]
25-01-14 01:30:26 | I |     + error = [0.2018]
25-01-14 01:30:27 | I |       - range scale = [    1.0000]
25-01-14 01:30:27 | I |         sum  error  = [    0.3155]
25-01-14 01:30:27 | I |         best error  = [    0.3155]
25-01-14 01:30:27 | I |     + error = [0.3155]
25-01-14 01:30:27 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:30:28 | I |       - range scale = [    1.0000]
25-01-14 01:30:28 | I |         sum  error  = [    1.2551]
25-01-14 01:30:28 | I |         best error  = [    1.2551]
25-01-14 01:30:28 | I |     + error = [1.2551]
25-01-14 01:30:29 | I |       - range scale = [    1.0000]
25-01-14 01:30:29 | I |         sum  error  = [    1.4041]
25-01-14 01:30:29 | I |         best error  = [    1.4041]
25-01-14 01:30:29 | I |     + error = [1.4041]
25-01-14 01:30:29 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:30:30 | I |       - range scale = [    1.0000]
25-01-14 01:30:30 | I |         sum  error  = [    1.3872]
25-01-14 01:30:30 | I |         best error  = [    1.3872]
25-01-14 01:30:30 | I |     + error = [1.3872]
25-01-14 01:30:31 | I |       - range scale = [    1.0000]
25-01-14 01:30:31 | I |         sum  error  = [    1.6212]
25-01-14 01:30:31 | I |         best error  = [    1.6212]
25-01-14 01:30:31 | I |     + error = [1.6212]
25-01-14 01:30:31 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:30:32 | I |       - range scale = [    1.0000]
25-01-14 01:30:32 | I |         sum  error  = [    0.2198]
25-01-14 01:30:32 | I |         best error  = [    0.2198]
25-01-14 01:30:32 | I |     + error = [0.2198]
25-01-14 01:30:33 | I |       - range scale = [    1.0000]
25-01-14 01:30:33 | I |         sum  error  = [    0.3317]
25-01-14 01:30:33 | I |         best error  = [    0.3317]
25-01-14 01:30:33 | I |     + error = [0.3317]
25-01-14 01:30:33 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:30:35 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:30:38 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:30:40 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:30:43 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:30:45 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:30:48 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:30:54 | I | quantizing activations for layer model.layers.0
25-01-14 01:30:54 | I | collecting info in model.layers.0
25-01-14 01:30:55 | I | collecting info in model.layers.0
25-01-14 01:30:56 | I | collecting info in model.layers.0
25-01-14 01:30:57 | I | collecting info in model.layers.0
25-01-14 01:30:59 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:00 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:06 | I | forward this layer
25-01-14 01:31:06 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/86.pt
25-01-14 01:31:06 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/86.pt
25-01-14 01:31:06 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:31:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 44           |        cudaMalloc retries: 47        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 104284 GiB | 104261 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 103574 GiB | 103552 GiB |
|       from small pool |      3 MiB |      5 MiB |    709 GiB |    709 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 104284 GiB | 104261 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 103574 GiB | 103552 GiB |
|       from small pool |      3 MiB |      5 MiB |    709 GiB |    709 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 104198 GiB | 104176 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 103491 GiB | 103469 GiB |
|       from small pool |      3 MiB |      5 MiB |    706 GiB |    706 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3094 GiB |   3070 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3090 GiB |   3067 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  54871 GiB |  54870 GiB |
|       from large pool |    943 MiB |   1689 MiB |  54041 GiB |  54040 GiB |
|       from small pool |      0 MiB |      4 MiB |    830 GiB |    830 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   15052 K  |   15052 K  |
|       from large pool |     186    |     223    |    2266 K  |    2266 K  |
|       from small pool |     109    |     111    |   12785 K  |   12785 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   15052 K  |   15052 K  |
|       from large pool |     186    |     223    |    2266 K  |    2266 K  |
|       from small pool |     109    |     111    |   12785 K  |   12785 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    7480    |    7304    |
|       from large pool |     174    |     174    |    5926    |    5752    |
|       from small pool |       2    |       4    |    1554    |    1552    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    6072 K  |    6072 K  |
|       from large pool |      20    |      24    |     716 K  |     716 K  |
|       from small pool |       8    |      16    |    5356 K  |    5356 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:31:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  22085 MiB |  15136 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21949 MiB |  15001 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  22085 MiB |  15136 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21949 MiB |  15001 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  21815 MiB |  14866 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  21679 MiB |  14731 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  23512 MiB |  16562 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23508 MiB |  16560 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1938 MiB |   1937 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1800 MiB |   1800 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    138 MiB |    137 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1090    |     910    |
|       from large pool |     126    |     128    |     756    |     630    |
|       from small pool |      54    |      56    |     334    |     280    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1090    |     910    |
|       from large pool |     126    |     128    |     756    |     630    |
|       from small pool |      54    |      56    |     334    |     280    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     668    |     541    |
|       from large pool |     126    |     128    |     666    |     540    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      92    |      91    |
|       from large pool |       0    |       1    |      90    |      90    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:31:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  22085 MiB |  15136 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21949 MiB |  15001 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  22085 MiB |  15136 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  21949 MiB |  15001 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  21815 MiB |  14866 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  21679 MiB |  14731 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  23512 MiB |  16562 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23508 MiB |  16560 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1938 MiB |   1937 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1800 MiB |   1800 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    138 MiB |    137 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1090    |     910    |
|       from large pool |     126    |     128    |     756    |     630    |
|       from small pool |      54    |      56    |     334    |     280    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1090    |     910    |
|       from large pool |     126    |     128    |     756    |     630    |
|       from small pool |      54    |      56    |     334    |     280    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     668    |     541    |
|       from large pool |     126    |     128    |     666    |     540    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      92    |      91    |
|       from large pool |       0    |       1    |      90    |      90    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:31:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  21041 MiB |  15136 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20905 MiB |  15001 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  21041 MiB |  15136 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  20905 MiB |  15001 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  20771 MiB |  14866 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  20635 MiB |  14731 MiB |
|       from small pool |      0 MiB |      1 MiB |    135 MiB |    135 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  22468 MiB |  16562 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22464 MiB |  16560 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1938 MiB |   1937 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1800 MiB |   1800 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    138 MiB |    137 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1057    |     909    |
|       from large pool |     100    |     102    |     730    |     630    |
|       from small pool |      48    |      50    |     327    |     279    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1057    |     909    |
|       from large pool |     100    |     102    |     730    |     630    |
|       from small pool |      48    |      50    |     327    |     279    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     642    |     541    |
|       from large pool |     100    |     102    |     640    |     540    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      92    |      91    |
|       from large pool |       0    |       1    |      90    |      90    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:31:06 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:31:06 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:31:06 | I | in layer model.layers.0
25-01-14 01:31:06 | I | quantizing weights for layer model.layers.0
25-01-14 01:31:06 | I | collecting info in model.layers.0
25-01-14 01:31:08 | I | collecting info in model.layers.0
25-01-14 01:31:09 | I | collecting info in model.layers.0
25-01-14 01:31:10 | I | collecting info in model.layers.0
25-01-14 01:31:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:31:17 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:31:17 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:31:22 | I |       - range scale = [    1.0000]
25-01-14 01:31:22 | I |         sum  error  = [    0.6474]
25-01-14 01:31:22 | I |         best error  = [    0.6474]
25-01-14 01:31:22 | I |     + error = [0.6474]
25-01-14 01:31:27 | I |       - range scale = [    1.0000]
25-01-14 01:31:27 | I |         sum  error  = [    1.5525]
25-01-14 01:31:27 | I |         best error  = [    1.5525]
25-01-14 01:31:27 | I |     + error = [1.5525]
25-01-14 01:31:27 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:31:32 | I |       - range scale = [    1.0000]
25-01-14 01:31:32 | I |         sum  error  = [    2.4229]
25-01-14 01:31:32 | I |         best error  = [    2.4229]
25-01-14 01:31:32 | I |     + error = [2.4229]
25-01-14 01:31:37 | I |       - range scale = [    1.0000]
25-01-14 01:31:37 | I |         sum  error  = [    3.7739]
25-01-14 01:31:37 | I |         best error  = [    3.7739]
25-01-14 01:31:37 | I |     + error = [3.7739]
25-01-14 01:31:37 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:31:37 | I |       - range scale = [    1.0000]
25-01-14 01:31:37 | I |         sum  error  = [    0.2612]
25-01-14 01:31:37 | I |         best error  = [    0.2612]
25-01-14 01:31:37 | I |     + error = [0.2612]
25-01-14 01:31:38 | I |       - range scale = [    1.0000]
25-01-14 01:31:38 | I |         sum  error  = [    0.3179]
25-01-14 01:31:38 | I |         best error  = [    0.3179]
25-01-14 01:31:38 | I |     + error = [0.3179]
25-01-14 01:31:38 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:31:39 | I |       - range scale = [    1.0000]
25-01-14 01:31:39 | I |         sum  error  = [    0.1888]
25-01-14 01:31:39 | I |         best error  = [    0.1888]
25-01-14 01:31:39 | I |     + error = [0.1888]
25-01-14 01:31:40 | I |       - range scale = [    1.0000]
25-01-14 01:31:40 | I |         sum  error  = [    0.2966]
25-01-14 01:31:40 | I |         best error  = [    0.2966]
25-01-14 01:31:40 | I |     + error = [0.2966]
25-01-14 01:31:40 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:31:41 | I |       - range scale = [    1.0000]
25-01-14 01:31:41 | I |         sum  error  = [    1.1297]
25-01-14 01:31:41 | I |         best error  = [    1.1297]
25-01-14 01:31:41 | I |     + error = [1.1297]
25-01-14 01:31:42 | I |       - range scale = [    1.0000]
25-01-14 01:31:42 | I |         sum  error  = [    1.3007]
25-01-14 01:31:42 | I |         best error  = [    1.3007]
25-01-14 01:31:42 | I |     + error = [1.3007]
25-01-14 01:31:42 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:31:43 | I |       - range scale = [    1.0000]
25-01-14 01:31:43 | I |         sum  error  = [    1.2659]
25-01-14 01:31:43 | I |         best error  = [    1.2659]
25-01-14 01:31:43 | I |     + error = [1.2659]
25-01-14 01:31:44 | I |       - range scale = [    1.0000]
25-01-14 01:31:44 | I |         sum  error  = [    1.5631]
25-01-14 01:31:44 | I |         best error  = [    1.5631]
25-01-14 01:31:44 | I |     + error = [1.5631]
25-01-14 01:31:44 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:31:45 | I |       - range scale = [    1.0000]
25-01-14 01:31:45 | I |         sum  error  = [    0.1956]
25-01-14 01:31:45 | I |         best error  = [    0.1956]
25-01-14 01:31:45 | I |     + error = [0.1956]
25-01-14 01:31:46 | I |       - range scale = [    1.0000]
25-01-14 01:31:46 | I |         sum  error  = [    0.3120]
25-01-14 01:31:46 | I |         best error  = [    0.3120]
25-01-14 01:31:46 | I |     + error = [0.3120]
25-01-14 01:31:46 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:31:49 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:31:51 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:31:54 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:31:56 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:31:58 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:32:01 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:32:07 | I | quantizing activations for layer model.layers.0
25-01-14 01:32:07 | I | collecting info in model.layers.0
25-01-14 01:32:08 | I | collecting info in model.layers.0
25-01-14 01:32:10 | I | collecting info in model.layers.0
25-01-14 01:32:11 | I | collecting info in model.layers.0
25-01-14 01:32:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:19 | I | forward this layer
25-01-14 01:32:19 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/88.pt
25-01-14 01:32:19 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/88.pt
25-01-14 01:32:20 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:32:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 45           |        cudaMalloc retries: 48        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 108562 GiB | 108539 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 107829 GiB | 107807 GiB |
|       from small pool |      3 MiB |      5 MiB |    732 GiB |    732 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 108562 GiB | 108539 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 107829 GiB | 107807 GiB |
|       from small pool |      3 MiB |      5 MiB |    732 GiB |    732 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 108475 GiB | 108452 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 107745 GiB | 107723 GiB |
|       from small pool |      3 MiB |      5 MiB |    729 GiB |    729 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3161 GiB |   3138 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3158 GiB |   3135 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  57264 GiB |  57263 GiB |
|       from large pool |    943 MiB |   1689 MiB |  56407 GiB |  56406 GiB |
|       from small pool |      0 MiB |      4 MiB |    857 GiB |    857 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   15552 K  |   15552 K  |
|       from large pool |     186    |     223    |    2346 K  |    2346 K  |
|       from small pool |     109    |     111    |   13206 K  |   13205 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   15552 K  |   15552 K  |
|       from large pool |     186    |     223    |    2346 K  |    2346 K  |
|       from small pool |     109    |     111    |   13206 K  |   13205 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    7638    |    7462    |
|       from large pool |     174    |     174    |    6049    |    5875    |
|       from small pool |       2    |       4    |    1589    |    1587    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    6262 K  |    6262 K  |
|       from large pool |      21    |      24    |     739 K  |     739 K  |
|       from small pool |       8    |      16    |    5523 K  |    5523 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:32:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  22421 MiB |  15473 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22283 MiB |  15335 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  22421 MiB |  15473 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22283 MiB |  15335 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  22145 MiB |  15197 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22007 MiB |  15059 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  23880 MiB |  16930 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23876 MiB |  16928 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1981 MiB |   1980 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1840 MiB |   1840 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    141 MiB |    140 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1110    |     930    |
|       from large pool |     126    |     128    |     770    |     644    |
|       from small pool |      54    |      56    |     340    |     286    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1110    |     930    |
|       from large pool |     126    |     128    |     770    |     644    |
|       from small pool |      54    |      56    |     340    |     286    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     680    |     553    |
|       from large pool |     126    |     128    |     678    |     552    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      94    |      93    |
|       from large pool |       0    |       1    |      92    |      92    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:32:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  22421 MiB |  15473 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22283 MiB |  15335 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  22421 MiB |  15473 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22283 MiB |  15335 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  22145 MiB |  15197 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22007 MiB |  15059 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  23880 MiB |  16930 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23876 MiB |  16928 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   1981 MiB |   1980 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1840 MiB |   1840 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    141 MiB |    140 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1110    |     930    |
|       from large pool |     126    |     128    |     770    |     644    |
|       from small pool |      54    |      56    |     340    |     286    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1110    |     930    |
|       from large pool |     126    |     128    |     770    |     644    |
|       from small pool |      54    |      56    |     340    |     286    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     680    |     553    |
|       from large pool |     126    |     128    |     678    |     552    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      94    |      93    |
|       from large pool |       0    |       1    |      92    |      92    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:32:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  21377 MiB |  15473 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21239 MiB |  15335 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  21377 MiB |  15473 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21239 MiB |  15335 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  21101 MiB |  15197 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  20963 MiB |  15059 MiB |
|       from small pool |      0 MiB |      1 MiB |    138 MiB |    138 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  22836 MiB |  16930 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22832 MiB |  16928 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   1981 MiB |   1980 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1840 MiB |   1840 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    141 MiB |    140 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1077    |     929    |
|       from large pool |     100    |     102    |     744    |     644    |
|       from small pool |      48    |      50    |     333    |     285    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1077    |     929    |
|       from large pool |     100    |     102    |     744    |     644    |
|       from small pool |      48    |      50    |     333    |     285    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     654    |     553    |
|       from large pool |     100    |     102    |     652    |     552    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      94    |      93    |
|       from large pool |       0    |       1    |      92    |      92    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:32:20 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:32:20 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:32:20 | I | in layer model.layers.0
25-01-14 01:32:20 | I | quantizing weights for layer model.layers.0
25-01-14 01:32:20 | I | collecting info in model.layers.0
25-01-14 01:32:21 | I | collecting info in model.layers.0
25-01-14 01:32:22 | I | collecting info in model.layers.0
25-01-14 01:32:23 | I | collecting info in model.layers.0
25-01-14 01:32:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:32:30 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:32:30 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:32:35 | I |       - range scale = [    1.0000]
25-01-14 01:32:35 | I |         sum  error  = [    0.6998]
25-01-14 01:32:35 | I |         best error  = [    0.6998]
25-01-14 01:32:35 | I |     + error = [0.6998]
25-01-14 01:32:40 | I |       - range scale = [    1.0000]
25-01-14 01:32:40 | I |         sum  error  = [    1.6195]
25-01-14 01:32:40 | I |         best error  = [    1.6195]
25-01-14 01:32:40 | I |     + error = [1.6195]
25-01-14 01:32:41 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:32:46 | I |       - range scale = [    1.0000]
25-01-14 01:32:46 | I |         sum  error  = [    2.3735]
25-01-14 01:32:46 | I |         best error  = [    2.3735]
25-01-14 01:32:46 | I |     + error = [2.3735]
25-01-14 01:32:51 | I |       - range scale = [    1.0000]
25-01-14 01:32:51 | I |         sum  error  = [    3.6451]
25-01-14 01:32:51 | I |         best error  = [    3.6451]
25-01-14 01:32:51 | I |     + error = [3.6451]
25-01-14 01:32:51 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:32:52 | I |       - range scale = [    1.0000]
25-01-14 01:32:52 | I |         sum  error  = [    0.2767]
25-01-14 01:32:52 | I |         best error  = [    0.2767]
25-01-14 01:32:52 | I |     + error = [0.2767]
25-01-14 01:32:52 | I |       - range scale = [    1.0000]
25-01-14 01:32:52 | I |         sum  error  = [    0.3254]
25-01-14 01:32:52 | I |         best error  = [    0.3254]
25-01-14 01:32:52 | I |     + error = [0.3254]
25-01-14 01:32:53 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:32:53 | I |       - range scale = [    1.0000]
25-01-14 01:32:53 | I |         sum  error  = [    0.2016]
25-01-14 01:32:53 | I |         best error  = [    0.2016]
25-01-14 01:32:53 | I |     + error = [0.2016]
25-01-14 01:32:54 | I |       - range scale = [    1.0000]
25-01-14 01:32:54 | I |         sum  error  = [    0.3285]
25-01-14 01:32:54 | I |         best error  = [    0.3285]
25-01-14 01:32:54 | I |     + error = [0.3285]
25-01-14 01:32:54 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:32:55 | I |       - range scale = [    1.0000]
25-01-14 01:32:55 | I |         sum  error  = [    1.5094]
25-01-14 01:32:55 | I |         best error  = [    1.5094]
25-01-14 01:32:55 | I |     + error = [1.5094]
25-01-14 01:32:56 | I |       - range scale = [    1.0000]
25-01-14 01:32:56 | I |         sum  error  = [    1.5488]
25-01-14 01:32:56 | I |         best error  = [    1.5488]
25-01-14 01:32:56 | I |     + error = [1.5488]
25-01-14 01:32:56 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:32:57 | I |       - range scale = [    1.0000]
25-01-14 01:32:57 | I |         sum  error  = [    1.6411]
25-01-14 01:32:57 | I |         best error  = [    1.6411]
25-01-14 01:32:57 | I |     + error = [1.6411]
25-01-14 01:32:58 | I |       - range scale = [    1.0000]
25-01-14 01:32:58 | I |         sum  error  = [    1.7401]
25-01-14 01:32:58 | I |         best error  = [    1.7401]
25-01-14 01:32:58 | I |     + error = [1.7401]
25-01-14 01:32:58 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:32:59 | I |       - range scale = [    1.0000]
25-01-14 01:32:59 | I |         sum  error  = [    0.3007]
25-01-14 01:32:59 | I |         best error  = [    0.3007]
25-01-14 01:32:59 | I |     + error = [0.3007]
25-01-14 01:33:00 | I |       - range scale = [    1.0000]
25-01-14 01:33:00 | I |         sum  error  = [    0.4281]
25-01-14 01:33:00 | I |         best error  = [    0.4281]
25-01-14 01:33:00 | I |     + error = [0.4281]
25-01-14 01:33:00 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:33:03 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:33:05 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:33:08 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:33:10 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:33:13 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:33:15 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:33:22 | I | quantizing activations for layer model.layers.0
25-01-14 01:33:22 | I | collecting info in model.layers.0
25-01-14 01:33:23 | I | collecting info in model.layers.0
25-01-14 01:33:24 | I | collecting info in model.layers.0
25-01-14 01:33:25 | I | collecting info in model.layers.0
25-01-14 01:33:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:34 | I | forward this layer
25-01-14 01:33:34 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/90.pt
25-01-14 01:33:34 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/90.pt
25-01-14 01:33:34 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:33:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 46           |        cudaMalloc retries: 49        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 112925 GiB | 112903 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 112170 GiB | 112147 GiB |
|       from small pool |      3 MiB |      5 MiB |    755 GiB |    755 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 112925 GiB | 112903 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 112170 GiB | 112147 GiB |
|       from small pool |      3 MiB |      5 MiB |    755 GiB |    755 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 112836 GiB | 112814 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 112084 GiB | 112061 GiB |
|       from small pool |      3 MiB |      5 MiB |    752 GiB |    752 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3230 GiB |   3207 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3227 GiB |   3204 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  59677 GiB |  59676 GiB |
|       from large pool |    943 MiB |   1689 MiB |  58793 GiB |  58792 GiB |
|       from small pool |      0 MiB |      4 MiB |    884 GiB |    884 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   16059 K  |   16059 K  |
|       from large pool |     186    |     223    |    2427 K  |    2427 K  |
|       from small pool |     109    |     111    |   13632 K  |   13631 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   16059 K  |   16059 K  |
|       from large pool |     186    |     223    |    2427 K  |    2427 K  |
|       from small pool |     109    |     111    |   13632 K  |   13631 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    7802    |    7626    |
|       from large pool |     174    |     174    |    6178    |    6004    |
|       from small pool |       2    |       4    |    1624    |    1622    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    6454 K  |    6454 K  |
|       from large pool |      20    |      24    |     761 K  |     761 K  |
|       from small pool |       8    |      16    |    5692 K  |    5692 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:33:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  22757 MiB |  15809 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22616 MiB |  15668 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  22757 MiB |  15809 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22616 MiB |  15668 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  22475 MiB |  15527 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22334 MiB |  15386 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  24248 MiB |  17298 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24244 MiB |  17296 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2024 MiB |   2023 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1880 MiB |   1880 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    144 MiB |    143 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1130    |     950    |
|       from large pool |     126    |     128    |     784    |     658    |
|       from small pool |      54    |      56    |     346    |     292    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1130    |     950    |
|       from large pool |     126    |     128    |     784    |     658    |
|       from small pool |      54    |      56    |     346    |     292    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     692    |     565    |
|       from large pool |     126    |     128    |     690    |     564    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      96    |      95    |
|       from large pool |       0    |       1    |      94    |      94    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:33:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  22757 MiB |  15809 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22616 MiB |  15668 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  22757 MiB |  15809 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22616 MiB |  15668 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  22475 MiB |  15527 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22334 MiB |  15386 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  24248 MiB |  17298 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24244 MiB |  17296 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2024 MiB |   2023 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1880 MiB |   1880 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    144 MiB |    143 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1130    |     950    |
|       from large pool |     126    |     128    |     784    |     658    |
|       from small pool |      54    |      56    |     346    |     292    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1130    |     950    |
|       from large pool |     126    |     128    |     784    |     658    |
|       from small pool |      54    |      56    |     346    |     292    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     692    |     565    |
|       from large pool |     126    |     128    |     690    |     564    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      96    |      95    |
|       from large pool |       0    |       1    |      94    |      94    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:33:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  21714 MiB |  15809 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21572 MiB |  15668 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  21714 MiB |  15809 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21572 MiB |  15668 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  21432 MiB |  15527 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  21290 MiB |  15386 MiB |
|       from small pool |      0 MiB |      1 MiB |    141 MiB |    141 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  23204 MiB |  17298 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23200 MiB |  17296 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2024 MiB |   2023 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1880 MiB |   1880 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    144 MiB |    143 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1097    |     949    |
|       from large pool |     100    |     102    |     758    |     658    |
|       from small pool |      48    |      50    |     339    |     291    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1097    |     949    |
|       from large pool |     100    |     102    |     758    |     658    |
|       from small pool |      48    |      50    |     339    |     291    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     666    |     565    |
|       from large pool |     100    |     102    |     664    |     564    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      96    |      95    |
|       from large pool |       0    |       1    |      94    |      94    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:33:34 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:33:35 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:33:35 | I | in layer model.layers.0
25-01-14 01:33:35 | I | quantizing weights for layer model.layers.0
25-01-14 01:33:35 | I | collecting info in model.layers.0
25-01-14 01:33:36 | I | collecting info in model.layers.0
25-01-14 01:33:37 | I | collecting info in model.layers.0
25-01-14 01:33:38 | I | collecting info in model.layers.0
25-01-14 01:33:40 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:41 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:43 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:44 | I | collecting calibration activations in model.layers.0
25-01-14 01:33:45 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:33:45 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:33:51 | I |       - range scale = [    1.0000]
25-01-14 01:33:51 | I |         sum  error  = [    0.7334]
25-01-14 01:33:51 | I |         best error  = [    0.7334]
25-01-14 01:33:51 | I |     + error = [0.7334]
25-01-14 01:33:56 | I |       - range scale = [    1.0000]
25-01-14 01:33:56 | I |         sum  error  = [    1.6953]
25-01-14 01:33:56 | I |         best error  = [    1.6953]
25-01-14 01:33:56 | I |     + error = [1.6953]
25-01-14 01:33:56 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:34:01 | I |       - range scale = [    1.0000]
25-01-14 01:34:01 | I |         sum  error  = [    2.6218]
25-01-14 01:34:01 | I |         best error  = [    2.6218]
25-01-14 01:34:01 | I |     + error = [2.6218]
25-01-14 01:34:06 | I |       - range scale = [    1.0000]
25-01-14 01:34:06 | I |         sum  error  = [    3.8687]
25-01-14 01:34:06 | I |         best error  = [    3.8687]
25-01-14 01:34:06 | I |     + error = [3.8687]
25-01-14 01:34:06 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:34:07 | I |       - range scale = [    1.0000]
25-01-14 01:34:07 | I |         sum  error  = [    0.2750]
25-01-14 01:34:07 | I |         best error  = [    0.2750]
25-01-14 01:34:07 | I |     + error = [0.2750]
25-01-14 01:34:08 | I |       - range scale = [    1.0000]
25-01-14 01:34:08 | I |         sum  error  = [    0.3213]
25-01-14 01:34:08 | I |         best error  = [    0.3213]
25-01-14 01:34:08 | I |     + error = [0.3213]
25-01-14 01:34:08 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:34:09 | I |       - range scale = [    1.0000]
25-01-14 01:34:09 | I |         sum  error  = [    0.1930]
25-01-14 01:34:09 | I |         best error  = [    0.1930]
25-01-14 01:34:09 | I |     + error = [0.1930]
25-01-14 01:34:10 | I |       - range scale = [    1.0000]
25-01-14 01:34:10 | I |         sum  error  = [    0.3205]
25-01-14 01:34:10 | I |         best error  = [    0.3205]
25-01-14 01:34:10 | I |     + error = [0.3205]
25-01-14 01:34:10 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:34:10 | I |       - range scale = [    1.0000]
25-01-14 01:34:10 | I |         sum  error  = [    1.1764]
25-01-14 01:34:10 | I |         best error  = [    1.1764]
25-01-14 01:34:10 | I |     + error = [1.1764]
25-01-14 01:34:12 | I |       - range scale = [    1.0000]
25-01-14 01:34:12 | I |         sum  error  = [    1.4346]
25-01-14 01:34:12 | I |         best error  = [    1.4346]
25-01-14 01:34:12 | I |     + error = [1.4346]
25-01-14 01:34:12 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:34:13 | I |       - range scale = [    1.0000]
25-01-14 01:34:13 | I |         sum  error  = [    1.3288]
25-01-14 01:34:13 | I |         best error  = [    1.3288]
25-01-14 01:34:13 | I |     + error = [1.3288]
25-01-14 01:34:14 | I |       - range scale = [    1.0000]
25-01-14 01:34:14 | I |         sum  error  = [    1.6918]
25-01-14 01:34:14 | I |         best error  = [    1.6918]
25-01-14 01:34:14 | I |     + error = [1.6918]
25-01-14 01:34:14 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:34:15 | I |       - range scale = [    1.0000]
25-01-14 01:34:15 | I |         sum  error  = [    0.2043]
25-01-14 01:34:15 | I |         best error  = [    0.2043]
25-01-14 01:34:15 | I |     + error = [0.2043]
25-01-14 01:34:16 | I |       - range scale = [    1.0000]
25-01-14 01:34:16 | I |         sum  error  = [    0.3347]
25-01-14 01:34:16 | I |         best error  = [    0.3347]
25-01-14 01:34:16 | I |     + error = [0.3347]
25-01-14 01:34:16 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:34:18 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:34:21 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:34:23 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:34:26 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:34:28 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:34:31 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:34:37 | I | quantizing activations for layer model.layers.0
25-01-14 01:34:37 | I | collecting info in model.layers.0
25-01-14 01:34:38 | I | collecting info in model.layers.0
25-01-14 01:34:40 | I | collecting info in model.layers.0
25-01-14 01:34:41 | I | collecting info in model.layers.0
25-01-14 01:34:42 | I | collecting calibration activations in model.layers.0
25-01-14 01:34:44 | I | collecting calibration activations in model.layers.0
25-01-14 01:34:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:34:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:34:50 | I | forward this layer
25-01-14 01:34:50 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/92.pt
25-01-14 01:34:50 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/92.pt
25-01-14 01:34:50 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:34:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 47           |        cudaMalloc retries: 50        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 117374 GiB | 117352 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 116595 GiB | 116573 GiB |
|       from small pool |      3 MiB |      5 MiB |    778 GiB |    778 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 117374 GiB | 117352 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 116595 GiB | 116573 GiB |
|       from small pool |      3 MiB |      5 MiB |    778 GiB |    778 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 117283 GiB | 117261 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 116507 GiB | 116485 GiB |
|       from small pool |      3 MiB |      5 MiB |    775 GiB |    775 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3298 GiB |   3275 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3295 GiB |   3272 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  62173 GiB |  62172 GiB |
|       from large pool |    943 MiB |   1689 MiB |  61260 GiB |  61259 GiB |
|       from small pool |      0 MiB |      4 MiB |    912 GiB |    912 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   16574 K  |   16573 K  |
|       from large pool |     186    |     223    |    2509 K  |    2509 K  |
|       from small pool |     109    |     111    |   14064 K  |   14063 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   16574 K  |   16573 K  |
|       from large pool |     186    |     223    |    2509 K  |    2509 K  |
|       from small pool |     109    |     111    |   14064 K  |   14063 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    7960    |    7784    |
|       from large pool |     174    |     174    |    6301    |    6127    |
|       from small pool |       2    |       4    |    1659    |    1657    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    6649 K  |    6649 K  |
|       from large pool |      21    |      24    |     785 K  |     785 K  |
|       from small pool |       8    |      16    |    5863 K  |    5863 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:34:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  23094 MiB |  16146 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22950 MiB |  16002 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  23094 MiB |  16146 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22950 MiB |  16002 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  22806 MiB |  15858 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22662 MiB |  15714 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  24616 MiB |  17666 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24612 MiB |  17664 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2067 MiB |   2066 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1920 MiB |   1920 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    147 MiB |    146 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1150    |     970    |
|       from large pool |     126    |     128    |     798    |     672    |
|       from small pool |      54    |      56    |     352    |     298    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1150    |     970    |
|       from large pool |     126    |     128    |     798    |     672    |
|       from small pool |      54    |      56    |     352    |     298    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     704    |     577    |
|       from large pool |     126    |     128    |     702    |     576    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      98    |      97    |
|       from large pool |       0    |       1    |      96    |      96    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:34:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  23094 MiB |  16146 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22950 MiB |  16002 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  23094 MiB |  16146 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  22950 MiB |  16002 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  22806 MiB |  15858 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22662 MiB |  15714 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  24616 MiB |  17666 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24612 MiB |  17664 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2067 MiB |   2066 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1920 MiB |   1920 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    147 MiB |    146 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1150    |     970    |
|       from large pool |     126    |     128    |     798    |     672    |
|       from small pool |      54    |      56    |     352    |     298    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1150    |     970    |
|       from large pool |     126    |     128    |     798    |     672    |
|       from small pool |      54    |      56    |     352    |     298    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     704    |     577    |
|       from large pool |     126    |     128    |     702    |     576    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      98    |      97    |
|       from large pool |       0    |       1    |      96    |      96    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:34:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  22050 MiB |  16146 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21906 MiB |  16002 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  22050 MiB |  16146 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  21906 MiB |  16002 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  21762 MiB |  15858 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  21618 MiB |  15714 MiB |
|       from small pool |      0 MiB |      1 MiB |    144 MiB |    144 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  23572 MiB |  17666 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23568 MiB |  17664 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2067 MiB |   2066 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1920 MiB |   1920 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    147 MiB |    146 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1117    |     969    |
|       from large pool |     100    |     102    |     772    |     672    |
|       from small pool |      48    |      50    |     345    |     297    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1117    |     969    |
|       from large pool |     100    |     102    |     772    |     672    |
|       from small pool |      48    |      50    |     345    |     297    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     678    |     577    |
|       from large pool |     100    |     102    |     676    |     576    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |      98    |      97    |
|       from large pool |       0    |       1    |      96    |      96    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:34:50 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:34:50 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:34:50 | I | in layer model.layers.0
25-01-14 01:34:50 | I | quantizing weights for layer model.layers.0
25-01-14 01:34:50 | I | collecting info in model.layers.0
25-01-14 01:34:51 | I | collecting info in model.layers.0
25-01-14 01:34:53 | I | collecting info in model.layers.0
25-01-14 01:34:54 | I | collecting info in model.layers.0
25-01-14 01:34:56 | I | collecting calibration activations in model.layers.0
25-01-14 01:34:57 | I | collecting calibration activations in model.layers.0
25-01-14 01:34:58 | I | collecting calibration activations in model.layers.0
25-01-14 01:35:00 | I | collecting calibration activations in model.layers.0
25-01-14 01:35:01 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:35:01 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:35:06 | I |       - range scale = [    1.0000]
25-01-14 01:35:06 | I |         sum  error  = [    0.6871]
25-01-14 01:35:06 | I |         best error  = [    0.6871]
25-01-14 01:35:06 | I |     + error = [0.6871]
25-01-14 01:35:11 | I |       - range scale = [    1.0000]
25-01-14 01:35:11 | I |         sum  error  = [    1.6070]
25-01-14 01:35:11 | I |         best error  = [    1.6070]
25-01-14 01:35:11 | I |     + error = [1.6070]
25-01-14 01:35:12 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:35:17 | I |       - range scale = [    1.0000]
25-01-14 01:35:17 | I |         sum  error  = [    2.7102]
25-01-14 01:35:17 | I |         best error  = [    2.7102]
25-01-14 01:35:17 | I |     + error = [2.7102]
25-01-14 01:35:22 | I |       - range scale = [    1.0000]
25-01-14 01:35:22 | I |         sum  error  = [    3.7438]
25-01-14 01:35:22 | I |         best error  = [    3.7438]
25-01-14 01:35:22 | I |     + error = [3.7438]
25-01-14 01:35:22 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:35:23 | I |       - range scale = [    1.0000]
25-01-14 01:35:23 | I |         sum  error  = [    0.2725]
25-01-14 01:35:23 | I |         best error  = [    0.2725]
25-01-14 01:35:23 | I |     + error = [0.2725]
25-01-14 01:35:24 | I |       - range scale = [    1.0000]
25-01-14 01:35:24 | I |         sum  error  = [    0.3256]
25-01-14 01:35:24 | I |         best error  = [    0.3256]
25-01-14 01:35:24 | I |     + error = [0.3256]
25-01-14 01:35:24 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:35:25 | I |       - range scale = [    1.0000]
25-01-14 01:35:25 | I |         sum  error  = [    0.1951]
25-01-14 01:35:25 | I |         best error  = [    0.1951]
25-01-14 01:35:25 | I |     + error = [0.1951]
25-01-14 01:35:25 | I |       - range scale = [    1.0000]
25-01-14 01:35:25 | I |         sum  error  = [    0.3144]
25-01-14 01:35:25 | I |         best error  = [    0.3144]
25-01-14 01:35:25 | I |     + error = [0.3144]
25-01-14 01:35:26 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:35:26 | I |       - range scale = [    1.0000]
25-01-14 01:35:26 | I |         sum  error  = [    1.2822]
25-01-14 01:35:26 | I |         best error  = [    1.2822]
25-01-14 01:35:26 | I |     + error = [1.2822]
25-01-14 01:35:27 | I |       - range scale = [    1.0000]
25-01-14 01:35:27 | I |         sum  error  = [    1.4287]
25-01-14 01:35:27 | I |         best error  = [    1.4287]
25-01-14 01:35:27 | I |     + error = [1.4287]
25-01-14 01:35:28 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:35:28 | I |       - range scale = [    1.0000]
25-01-14 01:35:28 | I |         sum  error  = [    1.4361]
25-01-14 01:35:28 | I |         best error  = [    1.4361]
25-01-14 01:35:28 | I |     + error = [1.4361]
25-01-14 01:35:29 | I |       - range scale = [    1.0000]
25-01-14 01:35:29 | I |         sum  error  = [    1.6226]
25-01-14 01:35:29 | I |         best error  = [    1.6226]
25-01-14 01:35:29 | I |     + error = [1.6226]
25-01-14 01:35:30 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:35:30 | I |       - range scale = [    1.0000]
25-01-14 01:35:30 | I |         sum  error  = [    0.2162]
25-01-14 01:35:30 | I |         best error  = [    0.2162]
25-01-14 01:35:30 | I |     + error = [0.2162]
25-01-14 01:35:32 | I |       - range scale = [    1.0000]
25-01-14 01:35:32 | I |         sum  error  = [    0.3197]
25-01-14 01:35:32 | I |         best error  = [    0.3197]
25-01-14 01:35:32 | I |     + error = [0.3197]
25-01-14 01:35:32 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:35:34 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:35:37 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:35:39 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:35:41 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:35:44 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:35:46 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:35:53 | I | quantizing activations for layer model.layers.0
25-01-14 01:35:53 | I | collecting info in model.layers.0
25-01-14 01:35:54 | I | collecting info in model.layers.0
25-01-14 01:35:55 | I | collecting info in model.layers.0
25-01-14 01:35:56 | I | collecting info in model.layers.0
25-01-14 01:35:58 | I | collecting calibration activations in model.layers.0
25-01-14 01:35:59 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:01 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:05 | I | forward this layer
25-01-14 01:36:05 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/94.pt
25-01-14 01:36:05 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/94.pt
25-01-14 01:36:05 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:36:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 48           |        cudaMalloc retries: 51        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 121908 GiB | 121886 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 121106 GiB | 121083 GiB |
|       from small pool |      3 MiB |      5 MiB |    802 GiB |    802 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 121908 GiB | 121886 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 121106 GiB | 121083 GiB |
|       from small pool |      3 MiB |      5 MiB |    802 GiB |    802 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 121816 GiB | 121794 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 121016 GiB | 120994 GiB |
|       from small pool |      3 MiB |      5 MiB |    799 GiB |    799 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3367 GiB |   3344 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3364 GiB |   3341 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  64686 GiB |  64685 GiB |
|       from large pool |    943 MiB |   1689 MiB |  63745 GiB |  63745 GiB |
|       from small pool |      0 MiB |      4 MiB |    940 GiB |    940 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   17095 K  |   17095 K  |
|       from large pool |     186    |     223    |    2593 K  |    2593 K  |
|       from small pool |     109    |     111    |   14502 K  |   14501 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   17095 K  |   17095 K  |
|       from large pool |     186    |     223    |    2593 K  |    2593 K  |
|       from small pool |     109    |     111    |   14502 K  |   14501 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    8124    |    7948    |
|       from large pool |     174    |     174    |    6430    |    6256    |
|       from small pool |       2    |       4    |    1694    |    1692    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    6846 K  |    6846 K  |
|       from large pool |      20    |      24    |     808 K  |     808 K  |
|       from small pool |       8    |      16    |    6037 K  |    6037 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:36:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  23430 MiB |  16482 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23283 MiB |  16335 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  23430 MiB |  16482 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23283 MiB |  16335 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  23136 MiB |  16188 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22989 MiB |  16041 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  24984 MiB |  18034 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24980 MiB |  18032 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2110 MiB |   2109 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1960 MiB |   1960 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    150 MiB |    149 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1170    |     990    |
|       from large pool |     126    |     128    |     812    |     686    |
|       from small pool |      54    |      56    |     358    |     304    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1170    |     990    |
|       from large pool |     126    |     128    |     812    |     686    |
|       from small pool |      54    |      56    |     358    |     304    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     716    |     589    |
|       from large pool |     126    |     128    |     714    |     588    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     100    |      99    |
|       from large pool |       0    |       1    |      98    |      98    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:36:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  23430 MiB |  16482 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23283 MiB |  16335 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  23430 MiB |  16482 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23283 MiB |  16335 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  23136 MiB |  16188 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  22989 MiB |  16041 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  24984 MiB |  18034 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24980 MiB |  18032 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2110 MiB |   2109 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1960 MiB |   1960 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    150 MiB |    149 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1170    |     990    |
|       from large pool |     126    |     128    |     812    |     686    |
|       from small pool |      54    |      56    |     358    |     304    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1170    |     990    |
|       from large pool |     126    |     128    |     812    |     686    |
|       from small pool |      54    |      56    |     358    |     304    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     716    |     589    |
|       from large pool |     126    |     128    |     714    |     588    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     100    |      99    |
|       from large pool |       0    |       1    |      98    |      98    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:36:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  22386 MiB |  16482 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22239 MiB |  16335 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  22386 MiB |  16482 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22239 MiB |  16335 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  22092 MiB |  16188 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  21945 MiB |  16041 MiB |
|       from small pool |      0 MiB |      1 MiB |    147 MiB |    147 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  23940 MiB |  18034 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23936 MiB |  18032 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2110 MiB |   2109 MiB |
|       from large pool |      0 KiB |  19104 KiB |   1960 MiB |   1960 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    150 MiB |    149 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1137    |     989    |
|       from large pool |     100    |     102    |     786    |     686    |
|       from small pool |      48    |      50    |     351    |     303    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1137    |     989    |
|       from large pool |     100    |     102    |     786    |     686    |
|       from small pool |      48    |      50    |     351    |     303    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     690    |     589    |
|       from large pool |     100    |     102    |     688    |     588    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     100    |      99    |
|       from large pool |       0    |       1    |      98    |      98    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:36:05 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:36:06 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:36:06 | I | in layer model.layers.0
25-01-14 01:36:06 | I | quantizing weights for layer model.layers.0
25-01-14 01:36:06 | I | collecting info in model.layers.0
25-01-14 01:36:07 | I | collecting info in model.layers.0
25-01-14 01:36:08 | I | collecting info in model.layers.0
25-01-14 01:36:09 | I | collecting info in model.layers.0
25-01-14 01:36:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:36:17 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:36:17 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:36:22 | I |       - range scale = [    1.0000]
25-01-14 01:36:22 | I |         sum  error  = [    0.7046]
25-01-14 01:36:22 | I |         best error  = [    0.7046]
25-01-14 01:36:22 | I |     + error = [0.7046]
25-01-14 01:36:27 | I |       - range scale = [    1.0000]
25-01-14 01:36:27 | I |         sum  error  = [    1.6905]
25-01-14 01:36:27 | I |         best error  = [    1.6905]
25-01-14 01:36:27 | I |     + error = [1.6905]
25-01-14 01:36:27 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:36:33 | I |       - range scale = [    1.0000]
25-01-14 01:36:33 | I |         sum  error  = [    2.8106]
25-01-14 01:36:33 | I |         best error  = [    2.8106]
25-01-14 01:36:33 | I |     + error = [2.8106]
25-01-14 01:36:38 | I |       - range scale = [    1.0000]
25-01-14 01:36:38 | I |         sum  error  = [    3.9066]
25-01-14 01:36:38 | I |         best error  = [    3.9066]
25-01-14 01:36:38 | I |     + error = [3.9066]
25-01-14 01:36:38 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:36:39 | I |       - range scale = [    1.0000]
25-01-14 01:36:39 | I |         sum  error  = [    0.2674]
25-01-14 01:36:39 | I |         best error  = [    0.2674]
25-01-14 01:36:39 | I |     + error = [0.2674]
25-01-14 01:36:40 | I |       - range scale = [    1.0000]
25-01-14 01:36:40 | I |         sum  error  = [    0.3365]
25-01-14 01:36:40 | I |         best error  = [    0.3365]
25-01-14 01:36:40 | I |     + error = [0.3365]
25-01-14 01:36:40 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:36:41 | I |       - range scale = [    1.0000]
25-01-14 01:36:41 | I |         sum  error  = [    0.1926]
25-01-14 01:36:41 | I |         best error  = [    0.1926]
25-01-14 01:36:41 | I |     + error = [0.1926]
25-01-14 01:36:41 | I |       - range scale = [    1.0000]
25-01-14 01:36:41 | I |         sum  error  = [    0.3210]
25-01-14 01:36:41 | I |         best error  = [    0.3210]
25-01-14 01:36:41 | I |     + error = [0.3210]
25-01-14 01:36:42 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:36:42 | I |       - range scale = [    1.0000]
25-01-14 01:36:42 | I |         sum  error  = [    1.2898]
25-01-14 01:36:42 | I |         best error  = [    1.2898]
25-01-14 01:36:42 | I |     + error = [1.2898]
25-01-14 01:36:43 | I |       - range scale = [    1.0000]
25-01-14 01:36:43 | I |         sum  error  = [    1.4457]
25-01-14 01:36:43 | I |         best error  = [    1.4457]
25-01-14 01:36:43 | I |     + error = [1.4457]
25-01-14 01:36:44 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:36:44 | I |       - range scale = [    1.0000]
25-01-14 01:36:44 | I |         sum  error  = [    1.4480]
25-01-14 01:36:44 | I |         best error  = [    1.4480]
25-01-14 01:36:44 | I |     + error = [1.4480]
25-01-14 01:36:45 | I |       - range scale = [    1.0000]
25-01-14 01:36:45 | I |         sum  error  = [    1.6575]
25-01-14 01:36:45 | I |         best error  = [    1.6575]
25-01-14 01:36:45 | I |     + error = [1.6575]
25-01-14 01:36:46 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:36:46 | I |       - range scale = [    1.0000]
25-01-14 01:36:46 | I |         sum  error  = [    0.2160]
25-01-14 01:36:46 | I |         best error  = [    0.2160]
25-01-14 01:36:46 | I |     + error = [0.2160]
25-01-14 01:36:47 | I |       - range scale = [    1.0000]
25-01-14 01:36:47 | I |         sum  error  = [    0.3175]
25-01-14 01:36:47 | I |         best error  = [    0.3175]
25-01-14 01:36:47 | I |     + error = [0.3175]
25-01-14 01:36:48 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:36:50 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:36:53 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:36:55 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:36:57 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:37:00 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:37:03 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:37:09 | I | quantizing activations for layer model.layers.0
25-01-14 01:37:09 | I | collecting info in model.layers.0
25-01-14 01:37:10 | I | collecting info in model.layers.0
25-01-14 01:37:11 | I | collecting info in model.layers.0
25-01-14 01:37:13 | I | collecting info in model.layers.0
25-01-14 01:37:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:22 | I | forward this layer
25-01-14 01:37:22 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/96.pt
25-01-14 01:37:22 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/96.pt
25-01-14 01:37:22 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:37:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 49           |        cudaMalloc retries: 52        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 126528 GiB | 126506 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 125701 GiB | 125679 GiB |
|       from small pool |      3 MiB |      5 MiB |    826 GiB |    826 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 126528 GiB | 126506 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 125701 GiB | 125679 GiB |
|       from small pool |      3 MiB |      5 MiB |    826 GiB |    826 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 126434 GiB | 126412 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 125610 GiB | 125588 GiB |
|       from small pool |      3 MiB |      5 MiB |    823 GiB |    823 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3435 GiB |   3412 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3431 GiB |   3408 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  67283 GiB |  67282 GiB |
|       from large pool |    943 MiB |   1689 MiB |  66314 GiB |  66313 GiB |
|       from small pool |      0 MiB |      4 MiB |    968 GiB |    968 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   17624 K  |   17623 K  |
|       from large pool |     186    |     223    |    2678 K  |    2678 K  |
|       from small pool |     109    |     111    |   14945 K  |   14945 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   17624 K  |   17623 K  |
|       from large pool |     186    |     223    |    2678 K  |    2678 K  |
|       from small pool |     109    |     111    |   14945 K  |   14945 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    8282    |    8106    |
|       from large pool |     174    |     174    |    6553    |    6379    |
|       from small pool |       2    |       4    |    1729    |    1727    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    7045 K  |    7045 K  |
|       from large pool |      21    |      24    |     833 K  |     833 K  |
|       from small pool |       8    |      16    |    6212 K  |    6212 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:37:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  23767 MiB |  16818 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23616 MiB |  16668 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  23767 MiB |  16818 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23616 MiB |  16668 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  23467 MiB |  16518 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  23316 MiB |  16368 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  25352 MiB |  18402 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25348 MiB |  18400 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2153 MiB |   2152 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2000 MiB |   2000 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    153 MiB |    152 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1190    |    1010    |
|       from large pool |     126    |     128    |     826    |     700    |
|       from small pool |      54    |      56    |     364    |     310    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1190    |    1010    |
|       from large pool |     126    |     128    |     826    |     700    |
|       from small pool |      54    |      56    |     364    |     310    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     728    |     601    |
|       from large pool |     126    |     128    |     726    |     600    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     102    |     101    |
|       from large pool |       0    |       1    |     100    |     100    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:37:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  23767 MiB |  16818 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23616 MiB |  16668 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  23767 MiB |  16818 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23616 MiB |  16668 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  23467 MiB |  16518 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  23316 MiB |  16368 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  25352 MiB |  18402 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25348 MiB |  18400 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2153 MiB |   2152 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2000 MiB |   2000 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    153 MiB |    152 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1190    |    1010    |
|       from large pool |     126    |     128    |     826    |     700    |
|       from small pool |      54    |      56    |     364    |     310    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1190    |    1010    |
|       from large pool |     126    |     128    |     826    |     700    |
|       from small pool |      54    |      56    |     364    |     310    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     728    |     601    |
|       from large pool |     126    |     128    |     726    |     600    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     102    |     101    |
|       from large pool |       0    |       1    |     100    |     100    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:37:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  22723 MiB |  16818 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22572 MiB |  16668 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  22723 MiB |  16818 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22572 MiB |  16668 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  22423 MiB |  16518 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  22272 MiB |  16368 MiB |
|       from small pool |      0 MiB |      1 MiB |    150 MiB |    150 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  24308 MiB |  18402 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24304 MiB |  18400 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2153 MiB |   2152 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2000 MiB |   2000 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    153 MiB |    152 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1157    |    1009    |
|       from large pool |     100    |     102    |     800    |     700    |
|       from small pool |      48    |      50    |     357    |     309    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1157    |    1009    |
|       from large pool |     100    |     102    |     800    |     700    |
|       from small pool |      48    |      50    |     357    |     309    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     702    |     601    |
|       from large pool |     100    |     102    |     700    |     600    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     102    |     101    |
|       from large pool |       0    |       1    |     100    |     100    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:37:22 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:37:22 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:37:22 | I | in layer model.layers.0
25-01-14 01:37:22 | I | quantizing weights for layer model.layers.0
25-01-14 01:37:22 | I | collecting info in model.layers.0
25-01-14 01:37:24 | I | collecting info in model.layers.0
25-01-14 01:37:25 | I | collecting info in model.layers.0
25-01-14 01:37:26 | I | collecting info in model.layers.0
25-01-14 01:37:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:37:34 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:37:34 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:37:39 | I |       - range scale = [    1.0000]
25-01-14 01:37:39 | I |         sum  error  = [    0.7027]
25-01-14 01:37:39 | I |         best error  = [    0.7027]
25-01-14 01:37:39 | I |     + error = [0.7027]
25-01-14 01:37:44 | I |       - range scale = [    1.0000]
25-01-14 01:37:44 | I |         sum  error  = [    1.6781]
25-01-14 01:37:44 | I |         best error  = [    1.6781]
25-01-14 01:37:44 | I |     + error = [1.6781]
25-01-14 01:37:45 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:37:50 | I |       - range scale = [    1.0000]
25-01-14 01:37:50 | I |         sum  error  = [    2.7842]
25-01-14 01:37:50 | I |         best error  = [    2.7842]
25-01-14 01:37:50 | I |     + error = [2.7842]
25-01-14 01:37:55 | I |       - range scale = [    1.0000]
25-01-14 01:37:55 | I |         sum  error  = [    3.8633]
25-01-14 01:37:55 | I |         best error  = [    3.8633]
25-01-14 01:37:55 | I |     + error = [3.8633]
25-01-14 01:37:56 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:37:56 | I |       - range scale = [    1.0000]
25-01-14 01:37:56 | I |         sum  error  = [    0.2743]
25-01-14 01:37:56 | I |         best error  = [    0.2743]
25-01-14 01:37:56 | I |     + error = [0.2743]
25-01-14 01:37:57 | I |       - range scale = [    1.0000]
25-01-14 01:37:57 | I |         sum  error  = [    0.3213]
25-01-14 01:37:57 | I |         best error  = [    0.3213]
25-01-14 01:37:57 | I |     + error = [0.3213]
25-01-14 01:37:57 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:37:58 | I |       - range scale = [    1.0000]
25-01-14 01:37:58 | I |         sum  error  = [    0.2019]
25-01-14 01:37:58 | I |         best error  = [    0.2019]
25-01-14 01:37:58 | I |     + error = [0.2019]
25-01-14 01:37:59 | I |       - range scale = [    1.0000]
25-01-14 01:37:59 | I |         sum  error  = [    0.3248]
25-01-14 01:37:59 | I |         best error  = [    0.3248]
25-01-14 01:37:59 | I |     + error = [0.3248]
25-01-14 01:37:59 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:38:00 | I |       - range scale = [    1.0000]
25-01-14 01:38:00 | I |         sum  error  = [    1.3124]
25-01-14 01:38:00 | I |         best error  = [    1.3124]
25-01-14 01:38:00 | I |     + error = [1.3124]
25-01-14 01:38:01 | I |       - range scale = [    1.0000]
25-01-14 01:38:01 | I |         sum  error  = [    1.4713]
25-01-14 01:38:01 | I |         best error  = [    1.4713]
25-01-14 01:38:01 | I |     + error = [1.4713]
25-01-14 01:38:01 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:38:02 | I |       - range scale = [    1.0000]
25-01-14 01:38:02 | I |         sum  error  = [    1.4669]
25-01-14 01:38:02 | I |         best error  = [    1.4669]
25-01-14 01:38:02 | I |     + error = [1.4669]
25-01-14 01:38:03 | I |       - range scale = [    1.0000]
25-01-14 01:38:03 | I |         sum  error  = [    1.6956]
25-01-14 01:38:03 | I |         best error  = [    1.6956]
25-01-14 01:38:03 | I |     + error = [1.6956]
25-01-14 01:38:03 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:38:04 | I |       - range scale = [    1.0000]
25-01-14 01:38:04 | I |         sum  error  = [    0.2223]
25-01-14 01:38:04 | I |         best error  = [    0.2223]
25-01-14 01:38:04 | I |     + error = [0.2223]
25-01-14 01:38:05 | I |       - range scale = [    1.0000]
25-01-14 01:38:05 | I |         sum  error  = [    0.3349]
25-01-14 01:38:05 | I |         best error  = [    0.3349]
25-01-14 01:38:05 | I |     + error = [0.3349]
25-01-14 01:38:05 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:38:07 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:38:10 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:38:12 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:38:15 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:38:17 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:38:20 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:38:26 | I | quantizing activations for layer model.layers.0
25-01-14 01:38:26 | I | collecting info in model.layers.0
25-01-14 01:38:27 | I | collecting info in model.layers.0
25-01-14 01:38:29 | I | collecting info in model.layers.0
25-01-14 01:38:30 | I | collecting info in model.layers.0
25-01-14 01:38:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:33 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:39 | I | forward this layer
25-01-14 01:38:39 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/98.pt
25-01-14 01:38:39 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/98.pt
25-01-14 01:38:39 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:38:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 50           |        cudaMalloc retries: 53        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 131233 GiB | 131211 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 130382 GiB | 130360 GiB |
|       from small pool |      3 MiB |      5 MiB |    851 GiB |    851 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 131233 GiB | 131211 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 130382 GiB | 130360 GiB |
|       from small pool |      3 MiB |      5 MiB |    851 GiB |    851 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 131137 GiB | 131115 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 130289 GiB | 130267 GiB |
|       from small pool |      3 MiB |      5 MiB |    847 GiB |    847 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3504 GiB |   3481 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3500 GiB |   3477 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  69896 GiB |  69896 GiB |
|       from large pool |    943 MiB |   1689 MiB |  68899 GiB |  68898 GiB |
|       from small pool |      0 MiB |      4 MiB |    997 GiB |    997 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   18160 K  |   18159 K  |
|       from large pool |     186    |     223    |    2764 K  |    2764 K  |
|       from small pool |     109    |     111    |   15395 K  |   15395 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   18160 K  |   18159 K  |
|       from large pool |     186    |     223    |    2764 K  |    2764 K  |
|       from small pool |     109    |     111    |   15395 K  |   15395 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    8446    |    8270    |
|       from large pool |     174    |     174    |    6682    |    6508    |
|       from small pool |       2    |       4    |    1764    |    1762    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    7247 K  |    7247 K  |
|       from large pool |      20    |      24    |     856 K  |     856 K  |
|       from small pool |       8    |      16    |    6390 K  |    6390 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:38:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  24103 MiB |  17155 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23950 MiB |  17002 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  24103 MiB |  17155 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23950 MiB |  17002 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  23797 MiB |  16849 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  23644 MiB |  16696 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  25720 MiB |  18770 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25716 MiB |  18768 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2196 MiB |   2195 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2040 MiB |   2040 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    156 MiB |    155 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1210    |    1030    |
|       from large pool |     126    |     128    |     840    |     714    |
|       from small pool |      54    |      56    |     370    |     316    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1210    |    1030    |
|       from large pool |     126    |     128    |     840    |     714    |
|       from small pool |      54    |      56    |     370    |     316    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     740    |     613    |
|       from large pool |     126    |     128    |     738    |     612    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     104    |     103    |
|       from large pool |       0    |       1    |     102    |     102    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:38:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  24103 MiB |  17155 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23950 MiB |  17002 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  24103 MiB |  17155 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  23950 MiB |  17002 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  23797 MiB |  16849 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  23644 MiB |  16696 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  25720 MiB |  18770 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25716 MiB |  18768 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2196 MiB |   2195 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2040 MiB |   2040 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    156 MiB |    155 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1210    |    1030    |
|       from large pool |     126    |     128    |     840    |     714    |
|       from small pool |      54    |      56    |     370    |     316    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1210    |    1030    |
|       from large pool |     126    |     128    |     840    |     714    |
|       from small pool |      54    |      56    |     370    |     316    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     740    |     613    |
|       from large pool |     126    |     128    |     738    |     612    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     104    |     103    |
|       from large pool |       0    |       1    |     102    |     102    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:38:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  23059 MiB |  17155 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22906 MiB |  17002 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  23059 MiB |  17155 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  22906 MiB |  17002 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  22753 MiB |  16849 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  22600 MiB |  16696 MiB |
|       from small pool |      0 MiB |      1 MiB |    153 MiB |    153 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  24676 MiB |  18770 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24672 MiB |  18768 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2196 MiB |   2195 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2040 MiB |   2040 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    156 MiB |    155 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1177    |    1029    |
|       from large pool |     100    |     102    |     814    |     714    |
|       from small pool |      48    |      50    |     363    |     315    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1177    |    1029    |
|       from large pool |     100    |     102    |     814    |     714    |
|       from small pool |      48    |      50    |     363    |     315    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     714    |     613    |
|       from large pool |     100    |     102    |     712    |     612    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     104    |     103    |
|       from large pool |       0    |       1    |     102    |     102    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:38:39 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:38:40 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:38:40 | I | in layer model.layers.0
25-01-14 01:38:40 | I | quantizing weights for layer model.layers.0
25-01-14 01:38:40 | I | collecting info in model.layers.0
25-01-14 01:38:41 | I | collecting info in model.layers.0
25-01-14 01:38:42 | I | collecting info in model.layers.0
25-01-14 01:38:43 | I | collecting info in model.layers.0
25-01-14 01:38:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:38:51 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:38:51 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:38:57 | I |       - range scale = [    1.0000]
25-01-14 01:38:57 | I |         sum  error  = [    0.7187]
25-01-14 01:38:57 | I |         best error  = [    0.7187]
25-01-14 01:38:57 | I |     + error = [0.7187]
25-01-14 01:39:02 | I |       - range scale = [    1.0000]
25-01-14 01:39:02 | I |         sum  error  = [    1.6935]
25-01-14 01:39:02 | I |         best error  = [    1.6935]
25-01-14 01:39:02 | I |     + error = [1.6935]
25-01-14 01:39:02 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:39:08 | I |       - range scale = [    1.0000]
25-01-14 01:39:08 | I |         sum  error  = [    2.7107]
25-01-14 01:39:08 | I |         best error  = [    2.7107]
25-01-14 01:39:08 | I |     + error = [2.7107]
25-01-14 01:39:13 | I |       - range scale = [    1.0000]
25-01-14 01:39:13 | I |         sum  error  = [    3.9216]
25-01-14 01:39:13 | I |         best error  = [    3.9216]
25-01-14 01:39:13 | I |     + error = [3.9216]
25-01-14 01:39:13 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:39:14 | I |       - range scale = [    1.0000]
25-01-14 01:39:14 | I |         sum  error  = [    0.2773]
25-01-14 01:39:14 | I |         best error  = [    0.2773]
25-01-14 01:39:14 | I |     + error = [0.2773]
25-01-14 01:39:15 | I |       - range scale = [    1.0000]
25-01-14 01:39:15 | I |         sum  error  = [    0.3275]
25-01-14 01:39:15 | I |         best error  = [    0.3275]
25-01-14 01:39:15 | I |     + error = [0.3275]
25-01-14 01:39:15 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:39:16 | I |       - range scale = [    1.0000]
25-01-14 01:39:16 | I |         sum  error  = [    0.2065]
25-01-14 01:39:16 | I |         best error  = [    0.2065]
25-01-14 01:39:16 | I |     + error = [0.2065]
25-01-14 01:39:17 | I |       - range scale = [    1.0000]
25-01-14 01:39:17 | I |         sum  error  = [    0.3345]
25-01-14 01:39:17 | I |         best error  = [    0.3345]
25-01-14 01:39:17 | I |     + error = [0.3345]
25-01-14 01:39:17 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:39:17 | I |       - range scale = [    1.0000]
25-01-14 01:39:17 | I |         sum  error  = [    1.2798]
25-01-14 01:39:17 | I |         best error  = [    1.2798]
25-01-14 01:39:17 | I |     + error = [1.2798]
25-01-14 01:39:19 | I |       - range scale = [    1.0000]
25-01-14 01:39:19 | I |         sum  error  = [    1.4604]
25-01-14 01:39:19 | I |         best error  = [    1.4604]
25-01-14 01:39:19 | I |     + error = [1.4604]
25-01-14 01:39:19 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:39:19 | I |       - range scale = [    1.0000]
25-01-14 01:39:19 | I |         sum  error  = [    1.4357]
25-01-14 01:39:19 | I |         best error  = [    1.4357]
25-01-14 01:39:19 | I |     + error = [1.4357]
25-01-14 01:39:21 | I |       - range scale = [    1.0000]
25-01-14 01:39:21 | I |         sum  error  = [    1.6722]
25-01-14 01:39:21 | I |         best error  = [    1.6722]
25-01-14 01:39:21 | I |     + error = [1.6722]
25-01-14 01:39:21 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:39:21 | I |       - range scale = [    1.0000]
25-01-14 01:39:21 | I |         sum  error  = [    0.2264]
25-01-14 01:39:21 | I |         best error  = [    0.2264]
25-01-14 01:39:21 | I |     + error = [0.2264]
25-01-14 01:39:23 | I |       - range scale = [    1.0000]
25-01-14 01:39:23 | I |         sum  error  = [    0.3351]
25-01-14 01:39:23 | I |         best error  = [    0.3351]
25-01-14 01:39:23 | I |     + error = [0.3351]
25-01-14 01:39:23 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:39:25 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:39:28 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:39:30 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:39:32 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:39:35 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:39:37 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:39:44 | I | quantizing activations for layer model.layers.0
25-01-14 01:39:44 | I | collecting info in model.layers.0
25-01-14 01:39:45 | I | collecting info in model.layers.0
25-01-14 01:39:46 | I | collecting info in model.layers.0
25-01-14 01:39:47 | I | collecting info in model.layers.0
25-01-14 01:39:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:39:51 | I | collecting calibration activations in model.layers.0
25-01-14 01:39:52 | I | collecting calibration activations in model.layers.0
25-01-14 01:39:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:39:57 | I | forward this layer
25-01-14 01:39:57 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/100.pt
25-01-14 01:39:57 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/100.pt
25-01-14 01:39:57 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:39:57 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 51           |        cudaMalloc retries: 54        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 136023 GiB | 136001 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 135148 GiB | 135125 GiB |
|       from small pool |      3 MiB |      5 MiB |    875 GiB |    875 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 136023 GiB | 136001 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 135148 GiB | 135125 GiB |
|       from small pool |      3 MiB |      5 MiB |    875 GiB |    875 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 135926 GiB | 135904 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 135053 GiB | 135031 GiB |
|       from small pool |      3 MiB |      5 MiB |    872 GiB |    872 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3572 GiB |   3548 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3568 GiB |   3545 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  72595 GiB |  72594 GiB |
|       from large pool |    943 MiB |   1689 MiB |  71568 GiB |  71567 GiB |
|       from small pool |      0 MiB |      4 MiB |   1026 GiB |   1026 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   18703 K  |   18703 K  |
|       from large pool |     186    |     223    |    2852 K  |    2851 K  |
|       from small pool |     109    |     111    |   15851 K  |   15851 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   18703 K  |   18703 K  |
|       from large pool |     186    |     223    |    2852 K  |    2851 K  |
|       from small pool |     109    |     111    |   15851 K  |   15851 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    8604    |    8428    |
|       from large pool |     174    |     174    |    6805    |    6631    |
|       from small pool |       2    |       4    |    1799    |    1797    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    7450 K  |    7450 K  |
|       from large pool |      21    |      24    |     880 K  |     880 K  |
|       from small pool |       8    |      16    |    6569 K  |    6569 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:39:57 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  24439 MiB |  17491 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24283 MiB |  17335 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  24439 MiB |  17491 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24283 MiB |  17335 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  24127 MiB |  17179 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  23971 MiB |  17023 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  26088 MiB |  19138 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26084 MiB |  19136 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2239 MiB |   2238 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2080 MiB |   2080 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    159 MiB |    158 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1230    |    1050    |
|       from large pool |     126    |     128    |     854    |     728    |
|       from small pool |      54    |      56    |     376    |     322    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1230    |    1050    |
|       from large pool |     126    |     128    |     854    |     728    |
|       from small pool |      54    |      56    |     376    |     322    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     752    |     625    |
|       from large pool |     126    |     128    |     750    |     624    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     106    |     105    |
|       from large pool |       0    |       1    |     104    |     104    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:39:57 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  24439 MiB |  17491 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24283 MiB |  17335 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  24439 MiB |  17491 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24283 MiB |  17335 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  24127 MiB |  17179 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  23971 MiB |  17023 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  26088 MiB |  19138 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26084 MiB |  19136 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2239 MiB |   2238 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2080 MiB |   2080 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    159 MiB |    158 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1230    |    1050    |
|       from large pool |     126    |     128    |     854    |     728    |
|       from small pool |      54    |      56    |     376    |     322    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1230    |    1050    |
|       from large pool |     126    |     128    |     854    |     728    |
|       from small pool |      54    |      56    |     376    |     322    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     752    |     625    |
|       from large pool |     126    |     128    |     750    |     624    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     106    |     105    |
|       from large pool |       0    |       1    |     104    |     104    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:39:57 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  23395 MiB |  17491 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23239 MiB |  17335 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  23395 MiB |  17491 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23239 MiB |  17335 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  23083 MiB |  17179 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  22927 MiB |  17023 MiB |
|       from small pool |      0 MiB |      1 MiB |    156 MiB |    156 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  25044 MiB |  19138 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25040 MiB |  19136 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2239 MiB |   2238 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2080 MiB |   2080 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    159 MiB |    158 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1197    |    1049    |
|       from large pool |     100    |     102    |     828    |     728    |
|       from small pool |      48    |      50    |     369    |     321    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1197    |    1049    |
|       from large pool |     100    |     102    |     828    |     728    |
|       from small pool |      48    |      50    |     369    |     321    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     726    |     625    |
|       from large pool |     100    |     102    |     724    |     624    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     106    |     105    |
|       from large pool |       0    |       1    |     104    |     104    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:39:57 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:39:57 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:39:57 | I | in layer model.layers.0
25-01-14 01:39:57 | I | quantizing weights for layer model.layers.0
25-01-14 01:39:57 | I | collecting info in model.layers.0
25-01-14 01:39:59 | I | collecting info in model.layers.0
25-01-14 01:40:00 | I | collecting info in model.layers.0
25-01-14 01:40:01 | I | collecting info in model.layers.0
25-01-14 01:40:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:40:05 | I | collecting calibration activations in model.layers.0
25-01-14 01:40:06 | I | collecting calibration activations in model.layers.0
25-01-14 01:40:07 | I | collecting calibration activations in model.layers.0
25-01-14 01:40:09 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:40:09 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:40:15 | I |       - range scale = [    1.0000]
25-01-14 01:40:15 | I |         sum  error  = [    0.7352]
25-01-14 01:40:15 | I |         best error  = [    0.7352]
25-01-14 01:40:15 | I |     + error = [0.7352]
25-01-14 01:40:20 | I |       - range scale = [    1.0000]
25-01-14 01:40:20 | I |         sum  error  = [    1.7393]
25-01-14 01:40:20 | I |         best error  = [    1.7393]
25-01-14 01:40:20 | I |     + error = [1.7393]
25-01-14 01:40:20 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:40:26 | I |       - range scale = [    1.0000]
25-01-14 01:40:26 | I |         sum  error  = [    2.8436]
25-01-14 01:40:26 | I |         best error  = [    2.8436]
25-01-14 01:40:26 | I |     + error = [2.8436]
25-01-14 01:40:31 | I |       - range scale = [    1.0000]
25-01-14 01:40:31 | I |         sum  error  = [    4.1600]
25-01-14 01:40:31 | I |         best error  = [    4.1600]
25-01-14 01:40:31 | I |     + error = [4.1600]
25-01-14 01:40:32 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:40:32 | I |       - range scale = [    1.0000]
25-01-14 01:40:32 | I |         sum  error  = [    0.2767]
25-01-14 01:40:32 | I |         best error  = [    0.2767]
25-01-14 01:40:32 | I |     + error = [0.2767]
25-01-14 01:40:33 | I |       - range scale = [    1.0000]
25-01-14 01:40:33 | I |         sum  error  = [    0.3286]
25-01-14 01:40:33 | I |         best error  = [    0.3286]
25-01-14 01:40:33 | I |     + error = [0.3286]
25-01-14 01:40:33 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:40:34 | I |       - range scale = [    1.0000]
25-01-14 01:40:34 | I |         sum  error  = [    0.2063]
25-01-14 01:40:34 | I |         best error  = [    0.2063]
25-01-14 01:40:34 | I |     + error = [0.2063]
25-01-14 01:40:35 | I |       - range scale = [    1.0000]
25-01-14 01:40:35 | I |         sum  error  = [    0.3379]
25-01-14 01:40:35 | I |         best error  = [    0.3379]
25-01-14 01:40:35 | I |     + error = [0.3379]
25-01-14 01:40:35 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:40:36 | I |       - range scale = [    1.0000]
25-01-14 01:40:36 | I |         sum  error  = [    1.3062]
25-01-14 01:40:36 | I |         best error  = [    1.3062]
25-01-14 01:40:36 | I |     + error = [1.3062]
25-01-14 01:40:37 | I |       - range scale = [    1.0000]
25-01-14 01:40:37 | I |         sum  error  = [    1.4583]
25-01-14 01:40:37 | I |         best error  = [    1.4583]
25-01-14 01:40:37 | I |     + error = [1.4583]
25-01-14 01:40:37 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:40:38 | I |       - range scale = [    1.0000]
25-01-14 01:40:38 | I |         sum  error  = [    1.4621]
25-01-14 01:40:38 | I |         best error  = [    1.4621]
25-01-14 01:40:38 | I |     + error = [1.4621]
25-01-14 01:40:39 | I |       - range scale = [    1.0000]
25-01-14 01:40:39 | I |         sum  error  = [    1.6751]
25-01-14 01:40:39 | I |         best error  = [    1.6751]
25-01-14 01:40:39 | I |     + error = [1.6751]
25-01-14 01:40:39 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:40:40 | I |       - range scale = [    1.0000]
25-01-14 01:40:40 | I |         sum  error  = [    0.2302]
25-01-14 01:40:40 | I |         best error  = [    0.2302]
25-01-14 01:40:40 | I |     + error = [0.2302]
25-01-14 01:40:41 | I |       - range scale = [    1.0000]
25-01-14 01:40:41 | I |         sum  error  = [    0.3477]
25-01-14 01:40:41 | I |         best error  = [    0.3477]
25-01-14 01:40:41 | I |     + error = [0.3477]
25-01-14 01:40:41 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:40:44 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:40:46 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:40:48 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:40:51 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:40:53 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:40:56 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:41:02 | I | quantizing activations for layer model.layers.0
25-01-14 01:41:02 | I | collecting info in model.layers.0
25-01-14 01:41:03 | I | collecting info in model.layers.0
25-01-14 01:41:05 | I | collecting info in model.layers.0
25-01-14 01:41:06 | I | collecting info in model.layers.0
25-01-14 01:41:08 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:09 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:15 | I | forward this layer
25-01-14 01:41:15 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/102.pt
25-01-14 01:41:15 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/102.pt
25-01-14 01:41:16 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:41:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 52           |        cudaMalloc retries: 55        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 140899 GiB | 140877 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 139998 GiB | 139976 GiB |
|       from small pool |      3 MiB |      5 MiB |    900 GiB |    900 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 140899 GiB | 140877 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 139998 GiB | 139976 GiB |
|       from small pool |      3 MiB |      5 MiB |    900 GiB |    900 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 140800 GiB | 140778 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 139903 GiB | 139881 GiB |
|       from small pool |      3 MiB |      5 MiB |    897 GiB |    897 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3641 GiB |   3617 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3637 GiB |   3614 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  75309 GiB |  75308 GiB |
|       from large pool |    943 MiB |   1689 MiB |  74253 GiB |  74252 GiB |
|       from small pool |      0 MiB |      4 MiB |   1056 GiB |   1056 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   19253 K  |   19253 K  |
|       from large pool |     186    |     223    |    2940 K  |    2940 K  |
|       from small pool |     109    |     111    |   16312 K  |   16312 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   19253 K  |   19253 K  |
|       from large pool |     186    |     223    |    2940 K  |    2940 K  |
|       from small pool |     109    |     111    |   16312 K  |   16312 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    8768    |    8592    |
|       from large pool |     174    |     174    |    6934    |    6760    |
|       from small pool |       2    |       4    |    1834    |    1832    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    7656 K  |    7656 K  |
|       from large pool |      20    |      24    |     904 K  |     904 K  |
|       from small pool |       8    |      16    |    6751 K  |    6751 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:41:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  24776 MiB |  17827 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24616 MiB |  17668 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  24776 MiB |  17827 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24616 MiB |  17668 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  24458 MiB |  17509 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  24298 MiB |  17350 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  26456 MiB |  19506 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26452 MiB |  19504 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2282 MiB |   2281 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2120 MiB |   2120 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    162 MiB |    161 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1250    |    1070    |
|       from large pool |     126    |     128    |     868    |     742    |
|       from small pool |      54    |      56    |     382    |     328    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1250    |    1070    |
|       from large pool |     126    |     128    |     868    |     742    |
|       from small pool |      54    |      56    |     382    |     328    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     764    |     637    |
|       from large pool |     126    |     128    |     762    |     636    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     108    |     107    |
|       from large pool |       0    |       1    |     106    |     106    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:41:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  24776 MiB |  17827 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24616 MiB |  17668 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  24776 MiB |  17827 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24616 MiB |  17668 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  24458 MiB |  17509 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  24298 MiB |  17350 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  26456 MiB |  19506 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26452 MiB |  19504 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2282 MiB |   2281 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2120 MiB |   2120 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    162 MiB |    161 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1250    |    1070    |
|       from large pool |     126    |     128    |     868    |     742    |
|       from small pool |      54    |      56    |     382    |     328    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1250    |    1070    |
|       from large pool |     126    |     128    |     868    |     742    |
|       from small pool |      54    |      56    |     382    |     328    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     764    |     637    |
|       from large pool |     126    |     128    |     762    |     636    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     108    |     107    |
|       from large pool |       0    |       1    |     106    |     106    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:41:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  23732 MiB |  17827 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23572 MiB |  17668 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  23732 MiB |  17827 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23572 MiB |  17668 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  23414 MiB |  17509 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  23254 MiB |  17350 MiB |
|       from small pool |      0 MiB |      1 MiB |    159 MiB |    159 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  25412 MiB |  19506 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25408 MiB |  19504 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2282 MiB |   2281 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2120 MiB |   2120 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    162 MiB |    161 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1217    |    1069    |
|       from large pool |     100    |     102    |     842    |     742    |
|       from small pool |      48    |      50    |     375    |     327    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1217    |    1069    |
|       from large pool |     100    |     102    |     842    |     742    |
|       from small pool |      48    |      50    |     375    |     327    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     738    |     637    |
|       from large pool |     100    |     102    |     736    |     636    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     108    |     107    |
|       from large pool |       0    |       1    |     106    |     106    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:41:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:41:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:41:16 | I | in layer model.layers.0
25-01-14 01:41:16 | I | quantizing weights for layer model.layers.0
25-01-14 01:41:16 | I | collecting info in model.layers.0
25-01-14 01:41:17 | I | collecting info in model.layers.0
25-01-14 01:41:19 | I | collecting info in model.layers.0
25-01-14 01:41:20 | I | collecting info in model.layers.0
25-01-14 01:41:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:23 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:25 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:41:28 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:41:28 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:41:33 | I |       - range scale = [    1.0000]
25-01-14 01:41:33 | I |         sum  error  = [    0.7483]
25-01-14 01:41:33 | I |         best error  = [    0.7483]
25-01-14 01:41:33 | I |     + error = [0.7483]
25-01-14 01:41:39 | I |       - range scale = [    1.0000]
25-01-14 01:41:39 | I |         sum  error  = [    1.7767]
25-01-14 01:41:39 | I |         best error  = [    1.7767]
25-01-14 01:41:39 | I |     + error = [1.7767]
25-01-14 01:41:39 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:41:45 | I |       - range scale = [    1.0000]
25-01-14 01:41:45 | I |         sum  error  = [    2.8825]
25-01-14 01:41:45 | I |         best error  = [    2.8825]
25-01-14 01:41:45 | I |     + error = [2.8825]
25-01-14 01:41:51 | I |       - range scale = [    1.0000]
25-01-14 01:41:51 | I |         sum  error  = [    4.3599]
25-01-14 01:41:51 | I |         best error  = [    4.3599]
25-01-14 01:41:51 | I |     + error = [4.3599]
25-01-14 01:41:51 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:41:52 | I |       - range scale = [    1.0000]
25-01-14 01:41:52 | I |         sum  error  = [    0.2790]
25-01-14 01:41:52 | I |         best error  = [    0.2790]
25-01-14 01:41:52 | I |     + error = [0.2790]
25-01-14 01:41:52 | I |       - range scale = [    1.0000]
25-01-14 01:41:52 | I |         sum  error  = [    0.3348]
25-01-14 01:41:52 | I |         best error  = [    0.3348]
25-01-14 01:41:52 | I |     + error = [0.3348]
25-01-14 01:41:53 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:41:53 | I |       - range scale = [    1.0000]
25-01-14 01:41:53 | I |         sum  error  = [    0.2068]
25-01-14 01:41:53 | I |         best error  = [    0.2068]
25-01-14 01:41:53 | I |     + error = [0.2068]
25-01-14 01:41:54 | I |       - range scale = [    1.0000]
25-01-14 01:41:54 | I |         sum  error  = [    0.3379]
25-01-14 01:41:54 | I |         best error  = [    0.3379]
25-01-14 01:41:54 | I |     + error = [0.3379]
25-01-14 01:41:54 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:41:55 | I |       - range scale = [    1.0000]
25-01-14 01:41:55 | I |         sum  error  = [    1.3133]
25-01-14 01:41:55 | I |         best error  = [    1.3133]
25-01-14 01:41:55 | I |     + error = [1.3133]
25-01-14 01:41:56 | I |       - range scale = [    1.0000]
25-01-14 01:41:56 | I |         sum  error  = [    1.4744]
25-01-14 01:41:56 | I |         best error  = [    1.4744]
25-01-14 01:41:56 | I |     + error = [1.4744]
25-01-14 01:41:56 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:41:57 | I |       - range scale = [    1.0000]
25-01-14 01:41:57 | I |         sum  error  = [    1.4678]
25-01-14 01:41:57 | I |         best error  = [    1.4678]
25-01-14 01:41:57 | I |     + error = [1.4678]
25-01-14 01:41:58 | I |       - range scale = [    1.0000]
25-01-14 01:41:58 | I |         sum  error  = [    1.7406]
25-01-14 01:41:58 | I |         best error  = [    1.7406]
25-01-14 01:41:58 | I |     + error = [1.7406]
25-01-14 01:41:58 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:41:59 | I |       - range scale = [    1.0000]
25-01-14 01:41:59 | I |         sum  error  = [    0.2323]
25-01-14 01:41:59 | I |         best error  = [    0.2323]
25-01-14 01:41:59 | I |     + error = [0.2323]
25-01-14 01:42:00 | I |       - range scale = [    1.0000]
25-01-14 01:42:00 | I |         sum  error  = [    0.3375]
25-01-14 01:42:00 | I |         best error  = [    0.3375]
25-01-14 01:42:00 | I |     + error = [0.3375]
25-01-14 01:42:00 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:42:03 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:42:05 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:42:08 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:42:10 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:42:13 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:42:15 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:42:22 | I | quantizing activations for layer model.layers.0
25-01-14 01:42:22 | I | collecting info in model.layers.0
25-01-14 01:42:23 | I | collecting info in model.layers.0
25-01-14 01:42:24 | I | collecting info in model.layers.0
25-01-14 01:42:26 | I | collecting info in model.layers.0
25-01-14 01:42:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:35 | I | forward this layer
25-01-14 01:42:35 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/104.pt
25-01-14 01:42:35 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/104.pt
25-01-14 01:42:36 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:42:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 53           |        cudaMalloc retries: 56        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 145860 GiB | 145838 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 144934 GiB | 144912 GiB |
|       from small pool |      3 MiB |      5 MiB |    925 GiB |    925 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 145860 GiB | 145838 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 144934 GiB | 144912 GiB |
|       from small pool |      3 MiB |      5 MiB |    925 GiB |    925 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 145760 GiB | 145737 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 144837 GiB | 144815 GiB |
|       from small pool |      3 MiB |      5 MiB |    922 GiB |    922 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3708 GiB |   3685 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3705 GiB |   3682 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  78110 GiB |  78109 GiB |
|       from large pool |    943 MiB |   1689 MiB |  77023 GiB |  77023 GiB |
|       from small pool |      0 MiB |      4 MiB |   1086 GiB |   1086 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   19811 K  |   19810 K  |
|       from large pool |     186    |     223    |    3030 K  |    3030 K  |
|       from small pool |     109    |     111    |   16780 K  |   16780 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   19811 K  |   19810 K  |
|       from large pool |     186    |     223    |    3030 K  |    3030 K  |
|       from small pool |     109    |     111    |   16780 K  |   16780 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    8926    |    8750    |
|       from large pool |     174    |     174    |    7057    |    6883    |
|       from small pool |       2    |       4    |    1869    |    1867    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    7865 K  |    7865 K  |
|       from large pool |      21    |      24    |     930 K  |     930 K  |
|       from small pool |       8    |      16    |    6935 K  |    6935 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:42:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  25112 MiB |  18164 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24950 MiB |  18002 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  25112 MiB |  18164 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24950 MiB |  18002 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  24788 MiB |  17840 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  24626 MiB |  17678 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  26824 MiB |  19874 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26820 MiB |  19872 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2325 MiB |   2324 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2160 MiB |   2160 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    165 MiB |    164 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1270    |    1090    |
|       from large pool |     126    |     128    |     882    |     756    |
|       from small pool |      54    |      56    |     388    |     334    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1270    |    1090    |
|       from large pool |     126    |     128    |     882    |     756    |
|       from small pool |      54    |      56    |     388    |     334    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     776    |     649    |
|       from large pool |     126    |     128    |     774    |     648    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     110    |     109    |
|       from large pool |       0    |       1    |     108    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:42:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  25112 MiB |  18164 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24950 MiB |  18002 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  25112 MiB |  18164 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  24950 MiB |  18002 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  24788 MiB |  17840 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  24626 MiB |  17678 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  26824 MiB |  19874 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26820 MiB |  19872 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2325 MiB |   2324 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2160 MiB |   2160 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    165 MiB |    164 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1270    |    1090    |
|       from large pool |     126    |     128    |     882    |     756    |
|       from small pool |      54    |      56    |     388    |     334    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1270    |    1090    |
|       from large pool |     126    |     128    |     882    |     756    |
|       from small pool |      54    |      56    |     388    |     334    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     776    |     649    |
|       from large pool |     126    |     128    |     774    |     648    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     110    |     109    |
|       from large pool |       0    |       1    |     108    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:42:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  24068 MiB |  18164 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23906 MiB |  18002 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  24068 MiB |  18164 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  23906 MiB |  18002 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  23744 MiB |  17840 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  23582 MiB |  17678 MiB |
|       from small pool |      0 MiB |      1 MiB |    162 MiB |    162 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  25780 MiB |  19874 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25776 MiB |  19872 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2325 MiB |   2324 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2160 MiB |   2160 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    165 MiB |    164 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1237    |    1089    |
|       from large pool |     100    |     102    |     856    |     756    |
|       from small pool |      48    |      50    |     381    |     333    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1237    |    1089    |
|       from large pool |     100    |     102    |     856    |     756    |
|       from small pool |      48    |      50    |     381    |     333    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     750    |     649    |
|       from large pool |     100    |     102    |     748    |     648    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     110    |     109    |
|       from large pool |       0    |       1    |     108    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:42:36 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:42:36 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:42:36 | I | in layer model.layers.0
25-01-14 01:42:36 | I | quantizing weights for layer model.layers.0
25-01-14 01:42:36 | I | collecting info in model.layers.0
25-01-14 01:42:37 | I | collecting info in model.layers.0
25-01-14 01:42:39 | I | collecting info in model.layers.0
25-01-14 01:42:40 | I | collecting info in model.layers.0
25-01-14 01:42:42 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:43 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:42:48 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:42:48 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:42:54 | I |       - range scale = [    1.0000]
25-01-14 01:42:54 | I |         sum  error  = [    0.7717]
25-01-14 01:42:54 | I |         best error  = [    0.7717]
25-01-14 01:42:54 | I |     + error = [0.7717]
25-01-14 01:43:00 | I |       - range scale = [    1.0000]
25-01-14 01:43:00 | I |         sum  error  = [    1.7774]
25-01-14 01:43:00 | I |         best error  = [    1.7774]
25-01-14 01:43:00 | I |     + error = [1.7774]
25-01-14 01:43:00 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:43:05 | I |       - range scale = [    1.0000]
25-01-14 01:43:05 | I |         sum  error  = [    3.1303]
25-01-14 01:43:05 | I |         best error  = [    3.1303]
25-01-14 01:43:05 | I |     + error = [3.1303]
25-01-14 01:43:11 | I |       - range scale = [    1.0000]
25-01-14 01:43:11 | I |         sum  error  = [    4.2855]
25-01-14 01:43:11 | I |         best error  = [    4.2855]
25-01-14 01:43:11 | I |     + error = [4.2855]
25-01-14 01:43:12 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:43:12 | I |       - range scale = [    1.0000]
25-01-14 01:43:12 | I |         sum  error  = [    0.2780]
25-01-14 01:43:12 | I |         best error  = [    0.2780]
25-01-14 01:43:12 | I |     + error = [0.2780]
25-01-14 01:43:13 | I |       - range scale = [    1.0000]
25-01-14 01:43:13 | I |         sum  error  = [    0.3288]
25-01-14 01:43:13 | I |         best error  = [    0.3288]
25-01-14 01:43:13 | I |     + error = [0.3288]
25-01-14 01:43:13 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:43:14 | I |       - range scale = [    1.0000]
25-01-14 01:43:14 | I |         sum  error  = [    0.2217]
25-01-14 01:43:14 | I |         best error  = [    0.2217]
25-01-14 01:43:14 | I |     + error = [0.2217]
25-01-14 01:43:15 | I |       - range scale = [    1.0000]
25-01-14 01:43:15 | I |         sum  error  = [    0.3438]
25-01-14 01:43:15 | I |         best error  = [    0.3438]
25-01-14 01:43:15 | I |     + error = [0.3438]
25-01-14 01:43:15 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:43:16 | I |       - range scale = [    1.0000]
25-01-14 01:43:16 | I |         sum  error  = [    1.3400]
25-01-14 01:43:16 | I |         best error  = [    1.3400]
25-01-14 01:43:16 | I |     + error = [1.3400]
25-01-14 01:43:17 | I |       - range scale = [    1.0000]
25-01-14 01:43:17 | I |         sum  error  = [    1.4993]
25-01-14 01:43:17 | I |         best error  = [    1.4993]
25-01-14 01:43:17 | I |     + error = [1.4993]
25-01-14 01:43:17 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:43:18 | I |       - range scale = [    1.0000]
25-01-14 01:43:18 | I |         sum  error  = [    1.4866]
25-01-14 01:43:18 | I |         best error  = [    1.4866]
25-01-14 01:43:18 | I |     + error = [1.4866]
25-01-14 01:43:19 | I |       - range scale = [    1.0000]
25-01-14 01:43:19 | I |         sum  error  = [    1.7130]
25-01-14 01:43:19 | I |         best error  = [    1.7130]
25-01-14 01:43:19 | I |     + error = [1.7130]
25-01-14 01:43:19 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:43:20 | I |       - range scale = [    1.0000]
25-01-14 01:43:20 | I |         sum  error  = [    0.2286]
25-01-14 01:43:20 | I |         best error  = [    0.2286]
25-01-14 01:43:20 | I |     + error = [0.2286]
25-01-14 01:43:21 | I |       - range scale = [    1.0000]
25-01-14 01:43:21 | I |         sum  error  = [    0.3346]
25-01-14 01:43:21 | I |         best error  = [    0.3346]
25-01-14 01:43:21 | I |     + error = [0.3346]
25-01-14 01:43:21 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:43:24 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:43:26 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:43:29 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:43:31 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:43:34 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:43:36 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:43:43 | I | quantizing activations for layer model.layers.0
25-01-14 01:43:43 | I | collecting info in model.layers.0
25-01-14 01:43:44 | I | collecting info in model.layers.0
25-01-14 01:43:45 | I | collecting info in model.layers.0
25-01-14 01:43:47 | I | collecting info in model.layers.0
25-01-14 01:43:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:43:50 | I | collecting calibration activations in model.layers.0
25-01-14 01:43:51 | I | collecting calibration activations in model.layers.0
25-01-14 01:43:53 | I | collecting calibration activations in model.layers.0
25-01-14 01:43:56 | I | forward this layer
25-01-14 01:43:56 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/106.pt
25-01-14 01:43:56 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/106.pt
25-01-14 01:43:56 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:43:56 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 54           |        cudaMalloc retries: 57        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 150907 GiB | 150885 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 149956 GiB | 149933 GiB |
|       from small pool |      3 MiB |      5 MiB |    951 GiB |    951 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 150907 GiB | 150885 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 149956 GiB | 149933 GiB |
|       from small pool |      3 MiB |      5 MiB |    951 GiB |    951 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 150804 GiB | 150782 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 149856 GiB | 149834 GiB |
|       from small pool |      3 MiB |      5 MiB |    947 GiB |    947 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3777 GiB |   3754 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3774 GiB |   3751 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  80924 GiB |  80923 GiB |
|       from large pool |    943 MiB |   1689 MiB |  79808 GiB |  79807 GiB |
|       from small pool |      0 MiB |      4 MiB |   1116 GiB |   1116 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   20375 K  |   20375 K  |
|       from large pool |     186    |     223    |    3122 K  |    3121 K  |
|       from small pool |     109    |     111    |   17253 K  |   17253 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   20375 K  |   20375 K  |
|       from large pool |     186    |     223    |    3122 K  |    3121 K  |
|       from small pool |     109    |     111    |   17253 K  |   17253 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    9090    |    8914    |
|       from large pool |     174    |     174    |    7186    |    7012    |
|       from small pool |       2    |       4    |    1904    |    1902    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    8076 K  |    8076 K  |
|       from large pool |      20    |      24    |     955 K  |     955 K  |
|       from small pool |       8    |      16    |    7121 K  |    7121 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:43:56 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  25448 MiB |  18500 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25283 MiB |  18335 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  25448 MiB |  18500 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25283 MiB |  18335 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  25118 MiB |  18170 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  24953 MiB |  18005 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  27192 MiB |  20242 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27188 MiB |  20240 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2368 MiB |   2367 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2200 MiB |   2200 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    168 MiB |    167 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1290    |    1110    |
|       from large pool |     126    |     128    |     896    |     770    |
|       from small pool |      54    |      56    |     394    |     340    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1290    |    1110    |
|       from large pool |     126    |     128    |     896    |     770    |
|       from small pool |      54    |      56    |     394    |     340    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     788    |     661    |
|       from large pool |     126    |     128    |     786    |     660    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     112    |     111    |
|       from large pool |       0    |       1    |     110    |     110    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:43:56 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  25448 MiB |  18500 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25283 MiB |  18335 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  25448 MiB |  18500 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25283 MiB |  18335 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  25118 MiB |  18170 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  24953 MiB |  18005 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  27192 MiB |  20242 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27188 MiB |  20240 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2368 MiB |   2367 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2200 MiB |   2200 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    168 MiB |    167 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1290    |    1110    |
|       from large pool |     126    |     128    |     896    |     770    |
|       from small pool |      54    |      56    |     394    |     340    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1290    |    1110    |
|       from large pool |     126    |     128    |     896    |     770    |
|       from small pool |      54    |      56    |     394    |     340    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     788    |     661    |
|       from large pool |     126    |     128    |     786    |     660    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     112    |     111    |
|       from large pool |       0    |       1    |     110    |     110    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:43:56 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  24405 MiB |  18500 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24239 MiB |  18335 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  24405 MiB |  18500 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24239 MiB |  18335 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  24075 MiB |  18170 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  23909 MiB |  18005 MiB |
|       from small pool |      0 MiB |      1 MiB |    165 MiB |    165 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  26148 MiB |  20242 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26144 MiB |  20240 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2368 MiB |   2367 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2200 MiB |   2200 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    168 MiB |    167 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1257    |    1109    |
|       from large pool |     100    |     102    |     870    |     770    |
|       from small pool |      48    |      50    |     387    |     339    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1257    |    1109    |
|       from large pool |     100    |     102    |     870    |     770    |
|       from small pool |      48    |      50    |     387    |     339    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     762    |     661    |
|       from large pool |     100    |     102    |     760    |     660    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     112    |     111    |
|       from large pool |       0    |       1    |     110    |     110    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:43:56 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:43:57 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:43:57 | I | in layer model.layers.0
25-01-14 01:43:57 | I | quantizing weights for layer model.layers.0
25-01-14 01:43:57 | I | collecting info in model.layers.0
25-01-14 01:43:58 | I | collecting info in model.layers.0
25-01-14 01:44:00 | I | collecting info in model.layers.0
25-01-14 01:44:01 | I | collecting info in model.layers.0
25-01-14 01:44:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:44:04 | I | collecting calibration activations in model.layers.0
25-01-14 01:44:06 | I | collecting calibration activations in model.layers.0
25-01-14 01:44:07 | I | collecting calibration activations in model.layers.0
25-01-14 01:44:09 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:44:09 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:44:15 | I |       - range scale = [    1.0000]
25-01-14 01:44:15 | I |         sum  error  = [    0.7780]
25-01-14 01:44:15 | I |         best error  = [    0.7780]
25-01-14 01:44:15 | I |     + error = [0.7780]
25-01-14 01:44:21 | I |       - range scale = [    1.0000]
25-01-14 01:44:21 | I |         sum  error  = [    1.8166]
25-01-14 01:44:21 | I |         best error  = [    1.8166]
25-01-14 01:44:21 | I |     + error = [1.8166]
25-01-14 01:44:21 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:44:27 | I |       - range scale = [    1.0000]
25-01-14 01:44:27 | I |         sum  error  = [    3.2224]
25-01-14 01:44:27 | I |         best error  = [    3.2224]
25-01-14 01:44:27 | I |     + error = [3.2224]
25-01-14 01:44:33 | I |       - range scale = [    1.0000]
25-01-14 01:44:33 | I |         sum  error  = [    4.4645]
25-01-14 01:44:33 | I |         best error  = [    4.4645]
25-01-14 01:44:33 | I |     + error = [4.4645]
25-01-14 01:44:33 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:44:34 | I |       - range scale = [    1.0000]
25-01-14 01:44:34 | I |         sum  error  = [    0.2843]
25-01-14 01:44:34 | I |         best error  = [    0.2843]
25-01-14 01:44:34 | I |     + error = [0.2843]
25-01-14 01:44:34 | I |       - range scale = [    1.0000]
25-01-14 01:44:34 | I |         sum  error  = [    0.3318]
25-01-14 01:44:34 | I |         best error  = [    0.3318]
25-01-14 01:44:34 | I |     + error = [0.3318]
25-01-14 01:44:35 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:44:35 | I |       - range scale = [    1.0000]
25-01-14 01:44:35 | I |         sum  error  = [    0.2231]
25-01-14 01:44:35 | I |         best error  = [    0.2231]
25-01-14 01:44:35 | I |     + error = [0.2231]
25-01-14 01:44:36 | I |       - range scale = [    1.0000]
25-01-14 01:44:36 | I |         sum  error  = [    0.3507]
25-01-14 01:44:36 | I |         best error  = [    0.3507]
25-01-14 01:44:36 | I |     + error = [0.3507]
25-01-14 01:44:36 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:44:37 | I |       - range scale = [    1.0000]
25-01-14 01:44:37 | I |         sum  error  = [    1.3194]
25-01-14 01:44:37 | I |         best error  = [    1.3194]
25-01-14 01:44:37 | I |     + error = [1.3194]
25-01-14 01:44:38 | I |       - range scale = [    1.0000]
25-01-14 01:44:38 | I |         sum  error  = [    1.4809]
25-01-14 01:44:38 | I |         best error  = [    1.4809]
25-01-14 01:44:38 | I |     + error = [1.4809]
25-01-14 01:44:38 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:44:39 | I |       - range scale = [    1.0000]
25-01-14 01:44:39 | I |         sum  error  = [    1.4687]
25-01-14 01:44:39 | I |         best error  = [    1.4687]
25-01-14 01:44:39 | I |     + error = [1.4687]
25-01-14 01:44:40 | I |       - range scale = [    1.0000]
25-01-14 01:44:40 | I |         sum  error  = [    1.7225]
25-01-14 01:44:40 | I |         best error  = [    1.7225]
25-01-14 01:44:40 | I |     + error = [1.7225]
25-01-14 01:44:40 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:44:41 | I |       - range scale = [    1.0000]
25-01-14 01:44:41 | I |         sum  error  = [    0.2333]
25-01-14 01:44:41 | I |         best error  = [    0.2333]
25-01-14 01:44:41 | I |     + error = [0.2333]
25-01-14 01:44:42 | I |       - range scale = [    1.0000]
25-01-14 01:44:42 | I |         sum  error  = [    0.3511]
25-01-14 01:44:42 | I |         best error  = [    0.3511]
25-01-14 01:44:42 | I |     + error = [0.3511]
25-01-14 01:44:42 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:44:45 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:44:48 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:44:50 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:44:52 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:44:55 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:44:57 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:45:04 | I | quantizing activations for layer model.layers.0
25-01-14 01:45:04 | I | collecting info in model.layers.0
25-01-14 01:45:05 | I | collecting info in model.layers.0
25-01-14 01:45:07 | I | collecting info in model.layers.0
25-01-14 01:45:08 | I | collecting info in model.layers.0
25-01-14 01:45:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:11 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:18 | I | forward this layer
25-01-14 01:45:18 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/108.pt
25-01-14 01:45:18 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/108.pt
25-01-14 01:45:18 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:45:18 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 55           |        cudaMalloc retries: 58        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 156039 GiB | 156017 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 155062 GiB | 155039 GiB |
|       from small pool |      3 MiB |      5 MiB |    977 GiB |    977 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 156039 GiB | 156017 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 155062 GiB | 155039 GiB |
|       from small pool |      3 MiB |      5 MiB |    977 GiB |    977 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 155935 GiB | 155913 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 154961 GiB | 154939 GiB |
|       from small pool |      3 MiB |      5 MiB |    973 GiB |    973 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3845 GiB |   3822 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3841 GiB |   3818 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  83827 GiB |  83826 GiB |
|       from large pool |    943 MiB |   1689 MiB |  82679 GiB |  82678 GiB |
|       from small pool |      0 MiB |      4 MiB |   1147 GiB |   1147 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   20947 K  |   20947 K  |
|       from large pool |     186    |     223    |    3214 K  |    3214 K  |
|       from small pool |     109    |     111    |   17733 K  |   17733 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   20947 K  |   20947 K  |
|       from large pool |     186    |     223    |    3214 K  |    3214 K  |
|       from small pool |     109    |     111    |   17733 K  |   17733 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    9248    |    9072    |
|       from large pool |     174    |     174    |    7309    |    7135    |
|       from small pool |       2    |       4    |    1939    |    1937    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    8289 K  |    8289 K  |
|       from large pool |      21    |      24    |     980 K  |     980 K  |
|       from small pool |       8    |      16    |    7309 K  |    7309 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:45:18 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  25785 MiB |  18837 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25617 MiB |  18669 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  25785 MiB |  18837 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25617 MiB |  18669 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  25449 MiB |  18501 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  25281 MiB |  18333 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  27560 MiB |  20610 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27556 MiB |  20608 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2411 MiB |   2410 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2240 MiB |   2240 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    171 MiB |    170 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1310    |    1130    |
|       from large pool |     126    |     128    |     910    |     784    |
|       from small pool |      54    |      56    |     400    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1310    |    1130    |
|       from large pool |     126    |     128    |     910    |     784    |
|       from small pool |      54    |      56    |     400    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     800    |     673    |
|       from large pool |     126    |     128    |     798    |     672    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     114    |     113    |
|       from large pool |       0    |       1    |     112    |     112    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:45:18 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  25785 MiB |  18837 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25617 MiB |  18669 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  25785 MiB |  18837 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25617 MiB |  18669 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  25449 MiB |  18501 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  25281 MiB |  18333 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  27560 MiB |  20610 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27556 MiB |  20608 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2411 MiB |   2410 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2240 MiB |   2240 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    171 MiB |    170 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1310    |    1130    |
|       from large pool |     126    |     128    |     910    |     784    |
|       from small pool |      54    |      56    |     400    |     346    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1310    |    1130    |
|       from large pool |     126    |     128    |     910    |     784    |
|       from small pool |      54    |      56    |     400    |     346    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     800    |     673    |
|       from large pool |     126    |     128    |     798    |     672    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     114    |     113    |
|       from large pool |       0    |       1    |     112    |     112    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:45:18 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  24741 MiB |  18837 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24573 MiB |  18669 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  24741 MiB |  18837 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24573 MiB |  18669 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  24405 MiB |  18501 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  24237 MiB |  18333 MiB |
|       from small pool |      0 MiB |      1 MiB |    168 MiB |    168 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  26516 MiB |  20610 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26512 MiB |  20608 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2411 MiB |   2410 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2240 MiB |   2240 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    171 MiB |    170 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1277    |    1129    |
|       from large pool |     100    |     102    |     884    |     784    |
|       from small pool |      48    |      50    |     393    |     345    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1277    |    1129    |
|       from large pool |     100    |     102    |     884    |     784    |
|       from small pool |      48    |      50    |     393    |     345    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     774    |     673    |
|       from large pool |     100    |     102    |     772    |     672    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     114    |     113    |
|       from large pool |       0    |       1    |     112    |     112    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:45:18 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:45:18 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:45:18 | I | in layer model.layers.0
25-01-14 01:45:18 | I | quantizing weights for layer model.layers.0
25-01-14 01:45:18 | I | collecting info in model.layers.0
25-01-14 01:45:20 | I | collecting info in model.layers.0
25-01-14 01:45:21 | I | collecting info in model.layers.0
25-01-14 01:45:22 | I | collecting info in model.layers.0
25-01-14 01:45:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:45:31 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:45:31 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:45:37 | I |       - range scale = [    1.0000]
25-01-14 01:45:37 | I |         sum  error  = [    0.8093]
25-01-14 01:45:37 | I |         best error  = [    0.8093]
25-01-14 01:45:37 | I |     + error = [0.8093]
25-01-14 01:45:43 | I |       - range scale = [    1.0000]
25-01-14 01:45:43 | I |         sum  error  = [    1.8637]
25-01-14 01:45:43 | I |         best error  = [    1.8637]
25-01-14 01:45:43 | I |     + error = [1.8637]
25-01-14 01:45:43 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:45:49 | I |       - range scale = [    1.0000]
25-01-14 01:45:49 | I |         sum  error  = [    3.2691]
25-01-14 01:45:49 | I |         best error  = [    3.2691]
25-01-14 01:45:49 | I |     + error = [3.2691]
25-01-14 01:45:55 | I |       - range scale = [    1.0000]
25-01-14 01:45:55 | I |         sum  error  = [    4.8576]
25-01-14 01:45:55 | I |         best error  = [    4.8576]
25-01-14 01:45:55 | I |     + error = [4.8576]
25-01-14 01:45:55 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:45:56 | I |       - range scale = [    1.0000]
25-01-14 01:45:56 | I |         sum  error  = [    0.2853]
25-01-14 01:45:56 | I |         best error  = [    0.2853]
25-01-14 01:45:56 | I |     + error = [0.2853]
25-01-14 01:45:56 | I |       - range scale = [    1.0000]
25-01-14 01:45:56 | I |         sum  error  = [    0.3750]
25-01-14 01:45:56 | I |         best error  = [    0.3750]
25-01-14 01:45:56 | I |     + error = [0.3750]
25-01-14 01:45:57 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:45:57 | I |       - range scale = [    1.0000]
25-01-14 01:45:57 | I |         sum  error  = [    0.2287]
25-01-14 01:45:57 | I |         best error  = [    0.2287]
25-01-14 01:45:57 | I |     + error = [0.2287]
25-01-14 01:45:58 | I |       - range scale = [    1.0000]
25-01-14 01:45:58 | I |         sum  error  = [    0.3621]
25-01-14 01:45:58 | I |         best error  = [    0.3621]
25-01-14 01:45:58 | I |     + error = [0.3621]
25-01-14 01:45:58 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:45:59 | I |       - range scale = [    1.0000]
25-01-14 01:45:59 | I |         sum  error  = [    1.3332]
25-01-14 01:45:59 | I |         best error  = [    1.3332]
25-01-14 01:45:59 | I |     + error = [1.3332]
25-01-14 01:46:00 | I |       - range scale = [    1.0000]
25-01-14 01:46:00 | I |         sum  error  = [    1.4688]
25-01-14 01:46:00 | I |         best error  = [    1.4688]
25-01-14 01:46:00 | I |     + error = [1.4688]
25-01-14 01:46:00 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:46:01 | I |       - range scale = [    1.0000]
25-01-14 01:46:01 | I |         sum  error  = [    1.4934]
25-01-14 01:46:01 | I |         best error  = [    1.4934]
25-01-14 01:46:01 | I |     + error = [1.4934]
25-01-14 01:46:02 | I |       - range scale = [    1.0000]
25-01-14 01:46:02 | I |         sum  error  = [    1.7432]
25-01-14 01:46:02 | I |         best error  = [    1.7432]
25-01-14 01:46:02 | I |     + error = [1.7432]
25-01-14 01:46:02 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:46:03 | I |       - range scale = [    1.0000]
25-01-14 01:46:03 | I |         sum  error  = [    0.2397]
25-01-14 01:46:03 | I |         best error  = [    0.2397]
25-01-14 01:46:03 | I |     + error = [0.2397]
25-01-14 01:46:04 | I |       - range scale = [    1.0000]
25-01-14 01:46:04 | I |         sum  error  = [    0.3643]
25-01-14 01:46:04 | I |         best error  = [    0.3643]
25-01-14 01:46:04 | I |     + error = [0.3643]
25-01-14 01:46:04 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:46:07 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:46:09 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:46:12 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:46:14 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:46:17 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:46:19 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:46:25 | I | quantizing activations for layer model.layers.0
25-01-14 01:46:25 | I | collecting info in model.layers.0
25-01-14 01:46:27 | I | collecting info in model.layers.0
25-01-14 01:46:28 | I | collecting info in model.layers.0
25-01-14 01:46:30 | I | collecting info in model.layers.0
25-01-14 01:46:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:33 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:39 | I | forward this layer
25-01-14 01:46:39 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/110.pt
25-01-14 01:46:39 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/110.pt
25-01-14 01:46:40 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:46:40 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 56           |        cudaMalloc retries: 59        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 161257 GiB | 161234 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 160253 GiB | 160231 GiB |
|       from small pool |      3 MiB |      5 MiB |   1003 GiB |   1003 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 161257 GiB | 161234 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 160253 GiB | 160231 GiB |
|       from small pool |      3 MiB |      5 MiB |   1003 GiB |   1003 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 161150 GiB | 161128 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 160151 GiB | 160128 GiB |
|       from small pool |      3 MiB |      5 MiB |    999 GiB |    999 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3914 GiB |   3891 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3910 GiB |   3887 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  86741 GiB |  86740 GiB |
|       from large pool |    943 MiB |   1689 MiB |  85563 GiB |  85562 GiB |
|       from small pool |      0 MiB |      4 MiB |   1178 GiB |   1178 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   21526 K  |   21526 K  |
|       from large pool |     186    |     223    |    3308 K  |    3308 K  |
|       from small pool |     109    |     111    |   18218 K  |   18218 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   21526 K  |   21526 K  |
|       from large pool |     186    |     223    |    3308 K  |    3308 K  |
|       from small pool |     109    |     111    |   18218 K  |   18218 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    9412    |    9236    |
|       from large pool |     174    |     174    |    7438    |    7264    |
|       from small pool |       2    |       4    |    1974    |    1972    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    8507 K  |    8507 K  |
|       from large pool |      20    |      24    |    1007 K  |    1007 K  |
|       from small pool |       8    |      16    |    7499 K  |    7499 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:46:40 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  26121 MiB |  19173 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25950 MiB |  19002 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  26121 MiB |  19173 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25950 MiB |  19002 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  25779 MiB |  18831 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  25608 MiB |  18660 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  27928 MiB |  20978 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27924 MiB |  20976 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2454 MiB |   2453 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2280 MiB |   2280 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    174 MiB |    173 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1330    |    1150    |
|       from large pool |     126    |     128    |     924    |     798    |
|       from small pool |      54    |      56    |     406    |     352    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1330    |    1150    |
|       from large pool |     126    |     128    |     924    |     798    |
|       from small pool |      54    |      56    |     406    |     352    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     812    |     685    |
|       from large pool |     126    |     128    |     810    |     684    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     116    |     115    |
|       from large pool |       0    |       1    |     114    |     114    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:46:40 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  26121 MiB |  19173 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25950 MiB |  19002 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  26121 MiB |  19173 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  25950 MiB |  19002 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  25779 MiB |  18831 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  25608 MiB |  18660 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  27928 MiB |  20978 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27924 MiB |  20976 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2454 MiB |   2453 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2280 MiB |   2280 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    174 MiB |    173 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1330    |    1150    |
|       from large pool |     126    |     128    |     924    |     798    |
|       from small pool |      54    |      56    |     406    |     352    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1330    |    1150    |
|       from large pool |     126    |     128    |     924    |     798    |
|       from small pool |      54    |      56    |     406    |     352    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     812    |     685    |
|       from large pool |     126    |     128    |     810    |     684    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     116    |     115    |
|       from large pool |       0    |       1    |     114    |     114    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:46:40 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  25077 MiB |  19173 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24906 MiB |  19002 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  25077 MiB |  19173 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  24906 MiB |  19002 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  24735 MiB |  18831 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  24564 MiB |  18660 MiB |
|       from small pool |      0 MiB |      1 MiB |    171 MiB |    171 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  26884 MiB |  20978 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26880 MiB |  20976 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2454 MiB |   2453 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2280 MiB |   2280 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    174 MiB |    173 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1297    |    1149    |
|       from large pool |     100    |     102    |     898    |     798    |
|       from small pool |      48    |      50    |     399    |     351    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1297    |    1149    |
|       from large pool |     100    |     102    |     898    |     798    |
|       from small pool |      48    |      50    |     399    |     351    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     786    |     685    |
|       from large pool |     100    |     102    |     784    |     684    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     116    |     115    |
|       from large pool |       0    |       1    |     114    |     114    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:46:40 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:46:40 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:46:40 | I | in layer model.layers.0
25-01-14 01:46:40 | I | quantizing weights for layer model.layers.0
25-01-14 01:46:40 | I | collecting info in model.layers.0
25-01-14 01:46:41 | I | collecting info in model.layers.0
25-01-14 01:46:43 | I | collecting info in model.layers.0
25-01-14 01:46:44 | I | collecting info in model.layers.0
25-01-14 01:46:46 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:51 | I | collecting calibration activations in model.layers.0
25-01-14 01:46:53 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:46:53 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:46:59 | I |       - range scale = [    1.0000]
25-01-14 01:46:59 | I |         sum  error  = [    0.9455]
25-01-14 01:46:59 | I |         best error  = [    0.9455]
25-01-14 01:46:59 | I |     + error = [0.9455]
25-01-14 01:47:05 | I |       - range scale = [    1.0000]
25-01-14 01:47:05 | I |         sum  error  = [    2.1712]
25-01-14 01:47:05 | I |         best error  = [    2.1712]
25-01-14 01:47:05 | I |     + error = [2.1712]
25-01-14 01:47:05 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:47:11 | I |       - range scale = [    1.0000]
25-01-14 01:47:11 | I |         sum  error  = [    3.8974]
25-01-14 01:47:11 | I |         best error  = [    3.8974]
25-01-14 01:47:11 | I |     + error = [3.8974]
25-01-14 01:47:17 | I |       - range scale = [    1.0000]
25-01-14 01:47:17 | I |         sum  error  = [    5.4135]
25-01-14 01:47:17 | I |         best error  = [    5.4135]
25-01-14 01:47:17 | I |     + error = [5.4135]
25-01-14 01:47:17 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:47:18 | I |       - range scale = [    1.0000]
25-01-14 01:47:18 | I |         sum  error  = [    0.3016]
25-01-14 01:47:18 | I |         best error  = [    0.3016]
25-01-14 01:47:18 | I |     + error = [0.3016]
25-01-14 01:47:19 | I |       - range scale = [    1.0000]
25-01-14 01:47:19 | I |         sum  error  = [    0.3712]
25-01-14 01:47:19 | I |         best error  = [    0.3712]
25-01-14 01:47:19 | I |     + error = [0.3712]
25-01-14 01:47:19 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:47:20 | I |       - range scale = [    1.0000]
25-01-14 01:47:20 | I |         sum  error  = [    0.2506]
25-01-14 01:47:20 | I |         best error  = [    0.2506]
25-01-14 01:47:20 | I |     + error = [0.2506]
25-01-14 01:47:20 | I |       - range scale = [    1.0000]
25-01-14 01:47:20 | I |         sum  error  = [    0.4083]
25-01-14 01:47:20 | I |         best error  = [    0.4083]
25-01-14 01:47:20 | I |     + error = [0.4083]
25-01-14 01:47:21 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:47:21 | I |       - range scale = [    1.0000]
25-01-14 01:47:21 | I |         sum  error  = [    1.4638]
25-01-14 01:47:21 | I |         best error  = [    1.4638]
25-01-14 01:47:21 | I |     + error = [1.4638]
25-01-14 01:47:22 | I |       - range scale = [    1.0000]
25-01-14 01:47:22 | I |         sum  error  = [    1.6022]
25-01-14 01:47:22 | I |         best error  = [    1.6022]
25-01-14 01:47:22 | I |     + error = [1.6022]
25-01-14 01:47:23 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:47:23 | I |       - range scale = [    1.0000]
25-01-14 01:47:23 | I |         sum  error  = [    1.6443]
25-01-14 01:47:23 | I |         best error  = [    1.6443]
25-01-14 01:47:23 | I |     + error = [1.6443]
25-01-14 01:47:24 | I |       - range scale = [    1.0000]
25-01-14 01:47:24 | I |         sum  error  = [    1.9357]
25-01-14 01:47:24 | I |         best error  = [    1.9357]
25-01-14 01:47:24 | I |     + error = [1.9357]
25-01-14 01:47:25 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:47:25 | I |       - range scale = [    1.0000]
25-01-14 01:47:25 | I |         sum  error  = [    0.2796]
25-01-14 01:47:25 | I |         best error  = [    0.2796]
25-01-14 01:47:25 | I |     + error = [0.2796]
25-01-14 01:47:26 | I |       - range scale = [    1.0000]
25-01-14 01:47:26 | I |         sum  error  = [    0.4264]
25-01-14 01:47:26 | I |         best error  = [    0.4264]
25-01-14 01:47:26 | I |     + error = [0.4264]
25-01-14 01:47:27 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:47:29 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:47:32 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:47:34 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:47:36 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:47:39 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:47:41 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:47:48 | I | quantizing activations for layer model.layers.0
25-01-14 01:47:48 | I | collecting info in model.layers.0
25-01-14 01:47:49 | I | collecting info in model.layers.0
25-01-14 01:47:50 | I | collecting info in model.layers.0
25-01-14 01:47:52 | I | collecting info in model.layers.0
25-01-14 01:47:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:47:55 | I | collecting calibration activations in model.layers.0
25-01-14 01:47:57 | I | collecting calibration activations in model.layers.0
25-01-14 01:47:58 | I | collecting calibration activations in model.layers.0
25-01-14 01:48:02 | I | forward this layer
25-01-14 01:48:02 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/112.pt
25-01-14 01:48:02 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/112.pt
25-01-14 01:48:02 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:48:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 57           |        cudaMalloc retries: 60        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 166559 GiB | 166537 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 165529 GiB | 165507 GiB |
|       from small pool |      3 MiB |      5 MiB |   1030 GiB |   1030 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 166559 GiB | 166537 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 165529 GiB | 165507 GiB |
|       from small pool |      3 MiB |      5 MiB |   1030 GiB |   1030 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 166452 GiB | 166429 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 165425 GiB | 165403 GiB |
|       from small pool |      3 MiB |      5 MiB |   1026 GiB |   1026 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   3982 GiB |   3959 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   3978 GiB |   3955 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  89745 GiB |  89744 GiB |
|       from large pool |    943 MiB |   1689 MiB |  88536 GiB |  88535 GiB |
|       from small pool |      0 MiB |      4 MiB |   1209 GiB |   1209 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   22113 K  |   22113 K  |
|       from large pool |     186    |     223    |    3403 K  |    3403 K  |
|       from small pool |     109    |     111    |   18709 K  |   18709 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   22113 K  |   22113 K  |
|       from large pool |     186    |     223    |    3403 K  |    3403 K  |
|       from small pool |     109    |     111    |   18709 K  |   18709 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    9570    |    9394    |
|       from large pool |     174    |     174    |    7561    |    7387    |
|       from small pool |       2    |       4    |    2009    |    2007    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    8726 K  |    8726 K  |
|       from large pool |      21    |      24    |    1034 K  |    1034 K  |
|       from small pool |       8    |      16    |    7691 K  |    7691 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:48:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  26458 MiB |  19509 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26283 MiB |  19335 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  26458 MiB |  19509 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26283 MiB |  19335 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  26110 MiB |  19161 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  25935 MiB |  18987 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  28296 MiB |  21346 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28292 MiB |  21344 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2497 MiB |   2496 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2320 MiB |   2320 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    177 MiB |    176 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1350    |    1170    |
|       from large pool |     126    |     128    |     938    |     812    |
|       from small pool |      54    |      56    |     412    |     358    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1350    |    1170    |
|       from large pool |     126    |     128    |     938    |     812    |
|       from small pool |      54    |      56    |     412    |     358    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     824    |     697    |
|       from large pool |     126    |     128    |     822    |     696    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     118    |     117    |
|       from large pool |       0    |       1    |     116    |     116    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:48:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  26458 MiB |  19509 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26283 MiB |  19335 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  26458 MiB |  19509 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26283 MiB |  19335 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  26110 MiB |  19161 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  25935 MiB |  18987 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  28296 MiB |  21346 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28292 MiB |  21344 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2497 MiB |   2496 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2320 MiB |   2320 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    177 MiB |    176 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1350    |    1170    |
|       from large pool |     126    |     128    |     938    |     812    |
|       from small pool |      54    |      56    |     412    |     358    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1350    |    1170    |
|       from large pool |     126    |     128    |     938    |     812    |
|       from small pool |      54    |      56    |     412    |     358    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     824    |     697    |
|       from large pool |     126    |     128    |     822    |     696    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     118    |     117    |
|       from large pool |       0    |       1    |     116    |     116    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:48:02 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  25414 MiB |  19509 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25239 MiB |  19335 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  25414 MiB |  19509 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25239 MiB |  19335 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  25066 MiB |  19161 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  24891 MiB |  18987 MiB |
|       from small pool |      0 MiB |      1 MiB |    174 MiB |    174 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  27252 MiB |  21346 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27248 MiB |  21344 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2497 MiB |   2496 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2320 MiB |   2320 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    177 MiB |    176 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1317    |    1169    |
|       from large pool |     100    |     102    |     912    |     812    |
|       from small pool |      48    |      50    |     405    |     357    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1317    |    1169    |
|       from large pool |     100    |     102    |     912    |     812    |
|       from small pool |      48    |      50    |     405    |     357    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     798    |     697    |
|       from large pool |     100    |     102    |     796    |     696    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     118    |     117    |
|       from large pool |       0    |       1    |     116    |     116    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:48:02 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:48:02 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:48:02 | I | in layer model.layers.0
25-01-14 01:48:02 | I | quantizing weights for layer model.layers.0
25-01-14 01:48:02 | I | collecting info in model.layers.0
25-01-14 01:48:04 | I | collecting info in model.layers.0
25-01-14 01:48:05 | I | collecting info in model.layers.0
25-01-14 01:48:07 | I | collecting info in model.layers.0
25-01-14 01:48:09 | I | collecting calibration activations in model.layers.0
25-01-14 01:48:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:48:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:48:13 | I | collecting calibration activations in model.layers.0
25-01-14 01:48:15 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:48:15 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:48:21 | I |       - range scale = [    1.0000]
25-01-14 01:48:21 | I |         sum  error  = [    0.9548]
25-01-14 01:48:21 | I |         best error  = [    0.9548]
25-01-14 01:48:21 | I |     + error = [0.9548]
25-01-14 01:48:27 | I |       - range scale = [    1.0000]
25-01-14 01:48:27 | I |         sum  error  = [    2.1906]
25-01-14 01:48:27 | I |         best error  = [    2.1906]
25-01-14 01:48:27 | I |     + error = [2.1906]
25-01-14 01:48:28 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:48:34 | I |       - range scale = [    1.0000]
25-01-14 01:48:34 | I |         sum  error  = [    3.8833]
25-01-14 01:48:34 | I |         best error  = [    3.8833]
25-01-14 01:48:34 | I |     + error = [3.8833]
25-01-14 01:48:40 | I |       - range scale = [    1.0000]
25-01-14 01:48:40 | I |         sum  error  = [    5.3294]
25-01-14 01:48:40 | I |         best error  = [    5.3294]
25-01-14 01:48:40 | I |     + error = [5.3294]
25-01-14 01:48:40 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:48:41 | I |       - range scale = [    1.0000]
25-01-14 01:48:41 | I |         sum  error  = [    0.3070]
25-01-14 01:48:41 | I |         best error  = [    0.3070]
25-01-14 01:48:41 | I |     + error = [0.3070]
25-01-14 01:48:42 | I |       - range scale = [    1.0000]
25-01-14 01:48:42 | I |         sum  error  = [    0.4014]
25-01-14 01:48:42 | I |         best error  = [    0.4014]
25-01-14 01:48:42 | I |     + error = [0.4014]
25-01-14 01:48:42 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:48:42 | I |       - range scale = [    1.0000]
25-01-14 01:48:42 | I |         sum  error  = [    0.2412]
25-01-14 01:48:42 | I |         best error  = [    0.2412]
25-01-14 01:48:42 | I |     + error = [0.2412]
25-01-14 01:48:43 | I |       - range scale = [    1.0000]
25-01-14 01:48:43 | I |         sum  error  = [    0.4134]
25-01-14 01:48:43 | I |         best error  = [    0.4134]
25-01-14 01:48:43 | I |     + error = [0.4134]
25-01-14 01:48:44 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:48:44 | I |       - range scale = [    1.0000]
25-01-14 01:48:44 | I |         sum  error  = [    1.5220]
25-01-14 01:48:44 | I |         best error  = [    1.5220]
25-01-14 01:48:44 | I |     + error = [1.5220]
25-01-14 01:48:45 | I |       - range scale = [    1.0000]
25-01-14 01:48:45 | I |         sum  error  = [    1.6943]
25-01-14 01:48:45 | I |         best error  = [    1.6943]
25-01-14 01:48:45 | I |     + error = [1.6943]
25-01-14 01:48:46 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:48:46 | I |       - range scale = [    1.0000]
25-01-14 01:48:46 | I |         sum  error  = [    1.6754]
25-01-14 01:48:46 | I |         best error  = [    1.6754]
25-01-14 01:48:46 | I |     + error = [1.6754]
25-01-14 01:48:47 | I |       - range scale = [    1.0000]
25-01-14 01:48:47 | I |         sum  error  = [    1.9092]
25-01-14 01:48:47 | I |         best error  = [    1.9092]
25-01-14 01:48:47 | I |     + error = [1.9092]
25-01-14 01:48:48 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:48:48 | I |       - range scale = [    1.0000]
25-01-14 01:48:48 | I |         sum  error  = [    0.3006]
25-01-14 01:48:48 | I |         best error  = [    0.3006]
25-01-14 01:48:48 | I |     + error = [0.3006]
25-01-14 01:48:49 | I |       - range scale = [    1.0000]
25-01-14 01:48:49 | I |         sum  error  = [    0.4627]
25-01-14 01:48:49 | I |         best error  = [    0.4627]
25-01-14 01:48:49 | I |     + error = [0.4627]
25-01-14 01:48:50 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:48:52 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:48:55 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:48:57 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:48:59 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:49:02 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:49:04 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:49:11 | I | quantizing activations for layer model.layers.0
25-01-14 01:49:11 | I | collecting info in model.layers.0
25-01-14 01:49:12 | I | collecting info in model.layers.0
25-01-14 01:49:14 | I | collecting info in model.layers.0
25-01-14 01:49:15 | I | collecting info in model.layers.0
25-01-14 01:49:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:20 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:26 | I | forward this layer
25-01-14 01:49:26 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/114.pt
25-01-14 01:49:26 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/114.pt
25-01-14 01:49:26 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:49:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 58           |        cudaMalloc retries: 61        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 171948 GiB | 171926 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 170891 GiB | 170869 GiB |
|       from small pool |      3 MiB |      5 MiB |   1056 GiB |   1056 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 171948 GiB | 171926 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 170891 GiB | 170869 GiB |
|       from small pool |      3 MiB |      5 MiB |   1056 GiB |   1056 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 171838 GiB | 171816 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 170785 GiB | 170763 GiB |
|       from small pool |      3 MiB |      5 MiB |   1052 GiB |   1052 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4051 GiB |   4028 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4047 GiB |   4024 GiB |
|       from small pool |      4 MiB |      8 MiB |      3 GiB |      3 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  92761 GiB |  92760 GiB |
|       from large pool |    943 MiB |   1689 MiB |  91519 GiB |  91518 GiB |
|       from small pool |      0 MiB |      4 MiB |   1241 GiB |   1241 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   22706 K  |   22706 K  |
|       from large pool |     186    |     223    |    3500 K  |    3499 K  |
|       from small pool |     109    |     111    |   19206 K  |   19206 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   22706 K  |   22706 K  |
|       from large pool |     186    |     223    |    3500 K  |    3499 K  |
|       from small pool |     109    |     111    |   19206 K  |   19206 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    9734    |    9558    |
|       from large pool |     174    |     174    |    7690    |    7516    |
|       from small pool |       2    |       4    |    2044    |    2042    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    8946 K  |    8946 K  |
|       from large pool |      20    |      24    |    1060 K  |    1060 K  |
|       from small pool |       8    |      16    |    7885 K  |    7885 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:49:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  26794 MiB |  19846 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26617 MiB |  19669 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  26794 MiB |  19846 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26617 MiB |  19669 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  26440 MiB |  19492 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  26263 MiB |  19315 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  28664 MiB |  21714 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28660 MiB |  21712 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2540 MiB |   2539 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2360 MiB |   2360 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    180 MiB |    179 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1370    |    1190    |
|       from large pool |     126    |     128    |     952    |     826    |
|       from small pool |      54    |      56    |     418    |     364    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1370    |    1190    |
|       from large pool |     126    |     128    |     952    |     826    |
|       from small pool |      54    |      56    |     418    |     364    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     836    |     709    |
|       from large pool |     126    |     128    |     834    |     708    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     120    |     119    |
|       from large pool |       0    |       1    |     118    |     118    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:49:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  26794 MiB |  19846 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26617 MiB |  19669 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  26794 MiB |  19846 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26617 MiB |  19669 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  26440 MiB |  19492 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  26263 MiB |  19315 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  28664 MiB |  21714 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28660 MiB |  21712 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2540 MiB |   2539 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2360 MiB |   2360 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    180 MiB |    179 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1370    |    1190    |
|       from large pool |     126    |     128    |     952    |     826    |
|       from small pool |      54    |      56    |     418    |     364    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1370    |    1190    |
|       from large pool |     126    |     128    |     952    |     826    |
|       from small pool |      54    |      56    |     418    |     364    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     836    |     709    |
|       from large pool |     126    |     128    |     834    |     708    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     120    |     119    |
|       from large pool |       0    |       1    |     118    |     118    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:49:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  25750 MiB |  19846 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25573 MiB |  19669 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  25750 MiB |  19846 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25573 MiB |  19669 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  25396 MiB |  19492 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  25219 MiB |  19315 MiB |
|       from small pool |      0 MiB |      1 MiB |    177 MiB |    177 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  27620 MiB |  21714 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27616 MiB |  21712 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2540 MiB |   2539 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2360 MiB |   2360 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    180 MiB |    179 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1337    |    1189    |
|       from large pool |     100    |     102    |     926    |     826    |
|       from small pool |      48    |      50    |     411    |     363    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1337    |    1189    |
|       from large pool |     100    |     102    |     926    |     826    |
|       from small pool |      48    |      50    |     411    |     363    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     810    |     709    |
|       from large pool |     100    |     102    |     808    |     708    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     120    |     119    |
|       from large pool |       0    |       1    |     118    |     118    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:49:26 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:49:26 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:49:26 | I | in layer model.layers.0
25-01-14 01:49:26 | I | quantizing weights for layer model.layers.0
25-01-14 01:49:26 | I | collecting info in model.layers.0
25-01-14 01:49:28 | I | collecting info in model.layers.0
25-01-14 01:49:29 | I | collecting info in model.layers.0
25-01-14 01:49:30 | I | collecting info in model.layers.0
25-01-14 01:49:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:37 | I | collecting calibration activations in model.layers.0
25-01-14 01:49:39 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:49:39 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:49:45 | I |       - range scale = [    1.0000]
25-01-14 01:49:45 | I |         sum  error  = [    0.9330]
25-01-14 01:49:45 | I |         best error  = [    0.9330]
25-01-14 01:49:45 | I |     + error = [0.9330]
25-01-14 01:49:52 | I |       - range scale = [    1.0000]
25-01-14 01:49:52 | I |         sum  error  = [    2.1117]
25-01-14 01:49:52 | I |         best error  = [    2.1117]
25-01-14 01:49:52 | I |     + error = [2.1117]
25-01-14 01:49:52 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:49:58 | I |       - range scale = [    1.0000]
25-01-14 01:49:58 | I |         sum  error  = [    3.9212]
25-01-14 01:49:58 | I |         best error  = [    3.9212]
25-01-14 01:49:58 | I |     + error = [3.9212]
25-01-14 01:50:04 | I |       - range scale = [    1.0000]
25-01-14 01:50:04 | I |         sum  error  = [    5.2801]
25-01-14 01:50:04 | I |         best error  = [    5.2801]
25-01-14 01:50:04 | I |     + error = [5.2801]
25-01-14 01:50:04 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:50:05 | I |       - range scale = [    1.0000]
25-01-14 01:50:05 | I |         sum  error  = [    0.3025]
25-01-14 01:50:05 | I |         best error  = [    0.3025]
25-01-14 01:50:05 | I |     + error = [0.3025]
25-01-14 01:50:06 | I |       - range scale = [    1.0000]
25-01-14 01:50:06 | I |         sum  error  = [    0.3486]
25-01-14 01:50:06 | I |         best error  = [    0.3486]
25-01-14 01:50:06 | I |     + error = [0.3486]
25-01-14 01:50:06 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:50:07 | I |       - range scale = [    1.0000]
25-01-14 01:50:07 | I |         sum  error  = [    0.2522]
25-01-14 01:50:07 | I |         best error  = [    0.2522]
25-01-14 01:50:07 | I |     + error = [0.2522]
25-01-14 01:50:08 | I |       - range scale = [    1.0000]
25-01-14 01:50:08 | I |         sum  error  = [    0.4205]
25-01-14 01:50:08 | I |         best error  = [    0.4205]
25-01-14 01:50:08 | I |     + error = [0.4205]
25-01-14 01:50:08 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:50:09 | I |       - range scale = [    1.0000]
25-01-14 01:50:09 | I |         sum  error  = [    1.6225]
25-01-14 01:50:09 | I |         best error  = [    1.6225]
25-01-14 01:50:09 | I |     + error = [1.6225]
25-01-14 01:50:10 | I |       - range scale = [    1.0000]
25-01-14 01:50:10 | I |         sum  error  = [    1.6756]
25-01-14 01:50:10 | I |         best error  = [    1.6756]
25-01-14 01:50:10 | I |     + error = [1.6756]
25-01-14 01:50:10 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:50:11 | I |       - range scale = [    1.0000]
25-01-14 01:50:11 | I |         sum  error  = [    1.7699]
25-01-14 01:50:11 | I |         best error  = [    1.7699]
25-01-14 01:50:11 | I |     + error = [1.7699]
25-01-14 01:50:12 | I |       - range scale = [    1.0000]
25-01-14 01:50:12 | I |         sum  error  = [    1.9839]
25-01-14 01:50:12 | I |         best error  = [    1.9839]
25-01-14 01:50:12 | I |     + error = [1.9839]
25-01-14 01:50:12 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:50:13 | I |       - range scale = [    1.0000]
25-01-14 01:50:13 | I |         sum  error  = [    0.3433]
25-01-14 01:50:13 | I |         best error  = [    0.3433]
25-01-14 01:50:13 | I |     + error = [0.3433]
25-01-14 01:50:14 | I |       - range scale = [    1.0000]
25-01-14 01:50:14 | I |         sum  error  = [    0.5001]
25-01-14 01:50:14 | I |         best error  = [    0.5001]
25-01-14 01:50:14 | I |     + error = [0.5001]
25-01-14 01:50:14 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:50:17 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:50:19 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:50:21 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:50:24 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:50:26 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:50:29 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:50:35 | I | quantizing activations for layer model.layers.0
25-01-14 01:50:35 | I | collecting info in model.layers.0
25-01-14 01:50:37 | I | collecting info in model.layers.0
25-01-14 01:50:38 | I | collecting info in model.layers.0
25-01-14 01:50:40 | I | collecting info in model.layers.0
25-01-14 01:50:42 | I | collecting calibration activations in model.layers.0
25-01-14 01:50:43 | I | collecting calibration activations in model.layers.0
25-01-14 01:50:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:50:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:50:50 | I | forward this layer
25-01-14 01:50:50 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/116.pt
25-01-14 01:50:50 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/116.pt
25-01-14 01:50:50 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:50:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 59           |        cudaMalloc retries: 62        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 177421 GiB | 177399 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 176337 GiB | 176315 GiB |
|       from small pool |      3 MiB |      5 MiB |   1084 GiB |   1084 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 177421 GiB | 177399 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 176337 GiB | 176315 GiB |
|       from small pool |      3 MiB |      5 MiB |   1084 GiB |   1084 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 177310 GiB | 177288 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 176230 GiB | 176208 GiB |
|       from small pool |      3 MiB |      5 MiB |   1079 GiB |   1079 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4119 GiB |   4096 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4115 GiB |   4091 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  95866 GiB |  95865 GiB |
|       from large pool |    943 MiB |   1689 MiB |  94593 GiB |  94592 GiB |
|       from small pool |      0 MiB |      4 MiB |   1273 GiB |   1273 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   23307 K  |   23307 K  |
|       from large pool |     186    |     223    |    3597 K  |    3597 K  |
|       from small pool |     109    |     111    |   19709 K  |   19709 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   23307 K  |   23307 K  |
|       from large pool |     186    |     223    |    3597 K  |    3597 K  |
|       from small pool |     109    |     111    |   19709 K  |   19709 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |    9892    |    9716    |
|       from large pool |     174    |     174    |    7813    |    7639    |
|       from small pool |       2    |       4    |    2079    |    2077    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    9170 K  |    9170 K  |
|       from large pool |      21    |      24    |    1088 K  |    1088 K  |
|       from small pool |       8    |      16    |    8082 K  |    8082 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:50:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  27130 MiB |  20182 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26950 MiB |  20002 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  27130 MiB |  20182 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26950 MiB |  20002 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  26770 MiB |  19822 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  26590 MiB |  19642 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  29032 MiB |  22082 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29028 MiB |  22080 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2583 MiB |   2582 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2400 MiB |   2400 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    183 MiB |    182 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1390    |    1210    |
|       from large pool |     126    |     128    |     966    |     840    |
|       from small pool |      54    |      56    |     424    |     370    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1390    |    1210    |
|       from large pool |     126    |     128    |     966    |     840    |
|       from small pool |      54    |      56    |     424    |     370    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     848    |     721    |
|       from large pool |     126    |     128    |     846    |     720    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     122    |     121    |
|       from large pool |       0    |       1    |     120    |     120    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:50:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  27130 MiB |  20182 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26950 MiB |  20002 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  27130 MiB |  20182 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  26950 MiB |  20002 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  26770 MiB |  19822 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  26590 MiB |  19642 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  29032 MiB |  22082 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29028 MiB |  22080 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2583 MiB |   2582 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2400 MiB |   2400 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    183 MiB |    182 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1390    |    1210    |
|       from large pool |     126    |     128    |     966    |     840    |
|       from small pool |      54    |      56    |     424    |     370    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1390    |    1210    |
|       from large pool |     126    |     128    |     966    |     840    |
|       from small pool |      54    |      56    |     424    |     370    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     848    |     721    |
|       from large pool |     126    |     128    |     846    |     720    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     122    |     121    |
|       from large pool |       0    |       1    |     120    |     120    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:50:50 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  26086 MiB |  20182 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25906 MiB |  20002 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  26086 MiB |  20182 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  25906 MiB |  20002 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  25726 MiB |  19822 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  25546 MiB |  19642 MiB |
|       from small pool |      0 MiB |      1 MiB |    180 MiB |    180 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  27988 MiB |  22082 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27984 MiB |  22080 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2583 MiB |   2582 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2400 MiB |   2400 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    183 MiB |    182 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1357    |    1209    |
|       from large pool |     100    |     102    |     940    |     840    |
|       from small pool |      48    |      50    |     417    |     369    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1357    |    1209    |
|       from large pool |     100    |     102    |     940    |     840    |
|       from small pool |      48    |      50    |     417    |     369    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     822    |     721    |
|       from large pool |     100    |     102    |     820    |     720    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     122    |     121    |
|       from large pool |       0    |       1    |     120    |     120    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:50:50 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:50:51 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:50:51 | I | in layer model.layers.0
25-01-14 01:50:51 | I | quantizing weights for layer model.layers.0
25-01-14 01:50:51 | I | collecting info in model.layers.0
25-01-14 01:50:52 | I | collecting info in model.layers.0
25-01-14 01:50:54 | I | collecting info in model.layers.0
25-01-14 01:50:55 | I | collecting info in model.layers.0
25-01-14 01:50:57 | I | collecting calibration activations in model.layers.0
25-01-14 01:50:59 | I | collecting calibration activations in model.layers.0
25-01-14 01:51:00 | I | collecting calibration activations in model.layers.0
25-01-14 01:51:02 | I | collecting calibration activations in model.layers.0
25-01-14 01:51:04 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:51:04 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:51:10 | I |       - range scale = [    1.0000]
25-01-14 01:51:10 | I |         sum  error  = [    0.9697]
25-01-14 01:51:10 | I |         best error  = [    0.9697]
25-01-14 01:51:10 | I |     + error = [0.9697]
25-01-14 01:51:17 | I |       - range scale = [    1.0000]
25-01-14 01:51:17 | I |         sum  error  = [    2.1699]
25-01-14 01:51:17 | I |         best error  = [    2.1699]
25-01-14 01:51:17 | I |     + error = [2.1699]
25-01-14 01:51:17 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:51:23 | I |       - range scale = [    1.0000]
25-01-14 01:51:23 | I |         sum  error  = [    4.0043]
25-01-14 01:51:23 | I |         best error  = [    4.0043]
25-01-14 01:51:23 | I |     + error = [4.0043]
25-01-14 01:51:29 | I |       - range scale = [    1.0000]
25-01-14 01:51:29 | I |         sum  error  = [    5.6055]
25-01-14 01:51:29 | I |         best error  = [    5.6055]
25-01-14 01:51:29 | I |     + error = [5.6055]
25-01-14 01:51:30 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:51:30 | I |       - range scale = [    1.0000]
25-01-14 01:51:30 | I |         sum  error  = [    0.2965]
25-01-14 01:51:30 | I |         best error  = [    0.2965]
25-01-14 01:51:30 | I |     + error = [0.2965]
25-01-14 01:51:31 | I |       - range scale = [    1.0000]
25-01-14 01:51:31 | I |         sum  error  = [    0.3430]
25-01-14 01:51:31 | I |         best error  = [    0.3430]
25-01-14 01:51:31 | I |     + error = [0.3430]
25-01-14 01:51:31 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:51:32 | I |       - range scale = [    1.0000]
25-01-14 01:51:32 | I |         sum  error  = [    0.2428]
25-01-14 01:51:32 | I |         best error  = [    0.2428]
25-01-14 01:51:32 | I |     + error = [0.2428]
25-01-14 01:51:33 | I |       - range scale = [    1.0000]
25-01-14 01:51:33 | I |         sum  error  = [    0.3971]
25-01-14 01:51:33 | I |         best error  = [    0.3971]
25-01-14 01:51:33 | I |     + error = [0.3971]
25-01-14 01:51:33 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:51:34 | I |       - range scale = [    1.0000]
25-01-14 01:51:34 | I |         sum  error  = [    1.3797]
25-01-14 01:51:34 | I |         best error  = [    1.3797]
25-01-14 01:51:34 | I |     + error = [1.3797]
25-01-14 01:51:35 | I |       - range scale = [    1.0000]
25-01-14 01:51:35 | I |         sum  error  = [    1.5686]
25-01-14 01:51:35 | I |         best error  = [    1.5686]
25-01-14 01:51:35 | I |     + error = [1.5686]
25-01-14 01:51:35 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:51:36 | I |       - range scale = [    1.0000]
25-01-14 01:51:36 | I |         sum  error  = [    1.5279]
25-01-14 01:51:36 | I |         best error  = [    1.5279]
25-01-14 01:51:36 | I |     + error = [1.5279]
25-01-14 01:51:37 | I |       - range scale = [    1.0000]
25-01-14 01:51:37 | I |         sum  error  = [    1.9197]
25-01-14 01:51:37 | I |         best error  = [    1.9197]
25-01-14 01:51:37 | I |     + error = [1.9197]
25-01-14 01:51:37 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:51:38 | I |       - range scale = [    1.0000]
25-01-14 01:51:38 | I |         sum  error  = [    0.2607]
25-01-14 01:51:38 | I |         best error  = [    0.2607]
25-01-14 01:51:38 | I |     + error = [0.2607]
25-01-14 01:51:39 | I |       - range scale = [    1.0000]
25-01-14 01:51:39 | I |         sum  error  = [    0.4444]
25-01-14 01:51:39 | I |         best error  = [    0.4444]
25-01-14 01:51:39 | I |     + error = [0.4444]
25-01-14 01:51:39 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:51:42 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:51:44 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:51:47 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:51:49 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:51:52 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:51:54 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:52:00 | I | quantizing activations for layer model.layers.0
25-01-14 01:52:00 | I | collecting info in model.layers.0
25-01-14 01:52:02 | I | collecting info in model.layers.0
25-01-14 01:52:03 | I | collecting info in model.layers.0
25-01-14 01:52:05 | I | collecting info in model.layers.0
25-01-14 01:52:07 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:08 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:10 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:15 | I | forward this layer
25-01-14 01:52:15 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/118.pt
25-01-14 01:52:15 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/118.pt
25-01-14 01:52:15 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:52:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 60           |        cudaMalloc retries: 63        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 182980 GiB | 182958 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 181869 GiB | 181847 GiB |
|       from small pool |      3 MiB |      5 MiB |   1111 GiB |   1111 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 182980 GiB | 182958 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 181869 GiB | 181847 GiB |
|       from small pool |      3 MiB |      5 MiB |   1111 GiB |   1111 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 182867 GiB | 182845 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 181760 GiB | 181738 GiB |
|       from small pool |      3 MiB |      5 MiB |   1107 GiB |   1107 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4188 GiB |   4165 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4183 GiB |   4160 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB |  98982 GiB |  98981 GiB |
|       from large pool |    943 MiB |   1689 MiB |  97676 GiB |  97675 GiB |
|       from small pool |      0 MiB |      4 MiB |   1306 GiB |   1306 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   23915 K  |   23915 K  |
|       from large pool |     186    |     223    |    3696 K  |    3696 K  |
|       from small pool |     109    |     111    |   20218 K  |   20218 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   23915 K  |   23915 K  |
|       from large pool |     186    |     223    |    3696 K  |    3696 K  |
|       from small pool |     109    |     111    |   20218 K  |   20218 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   10056    |    9880    |
|       from large pool |     174    |     174    |    7942    |    7768    |
|       from small pool |       2    |       4    |    2114    |    2112    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    9395 K  |    9395 K  |
|       from large pool |      20    |      24    |    1115 K  |    1115 K  |
|       from small pool |       8    |      16    |    8280 K  |    8280 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:52:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  27467 MiB |  20518 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27283 MiB |  20335 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  27467 MiB |  20518 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27283 MiB |  20335 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  27101 MiB |  20152 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  26917 MiB |  19969 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  29400 MiB |  22450 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29396 MiB |  22448 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2626 MiB |   2625 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2440 MiB |   2440 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    186 MiB |    185 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1410    |    1230    |
|       from large pool |     126    |     128    |     980    |     854    |
|       from small pool |      54    |      56    |     430    |     376    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1410    |    1230    |
|       from large pool |     126    |     128    |     980    |     854    |
|       from small pool |      54    |      56    |     430    |     376    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     860    |     733    |
|       from large pool |     126    |     128    |     858    |     732    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     124    |     123    |
|       from large pool |       0    |       1    |     122    |     122    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:52:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  27467 MiB |  20518 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27283 MiB |  20335 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  27467 MiB |  20518 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27283 MiB |  20335 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  27101 MiB |  20152 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  26917 MiB |  19969 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  29400 MiB |  22450 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29396 MiB |  22448 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2626 MiB |   2625 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2440 MiB |   2440 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    186 MiB |    185 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1410    |    1230    |
|       from large pool |     126    |     128    |     980    |     854    |
|       from small pool |      54    |      56    |     430    |     376    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1410    |    1230    |
|       from large pool |     126    |     128    |     980    |     854    |
|       from small pool |      54    |      56    |     430    |     376    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     860    |     733    |
|       from large pool |     126    |     128    |     858    |     732    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     124    |     123    |
|       from large pool |       0    |       1    |     122    |     122    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:52:16 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  26423 MiB |  20518 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26239 MiB |  20335 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  26423 MiB |  20518 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26239 MiB |  20335 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  26057 MiB |  20152 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  25873 MiB |  19969 MiB |
|       from small pool |      0 MiB |      1 MiB |    183 MiB |    183 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  28356 MiB |  22450 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28352 MiB |  22448 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2626 MiB |   2625 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2440 MiB |   2440 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    186 MiB |    185 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1377    |    1229    |
|       from large pool |     100    |     102    |     954    |     854    |
|       from small pool |      48    |      50    |     423    |     375    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1377    |    1229    |
|       from large pool |     100    |     102    |     954    |     854    |
|       from small pool |      48    |      50    |     423    |     375    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     834    |     733    |
|       from large pool |     100    |     102    |     832    |     732    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     124    |     123    |
|       from large pool |       0    |       1    |     122    |     122    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:52:16 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:52:16 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:52:16 | I | in layer model.layers.0
25-01-14 01:52:16 | I | quantizing weights for layer model.layers.0
25-01-14 01:52:16 | I | collecting info in model.layers.0
25-01-14 01:52:17 | I | collecting info in model.layers.0
25-01-14 01:52:19 | I | collecting info in model.layers.0
25-01-14 01:52:20 | I | collecting info in model.layers.0
25-01-14 01:52:22 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:52:29 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:52:29 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:52:36 | I |       - range scale = [    1.0000]
25-01-14 01:52:36 | I |         sum  error  = [    1.0175]
25-01-14 01:52:36 | I |         best error  = [    1.0175]
25-01-14 01:52:36 | I |     + error = [1.0175]
25-01-14 01:52:42 | I |       - range scale = [    1.0000]
25-01-14 01:52:42 | I |         sum  error  = [    2.2616]
25-01-14 01:52:42 | I |         best error  = [    2.2616]
25-01-14 01:52:42 | I |     + error = [2.2616]
25-01-14 01:52:42 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:52:49 | I |       - range scale = [    1.0000]
25-01-14 01:52:49 | I |         sum  error  = [    4.1955]
25-01-14 01:52:49 | I |         best error  = [    4.1955]
25-01-14 01:52:49 | I |     + error = [4.1955]
25-01-14 01:52:55 | I |       - range scale = [    1.0000]
25-01-14 01:52:55 | I |         sum  error  = [    5.8009]
25-01-14 01:52:55 | I |         best error  = [    5.8009]
25-01-14 01:52:55 | I |     + error = [5.8009]
25-01-14 01:52:55 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:52:56 | I |       - range scale = [    1.0000]
25-01-14 01:52:56 | I |         sum  error  = [    0.3004]
25-01-14 01:52:56 | I |         best error  = [    0.3004]
25-01-14 01:52:56 | I |     + error = [0.3004]
25-01-14 01:52:57 | I |       - range scale = [    1.0000]
25-01-14 01:52:57 | I |         sum  error  = [    0.3589]
25-01-14 01:52:57 | I |         best error  = [    0.3589]
25-01-14 01:52:57 | I |     + error = [0.3589]
25-01-14 01:52:57 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:52:58 | I |       - range scale = [    1.0000]
25-01-14 01:52:58 | I |         sum  error  = [    0.2591]
25-01-14 01:52:58 | I |         best error  = [    0.2591]
25-01-14 01:52:58 | I |     + error = [0.2591]
25-01-14 01:52:59 | I |       - range scale = [    1.0000]
25-01-14 01:52:59 | I |         sum  error  = [    0.4512]
25-01-14 01:52:59 | I |         best error  = [    0.4512]
25-01-14 01:52:59 | I |     + error = [0.4512]
25-01-14 01:52:59 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:53:00 | I |       - range scale = [    1.0000]
25-01-14 01:53:00 | I |         sum  error  = [    1.4893]
25-01-14 01:53:00 | I |         best error  = [    1.4893]
25-01-14 01:53:00 | I |     + error = [1.4893]
25-01-14 01:53:01 | I |       - range scale = [    1.0000]
25-01-14 01:53:01 | I |         sum  error  = [    1.6368]
25-01-14 01:53:01 | I |         best error  = [    1.6368]
25-01-14 01:53:01 | I |     + error = [1.6368]
25-01-14 01:53:01 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:53:02 | I |       - range scale = [    1.0000]
25-01-14 01:53:02 | I |         sum  error  = [    1.6554]
25-01-14 01:53:02 | I |         best error  = [    1.6554]
25-01-14 01:53:02 | I |     + error = [1.6554]
25-01-14 01:53:03 | I |       - range scale = [    1.0000]
25-01-14 01:53:03 | I |         sum  error  = [    1.9726]
25-01-14 01:53:03 | I |         best error  = [    1.9726]
25-01-14 01:53:03 | I |     + error = [1.9726]
25-01-14 01:53:03 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:53:04 | I |       - range scale = [    1.0000]
25-01-14 01:53:04 | I |         sum  error  = [    0.3095]
25-01-14 01:53:04 | I |         best error  = [    0.3095]
25-01-14 01:53:04 | I |     + error = [0.3095]
25-01-14 01:53:05 | I |       - range scale = [    1.0000]
25-01-14 01:53:05 | I |         sum  error  = [    0.4948]
25-01-14 01:53:05 | I |         best error  = [    0.4948]
25-01-14 01:53:05 | I |     + error = [0.4948]
25-01-14 01:53:05 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:53:08 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:53:10 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:53:12 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:53:15 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:53:17 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:53:20 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:53:26 | I | quantizing activations for layer model.layers.0
25-01-14 01:53:26 | I | collecting info in model.layers.0
25-01-14 01:53:28 | I | collecting info in model.layers.0
25-01-14 01:53:29 | I | collecting info in model.layers.0
25-01-14 01:53:31 | I | collecting info in model.layers.0
25-01-14 01:53:33 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:34 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:36 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:38 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:41 | I | forward this layer
25-01-14 01:53:41 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/120.pt
25-01-14 01:53:41 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/120.pt
25-01-14 01:53:42 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:53:42 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 61           |        cudaMalloc retries: 64        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 188625 GiB | 188603 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 187486 GiB | 187463 GiB |
|       from small pool |      3 MiB |      5 MiB |   1139 GiB |   1139 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 188625 GiB | 188603 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 187486 GiB | 187463 GiB |
|       from small pool |      3 MiB |      5 MiB |   1139 GiB |   1139 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 188510 GiB | 188488 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 187375 GiB | 187353 GiB |
|       from small pool |      3 MiB |      5 MiB |   1134 GiB |   1134 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4255 GiB |   4232 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4251 GiB |   4228 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 102190 GiB | 102189 GiB |
|       from large pool |    943 MiB |   1689 MiB | 100850 GiB | 100849 GiB |
|       from small pool |      0 MiB |      4 MiB |   1339 GiB |   1339 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   24530 K  |   24530 K  |
|       from large pool |     186    |     223    |    3796 K  |    3796 K  |
|       from small pool |     109    |     111    |   20733 K  |   20733 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   24530 K  |   24530 K  |
|       from large pool |     186    |     223    |    3796 K  |    3796 K  |
|       from small pool |     109    |     111    |   20733 K  |   20733 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   10214    |   10038    |
|       from large pool |     174    |     174    |    8065    |    7891    |
|       from small pool |       2    |       4    |    2149    |    2147    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |    9622 K  |    9622 K  |
|       from large pool |      21    |      24    |    1141 K  |    1141 K  |
|       from small pool |       8    |      16    |    8480 K  |    8480 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:53:42 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  27803 MiB |  20855 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27617 MiB |  20669 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  27803 MiB |  20855 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27617 MiB |  20669 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  27431 MiB |  20483 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  27245 MiB |  20297 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  29768 MiB |  22818 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29764 MiB |  22816 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2669 MiB |   2668 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2480 MiB |   2480 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    189 MiB |    188 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1430    |    1250    |
|       from large pool |     126    |     128    |     994    |     868    |
|       from small pool |      54    |      56    |     436    |     382    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1430    |    1250    |
|       from large pool |     126    |     128    |     994    |     868    |
|       from small pool |      54    |      56    |     436    |     382    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     872    |     745    |
|       from large pool |     126    |     128    |     870    |     744    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     126    |     125    |
|       from large pool |       0    |       1    |     124    |     124    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:53:42 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  27803 MiB |  20855 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27617 MiB |  20669 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  27803 MiB |  20855 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27617 MiB |  20669 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  27431 MiB |  20483 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  27245 MiB |  20297 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  29768 MiB |  22818 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29764 MiB |  22816 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2669 MiB |   2668 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2480 MiB |   2480 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    189 MiB |    188 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1430    |    1250    |
|       from large pool |     126    |     128    |     994    |     868    |
|       from small pool |      54    |      56    |     436    |     382    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1430    |    1250    |
|       from large pool |     126    |     128    |     994    |     868    |
|       from small pool |      54    |      56    |     436    |     382    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     872    |     745    |
|       from large pool |     126    |     128    |     870    |     744    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     126    |     125    |
|       from large pool |       0    |       1    |     124    |     124    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:53:42 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  26759 MiB |  20855 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26573 MiB |  20669 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  26759 MiB |  20855 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26573 MiB |  20669 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  26387 MiB |  20483 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  26201 MiB |  20297 MiB |
|       from small pool |      0 MiB |      1 MiB |    186 MiB |    186 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  28724 MiB |  22818 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28720 MiB |  22816 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2669 MiB |   2668 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2480 MiB |   2480 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    189 MiB |    188 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1397    |    1249    |
|       from large pool |     100    |     102    |     968    |     868    |
|       from small pool |      48    |      50    |     429    |     381    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1397    |    1249    |
|       from large pool |     100    |     102    |     968    |     868    |
|       from small pool |      48    |      50    |     429    |     381    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     846    |     745    |
|       from large pool |     100    |     102    |     844    |     744    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     126    |     125    |
|       from large pool |       0    |       1    |     124    |     124    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:53:42 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:53:42 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:53:42 | I | in layer model.layers.0
25-01-14 01:53:42 | I | quantizing weights for layer model.layers.0
25-01-14 01:53:42 | I | collecting info in model.layers.0
25-01-14 01:53:44 | I | collecting info in model.layers.0
25-01-14 01:53:45 | I | collecting info in model.layers.0
25-01-14 01:53:47 | I | collecting info in model.layers.0
25-01-14 01:53:49 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:50 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:52 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:54 | I | collecting calibration activations in model.layers.0
25-01-14 01:53:56 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:53:56 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:54:02 | I |       - range scale = [    1.0000]
25-01-14 01:54:02 | I |         sum  error  = [    1.0843]
25-01-14 01:54:02 | I |         best error  = [    1.0843]
25-01-14 01:54:02 | I |     + error = [1.0843]
25-01-14 01:54:09 | I |       - range scale = [    1.0000]
25-01-14 01:54:09 | I |         sum  error  = [    2.4452]
25-01-14 01:54:09 | I |         best error  = [    2.4452]
25-01-14 01:54:09 | I |     + error = [2.4452]
25-01-14 01:54:09 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:54:15 | I |       - range scale = [    1.0000]
25-01-14 01:54:15 | I |         sum  error  = [    4.4393]
25-01-14 01:54:15 | I |         best error  = [    4.4393]
25-01-14 01:54:15 | I |     + error = [4.4393]
25-01-14 01:54:22 | I |       - range scale = [    1.0000]
25-01-14 01:54:22 | I |         sum  error  = [    6.0261]
25-01-14 01:54:22 | I |         best error  = [    6.0261]
25-01-14 01:54:22 | I |     + error = [6.0261]
25-01-14 01:54:22 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:54:23 | I |       - range scale = [    1.0000]
25-01-14 01:54:23 | I |         sum  error  = [    0.3133]
25-01-14 01:54:23 | I |         best error  = [    0.3133]
25-01-14 01:54:23 | I |     + error = [0.3133]
25-01-14 01:54:24 | I |       - range scale = [    1.0000]
25-01-14 01:54:24 | I |         sum  error  = [    0.3795]
25-01-14 01:54:24 | I |         best error  = [    0.3795]
25-01-14 01:54:24 | I |     + error = [0.3795]
25-01-14 01:54:24 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:54:25 | I |       - range scale = [    1.0000]
25-01-14 01:54:25 | I |         sum  error  = [    0.2745]
25-01-14 01:54:25 | I |         best error  = [    0.2745]
25-01-14 01:54:25 | I |     + error = [0.2745]
25-01-14 01:54:25 | I |       - range scale = [    1.0000]
25-01-14 01:54:25 | I |         sum  error  = [    0.4575]
25-01-14 01:54:25 | I |         best error  = [    0.4575]
25-01-14 01:54:25 | I |     + error = [0.4575]
25-01-14 01:54:26 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:54:26 | I |       - range scale = [    1.0000]
25-01-14 01:54:26 | I |         sum  error  = [    1.6067]
25-01-14 01:54:26 | I |         best error  = [    1.6067]
25-01-14 01:54:26 | I |     + error = [1.6067]
25-01-14 01:54:27 | I |       - range scale = [    1.0000]
25-01-14 01:54:27 | I |         sum  error  = [    1.7118]
25-01-14 01:54:27 | I |         best error  = [    1.7118]
25-01-14 01:54:27 | I |     + error = [1.7118]
25-01-14 01:54:28 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:54:28 | I |       - range scale = [    1.0000]
25-01-14 01:54:28 | I |         sum  error  = [    1.7665]
25-01-14 01:54:28 | I |         best error  = [    1.7665]
25-01-14 01:54:28 | I |     + error = [1.7665]
25-01-14 01:54:29 | I |       - range scale = [    1.0000]
25-01-14 01:54:29 | I |         sum  error  = [    2.2153]
25-01-14 01:54:29 | I |         best error  = [    2.2153]
25-01-14 01:54:29 | I |     + error = [2.2153]
25-01-14 01:54:30 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:54:30 | I |       - range scale = [    1.0000]
25-01-14 01:54:30 | I |         sum  error  = [    0.3173]
25-01-14 01:54:30 | I |         best error  = [    0.3173]
25-01-14 01:54:30 | I |     + error = [0.3173]
25-01-14 01:54:32 | I |       - range scale = [    1.0000]
25-01-14 01:54:32 | I |         sum  error  = [    0.4926]
25-01-14 01:54:32 | I |         best error  = [    0.4926]
25-01-14 01:54:32 | I |     + error = [0.4926]
25-01-14 01:54:32 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:54:34 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:54:37 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:54:39 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:54:42 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:54:44 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:54:47 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:54:53 | I | quantizing activations for layer model.layers.0
25-01-14 01:54:53 | I | collecting info in model.layers.0
25-01-14 01:54:55 | I | collecting info in model.layers.0
25-01-14 01:54:56 | I | collecting info in model.layers.0
25-01-14 01:54:58 | I | collecting info in model.layers.0
25-01-14 01:55:00 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:01 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:03 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:05 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:08 | I | forward this layer
25-01-14 01:55:08 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/122.pt
25-01-14 01:55:08 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/122.pt
25-01-14 01:55:09 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:55:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 62           |        cudaMalloc retries: 65        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 194355 GiB | 194333 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 193187 GiB | 193165 GiB |
|       from small pool |      3 MiB |      5 MiB |   1167 GiB |   1167 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 194355 GiB | 194333 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 193187 GiB | 193165 GiB |
|       from small pool |      3 MiB |      5 MiB |   1167 GiB |   1167 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 194238 GiB | 194216 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 193075 GiB | 193053 GiB |
|       from small pool |      3 MiB |      5 MiB |   1162 GiB |   1162 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4324 GiB |   4301 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4320 GiB |   4297 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 105406 GiB | 105405 GiB |
|       from large pool |    943 MiB |   1689 MiB | 104033 GiB | 104032 GiB |
|       from small pool |      0 MiB |      4 MiB |   1372 GiB |   1372 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   25152 K  |   25152 K  |
|       from large pool |     186    |     223    |    3898 K  |    3898 K  |
|       from small pool |     109    |     111    |   21254 K  |   21254 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   25152 K  |   25152 K  |
|       from large pool |     186    |     223    |    3898 K  |    3898 K  |
|       from small pool |     109    |     111    |   21254 K  |   21254 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   10378    |   10202    |
|       from large pool |     174    |     174    |    8194    |    8020    |
|       from small pool |       2    |       4    |    2184    |    2182    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |    9855 K  |    9855 K  |
|       from large pool |      20    |      24    |    1171 K  |    1171 K  |
|       from small pool |       8    |      16    |    8683 K  |    8683 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:55:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  28139 MiB |  21191 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27950 MiB |  21002 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  28139 MiB |  21191 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27950 MiB |  21002 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  27761 MiB |  20813 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  27572 MiB |  20624 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  30136 MiB |  23186 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30132 MiB |  23184 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2712 MiB |   2711 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2520 MiB |   2520 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    192 MiB |    191 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1450    |    1270    |
|       from large pool |     126    |     128    |    1008    |     882    |
|       from small pool |      54    |      56    |     442    |     388    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1450    |    1270    |
|       from large pool |     126    |     128    |    1008    |     882    |
|       from small pool |      54    |      56    |     442    |     388    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     884    |     757    |
|       from large pool |     126    |     128    |     882    |     756    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     128    |     127    |
|       from large pool |       0    |       1    |     126    |     126    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:55:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  28139 MiB |  21191 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27950 MiB |  21002 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  28139 MiB |  21191 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  27950 MiB |  21002 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  27761 MiB |  20813 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  27572 MiB |  20624 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  30136 MiB |  23186 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30132 MiB |  23184 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2712 MiB |   2711 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2520 MiB |   2520 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    192 MiB |    191 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1450    |    1270    |
|       from large pool |     126    |     128    |    1008    |     882    |
|       from small pool |      54    |      56    |     442    |     388    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1450    |    1270    |
|       from large pool |     126    |     128    |    1008    |     882    |
|       from small pool |      54    |      56    |     442    |     388    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     884    |     757    |
|       from large pool |     126    |     128    |     882    |     756    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     128    |     127    |
|       from large pool |       0    |       1    |     126    |     126    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:55:09 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  27096 MiB |  21191 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26906 MiB |  21002 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  27096 MiB |  21191 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  26906 MiB |  21002 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  26718 MiB |  20813 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  26528 MiB |  20624 MiB |
|       from small pool |      0 MiB |      1 MiB |    189 MiB |    189 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  29092 MiB |  23186 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29088 MiB |  23184 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2712 MiB |   2711 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2520 MiB |   2520 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    192 MiB |    191 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1417    |    1269    |
|       from large pool |     100    |     102    |     982    |     882    |
|       from small pool |      48    |      50    |     435    |     387    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1417    |    1269    |
|       from large pool |     100    |     102    |     982    |     882    |
|       from small pool |      48    |      50    |     435    |     387    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     858    |     757    |
|       from large pool |     100    |     102    |     856    |     756    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     128    |     127    |
|       from large pool |       0    |       1    |     126    |     126    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:55:09 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:55:09 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:55:09 | I | in layer model.layers.0
25-01-14 01:55:09 | I | quantizing weights for layer model.layers.0
25-01-14 01:55:09 | I | collecting info in model.layers.0
25-01-14 01:55:11 | I | collecting info in model.layers.0
25-01-14 01:55:12 | I | collecting info in model.layers.0
25-01-14 01:55:14 | I | collecting info in model.layers.0
25-01-14 01:55:16 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:19 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:21 | I | collecting calibration activations in model.layers.0
25-01-14 01:55:23 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:55:23 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:55:29 | I |       - range scale = [    1.0000]
25-01-14 01:55:29 | I |         sum  error  = [    1.0514]
25-01-14 01:55:29 | I |         best error  = [    1.0514]
25-01-14 01:55:29 | I |     + error = [1.0514]
25-01-14 01:55:36 | I |       - range scale = [    1.0000]
25-01-14 01:55:36 | I |         sum  error  = [    2.3604]
25-01-14 01:55:36 | I |         best error  = [    2.3604]
25-01-14 01:55:36 | I |     + error = [2.3604]
25-01-14 01:55:36 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:55:43 | I |       - range scale = [    1.0000]
25-01-14 01:55:43 | I |         sum  error  = [    4.4329]
25-01-14 01:55:43 | I |         best error  = [    4.4329]
25-01-14 01:55:43 | I |     + error = [4.4329]
25-01-14 01:55:49 | I |       - range scale = [    1.0000]
25-01-14 01:55:49 | I |         sum  error  = [    6.3852]
25-01-14 01:55:49 | I |         best error  = [    6.3852]
25-01-14 01:55:49 | I |     + error = [6.3852]
25-01-14 01:55:50 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:55:50 | I |       - range scale = [    1.0000]
25-01-14 01:55:50 | I |         sum  error  = [    0.3036]
25-01-14 01:55:50 | I |         best error  = [    0.3036]
25-01-14 01:55:50 | I |     + error = [0.3036]
25-01-14 01:55:51 | I |       - range scale = [    1.0000]
25-01-14 01:55:51 | I |         sum  error  = [    0.3601]
25-01-14 01:55:51 | I |         best error  = [    0.3601]
25-01-14 01:55:51 | I |     + error = [0.3601]
25-01-14 01:55:51 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:55:52 | I |       - range scale = [    1.0000]
25-01-14 01:55:52 | I |         sum  error  = [    0.2706]
25-01-14 01:55:52 | I |         best error  = [    0.2706]
25-01-14 01:55:52 | I |     + error = [0.2706]
25-01-14 01:55:53 | I |       - range scale = [    1.0000]
25-01-14 01:55:53 | I |         sum  error  = [    0.4488]
25-01-14 01:55:53 | I |         best error  = [    0.4488]
25-01-14 01:55:53 | I |     + error = [0.4488]
25-01-14 01:55:53 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:55:54 | I |       - range scale = [    1.0000]
25-01-14 01:55:54 | I |         sum  error  = [    1.4466]
25-01-14 01:55:54 | I |         best error  = [    1.4466]
25-01-14 01:55:54 | I |     + error = [1.4466]
25-01-14 01:55:55 | I |       - range scale = [    1.0000]
25-01-14 01:55:55 | I |         sum  error  = [    1.6597]
25-01-14 01:55:55 | I |         best error  = [    1.6597]
25-01-14 01:55:55 | I |     + error = [1.6597]
25-01-14 01:55:55 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:55:56 | I |       - range scale = [    1.0000]
25-01-14 01:55:56 | I |         sum  error  = [    1.6190]
25-01-14 01:55:56 | I |         best error  = [    1.6190]
25-01-14 01:55:56 | I |     + error = [1.6190]
25-01-14 01:55:57 | I |       - range scale = [    1.0000]
25-01-14 01:55:57 | I |         sum  error  = [    2.0392]
25-01-14 01:55:57 | I |         best error  = [    2.0392]
25-01-14 01:55:57 | I |     + error = [2.0392]
25-01-14 01:55:57 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:55:58 | I |       - range scale = [    1.0000]
25-01-14 01:55:58 | I |         sum  error  = [    0.2830]
25-01-14 01:55:58 | I |         best error  = [    0.2830]
25-01-14 01:55:58 | I |     + error = [0.2830]
25-01-14 01:55:59 | I |       - range scale = [    1.0000]
25-01-14 01:55:59 | I |         sum  error  = [    0.4683]
25-01-14 01:55:59 | I |         best error  = [    0.4683]
25-01-14 01:55:59 | I |     + error = [0.4683]
25-01-14 01:55:59 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:56:02 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:56:04 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:56:07 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:56:09 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:56:11 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:56:14 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:56:20 | I | quantizing activations for layer model.layers.0
25-01-14 01:56:20 | I | collecting info in model.layers.0
25-01-14 01:56:22 | I | collecting info in model.layers.0
25-01-14 01:56:23 | I | collecting info in model.layers.0
25-01-14 01:56:25 | I | collecting info in model.layers.0
25-01-14 01:56:27 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:29 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:31 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:32 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:36 | I | forward this layer
25-01-14 01:56:36 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/124.pt
25-01-14 01:56:36 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/124.pt
25-01-14 01:56:36 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:56:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 63           |        cudaMalloc retries: 66        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 200170 GiB | 200148 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 198974 GiB | 198952 GiB |
|       from small pool |      3 MiB |      5 MiB |   1195 GiB |   1195 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 200170 GiB | 200148 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 198974 GiB | 198952 GiB |
|       from small pool |      3 MiB |      5 MiB |   1195 GiB |   1195 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 200052 GiB | 200030 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 198861 GiB | 198838 GiB |
|       from small pool |      3 MiB |      5 MiB |   1191 GiB |   1191 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4392 GiB |   4369 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4388 GiB |   4365 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 108715 GiB | 108714 GiB |
|       from large pool |    943 MiB |   1689 MiB | 107309 GiB | 107308 GiB |
|       from small pool |      0 MiB |      4 MiB |   1406 GiB |   1406 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   25782 K  |   25782 K  |
|       from large pool |     186    |     223    |    4001 K  |    4001 K  |
|       from small pool |     109    |     111    |   21781 K  |   21781 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   25782 K  |   25782 K  |
|       from large pool |     186    |     223    |    4001 K  |    4001 K  |
|       from small pool |     109    |     111    |   21781 K  |   21781 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   10536    |   10360    |
|       from large pool |     174    |     174    |    8317    |    8143    |
|       from small pool |       2    |       4    |    2219    |    2217    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |   10088 K  |   10088 K  |
|       from large pool |      21    |      24    |    1200 K  |    1200 K  |
|       from small pool |       8    |      16    |    8888 K  |    8888 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:56:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  28476 MiB |  21528 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28284 MiB |  21336 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  28476 MiB |  21528 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28284 MiB |  21336 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  28092 MiB |  21144 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  27900 MiB |  20952 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  30504 MiB |  23554 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30500 MiB |  23552 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2755 MiB |   2754 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2560 MiB |   2560 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    195 MiB |    194 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1470    |    1290    |
|       from large pool |     126    |     128    |    1022    |     896    |
|       from small pool |      54    |      56    |     448    |     394    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1470    |    1290    |
|       from large pool |     126    |     128    |    1022    |     896    |
|       from small pool |      54    |      56    |     448    |     394    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     896    |     769    |
|       from large pool |     126    |     128    |     894    |     768    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     130    |     129    |
|       from large pool |       0    |       1    |     128    |     128    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:56:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  28476 MiB |  21528 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28284 MiB |  21336 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  28476 MiB |  21528 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28284 MiB |  21336 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  28092 MiB |  21144 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  27900 MiB |  20952 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  30504 MiB |  23554 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30500 MiB |  23552 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2755 MiB |   2754 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2560 MiB |   2560 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    195 MiB |    194 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1470    |    1290    |
|       from large pool |     126    |     128    |    1022    |     896    |
|       from small pool |      54    |      56    |     448    |     394    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1470    |    1290    |
|       from large pool |     126    |     128    |    1022    |     896    |
|       from small pool |      54    |      56    |     448    |     394    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     896    |     769    |
|       from large pool |     126    |     128    |     894    |     768    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     130    |     129    |
|       from large pool |       0    |       1    |     128    |     128    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:56:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  27432 MiB |  21528 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27240 MiB |  21336 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  27432 MiB |  21528 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27240 MiB |  21336 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  27048 MiB |  21144 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  26856 MiB |  20952 MiB |
|       from small pool |      0 MiB |      1 MiB |    192 MiB |    192 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  29460 MiB |  23554 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29456 MiB |  23552 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2755 MiB |   2754 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2560 MiB |   2560 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    195 MiB |    194 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1437    |    1289    |
|       from large pool |     100    |     102    |     996    |     896    |
|       from small pool |      48    |      50    |     441    |     393    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1437    |    1289    |
|       from large pool |     100    |     102    |     996    |     896    |
|       from small pool |      48    |      50    |     441    |     393    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     870    |     769    |
|       from large pool |     100    |     102    |     868    |     768    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     130    |     129    |
|       from large pool |       0    |       1    |     128    |     128    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:56:36 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:56:36 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:56:36 | I | in layer model.layers.0
25-01-14 01:56:36 | I | quantizing weights for layer model.layers.0
25-01-14 01:56:36 | I | collecting info in model.layers.0
25-01-14 01:56:38 | I | collecting info in model.layers.0
25-01-14 01:56:40 | I | collecting info in model.layers.0
25-01-14 01:56:41 | I | collecting info in model.layers.0
25-01-14 01:56:43 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:48 | I | collecting calibration activations in model.layers.0
25-01-14 01:56:50 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:56:50 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:56:57 | I |       - range scale = [    1.0000]
25-01-14 01:56:57 | I |         sum  error  = [    1.0825]
25-01-14 01:56:57 | I |         best error  = [    1.0825]
25-01-14 01:56:57 | I |     + error = [1.0825]
25-01-14 01:57:04 | I |       - range scale = [    1.0000]
25-01-14 01:57:04 | I |         sum  error  = [    2.3735]
25-01-14 01:57:04 | I |         best error  = [    2.3735]
25-01-14 01:57:04 | I |     + error = [2.3735]
25-01-14 01:57:04 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:57:11 | I |       - range scale = [    1.0000]
25-01-14 01:57:11 | I |         sum  error  = [    4.7231]
25-01-14 01:57:11 | I |         best error  = [    4.7231]
25-01-14 01:57:11 | I |     + error = [4.7231]
25-01-14 01:57:17 | I |       - range scale = [    1.0000]
25-01-14 01:57:17 | I |         sum  error  = [    6.7616]
25-01-14 01:57:17 | I |         best error  = [    6.7616]
25-01-14 01:57:17 | I |     + error = [6.7616]
25-01-14 01:57:18 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:57:18 | I |       - range scale = [    1.0000]
25-01-14 01:57:18 | I |         sum  error  = [    0.3092]
25-01-14 01:57:18 | I |         best error  = [    0.3092]
25-01-14 01:57:18 | I |     + error = [0.3092]
25-01-14 01:57:19 | I |       - range scale = [    1.0000]
25-01-14 01:57:19 | I |         sum  error  = [    0.3617]
25-01-14 01:57:19 | I |         best error  = [    0.3617]
25-01-14 01:57:19 | I |     + error = [0.3617]
25-01-14 01:57:19 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:57:20 | I |       - range scale = [    1.0000]
25-01-14 01:57:20 | I |         sum  error  = [    0.2617]
25-01-14 01:57:20 | I |         best error  = [    0.2617]
25-01-14 01:57:20 | I |     + error = [0.2617]
25-01-14 01:57:21 | I |       - range scale = [    1.0000]
25-01-14 01:57:21 | I |         sum  error  = [    0.4348]
25-01-14 01:57:21 | I |         best error  = [    0.4348]
25-01-14 01:57:21 | I |     + error = [0.4348]
25-01-14 01:57:21 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:57:22 | I |       - range scale = [    1.0000]
25-01-14 01:57:22 | I |         sum  error  = [    1.4374]
25-01-14 01:57:22 | I |         best error  = [    1.4374]
25-01-14 01:57:22 | I |     + error = [1.4374]
25-01-14 01:57:23 | I |       - range scale = [    1.0000]
25-01-14 01:57:23 | I |         sum  error  = [    1.5845]
25-01-14 01:57:23 | I |         best error  = [    1.5845]
25-01-14 01:57:23 | I |     + error = [1.5845]
25-01-14 01:57:23 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:57:24 | I |       - range scale = [    1.0000]
25-01-14 01:57:24 | I |         sum  error  = [    1.5978]
25-01-14 01:57:24 | I |         best error  = [    1.5978]
25-01-14 01:57:24 | I |     + error = [1.5978]
25-01-14 01:57:25 | I |       - range scale = [    1.0000]
25-01-14 01:57:25 | I |         sum  error  = [    1.9173]
25-01-14 01:57:25 | I |         best error  = [    1.9173]
25-01-14 01:57:25 | I |     + error = [1.9173]
25-01-14 01:57:25 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:57:26 | I |       - range scale = [    1.0000]
25-01-14 01:57:26 | I |         sum  error  = [    0.2776]
25-01-14 01:57:26 | I |         best error  = [    0.2776]
25-01-14 01:57:26 | I |     + error = [0.2776]
25-01-14 01:57:27 | I |       - range scale = [    1.0000]
25-01-14 01:57:27 | I |         sum  error  = [    0.4301]
25-01-14 01:57:27 | I |         best error  = [    0.4301]
25-01-14 01:57:27 | I |     + error = [0.4301]
25-01-14 01:57:27 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:57:30 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:57:32 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:57:35 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:57:37 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:57:40 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:57:42 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:57:49 | I | quantizing activations for layer model.layers.0
25-01-14 01:57:49 | I | collecting info in model.layers.0
25-01-14 01:57:50 | I | collecting info in model.layers.0
25-01-14 01:57:52 | I | collecting info in model.layers.0
25-01-14 01:57:53 | I | collecting info in model.layers.0
25-01-14 01:57:55 | I | collecting calibration activations in model.layers.0
25-01-14 01:57:57 | I | collecting calibration activations in model.layers.0
25-01-14 01:57:59 | I | collecting calibration activations in model.layers.0
25-01-14 01:58:01 | I | collecting calibration activations in model.layers.0
25-01-14 01:58:04 | I | forward this layer
25-01-14 01:58:04 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/126.pt
25-01-14 01:58:04 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/126.pt
25-01-14 01:58:04 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:58:04 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 64           |        cudaMalloc retries: 67        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 206071 GiB | 206048 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 204846 GiB | 204824 GiB |
|       from small pool |      3 MiB |      5 MiB |   1224 GiB |   1224 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 206071 GiB | 206048 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 204846 GiB | 204824 GiB |
|       from small pool |      3 MiB |      5 MiB |   1224 GiB |   1224 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 205951 GiB | 205929 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 204731 GiB | 204709 GiB |
|       from small pool |      3 MiB |      5 MiB |   1219 GiB |   1219 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4461 GiB |   4438 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4457 GiB |   4434 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 112031 GiB | 112030 GiB |
|       from large pool |    943 MiB |   1689 MiB | 110591 GiB | 110590 GiB |
|       from small pool |      0 MiB |      4 MiB |   1440 GiB |   1440 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   26419 K  |   26418 K  |
|       from large pool |     186    |     223    |    4105 K  |    4105 K  |
|       from small pool |     109    |     111    |   22313 K  |   22313 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   26419 K  |   26418 K  |
|       from large pool |     186    |     223    |    4105 K  |    4105 K  |
|       from small pool |     109    |     111    |   22313 K  |   22313 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   10700    |   10524    |
|       from large pool |     174    |     174    |    8446    |    8272    |
|       from small pool |       2    |       4    |    2254    |    2252    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |   10323 K  |   10323 K  |
|       from large pool |      20    |      24    |    1228 K  |    1228 K  |
|       from small pool |       8    |      16    |    9094 K  |    9094 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:58:04 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  28812 MiB |  21864 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28617 MiB |  21669 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  28812 MiB |  21864 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28617 MiB |  21669 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  28422 MiB |  21474 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  28227 MiB |  21279 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  30872 MiB |  23922 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30868 MiB |  23920 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2798 MiB |   2797 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2600 MiB |   2600 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    198 MiB |    197 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1490    |    1310    |
|       from large pool |     126    |     128    |    1036    |     910    |
|       from small pool |      54    |      56    |     454    |     400    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1490    |    1310    |
|       from large pool |     126    |     128    |    1036    |     910    |
|       from small pool |      54    |      56    |     454    |     400    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     908    |     781    |
|       from large pool |     126    |     128    |     906    |     780    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     132    |     131    |
|       from large pool |       0    |       1    |     130    |     130    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:58:04 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  28812 MiB |  21864 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28617 MiB |  21669 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  28812 MiB |  21864 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28617 MiB |  21669 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  28422 MiB |  21474 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  28227 MiB |  21279 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  30872 MiB |  23922 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30868 MiB |  23920 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2798 MiB |   2797 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2600 MiB |   2600 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    198 MiB |    197 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1490    |    1310    |
|       from large pool |     126    |     128    |    1036    |     910    |
|       from small pool |      54    |      56    |     454    |     400    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1490    |    1310    |
|       from large pool |     126    |     128    |    1036    |     910    |
|       from small pool |      54    |      56    |     454    |     400    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     908    |     781    |
|       from large pool |     126    |     128    |     906    |     780    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     132    |     131    |
|       from large pool |       0    |       1    |     130    |     130    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:58:04 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  27768 MiB |  21864 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27573 MiB |  21669 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  27768 MiB |  21864 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27573 MiB |  21669 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  27378 MiB |  21474 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  27183 MiB |  21279 MiB |
|       from small pool |      0 MiB |      1 MiB |    195 MiB |    195 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  29828 MiB |  23922 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29824 MiB |  23920 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2798 MiB |   2797 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2600 MiB |   2600 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    198 MiB |    197 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1457    |    1309    |
|       from large pool |     100    |     102    |    1010    |     910    |
|       from small pool |      48    |      50    |     447    |     399    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1457    |    1309    |
|       from large pool |     100    |     102    |    1010    |     910    |
|       from small pool |      48    |      50    |     447    |     399    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     882    |     781    |
|       from large pool |     100    |     102    |     880    |     780    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     132    |     131    |
|       from large pool |       0    |       1    |     130    |     130    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:58:04 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:58:05 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:58:05 | I | in layer model.layers.0
25-01-14 01:58:05 | I | quantizing weights for layer model.layers.0
25-01-14 01:58:05 | I | collecting info in model.layers.0
25-01-14 01:58:06 | I | collecting info in model.layers.0
25-01-14 01:58:08 | I | collecting info in model.layers.0
25-01-14 01:58:10 | I | collecting info in model.layers.0
25-01-14 01:58:12 | I | collecting calibration activations in model.layers.0
25-01-14 01:58:14 | I | collecting calibration activations in model.layers.0
25-01-14 01:58:15 | I | collecting calibration activations in model.layers.0
25-01-14 01:58:17 | I | collecting calibration activations in model.layers.0
25-01-14 01:58:19 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:58:19 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:58:26 | I |       - range scale = [    1.0000]
25-01-14 01:58:26 | I |         sum  error  = [    1.1032]
25-01-14 01:58:26 | I |         best error  = [    1.1032]
25-01-14 01:58:26 | I |     + error = [1.1032]
25-01-14 01:58:33 | I |       - range scale = [    1.0000]
25-01-14 01:58:33 | I |         sum  error  = [    2.4493]
25-01-14 01:58:33 | I |         best error  = [    2.4493]
25-01-14 01:58:33 | I |     + error = [2.4493]
25-01-14 01:58:33 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 01:58:40 | I |       - range scale = [    1.0000]
25-01-14 01:58:40 | I |         sum  error  = [    4.6231]
25-01-14 01:58:40 | I |         best error  = [    4.6231]
25-01-14 01:58:40 | I |     + error = [4.6231]
25-01-14 01:58:46 | I |       - range scale = [    1.0000]
25-01-14 01:58:46 | I |         sum  error  = [    6.6337]
25-01-14 01:58:46 | I |         best error  = [    6.6337]
25-01-14 01:58:46 | I |     + error = [6.6337]
25-01-14 01:58:47 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 01:58:47 | I |       - range scale = [    1.0000]
25-01-14 01:58:47 | I |         sum  error  = [    0.3069]
25-01-14 01:58:47 | I |         best error  = [    0.3069]
25-01-14 01:58:47 | I |     + error = [0.3069]
25-01-14 01:58:48 | I |       - range scale = [    1.0000]
25-01-14 01:58:48 | I |         sum  error  = [    0.3658]
25-01-14 01:58:48 | I |         best error  = [    0.3658]
25-01-14 01:58:48 | I |     + error = [0.3658]
25-01-14 01:58:48 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 01:58:49 | I |       - range scale = [    1.0000]
25-01-14 01:58:49 | I |         sum  error  = [    0.2722]
25-01-14 01:58:49 | I |         best error  = [    0.2722]
25-01-14 01:58:49 | I |     + error = [0.2722]
25-01-14 01:58:50 | I |       - range scale = [    1.0000]
25-01-14 01:58:50 | I |         sum  error  = [    0.4571]
25-01-14 01:58:50 | I |         best error  = [    0.4571]
25-01-14 01:58:50 | I |     + error = [0.4571]
25-01-14 01:58:50 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 01:58:51 | I |       - range scale = [    1.0000]
25-01-14 01:58:51 | I |         sum  error  = [    1.4902]
25-01-14 01:58:51 | I |         best error  = [    1.4902]
25-01-14 01:58:51 | I |     + error = [1.4902]
25-01-14 01:58:52 | I |       - range scale = [    1.0000]
25-01-14 01:58:52 | I |         sum  error  = [    1.6556]
25-01-14 01:58:52 | I |         best error  = [    1.6556]
25-01-14 01:58:52 | I |     + error = [1.6556]
25-01-14 01:58:52 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 01:58:53 | I |       - range scale = [    1.0000]
25-01-14 01:58:53 | I |         sum  error  = [    1.6673]
25-01-14 01:58:53 | I |         best error  = [    1.6673]
25-01-14 01:58:53 | I |     + error = [1.6673]
25-01-14 01:58:54 | I |       - range scale = [    1.0000]
25-01-14 01:58:54 | I |         sum  error  = [    2.0118]
25-01-14 01:58:54 | I |         best error  = [    2.0118]
25-01-14 01:58:54 | I |     + error = [2.0118]
25-01-14 01:58:54 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 01:58:55 | I |       - range scale = [    1.0000]
25-01-14 01:58:55 | I |         sum  error  = [    0.2964]
25-01-14 01:58:55 | I |         best error  = [    0.2964]
25-01-14 01:58:55 | I |     + error = [0.2964]
25-01-14 01:58:56 | I |       - range scale = [    1.0000]
25-01-14 01:58:56 | I |         sum  error  = [    0.4687]
25-01-14 01:58:56 | I |         best error  = [    0.4687]
25-01-14 01:58:56 | I |     + error = [0.4687]
25-01-14 01:58:56 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 01:58:59 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 01:59:01 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 01:59:04 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 01:59:06 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 01:59:09 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 01:59:11 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 01:59:18 | I | quantizing activations for layer model.layers.0
25-01-14 01:59:18 | I | collecting info in model.layers.0
25-01-14 01:59:19 | I | collecting info in model.layers.0
25-01-14 01:59:21 | I | collecting info in model.layers.0
25-01-14 01:59:22 | I | collecting info in model.layers.0
25-01-14 01:59:24 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:26 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:28 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:30 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:34 | I | forward this layer
25-01-14 01:59:34 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/128.pt
25-01-14 01:59:34 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/128.pt
25-01-14 01:59:34 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 01:59:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 65           |        cudaMalloc retries: 68        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 212057 GiB | 212035 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 210803 GiB | 210781 GiB |
|       from small pool |      3 MiB |      5 MiB |   1253 GiB |   1253 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 212057 GiB | 212035 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 210803 GiB | 210781 GiB |
|       from small pool |      3 MiB |      5 MiB |   1253 GiB |   1253 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 211935 GiB | 211913 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 210686 GiB | 210664 GiB |
|       from small pool |      3 MiB |      5 MiB |   1248 GiB |   1248 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4529 GiB |   4506 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4524 GiB |   4501 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 115442 GiB | 115441 GiB |
|       from large pool |    943 MiB |   1689 MiB | 113968 GiB | 113967 GiB |
|       from small pool |      0 MiB |      4 MiB |   1474 GiB |   1474 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   27063 K  |   27062 K  |
|       from large pool |     186    |     223    |    4210 K  |    4210 K  |
|       from small pool |     109    |     111    |   22852 K  |   22852 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   27063 K  |   27062 K  |
|       from large pool |     186    |     223    |    4210 K  |    4210 K  |
|       from small pool |     109    |     111    |   22852 K  |   22852 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   10858    |   10682    |
|       from large pool |     174    |     174    |    8569    |    8395    |
|       from small pool |       2    |       4    |    2289    |    2287    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |   10561 K  |   10561 K  |
|       from large pool |      21    |      24    |    1257 K  |    1257 K  |
|       from small pool |       8    |      16    |    9303 K  |    9303 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:59:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  29149 MiB |  22200 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28950 MiB |  22002 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  29149 MiB |  22200 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28950 MiB |  22002 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  28753 MiB |  21804 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  28554 MiB |  21606 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  31240 MiB |  24290 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31236 MiB |  24288 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2841 MiB |   2840 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2640 MiB |   2640 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    201 MiB |    200 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1510    |    1330    |
|       from large pool |     126    |     128    |    1050    |     924    |
|       from small pool |      54    |      56    |     460    |     406    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1510    |    1330    |
|       from large pool |     126    |     128    |    1050    |     924    |
|       from small pool |      54    |      56    |     460    |     406    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     920    |     793    |
|       from large pool |     126    |     128    |     918    |     792    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     134    |     133    |
|       from large pool |       0    |       1    |     132    |     132    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:59:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  29149 MiB |  22200 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28950 MiB |  22002 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  29149 MiB |  22200 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  28950 MiB |  22002 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  28753 MiB |  21804 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  28554 MiB |  21606 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  31240 MiB |  24290 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31236 MiB |  24288 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2841 MiB |   2840 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2640 MiB |   2640 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    201 MiB |    200 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1510    |    1330    |
|       from large pool |     126    |     128    |    1050    |     924    |
|       from small pool |      54    |      56    |     460    |     406    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1510    |    1330    |
|       from large pool |     126    |     128    |    1050    |     924    |
|       from small pool |      54    |      56    |     460    |     406    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     920    |     793    |
|       from large pool |     126    |     128    |     918    |     792    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     134    |     133    |
|       from large pool |       0    |       1    |     132    |     132    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:59:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  28105 MiB |  22200 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27906 MiB |  22002 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  28105 MiB |  22200 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  27906 MiB |  22002 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  27709 MiB |  21804 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  27510 MiB |  21606 MiB |
|       from small pool |      0 MiB |      1 MiB |    198 MiB |    198 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  30196 MiB |  24290 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30192 MiB |  24288 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2841 MiB |   2840 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2640 MiB |   2640 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    201 MiB |    200 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1477    |    1329    |
|       from large pool |     100    |     102    |    1024    |     924    |
|       from small pool |      48    |      50    |     453    |     405    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1477    |    1329    |
|       from large pool |     100    |     102    |    1024    |     924    |
|       from small pool |      48    |      50    |     453    |     405    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     894    |     793    |
|       from large pool |     100    |     102    |     892    |     792    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     134    |     133    |
|       from large pool |       0    |       1    |     132    |     132    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 01:59:34 | W | attempting to recover from OOM in forward/backward pass
25-01-14 01:59:34 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 01:59:34 | I | in layer model.layers.0
25-01-14 01:59:34 | I | quantizing weights for layer model.layers.0
25-01-14 01:59:34 | I | collecting info in model.layers.0
25-01-14 01:59:36 | I | collecting info in model.layers.0
25-01-14 01:59:37 | I | collecting info in model.layers.0
25-01-14 01:59:39 | I | collecting info in model.layers.0
25-01-14 01:59:41 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:43 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:45 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:47 | I | collecting calibration activations in model.layers.0
25-01-14 01:59:49 | I | - Quantizing decoder layer model.layers.0
25-01-14 01:59:49 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 01:59:55 | I |       - range scale = [    1.0000]
25-01-14 01:59:55 | I |         sum  error  = [    1.1768]
25-01-14 01:59:55 | I |         best error  = [    1.1768]
25-01-14 01:59:55 | I |     + error = [1.1768]
25-01-14 02:00:02 | I |       - range scale = [    1.0000]
25-01-14 02:00:02 | I |         sum  error  = [    2.5449]
25-01-14 02:00:02 | I |         best error  = [    2.5449]
25-01-14 02:00:02 | I |     + error = [2.5449]
25-01-14 02:00:03 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:00:09 | I |       - range scale = [    1.0000]
25-01-14 02:00:09 | I |         sum  error  = [    4.9336]
25-01-14 02:00:09 | I |         best error  = [    4.9336]
25-01-14 02:00:09 | I |     + error = [4.9336]
25-01-14 02:00:16 | I |       - range scale = [    1.0000]
25-01-14 02:00:16 | I |         sum  error  = [    7.1163]
25-01-14 02:00:16 | I |         best error  = [    7.1163]
25-01-14 02:00:16 | I |     + error = [7.1163]
25-01-14 02:00:16 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:00:17 | I |       - range scale = [    1.0000]
25-01-14 02:00:17 | I |         sum  error  = [    0.3134]
25-01-14 02:00:17 | I |         best error  = [    0.3134]
25-01-14 02:00:17 | I |     + error = [0.3134]
25-01-14 02:00:18 | I |       - range scale = [    1.0000]
25-01-14 02:00:18 | I |         sum  error  = [    0.3701]
25-01-14 02:00:18 | I |         best error  = [    0.3701]
25-01-14 02:00:18 | I |     + error = [0.3701]
25-01-14 02:00:18 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:00:19 | I |       - range scale = [    1.0000]
25-01-14 02:00:19 | I |         sum  error  = [    0.2831]
25-01-14 02:00:19 | I |         best error  = [    0.2831]
25-01-14 02:00:19 | I |     + error = [0.2831]
25-01-14 02:00:20 | I |       - range scale = [    1.0000]
25-01-14 02:00:20 | I |         sum  error  = [    0.4642]
25-01-14 02:00:20 | I |         best error  = [    0.4642]
25-01-14 02:00:20 | I |     + error = [0.4642]
25-01-14 02:00:20 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:00:21 | I |       - range scale = [    1.0000]
25-01-14 02:00:21 | I |         sum  error  = [    1.6383]
25-01-14 02:00:21 | I |         best error  = [    1.6383]
25-01-14 02:00:21 | I |     + error = [1.6383]
25-01-14 02:00:22 | I |       - range scale = [    1.0000]
25-01-14 02:00:22 | I |         sum  error  = [    1.7188]
25-01-14 02:00:22 | I |         best error  = [    1.7188]
25-01-14 02:00:22 | I |     + error = [1.7188]
25-01-14 02:00:22 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:00:23 | I |       - range scale = [    1.0000]
25-01-14 02:00:23 | I |         sum  error  = [    1.8008]
25-01-14 02:00:23 | I |         best error  = [    1.8008]
25-01-14 02:00:23 | I |     + error = [1.8008]
25-01-14 02:00:24 | I |       - range scale = [    1.0000]
25-01-14 02:00:24 | I |         sum  error  = [    2.0896]
25-01-14 02:00:24 | I |         best error  = [    2.0896]
25-01-14 02:00:24 | I |     + error = [2.0896]
25-01-14 02:00:24 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:00:25 | I |       - range scale = [    1.0000]
25-01-14 02:00:25 | I |         sum  error  = [    0.3364]
25-01-14 02:00:25 | I |         best error  = [    0.3364]
25-01-14 02:00:25 | I |     + error = [0.3364]
25-01-14 02:00:26 | I |       - range scale = [    1.0000]
25-01-14 02:00:26 | I |         sum  error  = [    0.5115]
25-01-14 02:00:26 | I |         best error  = [    0.5115]
25-01-14 02:00:26 | I |     + error = [0.5115]
25-01-14 02:00:26 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:00:28 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:00:31 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:00:33 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:00:36 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:00:38 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:00:41 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:00:47 | I | quantizing activations for layer model.layers.0
25-01-14 02:00:47 | I | collecting info in model.layers.0
25-01-14 02:00:49 | I | collecting info in model.layers.0
25-01-14 02:00:50 | I | collecting info in model.layers.0
25-01-14 02:00:52 | I | collecting info in model.layers.0
25-01-14 02:00:54 | I | collecting calibration activations in model.layers.0
25-01-14 02:00:56 | I | collecting calibration activations in model.layers.0
25-01-14 02:00:58 | I | collecting calibration activations in model.layers.0
25-01-14 02:00:59 | I | collecting calibration activations in model.layers.0
25-01-14 02:01:03 | I | forward this layer
25-01-14 02:01:03 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/130.pt
25-01-14 02:01:03 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/130.pt
25-01-14 02:01:03 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:01:03 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 66           |        cudaMalloc retries: 69        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 218128 GiB | 218106 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 216846 GiB | 216823 GiB |
|       from small pool |      3 MiB |      5 MiB |   1282 GiB |   1282 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 218128 GiB | 218106 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 216846 GiB | 216823 GiB |
|       from small pool |      3 MiB |      5 MiB |   1282 GiB |   1282 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 218005 GiB | 217983 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 216727 GiB | 216705 GiB |
|       from small pool |      3 MiB |      5 MiB |   1277 GiB |   1277 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4598 GiB |   4575 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4593 GiB |   4570 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 118859 GiB | 118858 GiB |
|       from large pool |    943 MiB |   1689 MiB | 117350 GiB | 117349 GiB |
|       from small pool |      0 MiB |      4 MiB |   1509 GiB |   1509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   27714 K  |   27713 K  |
|       from large pool |     186    |     223    |    4317 K  |    4317 K  |
|       from small pool |     109    |     111    |   23396 K  |   23396 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   27714 K  |   27713 K  |
|       from large pool |     186    |     223    |    4317 K  |    4317 K  |
|       from small pool |     109    |     111    |   23396 K  |   23396 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11022    |   10846    |
|       from large pool |     174    |     174    |    8698    |    8524    |
|       from small pool |       2    |       4    |    2324    |    2322    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |   10800 K  |   10800 K  |
|       from large pool |      20    |      24    |    1286 K  |    1286 K  |
|       from small pool |       8    |      16    |    9514 K  |    9514 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:01:03 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  29485 MiB |  22537 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29284 MiB |  22336 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  29485 MiB |  22537 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29284 MiB |  22336 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  29083 MiB |  22135 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  28882 MiB |  21934 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  31608 MiB |  24658 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31604 MiB |  24656 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2884 MiB |   2883 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2680 MiB |   2680 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    204 MiB |    203 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1530    |    1350    |
|       from large pool |     126    |     128    |    1064    |     938    |
|       from small pool |      54    |      56    |     466    |     412    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1530    |    1350    |
|       from large pool |     126    |     128    |    1064    |     938    |
|       from small pool |      54    |      56    |     466    |     412    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     932    |     805    |
|       from large pool |     126    |     128    |     930    |     804    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     136    |     135    |
|       from large pool |       0    |       1    |     134    |     134    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:01:03 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  29485 MiB |  22537 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29284 MiB |  22336 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  29485 MiB |  22537 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29284 MiB |  22336 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  29083 MiB |  22135 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  28882 MiB |  21934 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  31608 MiB |  24658 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31604 MiB |  24656 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2884 MiB |   2883 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2680 MiB |   2680 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    204 MiB |    203 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1530    |    1350    |
|       from large pool |     126    |     128    |    1064    |     938    |
|       from small pool |      54    |      56    |     466    |     412    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1530    |    1350    |
|       from large pool |     126    |     128    |    1064    |     938    |
|       from small pool |      54    |      56    |     466    |     412    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     932    |     805    |
|       from large pool |     126    |     128    |     930    |     804    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     136    |     135    |
|       from large pool |       0    |       1    |     134    |     134    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:01:03 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  28441 MiB |  22537 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28240 MiB |  22336 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  28441 MiB |  22537 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28240 MiB |  22336 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  28039 MiB |  22135 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  27838 MiB |  21934 MiB |
|       from small pool |      0 MiB |      1 MiB |    201 MiB |    201 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  30564 MiB |  24658 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30560 MiB |  24656 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2884 MiB |   2883 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2680 MiB |   2680 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    204 MiB |    203 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1497    |    1349    |
|       from large pool |     100    |     102    |    1038    |     938    |
|       from small pool |      48    |      50    |     459    |     411    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1497    |    1349    |
|       from large pool |     100    |     102    |    1038    |     938    |
|       from small pool |      48    |      50    |     459    |     411    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     906    |     805    |
|       from large pool |     100    |     102    |     904    |     804    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     136    |     135    |
|       from large pool |       0    |       1    |     134    |     134    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:01:03 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:01:04 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:01:04 | I | in layer model.layers.0
25-01-14 02:01:04 | I | quantizing weights for layer model.layers.0
25-01-14 02:01:04 | I | collecting info in model.layers.0
25-01-14 02:01:05 | I | collecting info in model.layers.0
25-01-14 02:01:07 | I | collecting info in model.layers.0
25-01-14 02:01:09 | I | collecting info in model.layers.0
25-01-14 02:01:11 | I | collecting calibration activations in model.layers.0
25-01-14 02:01:13 | I | collecting calibration activations in model.layers.0
25-01-14 02:01:15 | I | collecting calibration activations in model.layers.0
25-01-14 02:01:16 | I | collecting calibration activations in model.layers.0
25-01-14 02:01:19 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:01:19 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:01:25 | I |       - range scale = [    1.0000]
25-01-14 02:01:25 | I |         sum  error  = [    1.1949]
25-01-14 02:01:25 | I |         best error  = [    1.1949]
25-01-14 02:01:25 | I |     + error = [1.1949]
25-01-14 02:01:32 | I |       - range scale = [    1.0000]
25-01-14 02:01:32 | I |         sum  error  = [    2.6457]
25-01-14 02:01:32 | I |         best error  = [    2.6457]
25-01-14 02:01:32 | I |     + error = [2.6457]
25-01-14 02:01:33 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:01:40 | I |       - range scale = [    1.0000]
25-01-14 02:01:40 | I |         sum  error  = [    5.1073]
25-01-14 02:01:40 | I |         best error  = [    5.1073]
25-01-14 02:01:40 | I |     + error = [5.1073]
25-01-14 02:01:46 | I |       - range scale = [    1.0000]
25-01-14 02:01:46 | I |         sum  error  = [    7.3983]
25-01-14 02:01:46 | I |         best error  = [    7.3983]
25-01-14 02:01:46 | I |     + error = [7.3983]
25-01-14 02:01:47 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:01:47 | I |       - range scale = [    1.0000]
25-01-14 02:01:47 | I |         sum  error  = [    0.3200]
25-01-14 02:01:47 | I |         best error  = [    0.3200]
25-01-14 02:01:47 | I |     + error = [0.3200]
25-01-14 02:01:48 | I |       - range scale = [    1.0000]
25-01-14 02:01:48 | I |         sum  error  = [    0.3791]
25-01-14 02:01:48 | I |         best error  = [    0.3791]
25-01-14 02:01:48 | I |     + error = [0.3791]
25-01-14 02:01:48 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:01:49 | I |       - range scale = [    1.0000]
25-01-14 02:01:49 | I |         sum  error  = [    0.2854]
25-01-14 02:01:49 | I |         best error  = [    0.2854]
25-01-14 02:01:49 | I |     + error = [0.2854]
25-01-14 02:01:50 | I |       - range scale = [    1.0000]
25-01-14 02:01:50 | I |         sum  error  = [    0.4896]
25-01-14 02:01:50 | I |         best error  = [    0.4896]
25-01-14 02:01:50 | I |     + error = [0.4896]
25-01-14 02:01:50 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:01:51 | I |       - range scale = [    1.0000]
25-01-14 02:01:51 | I |         sum  error  = [    1.5284]
25-01-14 02:01:51 | I |         best error  = [    1.5284]
25-01-14 02:01:51 | I |     + error = [1.5284]
25-01-14 02:01:52 | I |       - range scale = [    1.0000]
25-01-14 02:01:52 | I |         sum  error  = [    1.7481]
25-01-14 02:01:52 | I |         best error  = [    1.7481]
25-01-14 02:01:52 | I |     + error = [1.7481]
25-01-14 02:01:52 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:01:53 | I |       - range scale = [    1.0000]
25-01-14 02:01:53 | I |         sum  error  = [    1.7140]
25-01-14 02:01:53 | I |         best error  = [    1.7140]
25-01-14 02:01:53 | I |     + error = [1.7140]
25-01-14 02:01:54 | I |       - range scale = [    1.0000]
25-01-14 02:01:54 | I |         sum  error  = [    2.1625]
25-01-14 02:01:54 | I |         best error  = [    2.1625]
25-01-14 02:01:54 | I |     + error = [2.1625]
25-01-14 02:01:54 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:01:55 | I |       - range scale = [    1.0000]
25-01-14 02:01:55 | I |         sum  error  = [    0.3165]
25-01-14 02:01:55 | I |         best error  = [    0.3165]
25-01-14 02:01:55 | I |     + error = [0.3165]
25-01-14 02:01:56 | I |       - range scale = [    1.0000]
25-01-14 02:01:56 | I |         sum  error  = [    0.5063]
25-01-14 02:01:56 | I |         best error  = [    0.5063]
25-01-14 02:01:56 | I |     + error = [0.5063]
25-01-14 02:01:56 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:01:59 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:02:01 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:02:03 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:02:06 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:02:08 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:02:11 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:02:18 | I | quantizing activations for layer model.layers.0
25-01-14 02:02:18 | I | collecting info in model.layers.0
25-01-14 02:02:19 | I | collecting info in model.layers.0
25-01-14 02:02:21 | I | collecting info in model.layers.0
25-01-14 02:02:22 | I | collecting info in model.layers.0
25-01-14 02:02:25 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:27 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:28 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:30 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:34 | I | forward this layer
25-01-14 02:02:34 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/132.pt
25-01-14 02:02:34 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/132.pt
25-01-14 02:02:34 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:02:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 67           |        cudaMalloc retries: 70        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 224285 GiB | 224263 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 222973 GiB | 222951 GiB |
|       from small pool |      3 MiB |      5 MiB |   1312 GiB |   1312 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 224285 GiB | 224263 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 222973 GiB | 222951 GiB |
|       from small pool |      3 MiB |      5 MiB |   1312 GiB |   1312 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 224160 GiB | 224138 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 222853 GiB | 222831 GiB |
|       from small pool |      3 MiB |      5 MiB |   1307 GiB |   1307 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4666 GiB |   4643 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4661 GiB |   4638 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 122372 GiB | 122371 GiB |
|       from large pool |    943 MiB |   1689 MiB | 120828 GiB | 120827 GiB |
|       from small pool |      0 MiB |      4 MiB |   1544 GiB |   1544 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   28372 K  |   28372 K  |
|       from large pool |     186    |     223    |    4425 K  |    4425 K  |
|       from small pool |     109    |     111    |   23947 K  |   23947 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   28372 K  |   28372 K  |
|       from large pool |     186    |     223    |    4425 K  |    4425 K  |
|       from small pool |     109    |     111    |   23947 K  |   23947 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11180    |   11004    |
|       from large pool |     174    |     174    |    8821    |    8647    |
|       from small pool |       2    |       4    |    2359    |    2357    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |   11043 K  |   11043 K  |
|       from large pool |      21    |      24    |    1316 K  |    1316 K  |
|       from small pool |       8    |      16    |    9727 K  |    9727 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:02:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  29821 MiB |  22873 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29617 MiB |  22669 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  29821 MiB |  22873 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29617 MiB |  22669 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  29413 MiB |  22465 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  29209 MiB |  22261 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  31976 MiB |  25026 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31972 MiB |  25024 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2927 MiB |   2926 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2720 MiB |   2720 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    207 MiB |    206 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1550    |    1370    |
|       from large pool |     126    |     128    |    1078    |     952    |
|       from small pool |      54    |      56    |     472    |     418    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1550    |    1370    |
|       from large pool |     126    |     128    |    1078    |     952    |
|       from small pool |      54    |      56    |     472    |     418    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     944    |     817    |
|       from large pool |     126    |     128    |     942    |     816    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     138    |     137    |
|       from large pool |       0    |       1    |     136    |     136    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:02:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  29821 MiB |  22873 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29617 MiB |  22669 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  29821 MiB |  22873 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29617 MiB |  22669 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  29413 MiB |  22465 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  29209 MiB |  22261 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  31976 MiB |  25026 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31972 MiB |  25024 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2927 MiB |   2926 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2720 MiB |   2720 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    207 MiB |    206 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1550    |    1370    |
|       from large pool |     126    |     128    |    1078    |     952    |
|       from small pool |      54    |      56    |     472    |     418    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1550    |    1370    |
|       from large pool |     126    |     128    |    1078    |     952    |
|       from small pool |      54    |      56    |     472    |     418    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     944    |     817    |
|       from large pool |     126    |     128    |     942    |     816    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     138    |     137    |
|       from large pool |       0    |       1    |     136    |     136    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:02:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  28777 MiB |  22873 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28573 MiB |  22669 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  28777 MiB |  22873 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28573 MiB |  22669 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  28369 MiB |  22465 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  28165 MiB |  22261 MiB |
|       from small pool |      0 MiB |      1 MiB |    204 MiB |    204 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  30932 MiB |  25026 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30928 MiB |  25024 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2927 MiB |   2926 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2720 MiB |   2720 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    207 MiB |    206 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1517    |    1369    |
|       from large pool |     100    |     102    |    1052    |     952    |
|       from small pool |      48    |      50    |     465    |     417    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1517    |    1369    |
|       from large pool |     100    |     102    |    1052    |     952    |
|       from small pool |      48    |      50    |     465    |     417    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     918    |     817    |
|       from large pool |     100    |     102    |     916    |     816    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     138    |     137    |
|       from large pool |       0    |       1    |     136    |     136    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:02:34 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:02:35 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:02:35 | I | in layer model.layers.0
25-01-14 02:02:35 | I | quantizing weights for layer model.layers.0
25-01-14 02:02:35 | I | collecting info in model.layers.0
25-01-14 02:02:36 | I | collecting info in model.layers.0
25-01-14 02:02:38 | I | collecting info in model.layers.0
25-01-14 02:02:40 | I | collecting info in model.layers.0
25-01-14 02:02:42 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:44 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:46 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:47 | I | collecting calibration activations in model.layers.0
25-01-14 02:02:50 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:02:50 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:02:57 | I |       - range scale = [    1.0000]
25-01-14 02:02:57 | I |         sum  error  = [    1.1904]
25-01-14 02:02:57 | I |         best error  = [    1.1904]
25-01-14 02:02:57 | I |     + error = [1.1904]
25-01-14 02:03:04 | I |       - range scale = [    1.0000]
25-01-14 02:03:04 | I |         sum  error  = [    2.7129]
25-01-14 02:03:04 | I |         best error  = [    2.7129]
25-01-14 02:03:04 | I |     + error = [2.7129]
25-01-14 02:03:04 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:03:11 | I |       - range scale = [    1.0000]
25-01-14 02:03:11 | I |         sum  error  = [    5.7388]
25-01-14 02:03:11 | I |         best error  = [    5.7388]
25-01-14 02:03:11 | I |     + error = [5.7388]
25-01-14 02:03:18 | I |       - range scale = [    1.0000]
25-01-14 02:03:18 | I |         sum  error  = [    8.4187]
25-01-14 02:03:18 | I |         best error  = [    8.4187]
25-01-14 02:03:18 | I |     + error = [8.4187]
25-01-14 02:03:18 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:03:19 | I |       - range scale = [    1.0000]
25-01-14 02:03:19 | I |         sum  error  = [    0.3212]
25-01-14 02:03:19 | I |         best error  = [    0.3212]
25-01-14 02:03:19 | I |     + error = [0.3212]
25-01-14 02:03:20 | I |       - range scale = [    1.0000]
25-01-14 02:03:20 | I |         sum  error  = [    0.3923]
25-01-14 02:03:20 | I |         best error  = [    0.3923]
25-01-14 02:03:20 | I |     + error = [0.3923]
25-01-14 02:03:20 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:03:21 | I |       - range scale = [    1.0000]
25-01-14 02:03:21 | I |         sum  error  = [    0.3076]
25-01-14 02:03:21 | I |         best error  = [    0.3076]
25-01-14 02:03:21 | I |     + error = [0.3076]
25-01-14 02:03:21 | I |       - range scale = [    1.0000]
25-01-14 02:03:21 | I |         sum  error  = [    0.4830]
25-01-14 02:03:21 | I |         best error  = [    0.4830]
25-01-14 02:03:21 | I |     + error = [0.4830]
25-01-14 02:03:22 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:03:22 | I |       - range scale = [    1.0000]
25-01-14 02:03:22 | I |         sum  error  = [    1.7867]
25-01-14 02:03:22 | I |         best error  = [    1.7867]
25-01-14 02:03:22 | I |     + error = [1.7867]
25-01-14 02:03:23 | I |       - range scale = [    1.0000]
25-01-14 02:03:23 | I |         sum  error  = [    1.9347]
25-01-14 02:03:23 | I |         best error  = [    1.9347]
25-01-14 02:03:23 | I |     + error = [1.9347]
25-01-14 02:03:24 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:03:24 | I |       - range scale = [    1.0000]
25-01-14 02:03:24 | I |         sum  error  = [    1.9730]
25-01-14 02:03:24 | I |         best error  = [    1.9730]
25-01-14 02:03:24 | I |     + error = [1.9730]
25-01-14 02:03:25 | I |       - range scale = [    1.0000]
25-01-14 02:03:25 | I |         sum  error  = [    2.3527]
25-01-14 02:03:25 | I |         best error  = [    2.3527]
25-01-14 02:03:25 | I |     + error = [2.3527]
25-01-14 02:03:26 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:03:26 | I |       - range scale = [    1.0000]
25-01-14 02:03:26 | I |         sum  error  = [    0.3606]
25-01-14 02:03:26 | I |         best error  = [    0.3606]
25-01-14 02:03:26 | I |     + error = [0.3606]
25-01-14 02:03:27 | I |       - range scale = [    1.0000]
25-01-14 02:03:27 | I |         sum  error  = [    0.5515]
25-01-14 02:03:27 | I |         best error  = [    0.5515]
25-01-14 02:03:27 | I |     + error = [0.5515]
25-01-14 02:03:28 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:03:30 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:03:33 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:03:35 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:03:37 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:03:40 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:03:42 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:03:49 | I | quantizing activations for layer model.layers.0
25-01-14 02:03:49 | I | collecting info in model.layers.0
25-01-14 02:03:51 | I | collecting info in model.layers.0
25-01-14 02:03:52 | I | collecting info in model.layers.0
25-01-14 02:03:54 | I | collecting info in model.layers.0
25-01-14 02:03:56 | I | collecting calibration activations in model.layers.0
25-01-14 02:03:58 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:00 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:02 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:05 | I | forward this layer
25-01-14 02:04:05 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/134.pt
25-01-14 02:04:05 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/134.pt
25-01-14 02:04:06 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:04:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 68           |        cudaMalloc retries: 71        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 230527 GiB | 230505 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 229185 GiB | 229163 GiB |
|       from small pool |      3 MiB |      5 MiB |   1342 GiB |   1342 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 230527 GiB | 230505 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 229185 GiB | 229163 GiB |
|       from small pool |      3 MiB |      5 MiB |   1342 GiB |   1342 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 230400 GiB | 230378 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 229063 GiB | 229041 GiB |
|       from small pool |      3 MiB |      5 MiB |   1336 GiB |   1336 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4735 GiB |   4712 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4730 GiB |   4707 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 125889 GiB | 125888 GiB |
|       from large pool |    943 MiB |   1689 MiB | 124309 GiB | 124308 GiB |
|       from small pool |      0 MiB |      4 MiB |   1579 GiB |   1579 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   29038 K  |   29037 K  |
|       from large pool |     186    |     223    |    4534 K  |    4534 K  |
|       from small pool |     109    |     111    |   24503 K  |   24503 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   29038 K  |   29037 K  |
|       from large pool |     186    |     223    |    4534 K  |    4534 K  |
|       from small pool |     109    |     111    |   24503 K  |   24503 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11344    |   11168    |
|       from large pool |     174    |     174    |    8950    |    8776    |
|       from small pool |       2    |       4    |    2394    |    2392    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |   11288 K  |   11288 K  |
|       from large pool |      20    |      24    |    1345 K  |    1345 K  |
|       from small pool |       8    |      16    |    9942 K  |    9942 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:04:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  30158 MiB |  23209 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29950 MiB |  23002 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  30158 MiB |  23209 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29950 MiB |  23002 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  29744 MiB |  22795 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  29536 MiB |  22588 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  32344 MiB |  25394 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  32340 MiB |  25392 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2970 MiB |   2969 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2760 MiB |   2760 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    210 MiB |    209 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1570    |    1390    |
|       from large pool |     126    |     128    |    1092    |     966    |
|       from small pool |      54    |      56    |     478    |     424    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1570    |    1390    |
|       from large pool |     126    |     128    |    1092    |     966    |
|       from small pool |      54    |      56    |     478    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     956    |     829    |
|       from large pool |     126    |     128    |     954    |     828    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     140    |     139    |
|       from large pool |       0    |       1    |     138    |     138    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:04:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  30158 MiB |  23209 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29950 MiB |  23002 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  30158 MiB |  23209 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  29950 MiB |  23002 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  29744 MiB |  22795 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  29536 MiB |  22588 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  32344 MiB |  25394 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  32340 MiB |  25392 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   2970 MiB |   2969 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2760 MiB |   2760 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    210 MiB |    209 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1570    |    1390    |
|       from large pool |     126    |     128    |    1092    |     966    |
|       from small pool |      54    |      56    |     478    |     424    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1570    |    1390    |
|       from large pool |     126    |     128    |    1092    |     966    |
|       from small pool |      54    |      56    |     478    |     424    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     956    |     829    |
|       from large pool |     126    |     128    |     954    |     828    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     140    |     139    |
|       from large pool |       0    |       1    |     138    |     138    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:04:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  29114 MiB |  23209 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28906 MiB |  23002 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  29114 MiB |  23209 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  28906 MiB |  23002 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  28700 MiB |  22795 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  28492 MiB |  22588 MiB |
|       from small pool |      0 MiB |      1 MiB |    207 MiB |    207 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  31300 MiB |  25394 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  31296 MiB |  25392 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   2970 MiB |   2969 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2760 MiB |   2760 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    210 MiB |    209 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1537    |    1389    |
|       from large pool |     100    |     102    |    1066    |     966    |
|       from small pool |      48    |      50    |     471    |     423    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1537    |    1389    |
|       from large pool |     100    |     102    |    1066    |     966    |
|       from small pool |      48    |      50    |     471    |     423    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     930    |     829    |
|       from large pool |     100    |     102    |     928    |     828    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     140    |     139    |
|       from large pool |       0    |       1    |     138    |     138    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:04:06 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:04:06 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:04:06 | I | in layer model.layers.0
25-01-14 02:04:06 | I | quantizing weights for layer model.layers.0
25-01-14 02:04:06 | I | collecting info in model.layers.0
25-01-14 02:04:08 | I | collecting info in model.layers.0
25-01-14 02:04:09 | I | collecting info in model.layers.0
25-01-14 02:04:11 | I | collecting info in model.layers.0
25-01-14 02:04:13 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:15 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:17 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:19 | I | collecting calibration activations in model.layers.0
25-01-14 02:04:21 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:04:21 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:04:28 | I |       - range scale = [    1.0000]
25-01-14 02:04:28 | I |         sum  error  = [    1.2922]
25-01-14 02:04:28 | I |         best error  = [    1.2922]
25-01-14 02:04:28 | I |     + error = [1.2922]
25-01-14 02:04:35 | I |       - range scale = [    1.0000]
25-01-14 02:04:35 | I |         sum  error  = [    2.7766]
25-01-14 02:04:35 | I |         best error  = [    2.7766]
25-01-14 02:04:35 | I |     + error = [2.7766]
25-01-14 02:04:36 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:04:43 | I |       - range scale = [    1.0000]
25-01-14 02:04:43 | I |         sum  error  = [    6.1370]
25-01-14 02:04:43 | I |         best error  = [    6.1370]
25-01-14 02:04:43 | I |     + error = [6.1370]
25-01-14 02:04:50 | I |       - range scale = [    1.0000]
25-01-14 02:04:50 | I |         sum  error  = [    8.5359]
25-01-14 02:04:50 | I |         best error  = [    8.5359]
25-01-14 02:04:50 | I |     + error = [8.5359]
25-01-14 02:04:50 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:04:51 | I |       - range scale = [    1.0000]
25-01-14 02:04:51 | I |         sum  error  = [    0.3277]
25-01-14 02:04:51 | I |         best error  = [    0.3277]
25-01-14 02:04:51 | I |     + error = [0.3277]
25-01-14 02:04:52 | I |       - range scale = [    1.0000]
25-01-14 02:04:52 | I |         sum  error  = [    0.4034]
25-01-14 02:04:52 | I |         best error  = [    0.4034]
25-01-14 02:04:52 | I |     + error = [0.4034]
25-01-14 02:04:52 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:04:53 | I |       - range scale = [    1.0000]
25-01-14 02:04:53 | I |         sum  error  = [    0.3006]
25-01-14 02:04:53 | I |         best error  = [    0.3006]
25-01-14 02:04:53 | I |     + error = [0.3006]
25-01-14 02:04:54 | I |       - range scale = [    1.0000]
25-01-14 02:04:54 | I |         sum  error  = [    0.5530]
25-01-14 02:04:54 | I |         best error  = [    0.5530]
25-01-14 02:04:54 | I |     + error = [0.5530]
25-01-14 02:04:54 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:04:54 | I |       - range scale = [    1.0000]
25-01-14 02:04:54 | I |         sum  error  = [    1.6522]
25-01-14 02:04:54 | I |         best error  = [    1.6522]
25-01-14 02:04:54 | I |     + error = [1.6522]
25-01-14 02:04:56 | I |       - range scale = [    1.0000]
25-01-14 02:04:56 | I |         sum  error  = [    2.0561]
25-01-14 02:04:56 | I |         best error  = [    2.0561]
25-01-14 02:04:56 | I |     + error = [2.0561]
25-01-14 02:04:56 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:04:56 | I |       - range scale = [    1.0000]
25-01-14 02:04:56 | I |         sum  error  = [    1.8358]
25-01-14 02:04:56 | I |         best error  = [    1.8358]
25-01-14 02:04:56 | I |     + error = [1.8358]
25-01-14 02:04:58 | I |       - range scale = [    1.0000]
25-01-14 02:04:58 | I |         sum  error  = [    2.4462]
25-01-14 02:04:58 | I |         best error  = [    2.4462]
25-01-14 02:04:58 | I |     + error = [2.4462]
25-01-14 02:04:58 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:04:59 | I |       - range scale = [    1.0000]
25-01-14 02:04:59 | I |         sum  error  = [    0.3390]
25-01-14 02:04:59 | I |         best error  = [    0.3390]
25-01-14 02:04:59 | I |     + error = [0.3390]
25-01-14 02:05:00 | I |       - range scale = [    1.0000]
25-01-14 02:05:00 | I |         sum  error  = [    0.5385]
25-01-14 02:05:00 | I |         best error  = [    0.5385]
25-01-14 02:05:00 | I |     + error = [0.5385]
25-01-14 02:05:00 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:05:02 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:05:05 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:05:07 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:05:10 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:05:12 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:05:15 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:05:21 | I | quantizing activations for layer model.layers.0
25-01-14 02:05:21 | I | collecting info in model.layers.0
25-01-14 02:05:23 | I | collecting info in model.layers.0
25-01-14 02:05:25 | I | collecting info in model.layers.0
25-01-14 02:05:26 | I | collecting info in model.layers.0
25-01-14 02:05:29 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:31 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:32 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:34 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:38 | I | forward this layer
25-01-14 02:05:38 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/136.pt
25-01-14 02:05:38 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/136.pt
25-01-14 02:05:38 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:05:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 69           |        cudaMalloc retries: 72        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 236855 GiB | 236833 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 235483 GiB | 235460 GiB |
|       from small pool |      3 MiB |      5 MiB |   1372 GiB |   1372 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 236855 GiB | 236833 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 235483 GiB | 235460 GiB |
|       from small pool |      3 MiB |      5 MiB |   1372 GiB |   1372 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 236726 GiB | 236704 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 235359 GiB | 235337 GiB |
|       from small pool |      3 MiB |      5 MiB |   1366 GiB |   1366 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4802 GiB |   4779 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4798 GiB |   4775 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 129504 GiB | 129503 GiB |
|       from large pool |    943 MiB |   1689 MiB | 127888 GiB | 127887 GiB |
|       from small pool |      0 MiB |      4 MiB |   1615 GiB |   1615 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   29710 K  |   29710 K  |
|       from large pool |     186    |     223    |    4645 K  |    4644 K  |
|       from small pool |     109    |     111    |   25065 K  |   25065 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   29710 K  |   29710 K  |
|       from large pool |     186    |     223    |    4645 K  |    4644 K  |
|       from small pool |     109    |     111    |   25065 K  |   25065 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11502    |   11326    |
|       from large pool |     174    |     174    |    9073    |    8899    |
|       from small pool |       2    |       4    |    2429    |    2427    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |   11534 K  |   11534 K  |
|       from large pool |      21    |      24    |    1374 K  |    1374 K  |
|       from small pool |       8    |      16    |   10159 K  |   10159 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:05:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  30494 MiB |  23546 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30284 MiB |  23336 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  30494 MiB |  23546 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30284 MiB |  23336 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  30074 MiB |  23126 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  29864 MiB |  22916 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  32712 MiB |  25762 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  32708 MiB |  25760 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3013 MiB |   3012 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2800 MiB |   2800 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    213 MiB |    212 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1590    |    1410    |
|       from large pool |     126    |     128    |    1106    |     980    |
|       from small pool |      54    |      56    |     484    |     430    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1590    |    1410    |
|       from large pool |     126    |     128    |    1106    |     980    |
|       from small pool |      54    |      56    |     484    |     430    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     968    |     841    |
|       from large pool |     126    |     128    |     966    |     840    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     142    |     141    |
|       from large pool |       0    |       1    |     140    |     140    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:05:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  30494 MiB |  23546 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30284 MiB |  23336 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  30494 MiB |  23546 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30284 MiB |  23336 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  30074 MiB |  23126 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  29864 MiB |  22916 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  32712 MiB |  25762 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  32708 MiB |  25760 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3013 MiB |   3012 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2800 MiB |   2800 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    213 MiB |    212 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1590    |    1410    |
|       from large pool |     126    |     128    |    1106    |     980    |
|       from small pool |      54    |      56    |     484    |     430    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1590    |    1410    |
|       from large pool |     126    |     128    |    1106    |     980    |
|       from small pool |      54    |      56    |     484    |     430    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     968    |     841    |
|       from large pool |     126    |     128    |     966    |     840    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     142    |     141    |
|       from large pool |       0    |       1    |     140    |     140    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:05:38 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  29450 MiB |  23546 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29240 MiB |  23336 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  29450 MiB |  23546 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29240 MiB |  23336 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  29030 MiB |  23126 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  28820 MiB |  22916 MiB |
|       from small pool |      0 MiB |      1 MiB |    210 MiB |    210 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  31668 MiB |  25762 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  31664 MiB |  25760 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   3013 MiB |   3012 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2800 MiB |   2800 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    213 MiB |    212 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1557    |    1409    |
|       from large pool |     100    |     102    |    1080    |     980    |
|       from small pool |      48    |      50    |     477    |     429    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1557    |    1409    |
|       from large pool |     100    |     102    |    1080    |     980    |
|       from small pool |      48    |      50    |     477    |     429    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     942    |     841    |
|       from large pool |     100    |     102    |     940    |     840    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     142    |     141    |
|       from large pool |       0    |       1    |     140    |     140    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:05:38 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:05:39 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:05:39 | I | in layer model.layers.0
25-01-14 02:05:39 | I | quantizing weights for layer model.layers.0
25-01-14 02:05:39 | I | collecting info in model.layers.0
25-01-14 02:05:41 | I | collecting info in model.layers.0
25-01-14 02:05:42 | I | collecting info in model.layers.0
25-01-14 02:05:44 | I | collecting info in model.layers.0
25-01-14 02:05:46 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:48 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:50 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:52 | I | collecting calibration activations in model.layers.0
25-01-14 02:05:54 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:05:54 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:06:01 | I |       - range scale = [    1.0000]
25-01-14 02:06:01 | I |         sum  error  = [    1.2870]
25-01-14 02:06:01 | I |         best error  = [    1.2870]
25-01-14 02:06:01 | I |     + error = [1.2870]
25-01-14 02:06:09 | I |       - range scale = [    1.0000]
25-01-14 02:06:09 | I |         sum  error  = [    2.9976]
25-01-14 02:06:09 | I |         best error  = [    2.9976]
25-01-14 02:06:09 | I |     + error = [2.9976]
25-01-14 02:06:09 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:06:16 | I |       - range scale = [    1.0000]
25-01-14 02:06:16 | I |         sum  error  = [    5.4142]
25-01-14 02:06:16 | I |         best error  = [    5.4142]
25-01-14 02:06:16 | I |     + error = [5.4142]
25-01-14 02:06:23 | I |       - range scale = [    1.0000]
25-01-14 02:06:23 | I |         sum  error  = [    7.8541]
25-01-14 02:06:23 | I |         best error  = [    7.8541]
25-01-14 02:06:23 | I |     + error = [7.8541]
25-01-14 02:06:24 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:06:24 | I |       - range scale = [    1.0000]
25-01-14 02:06:24 | I |         sum  error  = [    0.3408]
25-01-14 02:06:24 | I |         best error  = [    0.3408]
25-01-14 02:06:24 | I |     + error = [0.3408]
25-01-14 02:06:25 | I |       - range scale = [    1.0000]
25-01-14 02:06:25 | I |         sum  error  = [    0.4073]
25-01-14 02:06:25 | I |         best error  = [    0.4073]
25-01-14 02:06:25 | I |     + error = [0.4073]
25-01-14 02:06:25 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:06:26 | I |       - range scale = [    1.0000]
25-01-14 02:06:26 | I |         sum  error  = [    0.3559]
25-01-14 02:06:26 | I |         best error  = [    0.3559]
25-01-14 02:06:26 | I |     + error = [0.3559]
25-01-14 02:06:27 | I |       - range scale = [    1.0000]
25-01-14 02:06:27 | I |         sum  error  = [    0.6125]
25-01-14 02:06:27 | I |         best error  = [    0.6125]
25-01-14 02:06:27 | I |     + error = [0.6125]
25-01-14 02:06:27 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:06:28 | I |       - range scale = [    1.0000]
25-01-14 02:06:28 | I |         sum  error  = [    1.7146]
25-01-14 02:06:28 | I |         best error  = [    1.7146]
25-01-14 02:06:28 | I |     + error = [1.7146]
25-01-14 02:06:29 | I |       - range scale = [    1.0000]
25-01-14 02:06:29 | I |         sum  error  = [    1.9713]
25-01-14 02:06:29 | I |         best error  = [    1.9713]
25-01-14 02:06:29 | I |     + error = [1.9713]
25-01-14 02:06:29 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:06:30 | I |       - range scale = [    1.0000]
25-01-14 02:06:30 | I |         sum  error  = [    1.9153]
25-01-14 02:06:30 | I |         best error  = [    1.9153]
25-01-14 02:06:30 | I |     + error = [1.9153]
25-01-14 02:06:31 | I |       - range scale = [    1.0000]
25-01-14 02:06:31 | I |         sum  error  = [    2.4751]
25-01-14 02:06:31 | I |         best error  = [    2.4751]
25-01-14 02:06:31 | I |     + error = [2.4751]
25-01-14 02:06:31 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:06:32 | I |       - range scale = [    1.0000]
25-01-14 02:06:32 | I |         sum  error  = [    0.3937]
25-01-14 02:06:32 | I |         best error  = [    0.3937]
25-01-14 02:06:32 | I |     + error = [0.3937]
25-01-14 02:06:33 | I |       - range scale = [    1.0000]
25-01-14 02:06:33 | I |         sum  error  = [    0.7335]
25-01-14 02:06:33 | I |         best error  = [    0.7335]
25-01-14 02:06:33 | I |     + error = [0.7335]
25-01-14 02:06:33 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:06:36 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:06:38 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:06:41 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:06:43 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:06:45 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:06:48 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:06:55 | I | quantizing activations for layer model.layers.0
25-01-14 02:06:55 | I | collecting info in model.layers.0
25-01-14 02:06:56 | I | collecting info in model.layers.0
25-01-14 02:06:58 | I | collecting info in model.layers.0
25-01-14 02:07:00 | I | collecting info in model.layers.0
25-01-14 02:07:02 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:04 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:06 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:08 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:12 | I | forward this layer
25-01-14 02:07:12 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/138.pt
25-01-14 02:07:12 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/138.pt
25-01-14 02:07:12 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:07:12 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 70           |        cudaMalloc retries: 73        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 243268 GiB | 243246 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 241865 GiB | 241843 GiB |
|       from small pool |      3 MiB |      5 MiB |   1402 GiB |   1402 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 243268 GiB | 243246 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 241865 GiB | 241843 GiB |
|       from small pool |      3 MiB |      5 MiB |   1402 GiB |   1402 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 243138 GiB | 243115 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 241740 GiB | 241718 GiB |
|       from small pool |      3 MiB |      5 MiB |   1397 GiB |   1397 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4871 GiB |   4848 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4867 GiB |   4843 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 133121 GiB | 133120 GiB |
|       from large pool |    943 MiB |   1689 MiB | 131469 GiB | 131468 GiB |
|       from small pool |      0 MiB |      4 MiB |   1651 GiB |   1651 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   30390 K  |   30390 K  |
|       from large pool |     186    |     223    |    4756 K  |    4756 K  |
|       from small pool |     109    |     111    |   25633 K  |   25633 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   30390 K  |   30390 K  |
|       from large pool |     186    |     223    |    4756 K  |    4756 K  |
|       from small pool |     109    |     111    |   25633 K  |   25633 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11666    |   11490    |
|       from large pool |     174    |     174    |    9202    |    9028    |
|       from small pool |       2    |       4    |    2464    |    2462    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |   11783 K  |   11783 K  |
|       from large pool |      20    |      24    |    1404 K  |    1404 K  |
|       from small pool |       8    |      16    |   10379 K  |   10379 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:07:12 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  30830 MiB |  23882 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30617 MiB |  23669 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  30830 MiB |  23882 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30617 MiB |  23669 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  30404 MiB |  23456 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  30191 MiB |  23243 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  33080 MiB |  26130 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  33076 MiB |  26128 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3056 MiB |   3055 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2840 MiB |   2840 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    216 MiB |    215 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1610    |    1430    |
|       from large pool |     126    |     128    |    1120    |     994    |
|       from small pool |      54    |      56    |     490    |     436    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1610    |    1430    |
|       from large pool |     126    |     128    |    1120    |     994    |
|       from small pool |      54    |      56    |     490    |     436    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     980    |     853    |
|       from large pool |     126    |     128    |     978    |     852    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     144    |     143    |
|       from large pool |       0    |       1    |     142    |     142    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:07:12 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  30830 MiB |  23882 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30617 MiB |  23669 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  30830 MiB |  23882 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30617 MiB |  23669 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  30404 MiB |  23456 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  30191 MiB |  23243 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  33080 MiB |  26130 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  33076 MiB |  26128 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3056 MiB |   3055 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2840 MiB |   2840 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    216 MiB |    215 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1610    |    1430    |
|       from large pool |     126    |     128    |    1120    |     994    |
|       from small pool |      54    |      56    |     490    |     436    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1610    |    1430    |
|       from large pool |     126    |     128    |    1120    |     994    |
|       from small pool |      54    |      56    |     490    |     436    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     980    |     853    |
|       from large pool |     126    |     128    |     978    |     852    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     144    |     143    |
|       from large pool |       0    |       1    |     142    |     142    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:07:12 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  29787 MiB |  23882 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29573 MiB |  23669 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  29787 MiB |  23882 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29573 MiB |  23669 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  29361 MiB |  23456 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  29147 MiB |  23243 MiB |
|       from small pool |      0 MiB |      1 MiB |    213 MiB |    213 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  32036 MiB |  26130 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  32032 MiB |  26128 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   3056 MiB |   3055 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2840 MiB |   2840 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    216 MiB |    215 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1577    |    1429    |
|       from large pool |     100    |     102    |    1094    |     994    |
|       from small pool |      48    |      50    |     483    |     435    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1577    |    1429    |
|       from large pool |     100    |     102    |    1094    |     994    |
|       from small pool |      48    |      50    |     483    |     435    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     954    |     853    |
|       from large pool |     100    |     102    |     952    |     852    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     144    |     143    |
|       from large pool |       0    |       1    |     142    |     142    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:07:12 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:07:12 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:07:12 | I | in layer model.layers.0
25-01-14 02:07:12 | I | quantizing weights for layer model.layers.0
25-01-14 02:07:12 | I | collecting info in model.layers.0
25-01-14 02:07:14 | I | collecting info in model.layers.0
25-01-14 02:07:16 | I | collecting info in model.layers.0
25-01-14 02:07:17 | I | collecting info in model.layers.0
25-01-14 02:07:20 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:22 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:24 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:26 | I | collecting calibration activations in model.layers.0
25-01-14 02:07:28 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:07:28 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:07:35 | I |       - range scale = [    1.0000]
25-01-14 02:07:35 | I |         sum  error  = [    1.4216]
25-01-14 02:07:35 | I |         best error  = [    1.4216]
25-01-14 02:07:35 | I |     + error = [1.4216]
25-01-14 02:07:42 | I |       - range scale = [    1.0000]
25-01-14 02:07:42 | I |         sum  error  = [    2.9780]
25-01-14 02:07:42 | I |         best error  = [    2.9780]
25-01-14 02:07:42 | I |     + error = [2.9780]
25-01-14 02:07:43 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:07:50 | I |       - range scale = [    1.0000]
25-01-14 02:07:50 | I |         sum  error  = [    6.1090]
25-01-14 02:07:50 | I |         best error  = [    6.1090]
25-01-14 02:07:50 | I |     + error = [6.1090]
25-01-14 02:07:57 | I |       - range scale = [    1.0000]
25-01-14 02:07:57 | I |         sum  error  = [    8.5115]
25-01-14 02:07:57 | I |         best error  = [    8.5115]
25-01-14 02:07:57 | I |     + error = [8.5115]
25-01-14 02:07:57 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:07:58 | I |       - range scale = [    1.0000]
25-01-14 02:07:58 | I |         sum  error  = [    0.3272]
25-01-14 02:07:58 | I |         best error  = [    0.3272]
25-01-14 02:07:58 | I |     + error = [0.3272]
25-01-14 02:07:59 | I |       - range scale = [    1.0000]
25-01-14 02:07:59 | I |         sum  error  = [    0.4795]
25-01-14 02:07:59 | I |         best error  = [    0.4795]
25-01-14 02:07:59 | I |     + error = [0.4795]
25-01-14 02:07:59 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:08:00 | I |       - range scale = [    1.0000]
25-01-14 02:08:00 | I |         sum  error  = [    0.3171]
25-01-14 02:08:00 | I |         best error  = [    0.3171]
25-01-14 02:08:00 | I |     + error = [0.3171]
25-01-14 02:08:01 | I |       - range scale = [    1.0000]
25-01-14 02:08:01 | I |         sum  error  = [    0.5345]
25-01-14 02:08:01 | I |         best error  = [    0.5345]
25-01-14 02:08:01 | I |     + error = [0.5345]
25-01-14 02:08:01 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:08:02 | I |       - range scale = [    1.0000]
25-01-14 02:08:02 | I |         sum  error  = [    1.6592]
25-01-14 02:08:02 | I |         best error  = [    1.6592]
25-01-14 02:08:02 | I |     + error = [1.6592]
25-01-14 02:08:03 | I |       - range scale = [    1.0000]
25-01-14 02:08:03 | I |         sum  error  = [    1.8575]
25-01-14 02:08:03 | I |         best error  = [    1.8575]
25-01-14 02:08:03 | I |     + error = [1.8575]
25-01-14 02:08:03 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:08:04 | I |       - range scale = [    1.0000]
25-01-14 02:08:04 | I |         sum  error  = [    1.8535]
25-01-14 02:08:04 | I |         best error  = [    1.8535]
25-01-14 02:08:04 | I |     + error = [1.8535]
25-01-14 02:08:05 | I |       - range scale = [    1.0000]
25-01-14 02:08:05 | I |         sum  error  = [    2.2459]
25-01-14 02:08:05 | I |         best error  = [    2.2459]
25-01-14 02:08:05 | I |     + error = [2.2459]
25-01-14 02:08:05 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:08:06 | I |       - range scale = [    1.0000]
25-01-14 02:08:06 | I |         sum  error  = [    0.3555]
25-01-14 02:08:06 | I |         best error  = [    0.3555]
25-01-14 02:08:06 | I |     + error = [0.3555]
25-01-14 02:08:07 | I |       - range scale = [    1.0000]
25-01-14 02:08:07 | I |         sum  error  = [    0.5476]
25-01-14 02:08:07 | I |         best error  = [    0.5476]
25-01-14 02:08:07 | I |     + error = [0.5476]
25-01-14 02:08:07 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:08:10 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:08:12 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:08:14 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:08:17 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:08:19 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:08:22 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:08:28 | I | quantizing activations for layer model.layers.0
25-01-14 02:08:28 | I | collecting info in model.layers.0
25-01-14 02:08:30 | I | collecting info in model.layers.0
25-01-14 02:08:32 | I | collecting info in model.layers.0
25-01-14 02:08:33 | I | collecting info in model.layers.0
25-01-14 02:08:36 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:38 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:39 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:41 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:45 | I | forward this layer
25-01-14 02:08:45 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/140.pt
25-01-14 02:08:45 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/140.pt
25-01-14 02:08:45 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:08:45 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 71           |        cudaMalloc retries: 74        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 249767 GiB | 249744 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 248333 GiB | 248311 GiB |
|       from small pool |      3 MiB |      5 MiB |   1433 GiB |   1433 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 249767 GiB | 249744 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 248333 GiB | 248311 GiB |
|       from small pool |      3 MiB |      5 MiB |   1433 GiB |   1433 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 249634 GiB | 249612 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 248206 GiB | 248184 GiB |
|       from small pool |      3 MiB |      5 MiB |   1428 GiB |   1428 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   4939 GiB |   4916 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   4934 GiB |   4911 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 136837 GiB | 136837 GiB |
|       from large pool |    943 MiB |   1689 MiB | 135149 GiB | 135148 GiB |
|       from small pool |      0 MiB |      4 MiB |   1688 GiB |   1688 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   31077 K  |   31077 K  |
|       from large pool |     186    |     223    |    4869 K  |    4869 K  |
|       from small pool |     109    |     111    |   26208 K  |   26207 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   31077 K  |   31077 K  |
|       from large pool |     186    |     223    |    4869 K  |    4869 K  |
|       from small pool |     109    |     111    |   26208 K  |   26207 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11824    |   11648    |
|       from large pool |     174    |     174    |    9325    |    9151    |
|       from small pool |       2    |       4    |    2499    |    2497    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |   12035 K  |   12035 K  |
|       from large pool |      21    |      24    |    1435 K  |    1435 K  |
|       from small pool |       8    |      16    |   10600 K  |   10600 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:08:45 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  31167 MiB |  24219 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30951 MiB |  24003 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  31167 MiB |  24219 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30951 MiB |  24003 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  30735 MiB |  23787 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  30519 MiB |  23571 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  33448 MiB |  26498 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  33444 MiB |  26496 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3099 MiB |   3098 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2880 MiB |   2880 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    219 MiB |    218 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1630    |    1450    |
|       from large pool |     126    |     128    |    1134    |    1008    |
|       from small pool |      54    |      56    |     496    |     442    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1630    |    1450    |
|       from large pool |     126    |     128    |    1134    |    1008    |
|       from small pool |      54    |      56    |     496    |     442    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     992    |     865    |
|       from large pool |     126    |     128    |     990    |     864    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     146    |     145    |
|       from large pool |       0    |       1    |     144    |     144    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:08:45 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  31167 MiB |  24219 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30951 MiB |  24003 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  31167 MiB |  24219 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  30951 MiB |  24003 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  30735 MiB |  23787 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  30519 MiB |  23571 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  33448 MiB |  26498 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  33444 MiB |  26496 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3099 MiB |   3098 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2880 MiB |   2880 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    219 MiB |    218 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1630    |    1450    |
|       from large pool |     126    |     128    |    1134    |    1008    |
|       from small pool |      54    |      56    |     496    |     442    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1630    |    1450    |
|       from large pool |     126    |     128    |    1134    |    1008    |
|       from small pool |      54    |      56    |     496    |     442    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |     992    |     865    |
|       from large pool |     126    |     128    |     990    |     864    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     146    |     145    |
|       from large pool |       0    |       1    |     144    |     144    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:08:45 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  30123 MiB |  24219 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29907 MiB |  24003 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  30123 MiB |  24219 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  29907 MiB |  24003 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  29691 MiB |  23787 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  29475 MiB |  23571 MiB |
|       from small pool |      0 MiB |      1 MiB |    216 MiB |    216 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  32404 MiB |  26498 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  32400 MiB |  26496 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   3099 MiB |   3098 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2880 MiB |   2880 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    219 MiB |    218 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1597    |    1449    |
|       from large pool |     100    |     102    |    1108    |    1008    |
|       from small pool |      48    |      50    |     489    |     441    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1597    |    1449    |
|       from large pool |     100    |     102    |    1108    |    1008    |
|       from small pool |      48    |      50    |     489    |     441    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     966    |     865    |
|       from large pool |     100    |     102    |     964    |     864    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     146    |     145    |
|       from large pool |       0    |       1    |     144    |     144    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:08:45 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:08:46 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:08:46 | I | in layer model.layers.0
25-01-14 02:08:46 | I | quantizing weights for layer model.layers.0
25-01-14 02:08:46 | I | collecting info in model.layers.0
25-01-14 02:08:48 | I | collecting info in model.layers.0
25-01-14 02:08:49 | I | collecting info in model.layers.0
25-01-14 02:08:51 | I | collecting info in model.layers.0
25-01-14 02:08:53 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:55 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:57 | I | collecting calibration activations in model.layers.0
25-01-14 02:08:59 | I | collecting calibration activations in model.layers.0
25-01-14 02:09:01 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:09:01 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:09:09 | I |       - range scale = [    1.0000]
25-01-14 02:09:09 | I |         sum  error  = [    1.3134]
25-01-14 02:09:09 | I |         best error  = [    1.3134]
25-01-14 02:09:09 | I |     + error = [1.3134]
25-01-14 02:09:16 | I |       - range scale = [    1.0000]
25-01-14 02:09:16 | I |         sum  error  = [    2.8677]
25-01-14 02:09:16 | I |         best error  = [    2.8677]
25-01-14 02:09:16 | I |     + error = [2.8677]
25-01-14 02:09:16 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:09:24 | I |       - range scale = [    1.0000]
25-01-14 02:09:24 | I |         sum  error  = [    6.4578]
25-01-14 02:09:24 | I |         best error  = [    6.4578]
25-01-14 02:09:24 | I |     + error = [6.4578]
25-01-14 02:09:31 | I |       - range scale = [    1.0000]
25-01-14 02:09:31 | I |         sum  error  = [    8.8479]
25-01-14 02:09:31 | I |         best error  = [    8.8479]
25-01-14 02:09:31 | I |     + error = [8.8479]
25-01-14 02:09:31 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:09:32 | I |       - range scale = [    1.0000]
25-01-14 02:09:32 | I |         sum  error  = [    0.3456]
25-01-14 02:09:32 | I |         best error  = [    0.3456]
25-01-14 02:09:32 | I |     + error = [0.3456]
25-01-14 02:09:33 | I |       - range scale = [    1.0000]
25-01-14 02:09:33 | I |         sum  error  = [    0.4011]
25-01-14 02:09:33 | I |         best error  = [    0.4011]
25-01-14 02:09:33 | I |     + error = [0.4011]
25-01-14 02:09:33 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:09:34 | I |       - range scale = [    1.0000]
25-01-14 02:09:34 | I |         sum  error  = [    0.3274]
25-01-14 02:09:34 | I |         best error  = [    0.3274]
25-01-14 02:09:34 | I |     + error = [0.3274]
25-01-14 02:09:35 | I |       - range scale = [    1.0000]
25-01-14 02:09:35 | I |         sum  error  = [    0.5608]
25-01-14 02:09:35 | I |         best error  = [    0.5608]
25-01-14 02:09:35 | I |     + error = [0.5608]
25-01-14 02:09:35 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:09:36 | I |       - range scale = [    1.0000]
25-01-14 02:09:36 | I |         sum  error  = [    1.7160]
25-01-14 02:09:36 | I |         best error  = [    1.7160]
25-01-14 02:09:36 | I |     + error = [1.7160]
25-01-14 02:09:37 | I |       - range scale = [    1.0000]
25-01-14 02:09:37 | I |         sum  error  = [    1.9074]
25-01-14 02:09:37 | I |         best error  = [    1.9074]
25-01-14 02:09:37 | I |     + error = [1.9074]
25-01-14 02:09:37 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:09:38 | I |       - range scale = [    1.0000]
25-01-14 02:09:38 | I |         sum  error  = [    1.9298]
25-01-14 02:09:38 | I |         best error  = [    1.9298]
25-01-14 02:09:38 | I |     + error = [1.9298]
25-01-14 02:09:39 | I |       - range scale = [    1.0000]
25-01-14 02:09:39 | I |         sum  error  = [    2.3080]
25-01-14 02:09:39 | I |         best error  = [    2.3080]
25-01-14 02:09:39 | I |     + error = [2.3080]
25-01-14 02:09:39 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:09:40 | I |       - range scale = [    1.0000]
25-01-14 02:09:40 | I |         sum  error  = [    0.3748]
25-01-14 02:09:40 | I |         best error  = [    0.3748]
25-01-14 02:09:40 | I |     + error = [0.3748]
25-01-14 02:09:41 | I |       - range scale = [    1.0000]
25-01-14 02:09:41 | I |         sum  error  = [    0.5833]
25-01-14 02:09:41 | I |         best error  = [    0.5833]
25-01-14 02:09:41 | I |     + error = [0.5833]
25-01-14 02:09:41 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:09:44 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:09:46 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:09:48 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:09:51 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:09:53 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:09:56 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:10:02 | I | quantizing activations for layer model.layers.0
25-01-14 02:10:02 | I | collecting info in model.layers.0
25-01-14 02:10:04 | I | collecting info in model.layers.0
25-01-14 02:10:06 | I | collecting info in model.layers.0
25-01-14 02:10:07 | I | collecting info in model.layers.0
25-01-14 02:10:10 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:12 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:14 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:16 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:19 | I | forward this layer
25-01-14 02:10:19 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/142.pt
25-01-14 02:10:19 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/142.pt
25-01-14 02:10:20 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:10:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 72           |        cudaMalloc retries: 75        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 256350 GiB | 256328 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 254886 GiB | 254863 GiB |
|       from small pool |      3 MiB |      5 MiB |   1464 GiB |   1464 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 256350 GiB | 256328 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 254886 GiB | 254863 GiB |
|       from small pool |      3 MiB |      5 MiB |   1464 GiB |   1464 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 256216 GiB | 256194 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 254757 GiB | 254735 GiB |
|       from small pool |      3 MiB |      5 MiB |   1459 GiB |   1459 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   5008 GiB |   4985 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   5003 GiB |   4980 GiB |
|       from small pool |      4 MiB |      8 MiB |      4 GiB |      4 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 140555 GiB | 140554 GiB |
|       from large pool |    943 MiB |   1689 MiB | 138830 GiB | 138829 GiB |
|       from small pool |      0 MiB |      4 MiB |   1725 GiB |   1725 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   31772 K  |   31771 K  |
|       from large pool |     186    |     223    |    4984 K  |    4983 K  |
|       from small pool |     109    |     111    |   26788 K  |   26787 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   31772 K  |   31771 K  |
|       from large pool |     186    |     223    |    4984 K  |    4983 K  |
|       from small pool |     109    |     111    |   26788 K  |   26787 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   11988    |   11812    |
|       from large pool |     174    |     174    |    9454    |    9280    |
|       from small pool |       2    |       4    |    2534    |    2532    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      28    |      35    |   12289 K  |   12289 K  |
|       from large pool |      20    |      24    |    1465 K  |    1465 K  |
|       from small pool |       8    |      16    |   10823 K  |   10823 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:10:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  31503 MiB |  24555 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31284 MiB |  24336 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  31503 MiB |  24555 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31284 MiB |  24336 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  31065 MiB |  24117 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  30846 MiB |  23898 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  33816 MiB |  26866 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  33812 MiB |  26864 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3142 MiB |   3141 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2920 MiB |   2920 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    222 MiB |    221 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1650    |    1470    |
|       from large pool |     126    |     128    |    1148    |    1022    |
|       from small pool |      54    |      56    |     502    |     448    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1650    |    1470    |
|       from large pool |     126    |     128    |    1148    |    1022    |
|       from small pool |      54    |      56    |     502    |     448    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |    1004    |     877    |
|       from large pool |     126    |     128    |    1002    |     876    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     148    |     147    |
|       from large pool |       0    |       1    |     146    |     146    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:10:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  31503 MiB |  24555 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31284 MiB |  24336 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  31503 MiB |  24555 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31284 MiB |  24336 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  31065 MiB |  24117 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  30846 MiB |  23898 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  33816 MiB |  26866 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  33812 MiB |  26864 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3142 MiB |   3141 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2920 MiB |   2920 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    222 MiB |    221 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1650    |    1470    |
|       from large pool |     126    |     128    |    1148    |    1022    |
|       from small pool |      54    |      56    |     502    |     448    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1650    |    1470    |
|       from large pool |     126    |     128    |    1148    |    1022    |
|       from small pool |      54    |      56    |     502    |     448    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |    1004    |     877    |
|       from large pool |     126    |     128    |    1002    |     876    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     148    |     147    |
|       from large pool |       0    |       1    |     146    |     146    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:10:20 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  30459 MiB |  24555 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30240 MiB |  24336 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  30459 MiB |  24555 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30240 MiB |  24336 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  30021 MiB |  24117 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  29802 MiB |  23898 MiB |
|       from small pool |      0 MiB |      1 MiB |    219 MiB |    219 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  32772 MiB |  26866 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  32768 MiB |  26864 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   3142 MiB |   3141 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2920 MiB |   2920 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    222 MiB |    221 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1617    |    1469    |
|       from large pool |     100    |     102    |    1122    |    1022    |
|       from small pool |      48    |      50    |     495    |     447    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1617    |    1469    |
|       from large pool |     100    |     102    |    1122    |    1022    |
|       from small pool |      48    |      50    |     495    |     447    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     978    |     877    |
|       from large pool |     100    |     102    |     976    |     876    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     148    |     147    |
|       from large pool |       0    |       1    |     146    |     146    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:10:20 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:10:20 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:10:20 | I | in layer model.layers.0
25-01-14 02:10:20 | I | quantizing weights for layer model.layers.0
25-01-14 02:10:20 | I | collecting info in model.layers.0
25-01-14 02:10:22 | I | collecting info in model.layers.0
25-01-14 02:10:24 | I | collecting info in model.layers.0
25-01-14 02:10:25 | I | collecting info in model.layers.0
25-01-14 02:10:28 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:30 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:32 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:34 | I | collecting calibration activations in model.layers.0
25-01-14 02:10:36 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:10:36 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
25-01-14 02:10:43 | I |       - range scale = [    1.0000]
25-01-14 02:10:43 | I |         sum  error  = [    1.3813]
25-01-14 02:10:43 | I |         best error  = [    1.3813]
25-01-14 02:10:43 | I |     + error = [1.3813]
25-01-14 02:10:51 | I |       - range scale = [    1.0000]
25-01-14 02:10:51 | I |         sum  error  = [    3.0751]
25-01-14 02:10:51 | I |         best error  = [    3.0751]
25-01-14 02:10:51 | I |     + error = [3.0751]
25-01-14 02:10:51 | I |   - Calibrating model.layers.0.self_attn.k_proj.weight
25-01-14 02:10:59 | I |       - range scale = [    1.0000]
25-01-14 02:10:59 | I |         sum  error  = [    5.9297]
25-01-14 02:10:59 | I |         best error  = [    5.9297]
25-01-14 02:10:59 | I |     + error = [5.9297]
25-01-14 02:11:06 | I |       - range scale = [    1.0000]
25-01-14 02:11:06 | I |         sum  error  = [    9.0707]
25-01-14 02:11:06 | I |         best error  = [    9.0707]
25-01-14 02:11:06 | I |     + error = [9.0707]
25-01-14 02:11:06 | I |   - Calibrating model.layers.0.self_attn.v_proj.weight
25-01-14 02:11:07 | I |       - range scale = [    1.0000]
25-01-14 02:11:07 | I |         sum  error  = [    0.3385]
25-01-14 02:11:07 | I |         best error  = [    0.3385]
25-01-14 02:11:07 | I |     + error = [0.3385]
25-01-14 02:11:08 | I |       - range scale = [    1.0000]
25-01-14 02:11:08 | I |         sum  error  = [    0.4071]
25-01-14 02:11:08 | I |         best error  = [    0.4071]
25-01-14 02:11:08 | I |     + error = [0.4071]
25-01-14 02:11:08 | I |   - Calibrating model.layers.0.self_attn.o_proj.weight
25-01-14 02:11:09 | I |       - range scale = [    1.0000]
25-01-14 02:11:09 | I |         sum  error  = [    0.3508]
25-01-14 02:11:09 | I |         best error  = [    0.3508]
25-01-14 02:11:09 | I |     + error = [0.3508]
25-01-14 02:11:10 | I |       - range scale = [    1.0000]
25-01-14 02:11:10 | I |         sum  error  = [    0.6089]
25-01-14 02:11:10 | I |         best error  = [    0.6089]
25-01-14 02:11:10 | I |     + error = [0.6089]
25-01-14 02:11:10 | I |   - Calibrating model.layers.0.mlp.up_proj.weight
25-01-14 02:11:11 | I |       - range scale = [    1.0000]
25-01-14 02:11:11 | I |         sum  error  = [    1.7756]
25-01-14 02:11:11 | I |         best error  = [    1.7756]
25-01-14 02:11:11 | I |     + error = [1.7756]
25-01-14 02:11:12 | I |       - range scale = [    1.0000]
25-01-14 02:11:12 | I |         sum  error  = [    1.9620]
25-01-14 02:11:12 | I |         best error  = [    1.9620]
25-01-14 02:11:12 | I |     + error = [1.9620]
25-01-14 02:11:12 | I |   - Calibrating model.layers.0.mlp.gate_proj.weight
25-01-14 02:11:13 | I |       - range scale = [    1.0000]
25-01-14 02:11:13 | I |         sum  error  = [    1.9771]
25-01-14 02:11:13 | I |         best error  = [    1.9771]
25-01-14 02:11:13 | I |     + error = [1.9771]
25-01-14 02:11:14 | I |       - range scale = [    1.0000]
25-01-14 02:11:14 | I |         sum  error  = [    2.3949]
25-01-14 02:11:14 | I |         best error  = [    2.3949]
25-01-14 02:11:14 | I |     + error = [2.3949]
25-01-14 02:11:14 | I |   - Calibrating model.layers.0.mlp.down_proj.weight
25-01-14 02:11:15 | I |       - range scale = [    1.0000]
25-01-14 02:11:15 | I |         sum  error  = [    0.4033]
25-01-14 02:11:15 | I |         best error  = [    0.4033]
25-01-14 02:11:15 | I |     + error = [0.4033]
25-01-14 02:11:16 | I |       - range scale = [    1.0000]
25-01-14 02:11:16 | I |         sum  error  = [    0.6198]
25-01-14 02:11:16 | I |         best error  = [    0.6198]
25-01-14 02:11:16 | I |     + error = [0.6198]
25-01-14 02:11:16 | I |   - Quantizing model.layers.0.self_attn.q_proj.weight
25-01-14 02:11:18 | I |   - Quantizing model.layers.0.self_attn.k_proj.weight
25-01-14 02:11:21 | I |   - Quantizing model.layers.0.self_attn.v_proj.weight
25-01-14 02:11:23 | I |   - Quantizing model.layers.0.self_attn.o_proj.weight
25-01-14 02:11:26 | I |   - Quantizing model.layers.0.mlp.up_proj.weight
25-01-14 02:11:28 | I |   - Quantizing model.layers.0.mlp.gate_proj.weight
25-01-14 02:11:31 | I |   - Quantizing model.layers.0.mlp.down_proj.weight
25-01-14 02:11:37 | I | quantizing activations for layer model.layers.0
25-01-14 02:11:37 | I | collecting info in model.layers.0
25-01-14 02:11:39 | I | collecting info in model.layers.0
25-01-14 02:11:41 | I | collecting info in model.layers.0
25-01-14 02:11:42 | I | collecting info in model.layers.0
25-01-14 02:11:45 | I | collecting calibration activations in model.layers.0
25-01-14 02:11:47 | I | collecting calibration activations in model.layers.0
25-01-14 02:11:49 | I | collecting calibration activations in model.layers.0
25-01-14 02:11:51 | I | collecting calibration activations in model.layers.0
25-01-14 02:11:55 | I | forward this layer
25-01-14 02:11:55 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_0/144.pt
25-01-14 02:11:55 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_0/144.pt
25-01-14 02:11:55 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 124.94 MiB is free. Process 46094 has 23.57 GiB memory in use. Of the allocated memory 22.17 GiB is allocated by PyTorch, and 944.26 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-14 02:11:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 73           |        cudaMalloc retries: 76        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22699 MiB |  23233 MiB | 263020 GiB | 262998 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 261523 GiB | 261501 GiB |
|       from small pool |      3 MiB |      5 MiB |   1496 GiB |   1496 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22699 MiB |  23233 MiB | 263020 GiB | 262998 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 261523 GiB | 261501 GiB |
|       from small pool |      3 MiB |      5 MiB |   1496 GiB |   1496 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22699 MiB |  23233 MiB | 262884 GiB | 262862 GiB |
|       from large pool |  22696 MiB |  23230 MiB | 261394 GiB | 261371 GiB |
|       from small pool |      3 MiB |      5 MiB |   1490 GiB |   1490 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23644 MiB |  23672 MiB |   5076 GiB |   5053 GiB |
|       from large pool |  23640 MiB |  23668 MiB |   5071 GiB |   5048 GiB |
|       from small pool |      4 MiB |      8 MiB |      5 GiB |      5 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    944 MiB |   1691 MiB | 144373 GiB | 144373 GiB |
|       from large pool |    943 MiB |   1689 MiB | 142611 GiB | 142610 GiB |
|       from small pool |      0 MiB |      4 MiB |   1762 GiB |   1762 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     320    |   32473 K  |   32473 K  |
|       from large pool |     186    |     223    |    5099 K  |    5099 K  |
|       from small pool |     109    |     111    |   27373 K  |   27373 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     320    |   32473 K  |   32473 K  |
|       from large pool |     186    |     223    |    5099 K  |    5099 K  |
|       from small pool |     109    |     111    |   27373 K  |   27373 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     176    |     178    |   12146    |   11970    |
|       from large pool |     174    |     174    |    9577    |    9403    |
|       from small pool |       2    |       4    |    2569    |    2567    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |      35    |   12545 K  |   12545 K  |
|       from large pool |      21    |      24    |    1496 K  |    1496 K  |
|       from small pool |       8    |      16    |   11049 K  |   11049 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:11:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  31840 MiB |  24891 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31617 MiB |  24669 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  31840 MiB |  24891 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31617 MiB |  24669 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  31396 MiB |  24447 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  31173 MiB |  24225 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  34184 MiB |  27234 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  34180 MiB |  27232 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3185 MiB |   3184 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2960 MiB |   2960 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    225 MiB |    224 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1670    |    1490    |
|       from large pool |     126    |     128    |    1162    |    1036    |
|       from small pool |      54    |      56    |     508    |     454    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1670    |    1490    |
|       from large pool |     126    |     128    |    1162    |    1036    |
|       from small pool |      54    |      56    |     508    |     454    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |    1016    |     889    |
|       from large pool |     126    |     128    |    1014    |     888    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     150    |     149    |
|       from large pool |       0    |       1    |     148    |     148    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:11:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6948 MiB |   7036 MiB |  31840 MiB |  24891 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31617 MiB |  24669 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   6948 MiB |   7036 MiB |  31840 MiB |  24891 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  31617 MiB |  24669 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6948 MiB |   7034 MiB |  31396 MiB |  24447 MiB |
|       from large pool |   6948 MiB |   7034 MiB |  31173 MiB |  24225 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6950 MiB |   7038 MiB |  34184 MiB |  27234 MiB |
|       from large pool |   6948 MiB |   7036 MiB |  34180 MiB |  27232 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1751 KiB |  20855 KiB |   3185 MiB |   3184 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2960 MiB |   2960 MiB |
|       from small pool |   1751 KiB |   2047 KiB |    225 MiB |    224 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     180    |     182    |    1670    |    1490    |
|       from large pool |     126    |     128    |    1162    |    1036    |
|       from small pool |      54    |      56    |     508    |     454    |
|---------------------------------------------------------------------------|
| Active allocs         |     180    |     182    |    1670    |    1490    |
|       from large pool |     126    |     128    |    1162    |    1036    |
|       from small pool |      54    |      56    |     508    |     454    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     127    |     129    |    1016    |     889    |
|       from large pool |     126    |     128    |    1014    |     888    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     150    |     149    |
|       from large pool |       0    |       1    |     148    |     148    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:11:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5904 MiB |   5992 MiB |  30796 MiB |  24891 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30573 MiB |  24669 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   5904 MiB |   5992 MiB |  30796 MiB |  24891 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  30573 MiB |  24669 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5904 MiB |   5990 MiB |  30352 MiB |  24447 MiB |
|       from large pool |   5904 MiB |   5990 MiB |  30129 MiB |  24225 MiB |
|       from small pool |      0 MiB |      1 MiB |    222 MiB |    222 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5906 MiB |   5994 MiB |  33140 MiB |  27234 MiB |
|       from large pool |   5904 MiB |   5992 MiB |  33136 MiB |  27232 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1544 KiB |  20648 KiB |   3185 MiB |   3184 MiB |
|       from large pool |      0 KiB |  19104 KiB |   2960 MiB |   2960 MiB |
|       from small pool |   1544 KiB |   2047 KiB |    225 MiB |    224 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     148    |     150    |    1637    |    1489    |
|       from large pool |     100    |     102    |    1136    |    1036    |
|       from small pool |      48    |      50    |     501    |     453    |
|---------------------------------------------------------------------------|
| Active allocs         |     148    |     150    |    1637    |    1489    |
|       from large pool |     100    |     102    |    1136    |    1036    |
|       from small pool |      48    |      50    |     501    |     453    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     101    |     103    |     990    |     889    |
|       from large pool |     100    |     102    |     988    |     888    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |       2    |     150    |     149    |
|       from large pool |       0    |       1    |     148    |     148    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-14 02:11:55 | W | attempting to recover from OOM in forward/backward pass
25-01-14 02:11:55 | I | TRAIN CURRENT LAYER_IDX = 0
25-01-14 02:11:55 | I | in layer model.layers.0
25-01-14 02:11:55 | I | quantizing weights for layer model.layers.0
25-01-14 02:11:55 | I | collecting info in model.layers.0
25-01-14 02:11:57 | I | collecting info in model.layers.0
25-01-14 02:11:59 | I | collecting info in model.layers.0
25-01-14 02:12:01 | I | collecting info in model.layers.0
25-01-14 02:12:03 | I | collecting calibration activations in model.layers.0
25-01-14 02:12:05 | I | collecting calibration activations in model.layers.0
25-01-14 02:12:07 | I | collecting calibration activations in model.layers.0
25-01-14 02:12:09 | I | collecting calibration activations in model.layers.0
25-01-14 02:12:11 | I | - Quantizing decoder layer model.layers.0
25-01-14 02:12:11 | I |   - Calibrating model.layers.0.self_attn.q_proj.weight
