25-01-19 10:49:16 | I | === Configurations ===
25-01-19 10:49:16 | I | LlmRunConfig(
25-01-19 10:49:16 | I |   model=LlmModelConfig(
25-01-19 10:49:16 | I |     name=llama2-7b,
25-01-19 10:49:16 | I |     path=/data/gyy/llama2-7b,
25-01-19 10:49:16 | I |     root=/dataset/models,
25-01-19 10:49:16 | I |     local_path=/dataset/models/llama2/llama2-7b,
25-01-19 10:49:16 | I |     local_root=/dataset/models,
25-01-19 10:49:16 | I |     family=llama2,
25-01-19 10:49:16 | I |     size=7.0),
25-01-19 10:49:16 | I |   eval=LlmEvalConfig(
25-01-19 10:49:16 | I |     num_gpus=4,
25-01-19 10:49:16 | I |     batch_size=8,
25-01-19 10:49:16 | I |     output_root=runs,
25-01-19 10:49:16 | I |     output_dirname=skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250119.104916,
25-01-19 10:49:16 | I |     attach_timestamp=True,
25-01-19 10:49:16 | I |     timestamp=250119.104916,
25-01-19 10:49:16 | I |     output_dirname_without_timestamp=skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0],
25-01-19 10:49:16 | I |     tasks=['wikitext'],
25-01-19 10:49:16 | I |     max_seq_length=-4096,
25-01-19 10:49:16 | I |     evaluator=gptq),
25-01-19 10:49:16 | I |   calib=LlmCalibConfig(
25-01-19 10:49:16 | I |     data=pileval,
25-01-19 10:49:16 | I |     num_samples=128,
25-01-19 10:49:16 | I |     cache_root=runs,
25-01-19 10:49:16 | I |     cache_dirpath=runs/llm/cache/pileval.128x1024.[0-0],
25-01-19 10:49:16 | I |     dataset_path=mit-han-lab/pile-val-backup,
25-01-19 10:49:16 | I |     seq_length=1024,
25-01-19 10:49:16 | I |     min_seq_length=0,
25-01-19 10:49:16 | I |     max_seq_length=0,
25-01-19 10:49:16 | I |     local_dataset_path=/dataset/pile),
25-01-19 10:49:16 | I |   quant=LlmQuantConfig(
25-01-19 10:49:16 | I |     wgts=WeightQuantizerConfig(
25-01-19 10:49:16 | I |       dtype=zint4,
25-01-19 10:49:16 | I |       group_shapes=((1, -1, -1), (1, 128, -1)),
25-01-19 10:49:16 | I |       group_scale_dtypes=(torch.float16, sint8),
25-01-19 10:49:16 | I |       compute_dtype=sint8,
25-01-19 10:49:16 | I |       compute_group_level=0,
25-01-19 10:49:16 | I |       saturate_compute_dtype=False,
25-01-19 10:49:16 | I |       exponent_scaling_level=2,
25-01-19 10:49:16 | I |       skips=['embed', 'head', 'router'],
25-01-19 10:49:16 | I |       static=True,
25-01-19 10:49:16 | I |       calib_kernel=QuantizerKernelConfig(
25-01-19 10:49:16 | I |         _kernels={'proj_1st': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512), 'proj_2nd': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512), 'proj_out': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512), 'proj_qkv': QuantGPTQConfig(includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'], damp_percentage=0.01, block_size=128, num_inv_tries=250, hessian_block_size=512)},
25-01-19 10:49:16 | I |         gptq=QuantGPTQConfig(
25-01-19 10:49:16 | I |           includes=['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'],
25-01-19 10:49:16 | I |           damp_percentage=0.01,
25-01-19 10:49:16 | I |           block_size=128,
25-01-19 10:49:16 | I |           num_inv_tries=250,
25-01-19 10:49:16 | I |           hessian_block_size=512)),
25-01-19 10:49:16 | I |       calib_range=DynamicRangeCalibConfig(
25-01-19 10:49:16 | I |         degree=2,
25-01-19 10:49:16 | I |         skips=[],
25-01-19 10:49:16 | I |         objective=SearchBasedCalibObjective.OutputsError,
25-01-19 10:49:16 | I |         strategy=SearchBasedCalibStrategy.Manual,
25-01-19 10:49:16 | I |         granularity=SearchBasedCalibGranularity.Group,
25-01-19 10:49:16 | I |         element_batch_size=64,
25-01-19 10:49:16 | I |         sample_batch_size=-1,
25-01-19 10:49:16 | I |         element_size=512,
25-01-19 10:49:16 | I |         sample_size=-1,
25-01-19 10:49:16 | I |         pre_reshape=True,
25-01-19 10:49:16 | I |         outputs_device=cpu,
25-01-19 10:49:16 | I |         allow_kernel_calib=False,
25-01-19 10:49:16 | I |         ratio=1.0,
25-01-19 10:49:16 | I |         max_shrink=0.2,
25-01-19 10:49:16 | I |         max_expand=1.0,
25-01-19 10:49:16 | I |         num_grids=80)),
25-01-19 10:49:16 | I |     ipts=ActivationQuantizerConfig(
25-01-19 10:49:16 | I |       dtype=sint8,
25-01-19 10:49:16 | I |       group_shapes=((1, -1, -1),),
25-01-19 10:49:16 | I |       group_scale_dtypes=(torch.float16,),
25-01-19 10:49:16 | I |       compute_dtype=None,
25-01-19 10:49:16 | I |       compute_group_level=-1,
25-01-19 10:49:16 | I |       saturate_compute_dtype=False,
25-01-19 10:49:16 | I |       exponent_scaling_level=1,
25-01-19 10:49:16 | I |       skips=['embed', 'head', 'router'],
25-01-19 10:49:16 | I |       static=False,
25-01-19 10:49:16 | I |       calib_kernel=None,
25-01-19 10:49:16 | I |       calib_range=None),
25-01-19 10:49:16 | I |     opts=ActivationQuantizerConfig(
25-01-19 10:49:16 | I |       dtype=zint4,
25-01-19 10:49:16 | I |       group_shapes=((1, 128, -1),),
25-01-19 10:49:16 | I |       group_scale_dtypes=(torch.float16,),
25-01-19 10:49:16 | I |       compute_dtype=None,
25-01-19 10:49:16 | I |       compute_group_level=-1,
25-01-19 10:49:16 | I |       saturate_compute_dtype=False,
25-01-19 10:49:16 | I |       exponent_scaling_level=1,
25-01-19 10:49:16 | I |       skips=['attn_q'],
25-01-19 10:49:16 | I |       static=False,
25-01-19 10:49:16 | I |       calib_kernel=None,
25-01-19 10:49:16 | I |       calib_range=None),
25-01-19 10:49:16 | I |     rotation=QuantRotationConfig(
25-01-19 10:49:16 | I |       random=False,
25-01-19 10:49:16 | I |       transforms=[]),
25-01-19 10:49:16 | I |     reorder=QuantReorderConfig(
25-01-19 10:49:16 | I |       degree=2,
25-01-19 10:49:16 | I |       skips=['proj_out', 'proj_qkv', 'residual'],
25-01-19 10:49:16 | I |       objective=SearchBasedCalibObjective.OutputsError,
25-01-19 10:49:16 | I |       strategy=SearchBasedCalibStrategy.Manual,
25-01-19 10:49:16 | I |       granularity=SearchBasedCalibGranularity.Layer,
25-01-19 10:49:16 | I |       element_batch_size=-1,
25-01-19 10:49:16 | I |       sample_batch_size=-1,
25-01-19 10:49:16 | I |       element_size=-1,
25-01-19 10:49:16 | I |       sample_size=-1,
25-01-19 10:49:16 | I |       pre_reshape=True,
25-01-19 10:49:16 | I |       outputs_device=cpu,
25-01-19 10:49:16 | I |       allow_kernel_calib=False,
25-01-19 10:49:16 | I |       channel_metric=ChannelMetric.InputsAbsMax,
25-01-19 10:49:16 | I |       channel_index=ChannelIndex.Sequential,
25-01-19 10:49:16 | I |       dynamic=False),
25-01-19 10:49:16 | I |     smooth=QuantSmoothConfig(
25-01-19 10:49:16 | I |       xw=QuantSmoothCalibConfig(
25-01-19 10:49:16 | I |         degree=2,
25-01-19 10:49:16 | I |         skips=['proj_1st', 'proj_qkv'],
25-01-19 10:49:16 | I |         objective=SearchBasedCalibObjective.OutputsError,
25-01-19 10:49:16 | I |         strategy=SearchBasedCalibStrategy.Manual,
25-01-19 10:49:16 | I |         granularity=SearchBasedCalibGranularity.Layer,
25-01-19 10:49:16 | I |         element_batch_size=-1,
25-01-19 10:49:16 | I |         sample_batch_size=-1,
25-01-19 10:49:16 | I |         element_size=-1,
25-01-19 10:49:16 | I |         sample_size=-1,
25-01-19 10:49:16 | I |         pre_reshape=True,
25-01-19 10:49:16 | I |         outputs_device=cpu,
25-01-19 10:49:16 | I |         allow_kernel_calib=False,
25-01-19 10:49:16 | I |         ranges=[(<RangeMode.AbsMax: 1>, <RangeMode.AbsMax: 1>)],
25-01-19 10:49:16 | I |         x_ranges=[<RangeMode.AbsMax: 1>],
25-01-19 10:49:16 | I |         w_ranges=[<RangeMode.AbsMax: 1>],
25-01-19 10:49:16 | I |         alpha=0.3,
25-01-19 10:49:16 | I |         beta=0.7,
25-01-19 10:49:16 | I |         num_grids=20),
25-01-19 10:49:16 | I |       yx=QuantSmoothCalibConfig(
25-01-19 10:49:16 | I |         degree=2,
25-01-19 10:49:16 | I |         skips=[],
25-01-19 10:49:16 | I |         objective=SearchBasedCalibObjective.OutputsError,
25-01-19 10:49:16 | I |         strategy=SearchBasedCalibStrategy.Manual,
25-01-19 10:49:16 | I |         granularity=SearchBasedCalibGranularity.Layer,
25-01-19 10:49:16 | I |         element_batch_size=-1,
25-01-19 10:49:16 | I |         sample_batch_size=-1,
25-01-19 10:49:16 | I |         element_size=-1,
25-01-19 10:49:16 | I |         sample_size=-1,
25-01-19 10:49:16 | I |         pre_reshape=True,
25-01-19 10:49:16 | I |         outputs_device=cpu,
25-01-19 10:49:16 | I |         allow_kernel_calib=False,
25-01-19 10:49:16 | I |         ranges=[(<RangeMode.AbsMax: 1>, <RangeMode.AbsMax: 1>)],
25-01-19 10:49:16 | I |         x_ranges=[<RangeMode.AbsMax: 1>],
25-01-19 10:49:16 | I |         w_ranges=[<RangeMode.AbsMax: 1>],
25-01-19 10:49:16 | I |         alpha=0.5,
25-01-19 10:49:16 | I |         beta=0.0,
25-01-19 10:49:16 | I |         num_grids=20)),
25-01-19 10:49:16 | I |     bias_correction=False,
25-01-19 10:49:16 | I |     post_rotary=True,
25-01-19 10:49:16 | I |     develop_dtype=torch.float32,
25-01-19 10:49:16 | I |     select_wgts=None,
25-01-19 10:49:16 | I |     select_ipts=None,
25-01-19 10:49:16 | I |     select_opts=None,
25-01-19 10:49:16 | I |     keywords_i={'proj_qkv': ['q_proj', 'k_proj', 'v_proj'], 'proj_out': ['out_proj', 'o_proj'], 'proj_1st': ['fc1', 'up_proj', 'gate_proj', 'w1', 'w3'], 'proj_2nd': ['fc2', 'down_proj', 'w2'], 'head': ['output', 'score', 'qa_outputs'], 'embed': ['embed', 'lm_head', 'embed_out'], 'router': ['block_sparse_moe']},
25-01-19 10:49:16 | I |     keywords_w={'proj_qkv': ['q_proj', 'k_proj', 'v_proj'], 'proj_out': ['out_proj', 'o_proj'], 'proj_1st': ['fc1', 'up_proj', 'gate_proj', 'w1', 'w3'], 'proj_2nd': ['fc2', 'down_proj', 'w2'], 'head': ['output', 'score', 'qa_outputs'], 'embed': ['embed', 'lm_head', 'embed_out'], 'router': ['block_sparse_moe.gate']},
25-01-19 10:49:16 | I |     keywords_o={'attn_q': ['q_rotary_emb'], 'attn_k': ['k_rotary_emb'], 'attn_v': ['v_proj']},
25-01-19 10:49:16 | I |     module_types_i=(<class 'torch.nn.modules.linear.Linear'>, <class 'transformers.models.mixtral.modeling_mixtral.MixtralSparseMoeBlock'>),
25-01-19 10:49:16 | I |     module_types_w=(<class 'torch.nn.modules.linear.Linear'>,),
25-01-19 10:49:16 | I |     module_types_o=(<class 'torch.nn.modules.linear.Linear'>, <class 'lmquant.llm.nn.attention.RotaryEmbedding'>),
25-01-19 10:49:16 | I |     num_hidden_layers=-1),
25-01-19 10:49:16 | I |   seed=12345,
25-01-19 10:49:16 | I |   save_model=True,
25-01-19 10:49:16 | I |   output_dirpath=runs/llm/llama2/llama2-7b/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/rot-reorder-smooth.xw.yx-w.static.kernel/skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250119.104916,
25-01-19 10:49:16 | I |   cache_dirpath=LlmQuantCachePath(rotation='runs/llm/cache/rotation/hadamard', reorder='runs/llm/cache/pileval.128x1024.[0-0]/reorder/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]', smooth='runs/llm/cache/pileval.128x1024.[0-0]/smooth/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]', wgts='runs/llm/cache/pileval.128x1024.[0-0]/wgts/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]/w.kernel.gptq.d0p01.b128/w.kernel.gptq.include.[proj_1st+proj_2nd+proj_out+proj_qkv]/w.range.OutputsError.Manual.Group.d2.e512.sn1/w.range.r.[1].static/w.range.skip.[]', acts=''),
25-01-19 10:49:16 | I |   cache_path=LlmQuantCachePath(rotation='runs/llm/cache/rotation/hadamard/llama2-7b.pt', reorder='runs/llm/cache/pileval.128x1024.[0-0]/reorder/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/llama2-7b.pt', smooth='runs/llm/cache/pileval.128x1024.[0-0]/smooth/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]/llama2-7b.pt', wgts='runs/llm/cache/pileval.128x1024.[0-0]/wgts/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/w.skip.[embed+head+router]-x.skip.[embed+head+router]-y.skip.[attn_q]/rotate.hadamard/reorder.OutputsError.Manual.Layer.d2.en1.sn1/reorder.InputsAbsMax.Sequential/reorder.skip.[proj_out+proj_qkv+residual]/smooth.xw.OutputsError.Manual.Layer.d2.en1.sn1-yx.OutputsError.Manual.Layer.d2.en1.sn1/smooth.xw.[x.AbsMax.w.AbsMax]-yx.[x.AbsMax.w.AbsMax]/smooth.xw.a0p3.b0p7-yx.a0p5.b0/smooth.xw.skip.[proj_1st+proj_qkv]-yx.skip.[]/w.kernel.gptq.d0p01.b128/w.kernel.gptq.include.[proj_1st+proj_2nd+proj_out+proj_qkv]/w.range.OutputsError.Manual.Group.d2.e512.sn1/w.range.r.[1].static/w.range.skip.[]/llama2-7b.pt', acts=''),
25-01-19 10:49:16 | I |   fairseq_args=/data/gyy/lmquant-main/projects/llm/configs/fairseq_args_7b_without_preprocess.json,
25-01-19 10:49:16 | I |   gen_teacher_opts=False,
25-01-19 10:49:16 | I |   enable_cache=True,
25-01-19 10:49:16 | I |   with_preprocess=False)
25-01-19 10:49:16 | I | === Dumped Configurations ===
25-01-19 10:49:16 | I | { 'calib': { 'cache_root': 'runs',
25-01-19 10:49:16 | I |              'data': 'pileval',
25-01-19 10:49:16 | I |              'dataset_path': 'mit-han-lab/pile-val-backup',
25-01-19 10:49:16 | I |              'local_dataset_path': '/dataset/pile',
25-01-19 10:49:16 | I |              'max_seq_length': 0,
25-01-19 10:49:16 | I |              'min_seq_length': 0,
25-01-19 10:49:16 | I |              'num_samples': 128,
25-01-19 10:49:16 | I |              'seq_length': 1024},
25-01-19 10:49:16 | I |   'enable_cache': True,
25-01-19 10:49:16 | I |   'eval': { 'attach_timestamp': True,
25-01-19 10:49:16 | I |             'batch_size': 8,
25-01-19 10:49:16 | I |             'evaluator': 'gptq',
25-01-19 10:49:16 | I |             'max_seq_length': -4096,
25-01-19 10:49:16 | I |             'num_gpus': 4,
25-01-19 10:49:16 | I |             'output_dirname': 'skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250119.104916',
25-01-19 10:49:16 | I |             'output_root': 'runs',
25-01-19 10:49:16 | I |             'tasks': ['wikitext']},
25-01-19 10:49:16 | I |   'fairseq_args': '/data/gyy/lmquant-main/projects/llm/configs/fairseq_args_7b_without_preprocess.json',
25-01-19 10:49:16 | I |   'gen_teacher_opts': False,
25-01-19 10:49:16 | I |   'model': { 'local_path': '/dataset/models/llama2/llama2-7b',
25-01-19 10:49:16 | I |              'local_root': '/dataset/models',
25-01-19 10:49:16 | I |              'name': 'llama2-7b',
25-01-19 10:49:16 | I |              'path': '/data/gyy/llama2-7b',
25-01-19 10:49:16 | I |              'root': '/dataset/models'},
25-01-19 10:49:16 | I |   'quant': { 'bias_correction': False,
25-01-19 10:49:16 | I |              'develop_dtype': 'torch.float32',
25-01-19 10:49:16 | I |              'enable_reorder': True,
25-01-19 10:49:16 | I |              'enable_rotation': True,
25-01-19 10:49:16 | I |              'enable_select_ipts': False,
25-01-19 10:49:16 | I |              'enable_select_opts': False,
25-01-19 10:49:16 | I |              'enable_select_wgts': False,
25-01-19 10:49:16 | I |              'enable_smooth': True,
25-01-19 10:49:16 | I |              'ipts': { 'compute_dtype': None,
25-01-19 10:49:16 | I |                        'compute_group_level': -1,
25-01-19 10:49:16 | I |                        'dtype': 'sint8',
25-01-19 10:49:16 | I |                        'enable_calib_range': False,
25-01-19 10:49:16 | I |                        'group_scale_dtypes': ['torch.float16'],
25-01-19 10:49:16 | I |                        'group_shapes': [[1, -1, -1]],
25-01-19 10:49:16 | I |                        'saturate_compute_dtype': False,
25-01-19 10:49:16 | I |                        'skips': ['embed', 'head', 'router'],
25-01-19 10:49:16 | I |                        'static': False},
25-01-19 10:49:16 | I |              'opts': { 'compute_dtype': None,
25-01-19 10:49:16 | I |                        'compute_group_level': -1,
25-01-19 10:49:16 | I |                        'dtype': 'zint4',
25-01-19 10:49:16 | I |                        'enable_calib_range': False,
25-01-19 10:49:16 | I |                        'group_scale_dtypes': ['torch.float16'],
25-01-19 10:49:16 | I |                        'group_shapes': [[1, 128, -1]],
25-01-19 10:49:16 | I |                        'saturate_compute_dtype': False,
25-01-19 10:49:16 | I |                        'skips': ['attn_q'],
25-01-19 10:49:16 | I |                        'static': False},
25-01-19 10:49:16 | I |              'post_rotary': True,
25-01-19 10:49:16 | I |              'reorder': { 'allow_kernel_calib': False,
25-01-19 10:49:16 | I |                           'channel_index': 'Sequential',
25-01-19 10:49:16 | I |                           'channel_metric': 'InputsAbsMax',
25-01-19 10:49:16 | I |                           'degree': 2,
25-01-19 10:49:16 | I |                           'dynamic': False,
25-01-19 10:49:16 | I |                           'element_batch_size': -1,
25-01-19 10:49:16 | I |                           'element_size': -1,
25-01-19 10:49:16 | I |                           'outputs_device': 'cpu',
25-01-19 10:49:16 | I |                           'pre_reshape': True,
25-01-19 10:49:16 | I |                           'sample_batch_size': -1,
25-01-19 10:49:16 | I |                           'sample_size': -1,
25-01-19 10:49:16 | I |                           'skips': ['proj_out', 'proj_qkv', 'residual'],
25-01-19 10:49:16 | I |                           'strategy': 'Manual'},
25-01-19 10:49:16 | I |              'rotation': {'random': False, 'transforms': []},
25-01-19 10:49:16 | I |              'smooth': { 'enable_xw': True,
25-01-19 10:49:16 | I |                          'enable_yx': True,
25-01-19 10:49:16 | I |                          'xw': { 'allow_kernel_calib': False,
25-01-19 10:49:16 | I |                                  'alpha': 0.3,
25-01-19 10:49:16 | I |                                  'beta': 0.7,
25-01-19 10:49:16 | I |                                  'degree': 2,
25-01-19 10:49:16 | I |                                  'element_batch_size': -1,
25-01-19 10:49:16 | I |                                  'element_size': -1,
25-01-19 10:49:16 | I |                                  'granularity': 'Layer',
25-01-19 10:49:16 | I |                                  'num_grids': 20,
25-01-19 10:49:16 | I |                                  'objective': 'OutputsError',
25-01-19 10:49:16 | I |                                  'outputs_device': 'cpu',
25-01-19 10:49:16 | I |                                  'pre_reshape': True,
25-01-19 10:49:16 | I |                                  'ranges': [['AbsMax', 'AbsMax']],
25-01-19 10:49:16 | I |                                  'sample_batch_size': -1,
25-01-19 10:49:16 | I |                                  'sample_size': -1,
25-01-19 10:49:16 | I |                                  'skips': ['proj_1st', 'proj_qkv'],
25-01-19 10:49:16 | I |                                  'strategy': 'Manual'},
25-01-19 10:49:16 | I |                          'yx': { 'allow_kernel_calib': False,
25-01-19 10:49:16 | I |                                  'alpha': 0.5,
25-01-19 10:49:16 | I |                                  'beta': 0.0,
25-01-19 10:49:16 | I |                                  'degree': 2,
25-01-19 10:49:16 | I |                                  'element_batch_size': -1,
25-01-19 10:49:16 | I |                                  'element_size': -1,
25-01-19 10:49:16 | I |                                  'granularity': 'Layer',
25-01-19 10:49:16 | I |                                  'num_grids': 20,
25-01-19 10:49:16 | I |                                  'objective': 'OutputsError',
25-01-19 10:49:16 | I |                                  'outputs_device': 'cpu',
25-01-19 10:49:16 | I |                                  'pre_reshape': True,
25-01-19 10:49:16 | I |                                  'ranges': [['AbsMax', 'AbsMax']],
25-01-19 10:49:16 | I |                                  'sample_batch_size': -1,
25-01-19 10:49:16 | I |                                  'sample_size': -1,
25-01-19 10:49:16 | I |                                  'skips': [],
25-01-19 10:49:16 | I |                                  'strategy': 'Manual'}},
25-01-19 10:49:16 | I |              'wgts': { 'calib_kernel': { 'enable_gptq': True,
25-01-19 10:49:16 | I |                                          'gptq': { 'block_size': 128,
25-01-19 10:49:16 | I |                                                    'damp_percentage': 0.01,
25-01-19 10:49:16 | I |                                                    'hessian_block_size': 512,
25-01-19 10:49:16 | I |                                                    'includes': ['proj_1st', 'proj_2nd', 'proj_out', 'proj_qkv'],
25-01-19 10:49:16 | I |                                                    'num_inv_tries': 250}},
25-01-19 10:49:16 | I |                        'calib_range': { 'allow_kernel_calib': False,
25-01-19 10:49:16 | I |                                         'degree': 2,
25-01-19 10:49:16 | I |                                         'element_batch_size': 64,
25-01-19 10:49:16 | I |                                         'element_size': 512,
25-01-19 10:49:16 | I |                                         'granularity': 'Group',
25-01-19 10:49:16 | I |                                         'max_expand': 1.0,
25-01-19 10:49:16 | I |                                         'max_shrink': 0.2,
25-01-19 10:49:16 | I |                                         'num_grids': 80,
25-01-19 10:49:16 | I |                                         'objective': 'OutputsError',
25-01-19 10:49:16 | I |                                         'outputs_device': 'cpu',
25-01-19 10:49:16 | I |                                         'pre_reshape': True,
25-01-19 10:49:16 | I |                                         'ratio': 1.0,
25-01-19 10:49:16 | I |                                         'sample_batch_size': -1,
25-01-19 10:49:16 | I |                                         'sample_size': -1,
25-01-19 10:49:16 | I |                                         'skips': [],
25-01-19 10:49:16 | I |                                         'strategy': 'Manual'},
25-01-19 10:49:16 | I |                        'compute_dtype': 'sint8',
25-01-19 10:49:16 | I |                        'compute_group_level': 0,
25-01-19 10:49:16 | I |                        'dtype': 'zint4',
25-01-19 10:49:16 | I |                        'enable_calib_kernel': True,
25-01-19 10:49:16 | I |                        'enable_calib_range': True,
25-01-19 10:49:16 | I |                        'group_scale_dtypes': ['torch.float16', 'sint8'],
25-01-19 10:49:16 | I |                        'group_shapes': [[1, -1, -1], [1, 128, -1]],
25-01-19 10:49:16 | I |                        'saturate_compute_dtype': False,
25-01-19 10:49:16 | I |                        'skips': ['embed', 'head', 'router']}},
25-01-19 10:49:16 | I |   'save_model': True,
25-01-19 10:49:16 | I |   'seed': 12345,
25-01-19 10:49:16 | I |   'with_preprocess': False}
25-01-19 10:49:16 | I | === Output Directory ===
25-01-19 10:49:16 | I | runs/llm/llama2/llama2-7b/w.4-x.8-y.4/w.zint4-x.sint8-y.zint4/w.gchn.fp16.g128.sint8.[gchn.sint8]-x.gchn.fp16-y.g128.fp16/rot-reorder-smooth.xw.yx-w.static.kernel/skip.y.[q]-krnl-rot-rodr.Seq.[fc2]-smth.xw.a0p3.b0p7.[AbsMax].[out+fc2].yx.a0p5.b0.[AbsMax].[qk]-pileval.128x1024.[0-0]-250119.104916
25-01-19 10:49:16 | I | === Start Evaluating ===
25-01-19 10:49:16 | I | * Building model llama2-7b from /data/gyy/llama2-7b
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.0.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.1.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.2.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.3.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.4.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.5.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.6.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.7.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.8.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.9.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.10.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.11.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.12.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.13.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.14.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.15.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.16.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.17.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.18.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.19.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.20.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.21.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.22.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.23.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.24.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.25.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.26.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.27.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.28.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.29.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.30.self_attn
25-01-19 10:51:00 | I | - Patching LlamaSdpaAttention._old_forward in model.layers.31.self_attn
25-01-19 10:51:00 | I | * Development dtype is torch.float32
25-01-19 10:51:01 | I | * Begin to QAT
25-01-19 10:51:01 | D | Setting JobRuntime:name=UNKNOWN_NAME
25-01-19 10:51:01 | D | Setting JobRuntime:name=utils
25-01-19 10:51:07 | I | distributed init (rank 0): env://
25-01-19 10:51:07 | I | initialized host 3fb0cc53fbf9 as rank 0
25-01-19 10:51:07 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 0.0, 'gpu_3_mem_used_gb': 6.873046875, 'gpu_4_mem_used_gb': 11.732421875, 'gpu_5_mem_used_gb': 7.0859375, 'gpu_6_mem_used_gb': 7.0859375, 'gpu_7_mem_used_gb': 6.06640625}
25-01-19 10:51:07 | I | {'_name': None, 'common': {'_name': None, 'no_progress_bar': False, 'log_interval': 1, 'log_format': 'simple', 'log_file': None, 'tensorboard_logdir': None, 'wandb_project': 'layer_wise_quant', 'azureml_logging': False, 'seed': 1, 'cpu': False, 'tpu': False, 'bf16': False, 'memory_efficient_bf16': False, 'fp16': True, 'memory_efficient_fp16': True, 'fp16_no_flatten_grads': False, 'fp16_init_scale': 128, 'fp16_scale_window': None, 'fp16_scale_tolerance': 0.0, 'min_loss_scale': 0.0001, 'threshold_loss_scale': None, 'user_dir': None, 'empty_cache_freq': 0, 'all_gather_list_size': 16384, 'model_parallel_size': 1, 'quantization_config_path': None, 'profile': False, 'reset_logging': False, 'suppress_crashes': False, 'use_plasma_view': False, 'plasma_path': '/tmp/plasma', 'log_nvidia_smi': False}, 'common_eval': {'_name': None, 'path': None, 'post_process': None, 'quiet': False, 'model_overrides': '{}', 'results_path': None, 'is_moe': False, 'is_model_parallel': False}, 'distributed_training': {'_name': None, 'distributed_world_size': 1, 'distributed_rank': 0, 'distributed_backend': 'nccl', 'distributed_init_method': 'env://', 'distributed_port': -1, 'device_id': 0, 'distributed_no_spawn': True, 'ddp_backend': 'pytorch_ddp', 'bucket_cap_mb': 25, 'fix_batches_to_gpus': False, 'find_unused_parameters': False, 'fast_stat_sync': False, 'heartbeat_timeout': -1, 'broadcast_buffers': False, 'slowmo_momentum': None, 'slowmo_algorithm': 'LocalSGD', 'localsgd_frequency': 3, 'nprocs_per_node': 4, 'pipeline_model_parallel': False, 'pipeline_balance': None, 'pipeline_devices': None, 'pipeline_chunks': 0, 'pipeline_encoder_balance': None, 'pipeline_encoder_devices': None, 'pipeline_decoder_balance': None, 'pipeline_decoder_devices': None, 'pipeline_checkpoint': 'never', 'zero_sharding': 'none', 'zero_group_size': -1, 'save_zero_ckpt_fast': False, 'fp16': True, 'memory_efficient_fp16': True, 'tpu': False, 'no_reshard_after_forward': False, 'fp32_reduce_scatter': False, 'cpu_offload': False, 'use_sharded_state': False}, 'dataset': {'_name': None, 'num_workers': 1, 'num_workers_valid': 0, 'skip_invalid_size_inputs_valid_test': False, 'max_tokens': None, 'batch_size': 32, 'required_batch_size_multiple': 8, 'required_seq_len_multiple': 1, 'dataset_impl': None, 'data_buffer_size': 10, 'train_subset': 'train', 'valid_subset': 'valid', 'combine_valid_subsets': None, 'ignore_unused_valid_subsets': False, 'validate_interval': 1, 'validate_interval_updates': 1, 'validate_after_updates': 0, 'fixed_validation_seed': None, 'disable_validation': False, 'max_tokens_valid': None, 'batch_size_valid': 32, 'max_valid_steps': None, 'curriculum': 0, 'gen_subset': 'test', 'num_shards': 1, 'shard_id': 0}, 'optimization': {'_name': None, 'max_epoch': 0, 'max_update': 100, 'stop_time_hours': 0.0, 'clip_norm': 2.0, 'sentence_avg': False, 'update_freq': [2], 'lr': [0.005], 'stop_min_lr': -1.0, 'use_bmuf': False}, 'checkpoint': {'_name': None, 'save_dir': 'checkpoints', 'restore_file': 'checkpoint_last.pt', 'finetune_from_model': None, 'reset_dataloader': False, 'reset_lr_scheduler': False, 'reset_meters': False, 'reset_optimizer': False, 'optimizer_overrides': '{}', 'save_interval': 1, 'save_interval_updates': 1000, 'keep_interval_updates': -1, 'keep_last_epochs': -1, 'keep_best_checkpoints': -1, 'no_save': True, 'no_epoch_checkpoints': True, 'no_last_checkpoints': False, 'no_best_checkpoints': False, 'no_save_optimizer_state': False, 'no_save_optimizer_state_on_training_finished': False, 'symlink_best_and_last_checkpoints': False, 'best_checkpoint_metric': 'loss_valid', 'maximize_best_checkpoint_metric': False, 'patience': -1, 'checkpoint_suffix': '', 'checkpoint_shard_count': 1, 'load_checkpoint_on_all_dp_ranks': False, 'write_checkpoints_asynchronously': False, 's3_upload_path': None, 'model_parallel_size': 1}, 'bmuf': {'_name': None, 'block_lr': 1.0, 'block_momentum': 0.875, 'global_sync_iter': 50, 'warmup_iterations': 500, 'use_nbm': False, 'average_sync': False, 'distributed_world_size': 4}, 'generation': {'_name': None, 'beam': 5, 'nbest': 1, 'max_len_a': 0.0, 'max_len_b': 200, 'min_len': 1, 'match_source_len': False, 'unnormalized': False, 'no_early_stop': False, 'no_beamable_mm': False, 'lenpen': 1.0, 'unkpen': 0.0, 'replace_unk': None, 'sacrebleu': False, 'score_reference': False, 'prefix_size': 0, 'no_repeat_ngram_size': 0, 'sampling': False, 'sampling_topk': -1, 'sampling_topp': -1.0, 'constraints': None, 'temperature': 1.0, 'diverse_beam_groups': -1, 'diverse_beam_strength': 0.5, 'diversity_rate': -1.0, 'print_alignment': None, 'print_step': False, 'lm_path': None, 'lm_weight': 0.0, 'iter_decode_eos_penalty': 0.0, 'iter_decode_max_iter': 10, 'iter_decode_force_max_iter': False, 'iter_decode_with_beam': 1, 'iter_decode_with_external_reranker': False, 'retain_iter_history': False, 'retain_dropout': False, 'retain_dropout_modules': None, 'decoding_format': None, 'no_seed_provided': False}, 'eval_lm': {'_name': None, 'input_quant_method': '', 'input_bits': -1, 'weight_quant_method': '', 'weight_bits': -1, 'smoothquant': False, 'smoothquant_alpha': 0.5, 'smoothquant_bitnet': False, 'input_bits_post': 8, 'hadamard_group': -1, 'cal_input_stat': 'none', 'output_word_probs': False, 'output_word_stats': False, 'context_window': 0, 'softmax_batch': 9223372036854775807, 'stats_path': None, 'max_valid_steps': None}, 'interactive': {'_name': None, 'buffer_size': 0, 'input': '-'}, 'model': {'_name': 'llama_for_layer_wise_qat', 'load_ckpt': None, 'batch_size': 32, 'share_input_output_embed': False, 'sliding_window': None, 'rope_theta': 10000.0, 'checkpoint_activations': False, 'tokens_per_sample': 512, 'model_parallel_size': 1}, 'task': {'_name': 'kd', 'path_to_labels': None, 'data': '/data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b', 'tokens_per_sample': 512, 'batch_size_in_quant': 8, 'max_target_positions': None, 'llama_model': None, 'quant_acts_when_training': True, 'tiktoken_model': 'cl100k_base', 'batch_read_ahead': 1, 'pad_to_max_len': True, 'absolute_path': False, 'tokenizer_pad_to_multiple': 1, 'seed': 1, 'batch_size': 32}, 'criterion': {'_name': 'mse', 'sentence_avg': False}, 'optimizer': {'_name': 'adam', 'adam_betas': '(0.9, 0.95)', 'adam_eps': 1e-06, 'weight_decay': 0.05, 'use_old_adam': False, 'fp16_adam_stats': False, 'tpu': False, 'bf16': False, 'lr': [0.005], 'block_wise': False}, 'lr_scheduler': {'_name': 'polynomial_decay', 'warmup_updates': 50, 'force_anneal': None, 'end_learning_rate': 0.0, 'power': 1.0, 'total_num_update': 300000.0, 'lr': [0.005]}, 'scoring': {'_name': 'bleu', 'pad': 1, 'eos': 2, 'unk': 3}, 'bpe': None, 'tokenizer': None}
25-01-19 10:51:07 | I | LlamaModelDecoderLayer(
  (decoder): LlamaDecoderLayerInFairseq(
    (model): LlamaDecoderLayer(
      (self_attn): LlamaSdpaAttention(
        (q_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (k_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (v_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (o_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (rotary_emb): LlamaRotaryEmbedding()
        (q_rotary_emb): RotaryEmbedding()
        (k_rotary_emb): RotaryEmbedding()
      )
      (mlp): LlamaMLP(
        (gate_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (up_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (down_proj): Linear(in_features=11008, out_features=4096, bias=False)
        (act_fn): SiLU()
      )
      (input_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
      (post_attention_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
    )
  )
  (model): LlamaDecoderLayerInFairseq(
    (model): LlamaDecoderLayer(
      (self_attn): LlamaSdpaAttention(
        (q_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (k_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (v_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (o_proj): Linear(in_features=4096, out_features=4096, bias=False)
        (rotary_emb): LlamaRotaryEmbedding()
        (q_rotary_emb): RotaryEmbedding()
        (k_rotary_emb): RotaryEmbedding()
      )
      (mlp): LlamaMLP(
        (gate_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (up_proj): Linear(in_features=4096, out_features=11008, bias=False)
        (down_proj): Linear(in_features=11008, out_features=4096, bias=False)
        (act_fn): SiLU()
      )
      (input_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
      (post_attention_layernorm): LlamaRMSNorm((4096,), eps=1e-05)
    )
  )
)
25-01-19 10:51:07 | I | task: KDTask
25-01-19 10:51:07 | I | model: LlamaModelDecoderLayer
25-01-19 10:51:07 | I | criterion: MSECriterion
25-01-19 10:51:07 | I | num. non-expert model params: 202,383,360 (num. trained: 202,383,360)
25-01-19 10:51:07 | I | num. expert model params: 0 (num. trained: 0)
25-01-19 10:51:07 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 0.0, 'gpu_3_mem_used_gb': 6.873046875, 'gpu_4_mem_used_gb': 11.732421875, 'gpu_5_mem_used_gb': 7.0859375, 'gpu_6_mem_used_gb': 7.0859375, 'gpu_7_mem_used_gb': 6.06640625}
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.weight <- model.model.self_attn.q_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.self_attn.k_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.self_attn.v_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.self_attn.o_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.mlp.gate_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.mlp.up_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- decoder.model.mlp.down_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.q_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.k_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.v_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.self_attn.o_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.mlp.gate_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.mlp.up_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.q_proj.bias <- model.model.mlp.down_proj.bias
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.k_proj.weight <- model.model.self_attn.k_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.v_proj.weight <- model.model.self_attn.v_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.self_attn.o_proj.weight <- model.model.self_attn.o_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.mlp.gate_proj.weight <- model.model.mlp.gate_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.mlp.up_proj.weight <- model.model.mlp.up_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.mlp.down_proj.weight <- model.model.mlp.down_proj.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.input_layernorm.weight <- model.model.input_layernorm.weight
25-01-19 10:51:08 | I | detected shared parameter: decoder.model.post_attention_layernorm.weight <- model.model.post_attention_layernorm.weight
25-01-19 10:51:08 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 0.0, 'gpu_3_mem_used_gb': 6.873046875, 'gpu_4_mem_used_gb': 11.7734375, 'gpu_5_mem_used_gb': 7.126953125, 'gpu_6_mem_used_gb': 7.126953125, 'gpu_7_mem_used_gb': 6.107421875}
25-01-19 10:51:08 | I | ***********************CUDA enviroments for all 1 workers***********************
25-01-19 10:51:08 | I | rank   0: capabilities =  8.6  ; total memory = 23.691 GB ; name = NVIDIA GeForce RTX 3090                 
25-01-19 10:51:08 | I | ***********************CUDA enviroments for all 1 workers***********************
25-01-19 10:51:08 | I | training on 1 devices (GPUs/TPUs)
25-01-19 10:51:08 | I | max tokens per GPU = None and batch size per GPU = 32
25-01-19 10:51:08 | I | nvidia-smi stats: {'gpu_0_mem_used_gb': 0.0, 'gpu_1_mem_used_gb': 0.0, 'gpu_2_mem_used_gb': 0.0, 'gpu_3_mem_used_gb': 6.873046875, 'gpu_4_mem_used_gb': 11.7734375, 'gpu_5_mem_used_gb': 7.126953125, 'gpu_6_mem_used_gb': 7.126953125, 'gpu_7_mem_used_gb': 6.107421875}
25-01-19 10:51:08 | I | loading train data for epoch 1
25-01-19 10:51:10 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/0.jsonl 
 ***
25-01-19 10:51:10 | I | *** 
 total_rows = 700 
 ***
25-01-19 10:51:10 | I | current row num = 0
25-01-19 10:51:10 | I | in forward_and_gen_teacher_outputs, Start iterating over samples
25-01-19 10:51:33 | I | current row num = 32
25-01-19 10:51:38 | I | current row num = 64
25-01-19 10:51:42 | I | current row num = 96
25-01-19 10:51:46 | I | current row num = 128
25-01-19 10:51:51 | I | current row num = 160
25-01-19 10:51:55 | I | current row num = 192
25-01-19 10:51:59 | I | current row num = 224
25-01-19 10:52:03 | I | current row num = 256
25-01-19 10:52:07 | I | current row num = 288
25-01-19 10:52:11 | I | current row num = 320
25-01-19 10:52:15 | I | current row num = 352
25-01-19 10:52:20 | I | current row num = 384
25-01-19 10:52:24 | I | current row num = 416
25-01-19 10:52:28 | I | current row num = 448
25-01-19 10:52:32 | I | current row num = 480
25-01-19 10:52:36 | I | current row num = 512
25-01-19 10:52:40 | I | current row num = 544
25-01-19 10:52:45 | I | current row num = 576
25-01-19 10:52:49 | I | current row num = 608
25-01-19 10:52:53 | I | current row num = 640
25-01-19 10:52:58 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/1.jsonl 
 ***
25-01-19 10:52:58 | I | *** 
 total_rows = 241 
 ***
25-01-19 10:52:58 | I | current row num = 0
25-01-19 10:53:02 | I | current row num = 32
25-01-19 10:53:06 | I | current row num = 64
25-01-19 10:53:10 | I | current row num = 96
25-01-19 10:53:14 | I | current row num = 128
25-01-19 10:53:18 | I | current row num = 160
25-01-19 10:53:23 | I | current row num = 192
25-01-19 10:53:27 | I | current row num = 224
25-01-19 10:53:32 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/2.jsonl 
 ***
25-01-19 10:53:32 | I | *** 
 total_rows = 509 
 ***
25-01-19 10:53:32 | I | current row num = 0
25-01-19 10:53:36 | I | current row num = 32
25-01-19 10:53:41 | I | current row num = 64
25-01-19 10:53:45 | I | current row num = 96
25-01-19 10:53:49 | I | current row num = 128
25-01-19 10:53:53 | I | current row num = 160
25-01-19 10:53:57 | I | current row num = 192
25-01-19 10:54:01 | I | current row num = 224
25-01-19 10:54:06 | I | current row num = 256
25-01-19 10:54:10 | I | current row num = 288
25-01-19 10:54:14 | I | current row num = 320
25-01-19 10:54:18 | I | current row num = 352
25-01-19 10:54:22 | I | current row num = 384
25-01-19 10:54:26 | I | current row num = 416
25-01-19 10:54:31 | I | current row num = 448
25-01-19 10:54:35 | I | current row num = 480
25-01-19 10:54:40 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/3.jsonl 
 ***
25-01-19 10:54:40 | I | *** 
 total_rows = 274 
 ***
25-01-19 10:54:40 | I | current row num = 0
25-01-19 10:54:44 | I | current row num = 32
25-01-19 10:54:48 | I | current row num = 64
25-01-19 10:54:52 | I | current row num = 96
25-01-19 10:54:57 | I | current row num = 128
25-01-19 10:55:01 | I | current row num = 160
25-01-19 10:55:05 | I | current row num = 192
25-01-19 10:55:09 | I | current row num = 224
25-01-19 10:55:14 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/4.jsonl 
 ***
25-01-19 10:55:14 | I | *** 
 total_rows = 191 
 ***
25-01-19 10:55:14 | I | current row num = 0
25-01-19 10:55:18 | I | current row num = 32
25-01-19 10:55:22 | I | current row num = 64
25-01-19 10:55:26 | I | current row num = 96
25-01-19 10:55:30 | I | current row num = 128
25-01-19 10:55:35 | I | current row num = 160
25-01-19 10:55:39 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/5.jsonl 
 ***
25-01-19 10:55:39 | I | *** 
 total_rows = 211 
 ***
25-01-19 10:55:39 | I | current row num = 0
25-01-19 10:55:43 | I | current row num = 32
25-01-19 10:55:48 | I | current row num = 64
25-01-19 10:55:52 | I | current row num = 96
25-01-19 10:55:56 | I | current row num = 128
25-01-19 10:56:00 | I | current row num = 160
25-01-19 10:56:04 | I | current row num = 192
25-01-19 10:56:09 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/6.jsonl 
 ***
25-01-19 10:56:09 | I | *** 
 total_rows = 241 
 ***
25-01-19 10:56:09 | I | current row num = 0
25-01-19 10:56:13 | I | current row num = 32
25-01-19 10:56:17 | I | current row num = 64
25-01-19 10:56:21 | I | current row num = 96
25-01-19 10:56:26 | I | current row num = 128
25-01-19 10:56:30 | I | current row num = 160
25-01-19 10:56:34 | I | current row num = 192
25-01-19 10:56:39 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/7.jsonl 
 ***
25-01-19 10:56:39 | I | *** 
 total_rows = 279 
 ***
25-01-19 10:56:39 | I | current row num = 0
25-01-19 10:56:43 | I | current row num = 32
25-01-19 10:56:47 | I | current row num = 64
25-01-19 10:56:52 | I | current row num = 96
25-01-19 10:56:56 | I | current row num = 128
25-01-19 10:57:00 | I | current row num = 160
25-01-19 10:57:04 | I | current row num = 192
25-01-19 10:57:08 | I | current row num = 224
25-01-19 10:57:12 | I | current row num = 256
25-01-19 10:57:17 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/8.jsonl 
 ***
25-01-19 10:57:17 | I | *** 
 total_rows = 186 
 ***
25-01-19 10:57:17 | I | current row num = 0
25-01-19 10:57:21 | I | current row num = 32
25-01-19 10:57:26 | I | current row num = 64
25-01-19 10:57:30 | I | current row num = 96
25-01-19 10:57:34 | I | current row num = 128
25-01-19 10:57:38 | I | current row num = 160
25-01-19 10:57:45 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/9.jsonl 
 ***
25-01-19 10:57:45 | I | *** 
 total_rows = 770 
 ***
25-01-19 10:57:45 | I | current row num = 0
25-01-19 10:57:49 | I | current row num = 32
25-01-19 10:57:53 | I | current row num = 64
25-01-19 10:57:57 | I | current row num = 96
25-01-19 10:58:01 | I | current row num = 128
25-01-19 10:58:06 | I | current row num = 160
25-01-19 10:58:10 | I | current row num = 192
25-01-19 10:58:14 | I | current row num = 224
25-01-19 10:58:18 | I | current row num = 256
25-01-19 10:58:22 | I | current row num = 288
25-01-19 10:58:26 | I | current row num = 320
25-01-19 10:58:30 | I | current row num = 352
25-01-19 10:58:35 | I | current row num = 384
25-01-19 10:58:39 | I | current row num = 416
25-01-19 10:58:43 | I | current row num = 448
25-01-19 10:58:47 | I | current row num = 480
25-01-19 10:58:51 | I | current row num = 512
25-01-19 10:58:55 | I | current row num = 544
25-01-19 10:59:00 | I | current row num = 576
25-01-19 10:59:04 | I | current row num = 608
25-01-19 10:59:08 | I | current row num = 640
25-01-19 10:59:12 | I | current row num = 672
25-01-19 10:59:16 | I | current row num = 704
25-01-19 10:59:20 | I | current row num = 736
25-01-19 10:59:26 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/10.jsonl 
 ***
25-01-19 10:59:26 | I | *** 
 total_rows = 271 
 ***
25-01-19 10:59:26 | I | current row num = 0
25-01-19 10:59:30 | I | current row num = 32
25-01-19 10:59:34 | I | current row num = 64
25-01-19 10:59:38 | I | current row num = 96
25-01-19 10:59:42 | I | current row num = 128
25-01-19 10:59:46 | I | current row num = 160
25-01-19 10:59:50 | I | current row num = 192
25-01-19 10:59:55 | I | current row num = 224
25-01-19 10:59:59 | I | current row num = 256
25-01-19 11:00:04 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/11.jsonl 
 ***
25-01-19 11:00:04 | I | *** 
 total_rows = 273 
 ***
25-01-19 11:00:04 | I | current row num = 0
25-01-19 11:00:08 | I | current row num = 32
25-01-19 11:00:12 | I | current row num = 64
25-01-19 11:00:16 | I | current row num = 96
25-01-19 11:00:20 | I | current row num = 128
25-01-19 11:00:25 | I | current row num = 160
25-01-19 11:00:29 | I | current row num = 192
25-01-19 11:00:33 | I | current row num = 224
25-01-19 11:00:38 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/12.jsonl 
 ***
25-01-19 11:00:38 | I | *** 
 total_rows = 301 
 ***
25-01-19 11:00:38 | I | current row num = 0
25-01-19 11:00:42 | I | current row num = 32
25-01-19 11:00:46 | I | current row num = 64
25-01-19 11:00:50 | I | current row num = 96
25-01-19 11:00:55 | I | current row num = 128
25-01-19 11:00:59 | I | current row num = 160
25-01-19 11:01:03 | I | current row num = 192
25-01-19 11:01:07 | I | current row num = 224
25-01-19 11:01:12 | I | current row num = 256
25-01-19 11:01:17 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/13.jsonl 
 ***
25-01-19 11:01:17 | I | *** 
 total_rows = 239 
 ***
25-01-19 11:01:17 | I | current row num = 0
25-01-19 11:01:21 | I | current row num = 32
25-01-19 11:01:25 | I | current row num = 64
25-01-19 11:01:29 | I | current row num = 96
25-01-19 11:01:33 | I | current row num = 128
25-01-19 11:01:37 | I | current row num = 160
25-01-19 11:01:41 | I | current row num = 192
25-01-19 11:01:46 | I | current row num = 224
25-01-19 11:01:50 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/14.jsonl 
 ***
25-01-19 11:01:50 | I | *** 
 total_rows = 262 
 ***
25-01-19 11:01:50 | I | current row num = 0
25-01-19 11:01:55 | I | current row num = 32
25-01-19 11:01:59 | I | current row num = 64
25-01-19 11:02:03 | I | current row num = 96
25-01-19 11:02:07 | I | current row num = 128
25-01-19 11:02:11 | I | current row num = 160
25-01-19 11:02:15 | I | current row num = 192
25-01-19 11:02:20 | I | current row num = 224
25-01-19 11:02:25 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/15.jsonl 
 ***
25-01-19 11:02:25 | I | *** 
 total_rows = 253 
 ***
25-01-19 11:02:25 | I | current row num = 0
25-01-19 11:02:29 | I | current row num = 32
25-01-19 11:02:33 | I | current row num = 64
25-01-19 11:02:37 | I | current row num = 96
25-01-19 11:02:41 | I | current row num = 128
25-01-19 11:02:45 | I | current row num = 160
25-01-19 11:02:50 | I | current row num = 192
25-01-19 11:02:54 | I | current row num = 224
25-01-19 11:02:59 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/16.jsonl 
 ***
25-01-19 11:02:59 | I | *** 
 total_rows = 523 
 ***
25-01-19 11:02:59 | I | current row num = 0
25-01-19 11:03:03 | I | current row num = 32
25-01-19 11:03:08 | I | current row num = 64
25-01-19 11:03:12 | I | current row num = 96
25-01-19 11:03:16 | I | current row num = 128
25-01-19 11:03:20 | I | current row num = 160
25-01-19 11:03:24 | I | current row num = 192
25-01-19 11:03:28 | I | current row num = 224
25-01-19 11:03:33 | I | current row num = 256
25-01-19 11:03:37 | I | current row num = 288
25-01-19 11:03:41 | I | current row num = 320
25-01-19 11:03:45 | I | current row num = 352
25-01-19 11:03:49 | I | current row num = 384
25-01-19 11:03:53 | I | current row num = 416
25-01-19 11:03:58 | I | current row num = 448
25-01-19 11:04:02 | I | current row num = 480
25-01-19 11:04:07 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/17.jsonl 
 ***
25-01-19 11:04:07 | I | *** 
 total_rows = 251 
 ***
25-01-19 11:04:07 | I | current row num = 0
25-01-19 11:04:11 | I | current row num = 32
25-01-19 11:04:15 | I | current row num = 64
25-01-19 11:04:19 | I | current row num = 96
25-01-19 11:04:23 | I | current row num = 128
25-01-19 11:04:28 | I | current row num = 160
25-01-19 11:04:32 | I | current row num = 192
25-01-19 11:04:36 | I | current row num = 224
25-01-19 11:04:41 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/18.jsonl 
 ***
25-01-19 11:04:41 | I | *** 
 total_rows = 274 
 ***
25-01-19 11:04:41 | I | current row num = 0
25-01-19 11:04:45 | I | current row num = 32
25-01-19 11:04:49 | I | current row num = 64
25-01-19 11:04:53 | I | current row num = 96
25-01-19 11:04:57 | I | current row num = 128
25-01-19 11:05:02 | I | current row num = 160
25-01-19 11:05:06 | I | current row num = 192
25-01-19 11:05:10 | I | current row num = 224
25-01-19 11:05:14 | I | current row num = 256
25-01-19 11:05:19 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/19.jsonl 
 ***
25-01-19 11:05:19 | I | *** 
 total_rows = 315 
 ***
25-01-19 11:05:19 | I | current row num = 0
25-01-19 11:05:23 | I | current row num = 32
25-01-19 11:05:27 | I | current row num = 64
25-01-19 11:05:32 | I | current row num = 96
25-01-19 11:05:36 | I | current row num = 128
25-01-19 11:05:40 | I | current row num = 160
25-01-19 11:05:44 | I | current row num = 192
25-01-19 11:05:48 | I | current row num = 224
25-01-19 11:05:52 | I | current row num = 256
25-01-19 11:05:57 | I | current row num = 288
25-01-19 11:06:01 | I | current row num = 320
25-01-19 11:06:02 | I | loading train data for epoch 1
25-01-19 11:06:04 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/0.jsonl 
 ***
25-01-19 11:06:04 | I | *** 
 total_rows = 700 
 ***
25-01-19 11:06:04 | I | current row num = 0
25-01-19 11:06:04 | I | in forward_and_gen_args_and_kwargs, Start iterating over samples
25-01-19 11:06:04 | I | current row num = 32
25-01-19 11:06:08 | I | current row num = 64
25-01-19 11:06:12 | I | current row num = 96
25-01-19 11:06:16 | I | current row num = 128
25-01-19 11:06:21 | I | current row num = 160
25-01-19 11:06:25 | I | current row num = 192
25-01-19 11:06:29 | I | current row num = 224
25-01-19 11:06:33 | I | current row num = 256
25-01-19 11:06:37 | I | current row num = 288
25-01-19 11:06:41 | I | current row num = 320
25-01-19 11:06:46 | I | current row num = 352
25-01-19 11:06:50 | I | current row num = 384
25-01-19 11:06:54 | I | current row num = 416
25-01-19 11:06:58 | I | current row num = 448
25-01-19 11:07:02 | I | current row num = 480
25-01-19 11:07:06 | I | current row num = 512
25-01-19 11:07:11 | I | current row num = 544
25-01-19 11:07:15 | I | current row num = 576
25-01-19 11:07:19 | I | current row num = 608
25-01-19 11:07:23 | I | current row num = 640
25-01-19 11:07:28 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/1.jsonl 
 ***
25-01-19 11:07:28 | I | *** 
 total_rows = 241 
 ***
25-01-19 11:07:28 | I | current row num = 0
25-01-19 11:07:32 | I | current row num = 32
25-01-19 11:07:36 | I | current row num = 64
25-01-19 11:07:40 | I | current row num = 96
25-01-19 11:07:45 | I | current row num = 128
25-01-19 11:07:49 | I | current row num = 160
25-01-19 11:07:53 | I | current row num = 192
25-01-19 11:07:57 | I | current row num = 224
25-01-19 11:08:03 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/2.jsonl 
 ***
25-01-19 11:08:03 | I | *** 
 total_rows = 509 
 ***
25-01-19 11:08:03 | I | current row num = 0
25-01-19 11:08:07 | I | current row num = 32
25-01-19 11:08:11 | I | current row num = 64
25-01-19 11:08:15 | I | current row num = 96
25-01-19 11:08:19 | I | current row num = 128
25-01-19 11:08:23 | I | current row num = 160
25-01-19 11:08:27 | I | current row num = 192
25-01-19 11:08:32 | I | current row num = 224
25-01-19 11:08:36 | I | current row num = 256
25-01-19 11:08:40 | I | current row num = 288
25-01-19 11:08:44 | I | current row num = 320
25-01-19 11:08:48 | I | current row num = 352
25-01-19 11:08:52 | I | current row num = 384
25-01-19 11:08:57 | I | current row num = 416
25-01-19 11:09:01 | I | current row num = 448
25-01-19 11:09:05 | I | current row num = 480
25-01-19 11:09:10 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/3.jsonl 
 ***
25-01-19 11:09:10 | I | *** 
 total_rows = 274 
 ***
25-01-19 11:09:10 | I | current row num = 0
25-01-19 11:09:14 | I | current row num = 32
25-01-19 11:09:18 | I | current row num = 64
25-01-19 11:09:22 | I | current row num = 96
25-01-19 11:09:27 | I | current row num = 128
25-01-19 11:09:31 | I | current row num = 160
25-01-19 11:09:35 | I | current row num = 192
25-01-19 11:09:39 | I | current row num = 224
25-01-19 11:09:44 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/4.jsonl 
 ***
25-01-19 11:09:44 | I | *** 
 total_rows = 191 
 ***
25-01-19 11:09:44 | I | current row num = 0
25-01-19 11:09:48 | I | current row num = 32
25-01-19 11:09:52 | I | current row num = 64
25-01-19 11:09:56 | I | current row num = 96
25-01-19 11:10:00 | I | current row num = 128
25-01-19 11:10:05 | I | current row num = 160
25-01-19 11:10:09 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/5.jsonl 
 ***
25-01-19 11:10:09 | I | *** 
 total_rows = 211 
 ***
25-01-19 11:10:09 | I | current row num = 0
25-01-19 11:10:13 | I | current row num = 32
25-01-19 11:10:18 | I | current row num = 64
25-01-19 11:10:22 | I | current row num = 96
25-01-19 11:10:26 | I | current row num = 128
25-01-19 11:10:30 | I | current row num = 160
25-01-19 11:10:34 | I | current row num = 192
25-01-19 11:10:39 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/6.jsonl 
 ***
25-01-19 11:10:39 | I | *** 
 total_rows = 241 
 ***
25-01-19 11:10:39 | I | current row num = 0
25-01-19 11:10:43 | I | current row num = 32
25-01-19 11:10:47 | I | current row num = 64
25-01-19 11:10:51 | I | current row num = 96
25-01-19 11:10:56 | I | current row num = 128
25-01-19 11:11:00 | I | current row num = 160
25-01-19 11:11:04 | I | current row num = 192
25-01-19 11:11:09 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/7.jsonl 
 ***
25-01-19 11:11:09 | I | *** 
 total_rows = 279 
 ***
25-01-19 11:11:09 | I | current row num = 0
25-01-19 11:11:13 | I | current row num = 32
25-01-19 11:11:17 | I | current row num = 64
25-01-19 11:11:21 | I | current row num = 96
25-01-19 11:11:26 | I | current row num = 128
25-01-19 11:11:30 | I | current row num = 160
25-01-19 11:11:34 | I | current row num = 192
25-01-19 11:11:38 | I | current row num = 224
25-01-19 11:11:42 | I | current row num = 256
25-01-19 11:11:47 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/8.jsonl 
 ***
25-01-19 11:11:47 | I | *** 
 total_rows = 186 
 ***
25-01-19 11:11:47 | I | current row num = 0
25-01-19 11:11:51 | I | current row num = 32
25-01-19 11:11:55 | I | current row num = 64
25-01-19 11:11:59 | I | current row num = 96
25-01-19 11:12:04 | I | current row num = 128
25-01-19 11:12:08 | I | current row num = 160
25-01-19 11:12:14 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/9.jsonl 
 ***
25-01-19 11:12:14 | I | *** 
 total_rows = 770 
 ***
25-01-19 11:12:14 | I | current row num = 0
25-01-19 11:12:18 | I | current row num = 32
25-01-19 11:12:22 | I | current row num = 64
25-01-19 11:12:27 | I | current row num = 96
25-01-19 11:12:31 | I | current row num = 128
25-01-19 11:12:35 | I | current row num = 160
25-01-19 11:12:39 | I | current row num = 192
25-01-19 11:12:43 | I | current row num = 224
25-01-19 11:12:47 | I | current row num = 256
25-01-19 11:12:52 | I | current row num = 288
25-01-19 11:12:56 | I | current row num = 320
25-01-19 11:13:00 | I | current row num = 352
25-01-19 11:13:04 | I | current row num = 384
25-01-19 11:13:08 | I | current row num = 416
25-01-19 11:13:12 | I | current row num = 448
25-01-19 11:13:17 | I | current row num = 480
25-01-19 11:13:21 | I | current row num = 512
25-01-19 11:13:25 | I | current row num = 544
25-01-19 11:13:29 | I | current row num = 576
25-01-19 11:13:33 | I | current row num = 608
25-01-19 11:13:37 | I | current row num = 640
25-01-19 11:13:42 | I | current row num = 672
25-01-19 11:13:46 | I | current row num = 704
25-01-19 11:13:50 | I | current row num = 736
25-01-19 11:13:55 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/10.jsonl 
 ***
25-01-19 11:13:55 | I | *** 
 total_rows = 271 
 ***
25-01-19 11:13:55 | I | current row num = 0
25-01-19 11:13:59 | I | current row num = 32
25-01-19 11:14:03 | I | current row num = 64
25-01-19 11:14:07 | I | current row num = 96
25-01-19 11:14:12 | I | current row num = 128
25-01-19 11:14:16 | I | current row num = 160
25-01-19 11:14:20 | I | current row num = 192
25-01-19 11:14:24 | I | current row num = 224
25-01-19 11:14:28 | I | current row num = 256
25-01-19 11:14:33 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/11.jsonl 
 ***
25-01-19 11:14:33 | I | *** 
 total_rows = 273 
 ***
25-01-19 11:14:33 | I | current row num = 0
25-01-19 11:14:37 | I | current row num = 32
25-01-19 11:14:41 | I | current row num = 64
25-01-19 11:14:46 | I | current row num = 96
25-01-19 11:14:50 | I | current row num = 128
25-01-19 11:14:54 | I | current row num = 160
25-01-19 11:14:58 | I | current row num = 192
25-01-19 11:15:02 | I | current row num = 224
25-01-19 11:15:07 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/12.jsonl 
 ***
25-01-19 11:15:07 | I | *** 
 total_rows = 301 
 ***
25-01-19 11:15:07 | I | current row num = 0
25-01-19 11:15:11 | I | current row num = 32
25-01-19 11:15:15 | I | current row num = 64
25-01-19 11:15:20 | I | current row num = 96
25-01-19 11:15:24 | I | current row num = 128
25-01-19 11:15:28 | I | current row num = 160
25-01-19 11:15:32 | I | current row num = 192
25-01-19 11:15:36 | I | current row num = 224
25-01-19 11:15:40 | I | current row num = 256
25-01-19 11:15:45 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/13.jsonl 
 ***
25-01-19 11:15:45 | I | *** 
 total_rows = 239 
 ***
25-01-19 11:15:45 | I | current row num = 0
25-01-19 11:15:49 | I | current row num = 32
25-01-19 11:15:54 | I | current row num = 64
25-01-19 11:15:58 | I | current row num = 96
25-01-19 11:16:02 | I | current row num = 128
25-01-19 11:16:06 | I | current row num = 160
25-01-19 11:16:10 | I | current row num = 192
25-01-19 11:16:15 | I | current row num = 224
25-01-19 11:16:19 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/14.jsonl 
 ***
25-01-19 11:16:19 | I | *** 
 total_rows = 262 
 ***
25-01-19 11:16:19 | I | current row num = 0
25-01-19 11:16:24 | I | current row num = 32
25-01-19 11:16:28 | I | current row num = 64
25-01-19 11:16:32 | I | current row num = 96
25-01-19 11:16:36 | I | current row num = 128
25-01-19 11:16:40 | I | current row num = 160
25-01-19 11:16:44 | I | current row num = 192
25-01-19 11:16:49 | I | current row num = 224
25-01-19 11:16:54 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/15.jsonl 
 ***
25-01-19 11:16:54 | I | *** 
 total_rows = 253 
 ***
25-01-19 11:16:54 | I | current row num = 0
25-01-19 11:16:58 | I | current row num = 32
25-01-19 11:17:02 | I | current row num = 64
25-01-19 11:17:06 | I | current row num = 96
25-01-19 11:17:10 | I | current row num = 128
25-01-19 11:17:14 | I | current row num = 160
25-01-19 11:17:18 | I | current row num = 192
25-01-19 11:17:23 | I | current row num = 224
25-01-19 11:17:28 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/16.jsonl 
 ***
25-01-19 11:17:28 | I | *** 
 total_rows = 523 
 ***
25-01-19 11:17:28 | I | current row num = 0
25-01-19 11:17:32 | I | current row num = 32
25-01-19 11:17:36 | I | current row num = 64
25-01-19 11:17:41 | I | current row num = 96
25-01-19 11:17:45 | I | current row num = 128
25-01-19 11:17:49 | I | current row num = 160
25-01-19 11:17:53 | I | current row num = 192
25-01-19 11:17:57 | I | current row num = 224
25-01-19 11:18:01 | I | current row num = 256
25-01-19 11:18:06 | I | current row num = 288
25-01-19 11:18:10 | I | current row num = 320
25-01-19 11:18:14 | I | current row num = 352
25-01-19 11:18:18 | I | current row num = 384
25-01-19 11:18:22 | I | current row num = 416
25-01-19 11:18:26 | I | current row num = 448
25-01-19 11:18:31 | I | current row num = 480
25-01-19 11:18:35 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/17.jsonl 
 ***
25-01-19 11:18:35 | I | *** 
 total_rows = 251 
 ***
25-01-19 11:18:35 | I | current row num = 0
25-01-19 11:18:40 | I | current row num = 32
25-01-19 11:18:44 | I | current row num = 64
25-01-19 11:18:48 | I | current row num = 96
25-01-19 11:18:52 | I | current row num = 128
25-01-19 11:18:56 | I | current row num = 160
25-01-19 11:19:00 | I | current row num = 192
25-01-19 11:19:05 | I | current row num = 224
25-01-19 11:19:09 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/18.jsonl 
 ***
25-01-19 11:19:09 | I | *** 
 total_rows = 274 
 ***
25-01-19 11:19:09 | I | current row num = 0
25-01-19 11:19:13 | I | current row num = 32
25-01-19 11:19:18 | I | current row num = 64
25-01-19 11:19:22 | I | current row num = 96
25-01-19 11:19:26 | I | current row num = 128
25-01-19 11:19:30 | I | current row num = 160
25-01-19 11:19:34 | I | current row num = 192
25-01-19 11:19:39 | I | current row num = 224
25-01-19 11:19:43 | I | current row num = 256
25-01-19 11:19:48 | I | *** 
 now in /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_1.1b/shard/val/19.jsonl 
 ***
25-01-19 11:19:48 | I | *** 
 total_rows = 315 
 ***
25-01-19 11:19:48 | I | current row num = 0
25-01-19 11:19:52 | I | current row num = 32
25-01-19 11:19:56 | I | current row num = 64
25-01-19 11:20:00 | I | current row num = 96
25-01-19 11:20:04 | I | current row num = 128
25-01-19 11:20:09 | I | current row num = 160
25-01-19 11:20:13 | I | current row num = 192
25-01-19 11:20:17 | I | current row num = 224
25-01-19 11:20:21 | I | current row num = 256
25-01-19 11:20:25 | I | current row num = 288
25-01-19 11:20:29 | I | current row num = 320
25-01-19 11:20:31 | I | No existing checkpoint found checkpoints/checkpoint_last.pt
25-01-19 11:20:31 | I | loading train data for epoch 1
25-01-19 11:20:31 | I | loading valid data for epoch 1
25-01-19 11:20:34 | I | begin training epoch 1
25-01-19 11:20:34 | I | Start iterating over samples
25-01-19 11:20:34 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:20:34 | I | in layer model.layers.4
25-01-19 11:20:34 | I | quantizing weights for layer model.layers.4
25-01-19 11:20:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:20:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:20:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:20:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:20:36 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:20:36 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:20:37 | I |       - range scale = [    1.0000]
25-01-19 11:20:37 | I |         sum  error  = [    3.3359]
25-01-19 11:20:37 | I |         best error  = [    3.3359]
25-01-19 11:20:37 | I |     + error = [3.3359]
25-01-19 11:20:38 | I |       - range scale = [    1.0000]
25-01-19 11:20:38 | I |         sum  error  = [   31.5180]
25-01-19 11:20:38 | I |         best error  = [   31.5180]
25-01-19 11:20:38 | I |     + error = [31.5180]
25-01-19 11:20:38 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:20:39 | I |       - range scale = [    1.0000]
25-01-19 11:20:39 | I |         sum  error  = [    1.1938]
25-01-19 11:20:39 | I |         best error  = [    1.1938]
25-01-19 11:20:39 | I |     + error = [1.1938]
25-01-19 11:20:40 | I |       - range scale = [    1.0000]
25-01-19 11:20:40 | I |         sum  error  = [   12.1243]
25-01-19 11:20:40 | I |         best error  = [   12.1243]
25-01-19 11:20:40 | I |     + error = [12.1243]
25-01-19 11:20:40 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:20:41 | I |       - range scale = [    1.0000]
25-01-19 11:20:41 | I |         sum  error  = [    3.6374]
25-01-19 11:20:41 | I |         best error  = [    3.6374]
25-01-19 11:20:41 | I |     + error = [3.6374]
25-01-19 11:20:42 | I |       - range scale = [    1.0000]
25-01-19 11:20:42 | I |         sum  error  = [   38.8105]
25-01-19 11:20:42 | I |         best error  = [   38.8105]
25-01-19 11:20:42 | I |     + error = [38.8105]
25-01-19 11:20:42 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:20:42 | I |       - range scale = [    1.0000]
25-01-19 11:20:42 | I |         sum  error  = [    0.4288]
25-01-19 11:20:42 | I |         best error  = [    0.4288]
25-01-19 11:20:42 | I |     + error = [0.4288]
25-01-19 11:20:43 | I |       - range scale = [    1.0000]
25-01-19 11:20:43 | I |         sum  error  = [    4.3502]
25-01-19 11:20:43 | I |         best error  = [    4.3502]
25-01-19 11:20:43 | I |     + error = [4.3502]
25-01-19 11:20:44 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:20:44 | I |       - range scale = [    1.0000]
25-01-19 11:20:44 | I |         sum  error  = [    3.9654]
25-01-19 11:20:44 | I |         best error  = [    3.9654]
25-01-19 11:20:44 | I |     + error = [3.9654]
25-01-19 11:20:46 | I |       - range scale = [    1.0000]
25-01-19 11:20:46 | I |         sum  error  = [   41.9417]
25-01-19 11:20:46 | I |         best error  = [   41.9417]
25-01-19 11:20:46 | I |     + error = [41.9417]
25-01-19 11:20:46 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:20:47 | I |       - range scale = [    1.0000]
25-01-19 11:20:47 | I |         sum  error  = [    4.4603]
25-01-19 11:20:47 | I |         best error  = [    4.4603]
25-01-19 11:20:47 | I |     + error = [4.4603]
25-01-19 11:20:48 | I |       - range scale = [    1.0000]
25-01-19 11:20:48 | I |         sum  error  = [   46.6500]
25-01-19 11:20:48 | I |         best error  = [   46.6500]
25-01-19 11:20:48 | I |     + error = [46.6500]
25-01-19 11:20:48 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:20:49 | I |       - range scale = [    1.0000]
25-01-19 11:20:49 | I |         sum  error  = [    0.9377]
25-01-19 11:20:49 | I |         best error  = [    0.9377]
25-01-19 11:20:49 | I |     + error = [0.9377]
25-01-19 11:20:50 | I |       - range scale = [    1.0000]
25-01-19 11:20:50 | I |         sum  error  = [    9.0722]
25-01-19 11:20:50 | I |         best error  = [    9.0722]
25-01-19 11:20:50 | I |     + error = [9.0722]
25-01-19 11:20:50 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:20:54 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:20:57 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:20:59 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:21:02 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:21:05 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:21:08 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:21:15 | I | quantizing activations for layer model.layers.4
25-01-19 11:21:16 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:16 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:16 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:17 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:19 | I | forward this layer
25-01-19 11:21:19 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/00.pt
25-01-19 11:21:19 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/00.pt
25-01-19 11:21:19 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 164.94 MiB is free. Process 13810 has 5.58 GiB memory in use. Process 29960 has 17.95 GiB memory in use. Of the allocated memory 16.98 GiB is allocated by PyTorch, and 512.95 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:21:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 1            |        cudaMalloc retries: 1         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  15542 MiB |  17383 MiB |  17002 GiB |  16986 GiB |
|       from large pool |  15540 MiB |  17380 MiB |  16990 GiB |  16975 GiB |
|       from small pool |      2 MiB |      5 MiB |     11 GiB |     11 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  15542 MiB |  17383 MiB |  17002 GiB |  16986 GiB |
|       from large pool |  15540 MiB |  17380 MiB |  16990 GiB |  16975 GiB |
|       from small pool |      2 MiB |      5 MiB |     11 GiB |     11 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  15542 MiB |  17383 MiB |  16999 GiB |  16984 GiB |
|       from large pool |  15540 MiB |  17380 MiB |  16988 GiB |  16972 GiB |
|       from small pool |      2 MiB |      5 MiB |     11 GiB |     11 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  17896 MiB |  17896 MiB |  93064 MiB |  75168 MiB |
|       from large pool |  17892 MiB |  17892 MiB |  93012 MiB |  75120 MiB |
|       from small pool |      4 MiB |      6 MiB |     52 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 394398 KiB |   1457 MiB |   7232 GiB |   7232 GiB |
|       from large pool | 393088 KiB |   1455 MiB |   7220 GiB |   7219 GiB |
|       from small pool |   1310 KiB |      3 MiB |     12 GiB |     12 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     243    |     256    |  307712    |  307469    |
|       from large pool |     167    |     174    |  119052    |  118885    |
|       from small pool |      76    |      82    |  188660    |  188584    |
|---------------------------------------------------------------------------|
| Active allocs         |     243    |     256    |  307712    |  307469    |
|       from large pool |     167    |     174    |  119052    |  118885    |
|       from small pool |      76    |      82    |  188660    |  188584    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     155    |     155    |     395    |     240    |
|       from large pool |     153    |     153    |     369    |     216    |
|       from small pool |       2    |       3    |      26    |      24    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      20    |      22    |  144931    |  144911    |
|       from large pool |       9    |      14    |   61717    |   61708    |
|       from small pool |      11    |      11    |   83214    |   83203    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:21:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20158 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20158 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20158 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7944 GiB |   7944 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7942 GiB |   7941 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159291    |  159110    |
|       from large pool |     127    |     152    |  122303    |  122176    |
|       from small pool |      54    |      61    |   36988    |   36934    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159291    |  159110    |
|       from large pool |     127    |     152    |  122303    |  122176    |
|       from small pool |      54    |      61    |   36988    |   36934    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:21:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20158 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20158 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20158 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6847 GiB |   6847 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6845 GiB |   6845 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159291    |  159110    |
|       from large pool |     127    |     152    |  122303    |  122176    |
|       from small pool |      54    |      61    |   36988    |   36934    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159291    |  159110    |
|       from large pool |     127    |     152    |  122303    |  122176    |
|       from small pool |      54    |      61    |   36988    |   36934    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:21:19 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17340 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17340 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17340 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  20704 MiB |  14778 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  20700 MiB |  14776 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131764    |  131615    |
|       from large pool |     101    |     122    |   98501    |   98400    |
|       from small pool |      48    |      57    |   33263    |   33215    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131764    |  131615    |
|       from large pool |     101    |     122    |   98501    |   98400    |
|       from small pool |      48    |      57    |   33263    |   33215    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     151    |      49    |
|       from large pool |     101    |     120    |     149    |      48    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:21:19 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:21:20 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:21:20 | I | in layer model.layers.4
25-01-19 11:21:20 | I | quantizing weights for layer model.layers.4
25-01-19 11:21:20 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:21 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:21 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:21 | I | collecting calibration activations in model.layers.4
25-01-19 11:21:22 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:21:22 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:21:23 | I |       - range scale = [    1.0000]
25-01-19 11:21:23 | I |         sum  error  = [   10.4925]
25-01-19 11:21:23 | I |         best error  = [   10.4925]
25-01-19 11:21:23 | I |     + error = [10.4925]
25-01-19 11:21:23 | I |       - range scale = [    1.0000]
25-01-19 11:21:23 | I |         sum  error  = [   17.7490]
25-01-19 11:21:23 | I |         best error  = [   17.7490]
25-01-19 11:21:23 | I |     + error = [17.7490]
25-01-19 11:21:24 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:21:25 | I |       - range scale = [    1.0000]
25-01-19 11:21:25 | I |         sum  error  = [   19.8104]
25-01-19 11:21:25 | I |         best error  = [   19.8104]
25-01-19 11:21:25 | I |     + error = [19.8104]
25-01-19 11:21:26 | I |       - range scale = [    1.0000]
25-01-19 11:21:26 | I |         sum  error  = [   39.3523]
25-01-19 11:21:26 | I |         best error  = [   39.3523]
25-01-19 11:21:26 | I |     + error = [39.3523]
25-01-19 11:21:26 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:21:27 | I |       - range scale = [    1.0000]
25-01-19 11:21:27 | I |         sum  error  = [    2.8102]
25-01-19 11:21:27 | I |         best error  = [    2.8102]
25-01-19 11:21:27 | I |     + error = [2.8102]
25-01-19 11:21:27 | I |       - range scale = [    1.0000]
25-01-19 11:21:27 | I |         sum  error  = [   12.8397]
25-01-19 11:21:27 | I |         best error  = [   12.8397]
25-01-19 11:21:27 | I |     + error = [12.8397]
25-01-19 11:21:28 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:21:28 | I |       - range scale = [    1.0000]
25-01-19 11:21:28 | I |         sum  error  = [    0.4262]
25-01-19 11:21:28 | I |         best error  = [    0.4262]
25-01-19 11:21:28 | I |     + error = [0.4262]
25-01-19 11:21:29 | I |       - range scale = [    1.0000]
25-01-19 11:21:29 | I |         sum  error  = [    2.0683]
25-01-19 11:21:29 | I |         best error  = [    2.0683]
25-01-19 11:21:29 | I |     + error = [2.0683]
25-01-19 11:21:29 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:21:30 | I |       - range scale = [    1.0000]
25-01-19 11:21:30 | I |         sum  error  = [    3.5943]
25-01-19 11:21:30 | I |         best error  = [    3.5943]
25-01-19 11:21:30 | I |     + error = [3.5943]
25-01-19 11:21:31 | I |       - range scale = [    1.0000]
25-01-19 11:21:31 | I |         sum  error  = [   16.8564]
25-01-19 11:21:31 | I |         best error  = [   16.8564]
25-01-19 11:21:31 | I |     + error = [16.8564]
25-01-19 11:21:32 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:21:32 | I |       - range scale = [    1.0000]
25-01-19 11:21:32 | I |         sum  error  = [    4.2662]
25-01-19 11:21:32 | I |         best error  = [    4.2662]
25-01-19 11:21:32 | I |     + error = [4.2662]
25-01-19 11:21:34 | I |       - range scale = [    1.0000]
25-01-19 11:21:34 | I |         sum  error  = [   19.0767]
25-01-19 11:21:34 | I |         best error  = [   19.0767]
25-01-19 11:21:34 | I |     + error = [19.0767]
25-01-19 11:21:34 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:21:35 | I |       - range scale = [    1.0000]
25-01-19 11:21:35 | I |         sum  error  = [    0.7896]
25-01-19 11:21:35 | I |         best error  = [    0.7896]
25-01-19 11:21:35 | I |     + error = [0.7896]
25-01-19 11:21:36 | I |       - range scale = [    1.0000]
25-01-19 11:21:36 | I |         sum  error  = [    3.7654]
25-01-19 11:21:36 | I |         best error  = [    3.7654]
25-01-19 11:21:36 | I |     + error = [3.7654]
25-01-19 11:21:36 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:21:39 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:21:42 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:21:45 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:21:47 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:21:50 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:21:53 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:22:01 | I | quantizing activations for layer model.layers.4
25-01-19 11:22:01 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:02 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:02 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:02 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:04 | I | forward this layer
25-01-19 11:22:04 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/02.pt
25-01-19 11:22:04 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/02.pt
25-01-19 11:22:05 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 176.94 MiB is free. Process 13810 has 5.58 GiB memory in use. Process 29960 has 17.93 GiB memory in use. Of the allocated memory 16.55 GiB is allocated by PyTorch, and 933.01 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:22:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 2            |        cudaMalloc retries: 2         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16950 MiB |  17383 MiB |  17602 GiB |  17586 GiB |
|       from large pool |  16948 MiB |  17380 MiB |  17582 GiB |  17565 GiB |
|       from small pool |      2 MiB |      5 MiB |     20 GiB |     20 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16950 MiB |  17383 MiB |  17602 GiB |  17586 GiB |
|       from large pool |  16948 MiB |  17380 MiB |  17582 GiB |  17565 GiB |
|       from small pool |      2 MiB |      5 MiB |     20 GiB |     20 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16950 MiB |  17383 MiB |  17593 GiB |  17576 GiB |
|       from large pool |  16948 MiB |  17380 MiB |  17572 GiB |  17556 GiB |
|       from small pool |      2 MiB |      5 MiB |     20 GiB |     20 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  17884 MiB |  17896 MiB | 160534 MiB | 142650 MiB |
|       from large pool |  17880 MiB |  17892 MiB | 160412 MiB | 142532 MiB |
|       from small pool |      4 MiB |      6 MiB |    122 MiB |    118 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    933 MiB |   1457 MiB |   7432 GiB |   7431 GiB |
|       from large pool |    931 MiB |   1455 MiB |   7409 GiB |   7408 GiB |
|       from small pool |      1 MiB |      4 MiB |     23 GiB |     23 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     254    |     258    |  497862    |  497608    |
|       from large pool |     176    |     178    |  143764    |  143588    |
|       from small pool |      78    |      82    |  354098    |  354020    |
|---------------------------------------------------------------------------|
| Active allocs         |     254    |     258    |  497862    |  497608    |
|       from large pool |     176    |     178    |  143764    |  143588    |
|       from small pool |      78    |      82    |  354098    |  354020    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     152    |     155    |     553    |     401    |
|       from large pool |     150    |     153    |     492    |     342    |
|       from small pool |       2    |       3    |      61    |      59    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      24    |      25    |  239637    |  239613    |
|       from large pool |      16    |      18    |   79118    |   79102    |
|       from small pool |       8    |      11    |  160519    |  160511    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7944 GiB |   7944 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7942 GiB |   7942 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159311    |  159130    |
|       from large pool |     127    |     152    |  122317    |  122190    |
|       from small pool |      54    |      61    |   36994    |   36940    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159311    |  159130    |
|       from large pool |     127    |     152    |  122317    |  122190    |
|       from small pool |      54    |      61    |   36994    |   36940    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6848 GiB |   6847 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6845 GiB |   6845 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159311    |  159130    |
|       from large pool |     127    |     152    |  122317    |  122190    |
|       from small pool |      54    |      61    |   36994    |   36940    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159311    |  159130    |
|       from large pool |     127    |     152    |  122317    |  122190    |
|       from small pool |      54    |      61    |   36994    |   36940    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:05 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17348 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17340 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17348 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17340 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17348 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17340 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  21032 MiB |  15106 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  21028 MiB |  15104 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131784    |  131635    |
|       from large pool |     101    |     122    |   98515    |   98414    |
|       from small pool |      48    |      57    |   33269    |   33221    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131784    |  131635    |
|       from large pool |     101    |     122    |   98515    |   98414    |
|       from small pool |      48    |      57    |   33269    |   33221    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     161    |      59    |
|       from large pool |     101    |     120    |     159    |      58    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:05 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:22:05 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:22:05 | I | in layer model.layers.4
25-01-19 11:22:05 | I | quantizing weights for layer model.layers.4
25-01-19 11:22:06 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:06 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:07 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:07 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:07 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:22:07 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:22:08 | I |       - range scale = [    1.0000]
25-01-19 11:22:08 | I |         sum  error  = [   10.3037]
25-01-19 11:22:08 | I |         best error  = [   10.3037]
25-01-19 11:22:08 | I |     + error = [10.3037]
25-01-19 11:22:09 | I |       - range scale = [    1.0000]
25-01-19 11:22:09 | I |         sum  error  = [   21.1434]
25-01-19 11:22:09 | I |         best error  = [   21.1434]
25-01-19 11:22:09 | I |     + error = [21.1434]
25-01-19 11:22:10 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:22:11 | I |       - range scale = [    1.0000]
25-01-19 11:22:11 | I |         sum  error  = [   19.8313]
25-01-19 11:22:11 | I |         best error  = [   19.8313]
25-01-19 11:22:11 | I |     + error = [19.8313]
25-01-19 11:22:12 | I |       - range scale = [    1.0000]
25-01-19 11:22:12 | I |         sum  error  = [   34.9766]
25-01-19 11:22:12 | I |         best error  = [   34.9766]
25-01-19 11:22:12 | I |     + error = [34.9766]
25-01-19 11:22:12 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:22:13 | I |       - range scale = [    1.0000]
25-01-19 11:22:13 | I |         sum  error  = [    2.6800]
25-01-19 11:22:13 | I |         best error  = [    2.6800]
25-01-19 11:22:13 | I |     + error = [2.6800]
25-01-19 11:22:14 | I |       - range scale = [    1.0000]
25-01-19 11:22:14 | I |         sum  error  = [    6.0538]
25-01-19 11:22:14 | I |         best error  = [    6.0538]
25-01-19 11:22:14 | I |     + error = [6.0538]
25-01-19 11:22:14 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:22:14 | I |       - range scale = [    1.0000]
25-01-19 11:22:14 | I |         sum  error  = [    0.4284]
25-01-19 11:22:14 | I |         best error  = [    0.4284]
25-01-19 11:22:14 | I |     + error = [0.4284]
25-01-19 11:22:15 | I |       - range scale = [    1.0000]
25-01-19 11:22:15 | I |         sum  error  = [    1.1596]
25-01-19 11:22:15 | I |         best error  = [    1.1596]
25-01-19 11:22:15 | I |     + error = [1.1596]
25-01-19 11:22:16 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:22:16 | I |       - range scale = [    1.0000]
25-01-19 11:22:16 | I |         sum  error  = [    3.4476]
25-01-19 11:22:16 | I |         best error  = [    3.4476]
25-01-19 11:22:16 | I |     + error = [3.4476]
25-01-19 11:22:17 | I |       - range scale = [    1.0000]
25-01-19 11:22:17 | I |         sum  error  = [    8.0227]
25-01-19 11:22:17 | I |         best error  = [    8.0227]
25-01-19 11:22:17 | I |     + error = [8.0227]
25-01-19 11:22:18 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:22:18 | I |       - range scale = [    1.0000]
25-01-19 11:22:18 | I |         sum  error  = [    4.1888]
25-01-19 11:22:18 | I |         best error  = [    4.1888]
25-01-19 11:22:18 | I |     + error = [4.1888]
25-01-19 11:22:20 | I |       - range scale = [    1.0000]
25-01-19 11:22:20 | I |         sum  error  = [    9.1162]
25-01-19 11:22:20 | I |         best error  = [    9.1162]
25-01-19 11:22:20 | I |     + error = [9.1162]
25-01-19 11:22:20 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:22:21 | I |       - range scale = [    1.0000]
25-01-19 11:22:21 | I |         sum  error  = [    0.7673]
25-01-19 11:22:21 | I |         best error  = [    0.7673]
25-01-19 11:22:21 | I |     + error = [0.7673]
25-01-19 11:22:22 | I |       - range scale = [    1.0000]
25-01-19 11:22:22 | I |         sum  error  = [    1.8566]
25-01-19 11:22:22 | I |         best error  = [    1.8566]
25-01-19 11:22:22 | I |     + error = [1.8566]
25-01-19 11:22:22 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:22:25 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:22:28 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:22:31 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:22:33 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:22:36 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:22:39 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:22:46 | I | quantizing activations for layer model.layers.4
25-01-19 11:22:47 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:51 | I | forward this layer
25-01-19 11:22:51 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/04.pt
25-01-19 11:22:51 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/04.pt
25-01-19 11:22:51 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 120.94 MiB is free. Process 13810 has 5.58 GiB memory in use. Process 29960 has 17.99 GiB memory in use. Of the allocated memory 16.91 GiB is allocated by PyTorch, and 625.61 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:22:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 3            |        cudaMalloc retries: 3         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  17314 MiB |  17383 MiB |  18284 GiB |  18267 GiB |
|       from large pool |  17312 MiB |  17380 MiB |  18253 GiB |  18236 GiB |
|       from small pool |      2 MiB |      5 MiB |     30 GiB |     30 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  17314 MiB |  17383 MiB |  18284 GiB |  18267 GiB |
|       from large pool |  17312 MiB |  17380 MiB |  18253 GiB |  18236 GiB |
|       from small pool |      2 MiB |      5 MiB |     30 GiB |     30 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  17314 MiB |  17383 MiB |  18271 GiB |  18254 GiB |
|       from large pool |  17312 MiB |  17380 MiB |  18241 GiB |  18224 GiB |
|       from small pool |      2 MiB |      5 MiB |     30 GiB |     30 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  17940 MiB |  17940 MiB | 221936 MiB | 203996 MiB |
|       from large pool |  17936 MiB |  17936 MiB | 221744 MiB | 203808 MiB |
|       from small pool |      4 MiB |      6 MiB |    192 MiB |    188 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 640622 KiB |   1533 MiB |   7711 GiB |   7710 GiB |
|       from large pool | 638848 KiB |   1529 MiB |   7676 GiB |   7675 GiB |
|       from small pool |   1774 KiB |      4 MiB |     35 GiB |     35 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     251    |     258    |  695163    |  694912    |
|       from large pool |     166    |     178    |  169718    |  169552    |
|       from small pool |      85    |      88    |  525445    |  525360    |
|---------------------------------------------------------------------------|
| Active allocs         |     251    |     258    |  695163    |  694912    |
|       from large pool |     166    |     178    |  169718    |  169552    |
|       from small pool |      85    |      88    |  525445    |  525360    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     150    |     155    |     676    |     526    |
|       from large pool |     148    |     153    |     580    |     432    |
|       from small pool |       2    |       3    |      96    |      94    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      24    |      30    |  330711    |  330687    |
|       from large pool |      16    |      21    |   90786    |   90770    |
|       from small pool |       8    |      15    |  239925    |  239917    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20161 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7945 GiB |   7944 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7942 GiB |   7942 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159331    |  159150    |
|       from large pool |     127    |     152    |  122331    |  122204    |
|       from small pool |      54    |      61    |   37000    |   36946    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159331    |  159150    |
|       from large pool |     127    |     152    |  122331    |  122204    |
|       from small pool |      54    |      61    |   37000    |   36946    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20161 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20161 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20152 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6848 GiB |   6848 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6846 GiB |   6845 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159331    |  159150    |
|       from large pool |     127    |     152    |  122331    |  122204    |
|       from small pool |      54    |      61    |   37000    |   36946    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159331    |  159150    |
|       from large pool |     127    |     152    |  122331    |  122204    |
|       from small pool |      54    |      61    |   37000    |   36946    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17346 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  21360 MiB |  15434 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  21356 MiB |  15432 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131804    |  131655    |
|       from large pool |     101    |     122    |   98529    |   98428    |
|       from small pool |      48    |      57    |   33275    |   33227    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131804    |  131655    |
|       from large pool |     101    |     122    |   98529    |   98428    |
|       from small pool |      48    |      57    |   33275    |   33227    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     171    |      69    |
|       from large pool |     101    |     120    |     169    |      68    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:22:51 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:22:51 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:22:51 | I | in layer model.layers.4
25-01-19 11:22:51 | I | quantizing weights for layer model.layers.4
25-01-19 11:22:52 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:22:54 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:22:54 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:22:55 | I |       - range scale = [    1.0000]
25-01-19 11:22:55 | I |         sum  error  = [   10.7939]
25-01-19 11:22:55 | I |         best error  = [   10.7939]
25-01-19 11:22:55 | I |     + error = [10.7939]
25-01-19 11:22:56 | I |       - range scale = [    1.0000]
25-01-19 11:22:56 | I |         sum  error  = [   20.9873]
25-01-19 11:22:56 | I |         best error  = [   20.9873]
25-01-19 11:22:56 | I |     + error = [20.9873]
25-01-19 11:22:56 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:22:57 | I |       - range scale = [    1.0000]
25-01-19 11:22:57 | I |         sum  error  = [   19.5501]
25-01-19 11:22:57 | I |         best error  = [   19.5501]
25-01-19 11:22:57 | I |     + error = [19.5501]
25-01-19 11:22:59 | I |       - range scale = [    1.0000]
25-01-19 11:22:59 | I |         sum  error  = [   33.8244]
25-01-19 11:22:59 | I |         best error  = [   33.8244]
25-01-19 11:22:59 | I |     + error = [33.8244]
25-01-19 11:22:59 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:23:00 | I |       - range scale = [    1.0000]
25-01-19 11:23:00 | I |         sum  error  = [    2.6674]
25-01-19 11:23:00 | I |         best error  = [    2.6674]
25-01-19 11:23:00 | I |     + error = [2.6674]
25-01-19 11:23:01 | I |       - range scale = [    1.0000]
25-01-19 11:23:01 | I |         sum  error  = [    4.3463]
25-01-19 11:23:01 | I |         best error  = [    4.3463]
25-01-19 11:23:01 | I |     + error = [4.3463]
25-01-19 11:23:01 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:23:02 | I |       - range scale = [    1.0000]
25-01-19 11:23:02 | I |         sum  error  = [    0.3992]
25-01-19 11:23:02 | I |         best error  = [    0.3992]
25-01-19 11:23:02 | I |     + error = [0.3992]
25-01-19 11:23:03 | I |       - range scale = [    1.0000]
25-01-19 11:23:03 | I |         sum  error  = [    0.7788]
25-01-19 11:23:03 | I |         best error  = [    0.7788]
25-01-19 11:23:03 | I |     + error = [0.7788]
25-01-19 11:23:03 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:23:04 | I |       - range scale = [    1.0000]
25-01-19 11:23:04 | I |         sum  error  = [    3.4721]
25-01-19 11:23:04 | I |         best error  = [    3.4721]
25-01-19 11:23:04 | I |     + error = [3.4721]
25-01-19 11:23:05 | I |       - range scale = [    1.0000]
25-01-19 11:23:05 | I |         sum  error  = [    5.7690]
25-01-19 11:23:05 | I |         best error  = [    5.7690]
25-01-19 11:23:05 | I |     + error = [5.7690]
25-01-19 11:23:05 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:23:06 | I |       - range scale = [    1.0000]
25-01-19 11:23:06 | I |         sum  error  = [    4.2064]
25-01-19 11:23:06 | I |         best error  = [    4.2064]
25-01-19 11:23:06 | I |     + error = [4.2064]
25-01-19 11:23:07 | I |       - range scale = [    1.0000]
25-01-19 11:23:07 | I |         sum  error  = [    6.6392]
25-01-19 11:23:07 | I |         best error  = [    6.6392]
25-01-19 11:23:07 | I |     + error = [6.6392]
25-01-19 11:23:07 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:23:08 | I |       - range scale = [    1.0000]
25-01-19 11:23:08 | I |         sum  error  = [    0.7635]
25-01-19 11:23:08 | I |         best error  = [    0.7635]
25-01-19 11:23:08 | I |     + error = [0.7635]
25-01-19 11:23:10 | I |       - range scale = [    1.0000]
25-01-19 11:23:10 | I |         sum  error  = [    1.2935]
25-01-19 11:23:10 | I |         best error  = [    1.2935]
25-01-19 11:23:10 | I |     + error = [1.2935]
25-01-19 11:23:10 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:23:13 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:23:16 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:23:19 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:23:22 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:23:25 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:23:28 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:23:35 | I | quantizing activations for layer model.layers.4
25-01-19 11:23:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:39 | I | forward this layer
25-01-19 11:23:39 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/06.pt
25-01-19 11:23:39 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/06.pt
25-01-19 11:23:39 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 202.94 MiB is free. Process 29960 has 23.49 GiB memory in use. Of the allocated memory 22.31 GiB is allocated by PyTorch, and 731.80 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:23:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 4            |        cudaMalloc retries: 4         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22842 MiB |  22842 MiB |  19061 GiB |  19039 GiB |
|       from large pool |  22838 MiB |  22838 MiB |  19020 GiB |  18998 GiB |
|       from small pool |      4 MiB |      5 MiB |     40 GiB |     40 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22842 MiB |  22842 MiB |  19061 GiB |  19039 GiB |
|       from large pool |  22838 MiB |  22838 MiB |  19020 GiB |  18998 GiB |
|       from small pool |      4 MiB |      5 MiB |     40 GiB |     40 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22842 MiB |  22842 MiB |  19046 GiB |  19024 GiB |
|       from large pool |  22838 MiB |  22838 MiB |  19005 GiB |  18983 GiB |
|       from small pool |      4 MiB |      5 MiB |     40 GiB |     40 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23574 MiB |  23574 MiB | 289316 MiB | 265742 MiB |
|       from large pool |  23568 MiB |  23568 MiB | 289052 MiB | 265484 MiB |
|       from small pool |      6 MiB |      6 MiB |    264 MiB |    258 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 749359 KiB |   1611 MiB |   8072 GiB |   8071 GiB |
|       from large pool | 747392 KiB |   1609 MiB |   8025 GiB |   8024 GiB |
|       from small pool |   1967 KiB |      4 MiB |     46 GiB |     46 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     301    |     305    |     899 K  |     899 K  |
|       from large pool |     199    |     200    |     197 K  |     196 K  |
|       from small pool |     102    |     106    |     702 K  |     702 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     301    |     305    |     899 K  |     899 K  |
|       from large pool |     199    |     200    |     197 K  |     196 K  |
|       from small pool |     102    |     106    |     702 K  |     702 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     173    |     824    |     651    |
|       from large pool |     170    |     170    |     692    |     522    |
|       from small pool |       3    |       3    |     132    |     129    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |  423199    |  423173    |
|       from large pool |      16    |      21    |  101698    |  101682    |
|       from small pool |      10    |      15    |  321501    |  321491    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:23:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7945 GiB |   7945 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7943 GiB |   7942 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159351    |  159170    |
|       from large pool |     127    |     152    |  122345    |  122218    |
|       from small pool |      54    |      61    |   37006    |   36952    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159351    |  159170    |
|       from large pool |     127    |     152    |  122345    |  122218    |
|       from small pool |      54    |      61    |   37006    |   36952    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:23:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20159 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6848 GiB |   6848 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6846 GiB |   6846 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159351    |  159170    |
|       from large pool |     127    |     152    |  122345    |  122218    |
|       from small pool |      54    |      61    |   37006    |   36952    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159351    |  159170    |
|       from large pool |     127    |     152    |  122345    |  122218    |
|       from small pool |      54    |      61    |   37006    |   36952    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:23:39 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  21688 MiB |  15762 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  21684 MiB |  15760 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131824    |  131675    |
|       from large pool |     101    |     122    |   98543    |   98442    |
|       from small pool |      48    |      57    |   33281    |   33233    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131824    |  131675    |
|       from large pool |     101    |     122    |   98543    |   98442    |
|       from small pool |      48    |      57    |   33281    |   33233    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     181    |      79    |
|       from large pool |     101    |     120    |     179    |      78    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:23:39 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:23:39 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:23:39 | I | in layer model.layers.4
25-01-19 11:23:39 | I | quantizing weights for layer model.layers.4
25-01-19 11:23:40 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:23:42 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:23:42 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:23:43 | I |       - range scale = [    1.0000]
25-01-19 11:23:43 | I |         sum  error  = [   11.1180]
25-01-19 11:23:43 | I |         best error  = [   11.1180]
25-01-19 11:23:43 | I |     + error = [11.1180]
25-01-19 11:23:44 | I |       - range scale = [    1.0000]
25-01-19 11:23:44 | I |         sum  error  = [   20.0717]
25-01-19 11:23:44 | I |         best error  = [   20.0717]
25-01-19 11:23:44 | I |     + error = [20.0717]
25-01-19 11:23:44 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:23:45 | I |       - range scale = [    1.0000]
25-01-19 11:23:45 | I |         sum  error  = [   21.1918]
25-01-19 11:23:45 | I |         best error  = [   21.1918]
25-01-19 11:23:45 | I |     + error = [21.1918]
25-01-19 11:23:47 | I |       - range scale = [    1.0000]
25-01-19 11:23:47 | I |         sum  error  = [   35.5122]
25-01-19 11:23:47 | I |         best error  = [   35.5122]
25-01-19 11:23:47 | I |     + error = [35.5122]
25-01-19 11:23:47 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:23:48 | I |       - range scale = [    1.0000]
25-01-19 11:23:48 | I |         sum  error  = [    2.6533]
25-01-19 11:23:48 | I |         best error  = [    2.6533]
25-01-19 11:23:48 | I |     + error = [2.6533]
25-01-19 11:23:48 | I |       - range scale = [    1.0000]
25-01-19 11:23:48 | I |         sum  error  = [    3.9333]
25-01-19 11:23:48 | I |         best error  = [    3.9333]
25-01-19 11:23:48 | I |     + error = [3.9333]
25-01-19 11:23:49 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:23:49 | I |       - range scale = [    1.0000]
25-01-19 11:23:49 | I |         sum  error  = [    0.4063]
25-01-19 11:23:49 | I |         best error  = [    0.4063]
25-01-19 11:23:49 | I |     + error = [0.4063]
25-01-19 11:23:50 | I |       - range scale = [    1.0000]
25-01-19 11:23:50 | I |         sum  error  = [    0.6778]
25-01-19 11:23:50 | I |         best error  = [    0.6778]
25-01-19 11:23:50 | I |     + error = [0.6778]
25-01-19 11:23:50 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:23:51 | I |       - range scale = [    1.0000]
25-01-19 11:23:51 | I |         sum  error  = [    3.4594]
25-01-19 11:23:51 | I |         best error  = [    3.4594]
25-01-19 11:23:51 | I |     + error = [3.4594]
25-01-19 11:23:52 | I |       - range scale = [    1.0000]
25-01-19 11:23:52 | I |         sum  error  = [    5.3302]
25-01-19 11:23:52 | I |         best error  = [    5.3302]
25-01-19 11:23:52 | I |     + error = [5.3302]
25-01-19 11:23:52 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:23:53 | I |       - range scale = [    1.0000]
25-01-19 11:23:53 | I |         sum  error  = [    4.1943]
25-01-19 11:23:53 | I |         best error  = [    4.1943]
25-01-19 11:23:53 | I |     + error = [4.1943]
25-01-19 11:23:54 | I |       - range scale = [    1.0000]
25-01-19 11:23:54 | I |         sum  error  = [    6.1251]
25-01-19 11:23:54 | I |         best error  = [    6.1251]
25-01-19 11:23:54 | I |     + error = [6.1251]
25-01-19 11:23:54 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:23:55 | I |       - range scale = [    1.0000]
25-01-19 11:23:55 | I |         sum  error  = [    0.7263]
25-01-19 11:23:55 | I |         best error  = [    0.7263]
25-01-19 11:23:55 | I |     + error = [0.7263]
25-01-19 11:23:56 | I |       - range scale = [    1.0000]
25-01-19 11:23:56 | I |         sum  error  = [    1.0973]
25-01-19 11:23:56 | I |         best error  = [    1.0973]
25-01-19 11:23:56 | I |     + error = [1.0973]
25-01-19 11:23:57 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:23:59 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:24:02 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:24:04 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:24:07 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:24:09 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:24:12 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:24:18 | I | quantizing activations for layer model.layers.4
25-01-19 11:24:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:20 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:20 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:22 | I | forward this layer
25-01-19 11:24:22 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/08.pt
25-01-19 11:24:22 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/08.pt
25-01-19 11:24:22 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 40.94 MiB is free. Process 29960 has 23.65 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 788.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:24:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 5            |        cudaMalloc retries: 5         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  22947 MiB |  19925 GiB |  19902 GiB |
|       from large pool |  22944 MiB |  22944 MiB |  19873 GiB |  19851 GiB |
|       from small pool |      3 MiB |      5 MiB |     51 GiB |     51 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  22947 MiB |  19925 GiB |  19902 GiB |
|       from large pool |  22944 MiB |  22944 MiB |  19873 GiB |  19851 GiB |
|       from small pool |      3 MiB |      5 MiB |     51 GiB |     51 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  22947 MiB |  19907 GiB |  19884 GiB |
|       from large pool |  22944 MiB |  22944 MiB |  19855 GiB |  19833 GiB |
|       from small pool |      3 MiB |      5 MiB |     51 GiB |     51 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23736 MiB |  23736 MiB | 356180 MiB | 332444 MiB |
|       from large pool |  23732 MiB |  23732 MiB | 355848 MiB | 332116 MiB |
|       from small pool |      4 MiB |      6 MiB |    332 MiB |    328 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    788 MiB |   1653 MiB |   8487 GiB |   8486 GiB |
|       from large pool |    787 MiB |   1649 MiB |   8428 GiB |   8427 GiB |
|       from small pool |      0 MiB |      4 MiB |     59 GiB |     59 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     297    |     305    |    1111 K  |    1111 K  |
|       from large pool |     188    |     200    |     225 K  |     225 K  |
|       from small pool |     109    |     111    |     886 K  |     886 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     297    |     305    |    1111 K  |    1111 K  |
|       from large pool |     188    |     200    |     225 K  |     225 K  |
|       from small pool |     109    |     111    |     886 K  |     886 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     172    |     173    |     969    |     797    |
|       from large pool |     170    |     170    |     803    |     633    |
|       from small pool |       2    |       3    |     166    |     164    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      24    |      30    |  519235    |  519211    |
|       from large pool |      16    |      21    |  114067    |  114051    |
|       from small pool |       8    |      15    |  405168    |  405160    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:24:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7945 GiB |   7945 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7943 GiB |   7943 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159371    |  159190    |
|       from large pool |     127    |     152    |  122359    |  122232    |
|       from small pool |      54    |      61    |   37012    |   36958    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159371    |  159190    |
|       from large pool |     127    |     152    |  122359    |  122232    |
|       from small pool |      54    |      61    |   37012    |   36958    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:24:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6849 GiB |   6848 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6846 GiB |   6846 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159371    |  159190    |
|       from large pool |     127    |     152    |  122359    |  122232    |
|       from small pool |      54    |      61    |   37012    |   36958    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159371    |  159190    |
|       from large pool |     127    |     152    |  122359    |  122232    |
|       from small pool |      54    |      61    |   37012    |   36958    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:24:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17349 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17349 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17349 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17341 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  22016 MiB |  16090 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  22012 MiB |  16088 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131844    |  131695    |
|       from large pool |     101    |     122    |   98557    |   98456    |
|       from small pool |      48    |      57    |   33287    |   33239    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131844    |  131695    |
|       from large pool |     101    |     122    |   98557    |   98456    |
|       from small pool |      48    |      57    |   33287    |   33239    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     191    |      89    |
|       from large pool |     101    |     120    |     189    |      88    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:24:22 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:24:23 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:24:23 | I | in layer model.layers.4
25-01-19 11:24:23 | I | quantizing weights for layer model.layers.4
25-01-19 11:24:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:24:26 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:24:26 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:24:27 | I |       - range scale = [    1.0000]
25-01-19 11:24:27 | I |         sum  error  = [   11.5495]
25-01-19 11:24:27 | I |         best error  = [   11.5495]
25-01-19 11:24:27 | I |     + error = [11.5495]
25-01-19 11:24:28 | I |       - range scale = [    1.0000]
25-01-19 11:24:28 | I |         sum  error  = [   19.6690]
25-01-19 11:24:28 | I |         best error  = [   19.6690]
25-01-19 11:24:28 | I |     + error = [19.6690]
25-01-19 11:24:28 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:24:29 | I |       - range scale = [    1.0000]
25-01-19 11:24:29 | I |         sum  error  = [   20.1849]
25-01-19 11:24:29 | I |         best error  = [   20.1849]
25-01-19 11:24:29 | I |     + error = [20.1849]
25-01-19 11:24:31 | I |       - range scale = [    1.0000]
25-01-19 11:24:31 | I |         sum  error  = [   35.0821]
25-01-19 11:24:31 | I |         best error  = [   35.0821]
25-01-19 11:24:31 | I |     + error = [35.0821]
25-01-19 11:24:31 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:24:32 | I |       - range scale = [    1.0000]
25-01-19 11:24:32 | I |         sum  error  = [    2.6704]
25-01-19 11:24:32 | I |         best error  = [    2.6704]
25-01-19 11:24:32 | I |     + error = [2.6704]
25-01-19 11:24:32 | I |       - range scale = [    1.0000]
25-01-19 11:24:32 | I |         sum  error  = [    3.8775]
25-01-19 11:24:32 | I |         best error  = [    3.8775]
25-01-19 11:24:32 | I |     + error = [3.8775]
25-01-19 11:24:33 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:24:33 | I |       - range scale = [    1.0000]
25-01-19 11:24:33 | I |         sum  error  = [    0.4041]
25-01-19 11:24:33 | I |         best error  = [    0.4041]
25-01-19 11:24:33 | I |     + error = [0.4041]
25-01-19 11:24:34 | I |       - range scale = [    1.0000]
25-01-19 11:24:34 | I |         sum  error  = [    0.6504]
25-01-19 11:24:34 | I |         best error  = [    0.6504]
25-01-19 11:24:34 | I |     + error = [0.6504]
25-01-19 11:24:34 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:24:35 | I |       - range scale = [    1.0000]
25-01-19 11:24:35 | I |         sum  error  = [    3.4873]
25-01-19 11:24:35 | I |         best error  = [    3.4873]
25-01-19 11:24:35 | I |     + error = [3.4873]
25-01-19 11:24:36 | I |       - range scale = [    1.0000]
25-01-19 11:24:36 | I |         sum  error  = [    5.3083]
25-01-19 11:24:36 | I |         best error  = [    5.3083]
25-01-19 11:24:36 | I |     + error = [5.3083]
25-01-19 11:24:36 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:24:37 | I |       - range scale = [    1.0000]
25-01-19 11:24:37 | I |         sum  error  = [    4.2259]
25-01-19 11:24:37 | I |         best error  = [    4.2259]
25-01-19 11:24:37 | I |     + error = [4.2259]
25-01-19 11:24:38 | I |       - range scale = [    1.0000]
25-01-19 11:24:38 | I |         sum  error  = [    6.0847]
25-01-19 11:24:38 | I |         best error  = [    6.0847]
25-01-19 11:24:38 | I |     + error = [6.0847]
25-01-19 11:24:38 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:24:39 | I |       - range scale = [    1.0000]
25-01-19 11:24:39 | I |         sum  error  = [    0.7343]
25-01-19 11:24:39 | I |         best error  = [    0.7343]
25-01-19 11:24:39 | I |     + error = [0.7343]
25-01-19 11:24:40 | I |       - range scale = [    1.0000]
25-01-19 11:24:40 | I |         sum  error  = [    1.0810]
25-01-19 11:24:40 | I |         best error  = [    1.0810]
25-01-19 11:24:40 | I |     + error = [1.0810]
25-01-19 11:24:41 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:24:43 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:24:46 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:24:48 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:24:51 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:24:53 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:24:56 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:25:02 | I | quantizing activations for layer model.layers.4
25-01-19 11:25:03 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:03 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:04 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:04 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:06 | I | forward this layer
25-01-19 11:25:06 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/10.pt
25-01-19 11:25:06 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/10.pt
25-01-19 11:25:07 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 160.94 MiB is free. Process 29960 has 23.53 GiB memory in use. Of the allocated memory 22.66 GiB is allocated by PyTorch, and 412.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:25:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 6            |        cudaMalloc retries: 6         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  23203 MiB |  23203 MiB |  20874 GiB |  20851 GiB |
|       from large pool |  23200 MiB |  23200 MiB |  20812 GiB |  20789 GiB |
|       from small pool |      3 MiB |      5 MiB |     62 GiB |     62 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  23203 MiB |  23203 MiB |  20874 GiB |  20851 GiB |
|       from large pool |  23200 MiB |  23200 MiB |  20812 GiB |  20789 GiB |
|       from small pool |      3 MiB |      5 MiB |     62 GiB |     62 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  23203 MiB |  23203 MiB |  20852 GiB |  20830 GiB |
|       from large pool |  23200 MiB |  23200 MiB |  20790 GiB |  20768 GiB |
|       from small pool |      3 MiB |      5 MiB |     62 GiB |     62 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23616 MiB |  23738 MiB | 422970 MiB | 399354 MiB |
|       from large pool |  23612 MiB |  23732 MiB | 422568 MiB | 398956 MiB |
|       from small pool |      4 MiB |      6 MiB |    402 MiB |    398 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 422286 KiB |   1740 MiB |   9010 GiB |   9009 GiB |
|       from large pool | 421760 KiB |   1737 MiB |   8938 GiB |   8938 GiB |
|       from small pool |    526 KiB |      4 MiB |     71 GiB |     71 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     298    |     305    |    1330 K  |    1330 K  |
|       from large pool |     189    |     200    |     255 K  |     255 K  |
|       from small pool |     109    |     111    |    1075 K  |    1075 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     298    |     305    |    1330 K  |    1330 K  |
|       from large pool |     189    |     200    |     255 K  |     255 K  |
|       from small pool |     109    |     111    |    1075 K  |    1075 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     173    |    1116    |     943    |
|       from large pool |     171    |     171    |     915    |     744    |
|       from small pool |       2    |       3    |     201    |     199    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      22    |      30    |  617805    |  617783    |
|       from large pool |      14    |      21    |  126880    |  126866    |
|       from small pool |       8    |      15    |  490925    |  490917    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7946 GiB |   7945 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7943 GiB |   7943 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159391    |  159210    |
|       from large pool |     127    |     152    |  122373    |  122246    |
|       from small pool |      54    |      61    |   37018    |   36964    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159391    |  159210    |
|       from large pool |     127    |     152    |  122373    |  122246    |
|       from small pool |      54    |      61    |   37018    |   36964    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6849 GiB |   6849 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6847 GiB |   6846 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159391    |  159210    |
|       from large pool |     127    |     152    |  122373    |  122246    |
|       from small pool |      54    |      61    |   37018    |   36964    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159391    |  159210    |
|       from large pool |     127    |     152    |  122373    |  122246    |
|       from small pool |      54    |      61    |   37018    |   36964    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:07 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17347 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  22344 MiB |  16418 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  22340 MiB |  16416 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131864    |  131715    |
|       from large pool |     101    |     122    |   98571    |   98470    |
|       from small pool |      48    |      57    |   33293    |   33245    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131864    |  131715    |
|       from large pool |     101    |     122    |   98571    |   98470    |
|       from small pool |      48    |      57    |   33293    |   33245    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     201    |      99    |
|       from large pool |     101    |     120    |     199    |      98    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:07 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:25:07 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:25:07 | I | in layer model.layers.4
25-01-19 11:25:07 | I | quantizing weights for layer model.layers.4
25-01-19 11:25:08 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:09 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:09 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:09 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:10 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:25:10 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:25:11 | I |       - range scale = [    1.0000]
25-01-19 11:25:11 | I |         sum  error  = [   11.1970]
25-01-19 11:25:11 | I |         best error  = [   11.1970]
25-01-19 11:25:11 | I |     + error = [11.1970]
25-01-19 11:25:13 | I |       - range scale = [    1.0000]
25-01-19 11:25:13 | I |         sum  error  = [   19.8086]
25-01-19 11:25:13 | I |         best error  = [   19.8086]
25-01-19 11:25:13 | I |     + error = [19.8086]
25-01-19 11:25:13 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:25:14 | I |       - range scale = [    1.0000]
25-01-19 11:25:14 | I |         sum  error  = [   20.7688]
25-01-19 11:25:14 | I |         best error  = [   20.7688]
25-01-19 11:25:14 | I |     + error = [20.7688]
25-01-19 11:25:15 | I |       - range scale = [    1.0000]
25-01-19 11:25:15 | I |         sum  error  = [   36.7356]
25-01-19 11:25:15 | I |         best error  = [   36.7356]
25-01-19 11:25:15 | I |     + error = [36.7356]
25-01-19 11:25:16 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:25:16 | I |       - range scale = [    1.0000]
25-01-19 11:25:16 | I |         sum  error  = [    2.6610]
25-01-19 11:25:16 | I |         best error  = [    2.6610]
25-01-19 11:25:16 | I |     + error = [2.6610]
25-01-19 11:25:17 | I |       - range scale = [    1.0000]
25-01-19 11:25:17 | I |         sum  error  = [    3.8507]
25-01-19 11:25:17 | I |         best error  = [    3.8507]
25-01-19 11:25:17 | I |     + error = [3.8507]
25-01-19 11:25:17 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:25:18 | I |       - range scale = [    1.0000]
25-01-19 11:25:18 | I |         sum  error  = [    0.4142]
25-01-19 11:25:18 | I |         best error  = [    0.4142]
25-01-19 11:25:18 | I |     + error = [0.4142]
25-01-19 11:25:19 | I |       - range scale = [    1.0000]
25-01-19 11:25:19 | I |         sum  error  = [    0.6441]
25-01-19 11:25:19 | I |         best error  = [    0.6441]
25-01-19 11:25:19 | I |     + error = [0.6441]
25-01-19 11:25:19 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:25:20 | I |       - range scale = [    1.0000]
25-01-19 11:25:20 | I |         sum  error  = [    3.5228]
25-01-19 11:25:20 | I |         best error  = [    3.5228]
25-01-19 11:25:20 | I |     + error = [3.5228]
25-01-19 11:25:21 | I |       - range scale = [    1.0000]
25-01-19 11:25:21 | I |         sum  error  = [    5.2926]
25-01-19 11:25:21 | I |         best error  = [    5.2926]
25-01-19 11:25:21 | I |     + error = [5.2926]
25-01-19 11:25:21 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:25:22 | I |       - range scale = [    1.0000]
25-01-19 11:25:22 | I |         sum  error  = [    4.2856]
25-01-19 11:25:22 | I |         best error  = [    4.2856]
25-01-19 11:25:22 | I |     + error = [4.2856]
25-01-19 11:25:23 | I |       - range scale = [    1.0000]
25-01-19 11:25:23 | I |         sum  error  = [    6.0642]
25-01-19 11:25:23 | I |         best error  = [    6.0642]
25-01-19 11:25:23 | I |     + error = [6.0642]
25-01-19 11:25:23 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:25:24 | I |       - range scale = [    1.0000]
25-01-19 11:25:24 | I |         sum  error  = [    0.7672]
25-01-19 11:25:24 | I |         best error  = [    0.7672]
25-01-19 11:25:24 | I |     + error = [0.7672]
25-01-19 11:25:25 | I |       - range scale = [    1.0000]
25-01-19 11:25:25 | I |         sum  error  = [    1.1240]
25-01-19 11:25:25 | I |         best error  = [    1.1240]
25-01-19 11:25:25 | I |     + error = [1.1240]
25-01-19 11:25:25 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:25:28 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:25:30 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:25:33 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:25:35 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:25:37 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:25:40 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:25:46 | I | quantizing activations for layer model.layers.4
25-01-19 11:25:47 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:49 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:51 | I | forward this layer
25-01-19 11:25:51 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/12.pt
25-01-19 11:25:51 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/12.pt
25-01-19 11:25:51 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 212.94 MiB is free. Process 29960 has 23.48 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 872.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:25:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 7            |        cudaMalloc retries: 7         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23203 MiB |  21907 GiB |  21885 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  21834 GiB |  21812 GiB |
|       from small pool |      3 MiB |      5 MiB |     73 GiB |     73 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23203 MiB |  21907 GiB |  21885 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  21834 GiB |  21812 GiB |
|       from small pool |      3 MiB |      5 MiB |     73 GiB |     73 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23203 MiB |  21884 GiB |  21861 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  21810 GiB |  21788 GiB |
|       from small pool |      3 MiB |      5 MiB |     73 GiB |     73 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23564 MiB |  23738 MiB | 486668 MiB | 463104 MiB |
|       from large pool |  23560 MiB |  23732 MiB | 486196 MiB | 462636 MiB |
|       from small pool |      4 MiB |      6 MiB |    472 MiB |    468 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    872 MiB |   1785 MiB |   9626 GiB |   9625 GiB |
|       from large pool |    871 MiB |   1781 MiB |   9542 GiB |   9541 GiB |
|       from small pool |      0 MiB |      4 MiB |     84 GiB |     84 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    1557 K  |    1556 K  |
|       from large pool |     186    |     200    |     286 K  |     286 K  |
|       from small pool |     109    |     111    |    1270 K  |    1270 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    1557 K  |    1556 K  |
|       from large pool |     186    |     200    |     286 K  |     286 K  |
|       from small pool |     109    |     111    |    1270 K  |    1270 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     172    |     174    |    1246    |    1074    |
|       from large pool |     170    |     171    |    1010    |     840    |
|       from small pool |       2    |       3    |     236    |     234    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |  717217    |  717191    |
|       from large pool |      18    |      22    |  138449    |  138431    |
|       from small pool |       8    |      15    |  578768    |  578760    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7946 GiB |   7946 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7944 GiB |   7943 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159411    |  159230    |
|       from large pool |     127    |     152    |  122387    |  122260    |
|       from small pool |      54    |      61    |   37024    |   36970    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159411    |  159230    |
|       from large pool |     127    |     152    |  122387    |  122260    |
|       from small pool |      54    |      61    |   37024    |   36970    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20160 GiB |  20153 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6849 GiB |   6849 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6847 GiB |   6847 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159411    |  159230    |
|       from large pool |     127    |     152    |  122387    |  122260    |
|       from small pool |      54    |      61    |   37024    |   36970    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159411    |  159230    |
|       from large pool |     127    |     152    |  122387    |  122260    |
|       from small pool |      54    |      61    |   37024    |   36970    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:51 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  22672 MiB |  16746 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  22668 MiB |  16744 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131884    |  131735    |
|       from large pool |     101    |     122    |   98585    |   98484    |
|       from small pool |      48    |      57    |   33299    |   33251    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131884    |  131735    |
|       from large pool |     101    |     122    |   98585    |   98484    |
|       from small pool |      48    |      57    |   33299    |   33251    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     211    |     109    |
|       from large pool |     101    |     120    |     209    |     108    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:25:51 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:25:51 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:25:51 | I | in layer model.layers.4
25-01-19 11:25:51 | I | quantizing weights for layer model.layers.4
25-01-19 11:25:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:54 | I | collecting calibration activations in model.layers.4
25-01-19 11:25:54 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:25:54 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:25:56 | I |       - range scale = [    1.0000]
25-01-19 11:25:56 | I |         sum  error  = [   11.8221]
25-01-19 11:25:56 | I |         best error  = [   11.8221]
25-01-19 11:25:56 | I |     + error = [11.8221]
25-01-19 11:25:57 | I |       - range scale = [    1.0000]
25-01-19 11:25:57 | I |         sum  error  = [   19.6607]
25-01-19 11:25:57 | I |         best error  = [   19.6607]
25-01-19 11:25:57 | I |     + error = [19.6607]
25-01-19 11:25:57 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:25:59 | I |       - range scale = [    1.0000]
25-01-19 11:25:59 | I |         sum  error  = [   20.8620]
25-01-19 11:25:59 | I |         best error  = [   20.8620]
25-01-19 11:25:59 | I |     + error = [20.8620]
25-01-19 11:26:00 | I |       - range scale = [    1.0000]
25-01-19 11:26:00 | I |         sum  error  = [   35.8773]
25-01-19 11:26:00 | I |         best error  = [   35.8773]
25-01-19 11:26:00 | I |     + error = [35.8773]
25-01-19 11:26:00 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:26:01 | I |       - range scale = [    1.0000]
25-01-19 11:26:01 | I |         sum  error  = [    2.6411]
25-01-19 11:26:01 | I |         best error  = [    2.6411]
25-01-19 11:26:01 | I |     + error = [2.6411]
25-01-19 11:26:02 | I |       - range scale = [    1.0000]
25-01-19 11:26:02 | I |         sum  error  = [    3.7831]
25-01-19 11:26:02 | I |         best error  = [    3.7831]
25-01-19 11:26:02 | I |     + error = [3.7831]
25-01-19 11:26:02 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:26:03 | I |       - range scale = [    1.0000]
25-01-19 11:26:03 | I |         sum  error  = [    0.4068]
25-01-19 11:26:03 | I |         best error  = [    0.4068]
25-01-19 11:26:03 | I |     + error = [0.4068]
25-01-19 11:26:04 | I |       - range scale = [    1.0000]
25-01-19 11:26:04 | I |         sum  error  = [    0.6356]
25-01-19 11:26:04 | I |         best error  = [    0.6356]
25-01-19 11:26:04 | I |     + error = [0.6356]
25-01-19 11:26:04 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:26:05 | I |       - range scale = [    1.0000]
25-01-19 11:26:05 | I |         sum  error  = [    3.4637]
25-01-19 11:26:05 | I |         best error  = [    3.4637]
25-01-19 11:26:05 | I |     + error = [3.4637]
25-01-19 11:26:06 | I |       - range scale = [    1.0000]
25-01-19 11:26:06 | I |         sum  error  = [    5.1719]
25-01-19 11:26:06 | I |         best error  = [    5.1719]
25-01-19 11:26:06 | I |     + error = [5.1719]
25-01-19 11:26:06 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:26:07 | I |       - range scale = [    1.0000]
25-01-19 11:26:07 | I |         sum  error  = [    4.2313]
25-01-19 11:26:07 | I |         best error  = [    4.2313]
25-01-19 11:26:07 | I |     + error = [4.2313]
25-01-19 11:26:08 | I |       - range scale = [    1.0000]
25-01-19 11:26:08 | I |         sum  error  = [    5.9639]
25-01-19 11:26:08 | I |         best error  = [    5.9639]
25-01-19 11:26:08 | I |     + error = [5.9639]
25-01-19 11:26:08 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:26:09 | I |       - range scale = [    1.0000]
25-01-19 11:26:09 | I |         sum  error  = [    0.7483]
25-01-19 11:26:09 | I |         best error  = [    0.7483]
25-01-19 11:26:09 | I |     + error = [0.7483]
25-01-19 11:26:10 | I |       - range scale = [    1.0000]
25-01-19 11:26:10 | I |         sum  error  = [    1.0893]
25-01-19 11:26:10 | I |         best error  = [    1.0893]
25-01-19 11:26:10 | I |     + error = [1.0893]
25-01-19 11:26:10 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:26:13 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:26:15 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:26:17 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:26:20 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:26:22 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:26:25 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:26:31 | I | quantizing activations for layer model.layers.4
25-01-19 11:26:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:34 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:36 | I | forward this layer
25-01-19 11:26:36 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/14.pt
25-01-19 11:26:36 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/14.pt
25-01-19 11:26:36 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:26:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 8            |        cudaMalloc retries: 8         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23203 MiB |  23026 GiB |  23004 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  22942 GiB |  22919 GiB |
|       from small pool |      3 MiB |      5 MiB |     84 GiB |     84 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23203 MiB |  23026 GiB |  23004 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  22942 GiB |  22919 GiB |
|       from small pool |      3 MiB |      5 MiB |     84 GiB |     84 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23203 MiB |  23000 GiB |  22978 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  22915 GiB |  22893 GiB |
|       from small pool |      3 MiB |      5 MiB |     84 GiB |     84 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23738 MiB | 554046 MiB | 530518 MiB |
|       from large pool |  23524 MiB |  23732 MiB | 553504 MiB | 529980 MiB |
|       from small pool |      4 MiB |      6 MiB |    542 MiB |    538 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1785 MiB |  10147 GiB |  10147 GiB |
|       from large pool |    835 MiB |   1781 MiB |  10050 GiB |  10049 GiB |
|       from small pool |      0 MiB |      4 MiB |     97 GiB |     97 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    1790 K  |    1790 K  |
|       from large pool |     186    |     200    |     318 K  |     318 K  |
|       from small pool |     109    |     111    |    1471 K  |    1471 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    1790 K  |    1790 K  |
|       from large pool |     186    |     200    |     318 K  |     318 K  |
|       from small pool |     109    |     111    |    1471 K  |    1471 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     174    |    1393    |    1220    |
|       from large pool |     171    |     171    |    1122    |     951    |
|       from small pool |       2    |       3    |     271    |     269    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |     819 K  |     819 K  |
|       from large pool |      18    |      22    |     150 K  |     150 K  |
|       from small pool |       8    |      15    |     668 K  |     668 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:26:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7946 GiB |   7946 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7944 GiB |   7944 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159431    |  159250    |
|       from large pool |     127    |     152    |  122401    |  122274    |
|       from small pool |      54    |      61    |   37030    |   36976    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159431    |  159250    |
|       from large pool |     127    |     152    |  122401    |  122274    |
|       from small pool |      54    |      61    |   37030    |   36976    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:26:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6849 GiB |   6849 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6847 GiB |   6847 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159431    |  159250    |
|       from large pool |     127    |     152    |  122401    |  122274    |
|       from small pool |      54    |      61    |   37030    |   36976    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159431    |  159250    |
|       from large pool |     127    |     152    |  122401    |  122274    |
|       from small pool |      54    |      61    |   37030    |   36976    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:26:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17350 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17350 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17350 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17342 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  23000 MiB |  17074 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  22996 MiB |  17072 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131904    |  131755    |
|       from large pool |     101    |     122    |   98599    |   98498    |
|       from small pool |      48    |      57    |   33305    |   33257    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131904    |  131755    |
|       from large pool |     101    |     122    |   98599    |   98498    |
|       from small pool |      48    |      57    |   33305    |   33257    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     221    |     119    |
|       from large pool |     101    |     120    |     219    |     118    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:26:36 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:26:36 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:26:36 | I | in layer model.layers.4
25-01-19 11:26:36 | I | quantizing weights for layer model.layers.4
25-01-19 11:26:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:39 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:39 | I | collecting calibration activations in model.layers.4
25-01-19 11:26:40 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:26:40 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:26:41 | I |       - range scale = [    1.0000]
25-01-19 11:26:41 | I |         sum  error  = [   11.5591]
25-01-19 11:26:41 | I |         best error  = [   11.5591]
25-01-19 11:26:41 | I |     + error = [11.5591]
25-01-19 11:26:43 | I |       - range scale = [    1.0000]
25-01-19 11:26:43 | I |         sum  error  = [   19.2000]
25-01-19 11:26:43 | I |         best error  = [   19.2000]
25-01-19 11:26:43 | I |     + error = [19.2000]
25-01-19 11:26:43 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:26:44 | I |       - range scale = [    1.0000]
25-01-19 11:26:44 | I |         sum  error  = [   20.8333]
25-01-19 11:26:44 | I |         best error  = [   20.8333]
25-01-19 11:26:44 | I |     + error = [20.8333]
25-01-19 11:26:46 | I |       - range scale = [    1.0000]
25-01-19 11:26:46 | I |         sum  error  = [   35.2674]
25-01-19 11:26:46 | I |         best error  = [   35.2674]
25-01-19 11:26:46 | I |     + error = [35.2674]
25-01-19 11:26:46 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:26:47 | I |       - range scale = [    1.0000]
25-01-19 11:26:47 | I |         sum  error  = [    2.6365]
25-01-19 11:26:47 | I |         best error  = [    2.6365]
25-01-19 11:26:47 | I |     + error = [2.6365]
25-01-19 11:26:48 | I |       - range scale = [    1.0000]
25-01-19 11:26:48 | I |         sum  error  = [    3.7547]
25-01-19 11:26:48 | I |         best error  = [    3.7547]
25-01-19 11:26:48 | I |     + error = [3.7547]
25-01-19 11:26:48 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:26:49 | I |       - range scale = [    1.0000]
25-01-19 11:26:49 | I |         sum  error  = [    0.4081]
25-01-19 11:26:49 | I |         best error  = [    0.4081]
25-01-19 11:26:49 | I |     + error = [0.4081]
25-01-19 11:26:49 | I |       - range scale = [    1.0000]
25-01-19 11:26:49 | I |         sum  error  = [    0.6297]
25-01-19 11:26:49 | I |         best error  = [    0.6297]
25-01-19 11:26:49 | I |     + error = [0.6297]
25-01-19 11:26:50 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:26:50 | I |       - range scale = [    1.0000]
25-01-19 11:26:50 | I |         sum  error  = [    3.4662]
25-01-19 11:26:50 | I |         best error  = [    3.4662]
25-01-19 11:26:50 | I |     + error = [3.4662]
25-01-19 11:26:51 | I |       - range scale = [    1.0000]
25-01-19 11:26:51 | I |         sum  error  = [    5.1179]
25-01-19 11:26:51 | I |         best error  = [    5.1179]
25-01-19 11:26:51 | I |     + error = [5.1179]
25-01-19 11:26:52 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:26:52 | I |       - range scale = [    1.0000]
25-01-19 11:26:52 | I |         sum  error  = [    4.2474]
25-01-19 11:26:52 | I |         best error  = [    4.2474]
25-01-19 11:26:52 | I |     + error = [4.2474]
25-01-19 11:26:53 | I |       - range scale = [    1.0000]
25-01-19 11:26:53 | I |         sum  error  = [    5.9178]
25-01-19 11:26:53 | I |         best error  = [    5.9178]
25-01-19 11:26:53 | I |     + error = [5.9178]
25-01-19 11:26:54 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:26:54 | I |       - range scale = [    1.0000]
25-01-19 11:26:54 | I |         sum  error  = [    0.7463]
25-01-19 11:26:54 | I |         best error  = [    0.7463]
25-01-19 11:26:54 | I |     + error = [0.7463]
25-01-19 11:26:56 | I |       - range scale = [    1.0000]
25-01-19 11:26:56 | I |         sum  error  = [    1.0951]
25-01-19 11:26:56 | I |         best error  = [    1.0951]
25-01-19 11:26:56 | I |     + error = [1.0951]
25-01-19 11:26:56 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:26:58 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:27:01 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:27:03 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:27:05 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:27:08 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:27:10 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:27:17 | I | quantizing activations for layer model.layers.4
25-01-19 11:27:18 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:18 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:22 | I | forward this layer
25-01-19 11:27:22 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/16.pt
25-01-19 11:27:22 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/16.pt
25-01-19 11:27:22 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:27:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 9            |        cudaMalloc retries: 9         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23203 MiB |  24231 GiB |  24209 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  24134 GiB |  24112 GiB |
|       from small pool |      3 MiB |      5 MiB |     96 GiB |     96 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23203 MiB |  24231 GiB |  24209 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  24134 GiB |  24112 GiB |
|       from small pool |      3 MiB |      5 MiB |     96 GiB |     96 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23203 MiB |  24202 GiB |  24180 GiB |
|       from large pool |  22688 MiB |  23200 MiB |  24105 GiB |  24083 GiB |
|       from small pool |      3 MiB |      5 MiB |     96 GiB |     96 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23738 MiB | 622284 MiB | 598756 MiB |
|       from large pool |  23524 MiB |  23732 MiB | 621672 MiB | 598148 MiB |
|       from small pool |      4 MiB |      6 MiB |    612 MiB |    608 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1785 MiB |  10714 GiB |  10713 GiB |
|       from large pool |    835 MiB |   1781 MiB |  10602 GiB |  10601 GiB |
|       from small pool |      0 MiB |      4 MiB |    111 GiB |    111 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    2031 K  |    2031 K  |
|       from large pool |     186    |     200    |     352 K  |     352 K  |
|       from small pool |     109    |     111    |    1678 K  |    1678 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    2031 K  |    2031 K  |
|       from large pool |     186    |     200    |     352 K  |     352 K  |
|       from small pool |     109    |     111    |    1678 K  |    1678 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     174    |    1545    |    1372    |
|       from large pool |     171    |     171    |    1239    |    1068    |
|       from small pool |       2    |       3    |     306    |     304    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |     923 K  |     923 K  |
|       from large pool |      17    |      22    |     162 K  |     162 K  |
|       from small pool |       8    |      15    |     760 K  |     760 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:27:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7947 GiB |   7946 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7944 GiB |   7944 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159451    |  159270    |
|       from large pool |     127    |     152    |  122415    |  122288    |
|       from small pool |      54    |      61    |   37036    |   36982    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159451    |  159270    |
|       from large pool |     127    |     152    |  122415    |  122288    |
|       from small pool |      54    |      61    |   37036    |   36982    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:27:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6850 GiB |   6850 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6847 GiB |   6847 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159451    |  159270    |
|       from large pool |     127    |     152    |  122415    |  122288    |
|       from small pool |      54    |      61    |   37036    |   36982    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159451    |  159270    |
|       from large pool |     127    |     152    |  122415    |  122288    |
|       from small pool |      54    |      61    |   37036    |   36982    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:27:22 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17348 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  23328 MiB |  17402 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  23324 MiB |  17400 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131924    |  131775    |
|       from large pool |     101    |     122    |   98613    |   98512    |
|       from small pool |      48    |      57    |   33311    |   33263    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131924    |  131775    |
|       from large pool |     101    |     122    |   98613    |   98512    |
|       from small pool |      48    |      57    |   33311    |   33263    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     231    |     129    |
|       from large pool |     101    |     120    |     229    |     128    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:27:22 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:27:22 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:27:22 | I | in layer model.layers.4
25-01-19 11:27:22 | I | quantizing weights for layer model.layers.4
25-01-19 11:27:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:27:26 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:27:26 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:27:27 | I |       - range scale = [    1.0000]
25-01-19 11:27:27 | I |         sum  error  = [   13.1573]
25-01-19 11:27:27 | I |         best error  = [   13.1573]
25-01-19 11:27:27 | I |     + error = [13.1573]
25-01-19 11:27:29 | I |       - range scale = [    1.0000]
25-01-19 11:27:29 | I |         sum  error  = [   22.6060]
25-01-19 11:27:29 | I |         best error  = [   22.6060]
25-01-19 11:27:29 | I |     + error = [22.6060]
25-01-19 11:27:29 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:27:31 | I |       - range scale = [    1.0000]
25-01-19 11:27:31 | I |         sum  error  = [   23.3174]
25-01-19 11:27:31 | I |         best error  = [   23.3174]
25-01-19 11:27:31 | I |     + error = [23.3174]
25-01-19 11:27:32 | I |       - range scale = [    1.0000]
25-01-19 11:27:32 | I |         sum  error  = [   38.0844]
25-01-19 11:27:32 | I |         best error  = [   38.0844]
25-01-19 11:27:32 | I |     + error = [38.0844]
25-01-19 11:27:32 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:27:33 | I |       - range scale = [    1.0000]
25-01-19 11:27:33 | I |         sum  error  = [    2.6124]
25-01-19 11:27:33 | I |         best error  = [    2.6124]
25-01-19 11:27:33 | I |     + error = [2.6124]
25-01-19 11:27:34 | I |       - range scale = [    1.0000]
25-01-19 11:27:34 | I |         sum  error  = [    3.7124]
25-01-19 11:27:34 | I |         best error  = [    3.7124]
25-01-19 11:27:34 | I |     + error = [3.7124]
25-01-19 11:27:34 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:27:35 | I |       - range scale = [    1.0000]
25-01-19 11:27:35 | I |         sum  error  = [    0.4308]
25-01-19 11:27:35 | I |         best error  = [    0.4308]
25-01-19 11:27:35 | I |     + error = [0.4308]
25-01-19 11:27:36 | I |       - range scale = [    1.0000]
25-01-19 11:27:36 | I |         sum  error  = [    0.6799]
25-01-19 11:27:36 | I |         best error  = [    0.6799]
25-01-19 11:27:36 | I |     + error = [0.6799]
25-01-19 11:27:36 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:27:36 | I |       - range scale = [    1.0000]
25-01-19 11:27:36 | I |         sum  error  = [    3.4515]
25-01-19 11:27:36 | I |         best error  = [    3.4515]
25-01-19 11:27:36 | I |     + error = [3.4515]
25-01-19 11:27:38 | I |       - range scale = [    1.0000]
25-01-19 11:27:38 | I |         sum  error  = [    5.0842]
25-01-19 11:27:38 | I |         best error  = [    5.0842]
25-01-19 11:27:38 | I |     + error = [5.0842]
25-01-19 11:27:38 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:27:39 | I |       - range scale = [    1.0000]
25-01-19 11:27:39 | I |         sum  error  = [    4.1775]
25-01-19 11:27:39 | I |         best error  = [    4.1775]
25-01-19 11:27:39 | I |     + error = [4.1775]
25-01-19 11:27:40 | I |       - range scale = [    1.0000]
25-01-19 11:27:40 | I |         sum  error  = [    5.8408]
25-01-19 11:27:40 | I |         best error  = [    5.8408]
25-01-19 11:27:40 | I |     + error = [5.8408]
25-01-19 11:27:40 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:27:41 | I |       - range scale = [    1.0000]
25-01-19 11:27:41 | I |         sum  error  = [    0.7241]
25-01-19 11:27:41 | I |         best error  = [    0.7241]
25-01-19 11:27:41 | I |     + error = [0.7241]
25-01-19 11:27:42 | I |       - range scale = [    1.0000]
25-01-19 11:27:42 | I |         sum  error  = [    1.0582]
25-01-19 11:27:42 | I |         best error  = [    1.0582]
25-01-19 11:27:42 | I |     + error = [1.0582]
25-01-19 11:27:42 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:27:44 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:27:47 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:27:49 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:27:52 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:27:54 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:27:56 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:28:03 | I | quantizing activations for layer model.layers.4
25-01-19 11:28:04 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:05 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:05 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:06 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:08 | I | forward this layer
25-01-19 11:28:08 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/18.pt
25-01-19 11:28:08 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/18.pt
25-01-19 11:28:08 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 80.94 MiB is free. Process 29960 has 23.61 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 748.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:28:08 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 10           |        cudaMalloc retries: 10        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  23203 MiB |  25521 GiB |  25498 GiB |
|       from large pool |  22944 MiB |  23200 MiB |  25412 GiB |  25390 GiB |
|       from small pool |      3 MiB |      5 MiB |    108 GiB |    108 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  23203 MiB |  25521 GiB |  25498 GiB |
|       from large pool |  22944 MiB |  23200 MiB |  25412 GiB |  25390 GiB |
|       from small pool |      3 MiB |      5 MiB |    108 GiB |    108 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  23203 MiB |  25489 GiB |  25467 GiB |
|       from large pool |  22944 MiB |  23200 MiB |  25381 GiB |  25358 GiB |
|       from small pool |      3 MiB |      5 MiB |    108 GiB |    108 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23696 MiB |  23738 MiB | 688126 MiB | 664430 MiB |
|       from large pool |  23692 MiB |  23732 MiB | 687444 MiB | 663752 MiB |
|       from small pool |      4 MiB |      6 MiB |    682 MiB |    678 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 766350 KiB |   1785 MiB |  11461 GiB |  11460 GiB |
|       from large pool | 765824 KiB |   1781 MiB |  11335 GiB |  11335 GiB |
|       from small pool |    526 KiB |      4 MiB |    125 GiB |    125 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     305    |    2279 K  |    2279 K  |
|       from large pool |     187    |     200    |     387 K  |     387 K  |
|       from small pool |     109    |     111    |    1891 K  |    1891 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     305    |    2279 K  |    2279 K  |
|       from large pool |     187    |     200    |     387 K  |     387 K  |
|       from small pool |     109    |     111    |    1891 K  |    1891 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     174    |    1687    |    1514    |
|       from large pool |     171    |     171    |    1346    |    1175    |
|       from small pool |       2    |       3    |     341    |     339    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    1030 K  |    1030 K  |
|       from large pool |      17    |      22    |     176 K  |     176 K  |
|       from small pool |       8    |      15    |     854 K  |     854 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:08 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7947 GiB |   7947 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7945 GiB |   7944 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159471    |  159290    |
|       from large pool |     127    |     152    |  122429    |  122302    |
|       from small pool |      54    |      61    |   37042    |   36988    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159471    |  159290    |
|       from large pool |     127    |     152    |  122429    |  122302    |
|       from small pool |      54    |      61    |   37042    |   36988    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:08 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20161 GiB |  20154 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6850 GiB |   6850 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6848 GiB |   6848 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159471    |  159290    |
|       from large pool |     127    |     152    |  122429    |  122302    |
|       from small pool |      54    |      61    |   37042    |   36988    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159471    |  159290    |
|       from large pool |     127    |     152    |  122429    |  122302    |
|       from small pool |      54    |      61    |   37042    |   36988    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:08 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  23656 MiB |  17730 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  23652 MiB |  17728 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131944    |  131795    |
|       from large pool |     101    |     122    |   98627    |   98526    |
|       from small pool |      48    |      57    |   33317    |   33269    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131944    |  131795    |
|       from large pool |     101    |     122    |   98627    |   98526    |
|       from small pool |      48    |      57    |   33317    |   33269    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     241    |     139    |
|       from large pool |     101    |     120    |     239    |     138    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:08 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:28:09 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:28:09 | I | in layer model.layers.4
25-01-19 11:28:09 | I | quantizing weights for layer model.layers.4
25-01-19 11:28:10 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:11 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:11 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:11 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:12 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:28:12 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:28:14 | I |       - range scale = [    1.0000]
25-01-19 11:28:14 | I |         sum  error  = [   11.7970]
25-01-19 11:28:14 | I |         best error  = [   11.7970]
25-01-19 11:28:14 | I |     + error = [11.7970]
25-01-19 11:28:16 | I |       - range scale = [    1.0000]
25-01-19 11:28:16 | I |         sum  error  = [   20.3821]
25-01-19 11:28:16 | I |         best error  = [   20.3821]
25-01-19 11:28:16 | I |     + error = [20.3821]
25-01-19 11:28:16 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:28:17 | I |       - range scale = [    1.0000]
25-01-19 11:28:17 | I |         sum  error  = [   22.1527]
25-01-19 11:28:17 | I |         best error  = [   22.1527]
25-01-19 11:28:17 | I |     + error = [22.1527]
25-01-19 11:28:19 | I |       - range scale = [    1.0000]
25-01-19 11:28:19 | I |         sum  error  = [   36.7347]
25-01-19 11:28:19 | I |         best error  = [   36.7347]
25-01-19 11:28:19 | I |     + error = [36.7347]
25-01-19 11:28:19 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:28:20 | I |       - range scale = [    1.0000]
25-01-19 11:28:20 | I |         sum  error  = [    2.5966]
25-01-19 11:28:20 | I |         best error  = [    2.5966]
25-01-19 11:28:20 | I |     + error = [2.5966]
25-01-19 11:28:21 | I |       - range scale = [    1.0000]
25-01-19 11:28:21 | I |         sum  error  = [    3.6725]
25-01-19 11:28:21 | I |         best error  = [    3.6725]
25-01-19 11:28:21 | I |     + error = [3.6725]
25-01-19 11:28:21 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:28:22 | I |       - range scale = [    1.0000]
25-01-19 11:28:22 | I |         sum  error  = [    0.4195]
25-01-19 11:28:22 | I |         best error  = [    0.4195]
25-01-19 11:28:22 | I |     + error = [0.4195]
25-01-19 11:28:23 | I |       - range scale = [    1.0000]
25-01-19 11:28:23 | I |         sum  error  = [    0.6475]
25-01-19 11:28:23 | I |         best error  = [    0.6475]
25-01-19 11:28:23 | I |     + error = [0.6475]
25-01-19 11:28:23 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:28:23 | I |       - range scale = [    1.0000]
25-01-19 11:28:23 | I |         sum  error  = [    3.3773]
25-01-19 11:28:23 | I |         best error  = [    3.3773]
25-01-19 11:28:23 | I |     + error = [3.3773]
25-01-19 11:28:25 | I |       - range scale = [    1.0000]
25-01-19 11:28:25 | I |         sum  error  = [    4.9476]
25-01-19 11:28:25 | I |         best error  = [    4.9476]
25-01-19 11:28:25 | I |     + error = [4.9476]
25-01-19 11:28:25 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:28:25 | I |       - range scale = [    1.0000]
25-01-19 11:28:25 | I |         sum  error  = [    4.1404]
25-01-19 11:28:25 | I |         best error  = [    4.1404]
25-01-19 11:28:25 | I |     + error = [4.1404]
25-01-19 11:28:27 | I |       - range scale = [    1.0000]
25-01-19 11:28:27 | I |         sum  error  = [    5.7544]
25-01-19 11:28:27 | I |         best error  = [    5.7544]
25-01-19 11:28:27 | I |     + error = [5.7544]
25-01-19 11:28:27 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:28:28 | I |       - range scale = [    1.0000]
25-01-19 11:28:28 | I |         sum  error  = [    0.6981]
25-01-19 11:28:28 | I |         best error  = [    0.6981]
25-01-19 11:28:28 | I |     + error = [0.6981]
25-01-19 11:28:29 | I |       - range scale = [    1.0000]
25-01-19 11:28:29 | I |         sum  error  = [    0.9977]
25-01-19 11:28:29 | I |         best error  = [    0.9977]
25-01-19 11:28:29 | I |     + error = [0.9977]
25-01-19 11:28:29 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:28:31 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:28:34 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:28:36 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:28:39 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:28:41 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:28:44 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:28:50 | I | quantizing activations for layer model.layers.4
25-01-19 11:28:51 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:52 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:52 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:53 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:55 | I | forward this layer
25-01-19 11:28:55 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/20.pt
25-01-19 11:28:55 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/20.pt
25-01-19 11:28:55 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 28.94 MiB is free. Process 29960 has 23.66 GiB memory in use. Of the allocated memory 22.66 GiB is allocated by PyTorch, and 544.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:28:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 11           |        cudaMalloc retries: 11        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  23203 MiB |  23267 MiB |  26896 GiB |  26874 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  26775 GiB |  26753 GiB |
|       from small pool |      3 MiB |      5 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  23203 MiB |  23267 MiB |  26896 GiB |  26874 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  26775 GiB |  26753 GiB |
|       from small pool |      3 MiB |      5 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  23203 MiB |  23267 MiB |  26863 GiB |  26840 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  26742 GiB |  26719 GiB |
|       from small pool |      3 MiB |      5 MiB |    120 GiB |    120 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23748 MiB |  23748 MiB | 759112 MiB | 735364 MiB |
|       from large pool |  23744 MiB |  23744 MiB | 758360 MiB | 734616 MiB |
|       from small pool |      4 MiB |      6 MiB |    752 MiB |    748 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 557454 KiB |   1785 MiB |  12300 GiB |  12299 GiB |
|       from large pool | 556928 KiB |   1781 MiB |  12160 GiB |  12159 GiB |
|       from small pool |    526 KiB |      4 MiB |    139 GiB |    139 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     297    |     305    |    2534 K  |    2534 K  |
|       from large pool |     188    |     200    |     423 K  |     423 K  |
|       from small pool |     109    |     112    |    2110 K  |    2110 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     297    |     305    |    2534 K  |    2534 K  |
|       from large pool |     188    |     200    |     423 K  |     423 K  |
|       from small pool |     109    |     112    |    2110 K  |    2110 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     175    |    1854    |    1679    |
|       from large pool |     173    |     173    |    1478    |    1305    |
|       from small pool |       2    |       3    |     376    |     374    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      23    |      30    |    1140 K  |    1140 K  |
|       from large pool |      15    |      22    |     189 K  |     189 K  |
|       from small pool |       8    |      15    |     950 K  |     950 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7947 GiB |   7947 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7945 GiB |   7945 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159491    |  159310    |
|       from large pool |     127    |     152    |  122443    |  122316    |
|       from small pool |      54    |      61    |   37048    |   36994    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159491    |  159310    |
|       from large pool |     127    |     152    |  122443    |  122316    |
|       from small pool |      54    |      61    |   37048    |   36994    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6850 GiB |   6850 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6848 GiB |   6848 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159491    |  159310    |
|       from large pool |     127    |     152    |  122443    |  122316    |
|       from small pool |      54    |      61    |   37048    |   36994    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159491    |  159310    |
|       from large pool |     127    |     152    |  122443    |  122316    |
|       from small pool |      54    |      61    |   37048    |   36994    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:55 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17351 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17351 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17351 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17343 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  23984 MiB |  18058 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  23980 MiB |  18056 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131964    |  131815    |
|       from large pool |     101    |     122    |   98641    |   98540    |
|       from small pool |      48    |      57    |   33323    |   33275    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131964    |  131815    |
|       from large pool |     101    |     122    |   98641    |   98540    |
|       from small pool |      48    |      57    |   33323    |   33275    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     251    |     149    |
|       from large pool |     101    |     120    |     249    |     148    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:28:55 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:28:56 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:28:56 | I | in layer model.layers.4
25-01-19 11:28:56 | I | quantizing weights for layer model.layers.4
25-01-19 11:28:57 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:58 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:58 | I | collecting calibration activations in model.layers.4
25-01-19 11:28:59 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:00 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:29:00 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:29:01 | I |       - range scale = [    1.0000]
25-01-19 11:29:01 | I |         sum  error  = [   12.5134]
25-01-19 11:29:01 | I |         best error  = [   12.5134]
25-01-19 11:29:01 | I |     + error = [12.5134]
25-01-19 11:29:03 | I |       - range scale = [    1.0000]
25-01-19 11:29:03 | I |         sum  error  = [   21.2625]
25-01-19 11:29:03 | I |         best error  = [   21.2625]
25-01-19 11:29:03 | I |     + error = [21.2625]
25-01-19 11:29:03 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:29:05 | I |       - range scale = [    1.0000]
25-01-19 11:29:05 | I |         sum  error  = [   22.1866]
25-01-19 11:29:05 | I |         best error  = [   22.1866]
25-01-19 11:29:05 | I |     + error = [22.1866]
25-01-19 11:29:07 | I |       - range scale = [    1.0000]
25-01-19 11:29:07 | I |         sum  error  = [   37.3687]
25-01-19 11:29:07 | I |         best error  = [   37.3687]
25-01-19 11:29:07 | I |     + error = [37.3687]
25-01-19 11:29:07 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:29:08 | I |       - range scale = [    1.0000]
25-01-19 11:29:08 | I |         sum  error  = [    2.6214]
25-01-19 11:29:08 | I |         best error  = [    2.6214]
25-01-19 11:29:08 | I |     + error = [2.6214]
25-01-19 11:29:09 | I |       - range scale = [    1.0000]
25-01-19 11:29:09 | I |         sum  error  = [    3.6977]
25-01-19 11:29:09 | I |         best error  = [    3.6977]
25-01-19 11:29:09 | I |     + error = [3.6977]
25-01-19 11:29:09 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:29:10 | I |       - range scale = [    1.0000]
25-01-19 11:29:10 | I |         sum  error  = [    0.4059]
25-01-19 11:29:10 | I |         best error  = [    0.4059]
25-01-19 11:29:10 | I |     + error = [0.4059]
25-01-19 11:29:10 | I |       - range scale = [    1.0000]
25-01-19 11:29:10 | I |         sum  error  = [    0.6244]
25-01-19 11:29:10 | I |         best error  = [    0.6244]
25-01-19 11:29:10 | I |     + error = [0.6244]
25-01-19 11:29:11 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:29:11 | I |       - range scale = [    1.0000]
25-01-19 11:29:11 | I |         sum  error  = [    3.4408]
25-01-19 11:29:11 | I |         best error  = [    3.4408]
25-01-19 11:29:11 | I |     + error = [3.4408]
25-01-19 11:29:12 | I |       - range scale = [    1.0000]
25-01-19 11:29:12 | I |         sum  error  = [    4.9813]
25-01-19 11:29:12 | I |         best error  = [    4.9813]
25-01-19 11:29:12 | I |     + error = [4.9813]
25-01-19 11:29:13 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:29:13 | I |       - range scale = [    1.0000]
25-01-19 11:29:13 | I |         sum  error  = [    4.2053]
25-01-19 11:29:13 | I |         best error  = [    4.2053]
25-01-19 11:29:13 | I |     + error = [4.2053]
25-01-19 11:29:15 | I |       - range scale = [    1.0000]
25-01-19 11:29:15 | I |         sum  error  = [    5.7669]
25-01-19 11:29:15 | I |         best error  = [    5.7669]
25-01-19 11:29:15 | I |     + error = [5.7669]
25-01-19 11:29:15 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:29:16 | I |       - range scale = [    1.0000]
25-01-19 11:29:16 | I |         sum  error  = [    0.7232]
25-01-19 11:29:16 | I |         best error  = [    0.7232]
25-01-19 11:29:16 | I |     + error = [0.7232]
25-01-19 11:29:17 | I |       - range scale = [    1.0000]
25-01-19 11:29:17 | I |         sum  error  = [    1.0276]
25-01-19 11:29:17 | I |         best error  = [    1.0276]
25-01-19 11:29:17 | I |     + error = [1.0276]
25-01-19 11:29:17 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:29:20 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:29:22 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:29:24 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:29:27 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:29:29 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:29:32 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:29:38 | I | quantizing activations for layer model.layers.4
25-01-19 11:29:40 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:40 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:43 | I | forward this layer
25-01-19 11:29:43 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/22.pt
25-01-19 11:29:43 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/22.pt
25-01-19 11:29:44 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 580.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:29:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 12           |        cudaMalloc retries: 12        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  23267 MiB |  28357 GiB |  28335 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  28224 GiB |  28201 GiB |
|       from small pool |      3 MiB |      5 MiB |    133 GiB |    133 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  23267 MiB |  28357 GiB |  28335 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  28224 GiB |  28201 GiB |
|       from small pool |      3 MiB |      5 MiB |    133 GiB |    133 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  23267 MiB |  28321 GiB |  28299 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  28188 GiB |  28165 GiB |
|       from small pool |      3 MiB |      5 MiB |    133 GiB |    133 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |    807 GiB |    784 GiB |
|       from large pool |  23524 MiB |  23744 MiB |    806 GiB |    783 GiB |
|       from small pool |      4 MiB |      6 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 594318 KiB |   1785 MiB |  13234 GiB |  13233 GiB |
|       from large pool | 593792 KiB |   1781 MiB |  13079 GiB |  13079 GiB |
|       from small pool |    526 KiB |      4 MiB |    154 GiB |    154 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     296    |     305    |    2796 K  |    2796 K  |
|       from large pool |     187    |     200    |     461 K  |     461 K  |
|       from small pool |     109    |     112    |    2335 K  |    2335 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     296    |     305    |    2796 K  |    2796 K  |
|       from large pool |     187    |     200    |     461 K  |     461 K  |
|       from small pool |     109    |     112    |    2335 K  |    2335 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    2001    |    1828    |
|       from large pool |     171    |     173    |    1590    |    1419    |
|       from small pool |       2    |       3    |     411    |     409    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      24    |      30    |    1251 K  |    1251 K  |
|       from large pool |      16    |      22    |     201 K  |     201 K  |
|       from small pool |       8    |      15    |    1049 K  |    1049 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:29:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7948 GiB |   7947 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7945 GiB |   7945 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159511    |  159330    |
|       from large pool |     127    |     152    |  122457    |  122330    |
|       from small pool |      54    |      61    |   37054    |   37000    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159511    |  159330    |
|       from large pool |     127    |     152    |  122457    |  122330    |
|       from small pool |      54    |      61    |   37054    |   37000    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:29:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6851 GiB |   6851 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6848 GiB |   6848 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159511    |  159330    |
|       from large pool |     127    |     152    |  122457    |  122330    |
|       from small pool |      54    |      61    |   37054    |   37000    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159511    |  159330    |
|       from large pool |     127    |     152    |  122457    |  122330    |
|       from small pool |      54    |      61    |   37054    |   37000    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:29:44 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17349 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  24312 MiB |  18386 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  24308 MiB |  18384 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  131984    |  131835    |
|       from large pool |     101    |     122    |   98655    |   98554    |
|       from small pool |      48    |      57    |   33329    |   33281    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  131984    |  131835    |
|       from large pool |     101    |     122    |   98655    |   98554    |
|       from small pool |      48    |      57    |   33329    |   33281    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     261    |     159    |
|       from large pool |     101    |     120    |     259    |     158    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:29:44 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:29:44 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:29:44 | I | in layer model.layers.4
25-01-19 11:29:44 | I | quantizing weights for layer model.layers.4
25-01-19 11:29:46 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:46 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:47 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:47 | I | collecting calibration activations in model.layers.4
25-01-19 11:29:48 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:29:48 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:29:50 | I |       - range scale = [    1.0000]
25-01-19 11:29:50 | I |         sum  error  = [   13.1013]
25-01-19 11:29:50 | I |         best error  = [   13.1013]
25-01-19 11:29:50 | I |     + error = [13.1013]
25-01-19 11:29:52 | I |       - range scale = [    1.0000]
25-01-19 11:29:52 | I |         sum  error  = [   22.3789]
25-01-19 11:29:52 | I |         best error  = [   22.3789]
25-01-19 11:29:52 | I |     + error = [22.3789]
25-01-19 11:29:52 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:29:54 | I |       - range scale = [    1.0000]
25-01-19 11:29:54 | I |         sum  error  = [   23.7079]
25-01-19 11:29:54 | I |         best error  = [   23.7079]
25-01-19 11:29:54 | I |     + error = [23.7079]
25-01-19 11:29:56 | I |       - range scale = [    1.0000]
25-01-19 11:29:56 | I |         sum  error  = [   40.6871]
25-01-19 11:29:56 | I |         best error  = [   40.6871]
25-01-19 11:29:56 | I |     + error = [40.6871]
25-01-19 11:29:56 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:29:57 | I |       - range scale = [    1.0000]
25-01-19 11:29:57 | I |         sum  error  = [    2.6234]
25-01-19 11:29:57 | I |         best error  = [    2.6234]
25-01-19 11:29:57 | I |     + error = [2.6234]
25-01-19 11:29:57 | I |       - range scale = [    1.0000]
25-01-19 11:29:57 | I |         sum  error  = [    3.6604]
25-01-19 11:29:57 | I |         best error  = [    3.6604]
25-01-19 11:29:57 | I |     + error = [3.6604]
25-01-19 11:29:58 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:29:58 | I |       - range scale = [    1.0000]
25-01-19 11:29:58 | I |         sum  error  = [    0.4404]
25-01-19 11:29:58 | I |         best error  = [    0.4404]
25-01-19 11:29:58 | I |     + error = [0.4404]
25-01-19 11:29:59 | I |       - range scale = [    1.0000]
25-01-19 11:29:59 | I |         sum  error  = [    0.6676]
25-01-19 11:29:59 | I |         best error  = [    0.6676]
25-01-19 11:29:59 | I |     + error = [0.6676]
25-01-19 11:29:59 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:30:00 | I |       - range scale = [    1.0000]
25-01-19 11:30:00 | I |         sum  error  = [    3.4600]
25-01-19 11:30:00 | I |         best error  = [    3.4600]
25-01-19 11:30:00 | I |     + error = [3.4600]
25-01-19 11:30:01 | I |       - range scale = [    1.0000]
25-01-19 11:30:01 | I |         sum  error  = [    4.9777]
25-01-19 11:30:01 | I |         best error  = [    4.9777]
25-01-19 11:30:01 | I |     + error = [4.9777]
25-01-19 11:30:01 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:30:02 | I |       - range scale = [    1.0000]
25-01-19 11:30:02 | I |         sum  error  = [    4.2299]
25-01-19 11:30:02 | I |         best error  = [    4.2299]
25-01-19 11:30:02 | I |     + error = [4.2299]
25-01-19 11:30:03 | I |       - range scale = [    1.0000]
25-01-19 11:30:03 | I |         sum  error  = [    5.7445]
25-01-19 11:30:03 | I |         best error  = [    5.7445]
25-01-19 11:30:03 | I |     + error = [5.7445]
25-01-19 11:30:04 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:30:04 | I |       - range scale = [    1.0000]
25-01-19 11:30:04 | I |         sum  error  = [    0.7165]
25-01-19 11:30:04 | I |         best error  = [    0.7165]
25-01-19 11:30:04 | I |     + error = [0.7165]
25-01-19 11:30:06 | I |       - range scale = [    1.0000]
25-01-19 11:30:06 | I |         sum  error  = [    1.0290]
25-01-19 11:30:06 | I |         best error  = [    1.0290]
25-01-19 11:30:06 | I |     + error = [1.0290]
25-01-19 11:30:06 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:30:08 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:30:11 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:30:13 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:30:16 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:30:18 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:30:21 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:30:27 | I | quantizing activations for layer model.layers.4
25-01-19 11:30:29 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:29 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:33 | I | forward this layer
25-01-19 11:30:33 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/24.pt
25-01-19 11:30:33 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/24.pt
25-01-19 11:30:33 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.28 GiB is allocated by PyTorch, and 708.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:30:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 13           |        cudaMalloc retries: 13        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22819 MiB |  23267 MiB |  29904 GiB |  29881 GiB |
|       from large pool |  22816 MiB |  23264 MiB |  29757 GiB |  29735 GiB |
|       from small pool |      3 MiB |      5 MiB |    146 GiB |    146 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22819 MiB |  23267 MiB |  29904 GiB |  29881 GiB |
|       from large pool |  22816 MiB |  23264 MiB |  29757 GiB |  29735 GiB |
|       from small pool |      3 MiB |      5 MiB |    146 GiB |    146 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22819 MiB |  23267 MiB |  29865 GiB |  29842 GiB |
|       from large pool |  22816 MiB |  23264 MiB |  29718 GiB |  29696 GiB |
|       from small pool |      3 MiB |      5 MiB |    146 GiB |    146 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |    871 GiB |    848 GiB |
|       from large pool |  23524 MiB |  23744 MiB |    871 GiB |    848 GiB |
|       from small pool |      4 MiB |      6 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 725390 KiB |   1785 MiB |  13998 GiB |  13997 GiB |
|       from large pool | 724864 KiB |   1781 MiB |  13828 GiB |  13828 GiB |
|       from small pool |    526 KiB |      4 MiB |    169 GiB |    169 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    3066 K  |    3066 K  |
|       from large pool |     186    |     200    |     500 K  |     500 K  |
|       from small pool |     109    |     112    |    2566 K  |    2566 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    3066 K  |    3066 K  |
|       from large pool |     186    |     200    |     500 K  |     500 K  |
|       from small pool |     109    |     112    |    2566 K  |    2566 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    2144    |    1971    |
|       from large pool |     171    |     173    |    1698    |    1527    |
|       from small pool |       2    |       3    |     446    |     444    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    1364 K  |    1364 K  |
|       from large pool |      17    |      22    |     215 K  |     215 K  |
|       from small pool |       8    |      15    |    1149 K  |    1149 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:30:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7948 GiB |   7948 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7946 GiB |   7945 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159531    |  159350    |
|       from large pool |     127    |     152    |  122471    |  122344    |
|       from small pool |      54    |      61    |   37060    |   37006    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159531    |  159350    |
|       from large pool |     127    |     152    |  122471    |  122344    |
|       from small pool |      54    |      61    |   37060    |   37006    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:30:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20162 GiB |  20155 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6851 GiB |   6851 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6849 GiB |   6849 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159531    |  159350    |
|       from large pool |     127    |     152    |  122471    |  122344    |
|       from small pool |      54    |      61    |   37060    |   37006    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159531    |  159350    |
|       from large pool |     127    |     152    |  122471    |  122344    |
|       from small pool |      54    |      61    |   37060    |   37006    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:30:33 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  24640 MiB |  18714 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  24636 MiB |  18712 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132004    |  131855    |
|       from large pool |     101    |     122    |   98669    |   98568    |
|       from small pool |      48    |      57    |   33335    |   33287    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132004    |  131855    |
|       from large pool |     101    |     122    |   98669    |   98568    |
|       from small pool |      48    |      57    |   33335    |   33287    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     271    |     169    |
|       from large pool |     101    |     120    |     269    |     168    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:30:33 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:30:33 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:30:33 | I | in layer model.layers.4
25-01-19 11:30:33 | I | quantizing weights for layer model.layers.4
25-01-19 11:30:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:30:38 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:30:38 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:30:40 | I |       - range scale = [    1.0000]
25-01-19 11:30:40 | I |         sum  error  = [   12.2932]
25-01-19 11:30:40 | I |         best error  = [   12.2932]
25-01-19 11:30:40 | I |     + error = [12.2932]
25-01-19 11:30:42 | I |       - range scale = [    1.0000]
25-01-19 11:30:42 | I |         sum  error  = [   21.3102]
25-01-19 11:30:42 | I |         best error  = [   21.3102]
25-01-19 11:30:42 | I |     + error = [21.3102]
25-01-19 11:30:42 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:30:44 | I |       - range scale = [    1.0000]
25-01-19 11:30:44 | I |         sum  error  = [   21.6096]
25-01-19 11:30:44 | I |         best error  = [   21.6096]
25-01-19 11:30:44 | I |     + error = [21.6096]
25-01-19 11:30:46 | I |       - range scale = [    1.0000]
25-01-19 11:30:46 | I |         sum  error  = [   36.4951]
25-01-19 11:30:46 | I |         best error  = [   36.4951]
25-01-19 11:30:46 | I |     + error = [36.4951]
25-01-19 11:30:46 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:30:47 | I |       - range scale = [    1.0000]
25-01-19 11:30:47 | I |         sum  error  = [    2.6413]
25-01-19 11:30:47 | I |         best error  = [    2.6413]
25-01-19 11:30:47 | I |     + error = [2.6413]
25-01-19 11:30:48 | I |       - range scale = [    1.0000]
25-01-19 11:30:48 | I |         sum  error  = [    3.6648]
25-01-19 11:30:48 | I |         best error  = [    3.6648]
25-01-19 11:30:48 | I |     + error = [3.6648]
25-01-19 11:30:48 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:30:48 | I |       - range scale = [    1.0000]
25-01-19 11:30:48 | I |         sum  error  = [    0.4359]
25-01-19 11:30:48 | I |         best error  = [    0.4359]
25-01-19 11:30:48 | I |     + error = [0.4359]
25-01-19 11:30:49 | I |       - range scale = [    1.0000]
25-01-19 11:30:49 | I |         sum  error  = [    0.6553]
25-01-19 11:30:49 | I |         best error  = [    0.6553]
25-01-19 11:30:49 | I |     + error = [0.6553]
25-01-19 11:30:50 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:30:50 | I |       - range scale = [    1.0000]
25-01-19 11:30:50 | I |         sum  error  = [    3.4581]
25-01-19 11:30:50 | I |         best error  = [    3.4581]
25-01-19 11:30:50 | I |     + error = [3.4581]
25-01-19 11:30:51 | I |       - range scale = [    1.0000]
25-01-19 11:30:51 | I |         sum  error  = [    4.9331]
25-01-19 11:30:51 | I |         best error  = [    4.9331]
25-01-19 11:30:51 | I |     + error = [4.9331]
25-01-19 11:30:52 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:30:52 | I |       - range scale = [    1.0000]
25-01-19 11:30:52 | I |         sum  error  = [    4.2582]
25-01-19 11:30:52 | I |         best error  = [    4.2582]
25-01-19 11:30:52 | I |     + error = [4.2582]
25-01-19 11:30:53 | I |       - range scale = [    1.0000]
25-01-19 11:30:53 | I |         sum  error  = [    5.7229]
25-01-19 11:30:53 | I |         best error  = [    5.7229]
25-01-19 11:30:53 | I |     + error = [5.7229]
25-01-19 11:30:54 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:30:54 | I |       - range scale = [    1.0000]
25-01-19 11:30:54 | I |         sum  error  = [    0.7203]
25-01-19 11:30:54 | I |         best error  = [    0.7203]
25-01-19 11:30:54 | I |     + error = [0.7203]
25-01-19 11:30:55 | I |       - range scale = [    1.0000]
25-01-19 11:30:55 | I |         sum  error  = [    1.0049]
25-01-19 11:30:55 | I |         best error  = [    1.0049]
25-01-19 11:30:55 | I |     + error = [1.0049]
25-01-19 11:30:56 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:30:58 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:31:01 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:31:03 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:31:06 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:31:08 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:31:11 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:31:17 | I | quantizing activations for layer model.layers.4
25-01-19 11:31:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:20 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:21 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:23 | I | forward this layer
25-01-19 11:31:23 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/26.pt
25-01-19 11:31:23 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/26.pt
25-01-19 11:31:23 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:31:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 14           |        cudaMalloc retries: 14        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  31535 GiB |  31513 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  31375 GiB |  31353 GiB |
|       from small pool |      3 MiB |      5 MiB |    160 GiB |    160 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  31535 GiB |  31513 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  31375 GiB |  31353 GiB |
|       from small pool |      3 MiB |      5 MiB |    160 GiB |    160 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  31494 GiB |  31471 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  31334 GiB |  31312 GiB |
|       from small pool |      3 MiB |      5 MiB |    159 GiB |    159 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |    939 GiB |    916 GiB |
|       from large pool |  23524 MiB |  23744 MiB |    938 GiB |    915 GiB |
|       from small pool |      4 MiB |      6 MiB |      0 GiB |      0 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1785 MiB |  14822 GiB |  14821 GiB |
|       from large pool |    835 MiB |   1781 MiB |  14636 GiB |  14636 GiB |
|       from small pool |      0 MiB |      4 MiB |    185 GiB |    185 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    3343 K  |    3342 K  |
|       from large pool |     185    |     200    |     540 K  |     540 K  |
|       from small pool |     109    |     112    |    2802 K  |    2802 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    3343 K  |    3342 K  |
|       from large pool |     185    |     200    |     540 K  |     540 K  |
|       from small pool |     109    |     112    |    2802 K  |    2802 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    2300    |    2127    |
|       from large pool |     171    |     173    |    1819    |    1648    |
|       from small pool |       2    |       3    |     481    |     479    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    1480 K  |    1480 K  |
|       from large pool |      17    |      22    |     228 K  |     228 K  |
|       from small pool |       8    |      15    |    1252 K  |    1252 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:31:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7948 GiB |   7948 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7946 GiB |   7946 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159551    |  159370    |
|       from large pool |     127    |     152    |  122485    |  122358    |
|       from small pool |      54    |      61    |   37066    |   37012    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159551    |  159370    |
|       from large pool |     127    |     152    |  122485    |  122358    |
|       from small pool |      54    |      61    |   37066    |   37012    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:31:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6851 GiB |   6851 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6849 GiB |   6849 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159551    |  159370    |
|       from large pool |     127    |     152    |  122485    |  122358    |
|       from small pool |      54    |      61    |   37066    |   37012    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159551    |  159370    |
|       from large pool |     127    |     152    |  122485    |  122358    |
|       from small pool |      54    |      61    |   37066    |   37012    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:31:23 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17352 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17352 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17344 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  24968 MiB |  19042 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  24964 MiB |  19040 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132024    |  131875    |
|       from large pool |     101    |     122    |   98683    |   98582    |
|       from small pool |      48    |      57    |   33341    |   33293    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132024    |  131875    |
|       from large pool |     101    |     122    |   98683    |   98582    |
|       from small pool |      48    |      57    |   33341    |   33293    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     281    |     179    |
|       from large pool |     101    |     120    |     279    |     178    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:31:23 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:31:24 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:31:24 | I | in layer model.layers.4
25-01-19 11:31:24 | I | quantizing weights for layer model.layers.4
25-01-19 11:31:26 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:26 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:27 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:27 | I | collecting calibration activations in model.layers.4
25-01-19 11:31:28 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:31:28 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:31:30 | I |       - range scale = [    1.0000]
25-01-19 11:31:30 | I |         sum  error  = [   12.8044]
25-01-19 11:31:30 | I |         best error  = [   12.8044]
25-01-19 11:31:30 | I |     + error = [12.8044]
25-01-19 11:31:32 | I |       - range scale = [    1.0000]
25-01-19 11:31:32 | I |         sum  error  = [   22.0832]
25-01-19 11:31:32 | I |         best error  = [   22.0832]
25-01-19 11:31:32 | I |     + error = [22.0832]
25-01-19 11:31:32 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:31:34 | I |       - range scale = [    1.0000]
25-01-19 11:31:34 | I |         sum  error  = [   22.6745]
25-01-19 11:31:34 | I |         best error  = [   22.6745]
25-01-19 11:31:34 | I |     + error = [22.6745]
25-01-19 11:31:36 | I |       - range scale = [    1.0000]
25-01-19 11:31:36 | I |         sum  error  = [   38.1793]
25-01-19 11:31:36 | I |         best error  = [   38.1793]
25-01-19 11:31:36 | I |     + error = [38.1793]
25-01-19 11:31:37 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:31:37 | I |       - range scale = [    1.0000]
25-01-19 11:31:37 | I |         sum  error  = [    2.6268]
25-01-19 11:31:37 | I |         best error  = [    2.6268]
25-01-19 11:31:37 | I |     + error = [2.6268]
25-01-19 11:31:38 | I |       - range scale = [    1.0000]
25-01-19 11:31:38 | I |         sum  error  = [    3.6403]
25-01-19 11:31:38 | I |         best error  = [    3.6403]
25-01-19 11:31:38 | I |     + error = [3.6403]
25-01-19 11:31:38 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:31:39 | I |       - range scale = [    1.0000]
25-01-19 11:31:39 | I |         sum  error  = [    0.4275]
25-01-19 11:31:39 | I |         best error  = [    0.4275]
25-01-19 11:31:39 | I |     + error = [0.4275]
25-01-19 11:31:40 | I |       - range scale = [    1.0000]
25-01-19 11:31:40 | I |         sum  error  = [    0.6433]
25-01-19 11:31:40 | I |         best error  = [    0.6433]
25-01-19 11:31:40 | I |     + error = [0.6433]
25-01-19 11:31:40 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:31:41 | I |       - range scale = [    1.0000]
25-01-19 11:31:41 | I |         sum  error  = [    3.4800]
25-01-19 11:31:41 | I |         best error  = [    3.4800]
25-01-19 11:31:41 | I |     + error = [3.4800]
25-01-19 11:31:42 | I |       - range scale = [    1.0000]
25-01-19 11:31:42 | I |         sum  error  = [    4.9722]
25-01-19 11:31:42 | I |         best error  = [    4.9722]
25-01-19 11:31:42 | I |     + error = [4.9722]
25-01-19 11:31:42 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:31:43 | I |       - range scale = [    1.0000]
25-01-19 11:31:43 | I |         sum  error  = [    4.2604]
25-01-19 11:31:43 | I |         best error  = [    4.2604]
25-01-19 11:31:43 | I |     + error = [4.2604]
25-01-19 11:31:44 | I |       - range scale = [    1.0000]
25-01-19 11:31:44 | I |         sum  error  = [    5.7190]
25-01-19 11:31:44 | I |         best error  = [    5.7190]
25-01-19 11:31:44 | I |     + error = [5.7190]
25-01-19 11:31:44 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:31:45 | I |       - range scale = [    1.0000]
25-01-19 11:31:45 | I |         sum  error  = [    0.6958]
25-01-19 11:31:45 | I |         best error  = [    0.6958]
25-01-19 11:31:45 | I |     + error = [0.6958]
25-01-19 11:31:46 | I |       - range scale = [    1.0000]
25-01-19 11:31:46 | I |         sum  error  = [    0.9595]
25-01-19 11:31:46 | I |         best error  = [    0.9595]
25-01-19 11:31:46 | I |     + error = [0.9595]
25-01-19 11:31:46 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:31:49 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:31:51 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:31:54 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:31:56 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:31:59 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:32:01 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:32:08 | I | quantizing activations for layer model.layers.4
25-01-19 11:32:10 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:11 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:11 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:12 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:14 | I | forward this layer
25-01-19 11:32:14 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/28.pt
25-01-19 11:32:14 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/28.pt
25-01-19 11:32:14 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 80.94 MiB is free. Process 29960 has 23.61 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 748.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:32:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 15           |        cudaMalloc retries: 15        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  23267 MiB |  33253 GiB |  33230 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  33079 GiB |  33057 GiB |
|       from small pool |      3 MiB |      5 MiB |    173 GiB |    173 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  23267 MiB |  33253 GiB |  33230 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  33079 GiB |  33057 GiB |
|       from small pool |      3 MiB |      5 MiB |    173 GiB |    173 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  23267 MiB |  33208 GiB |  33186 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  33035 GiB |  33013 GiB |
|       from small pool |      3 MiB |      5 MiB |    173 GiB |    173 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23696 MiB |  23750 MiB |   1002 GiB |    979 GiB |
|       from large pool |  23692 MiB |  23744 MiB |   1001 GiB |    978 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 766350 KiB |   1907 MiB |  15936 GiB |  15936 GiB |
|       from large pool | 765824 KiB |   1905 MiB |  15735 GiB |  15734 GiB |
|       from small pool |    526 KiB |      4 MiB |    201 GiB |    201 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    3627 K  |    3626 K  |
|       from large pool |     186    |     200    |     581 K  |     581 K  |
|       from small pool |     109    |     112    |    3045 K  |    3045 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    3627 K  |    3626 K  |
|       from large pool |     186    |     200    |     581 K  |     581 K  |
|       from small pool |     109    |     112    |    3045 K  |    3045 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    2438    |    2265    |
|       from large pool |     171    |     173    |    1922    |    1751    |
|       from small pool |       2    |       3    |     516    |     514    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    1599 K  |    1599 K  |
|       from large pool |      17    |      22    |     243 K  |     243 K  |
|       from small pool |       8    |      15    |    1356 K  |    1356 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:32:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7948 GiB |   7948 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7946 GiB |   7946 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159571    |  159390    |
|       from large pool |     127    |     152    |  122499    |  122372    |
|       from small pool |      54    |      61    |   37072    |   37018    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159571    |  159390    |
|       from large pool |     127    |     152    |  122499    |  122372    |
|       from small pool |      54    |      61    |   37072    |   37018    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:32:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6852 GiB |   6851 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6849 GiB |   6849 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159571    |  159390    |
|       from large pool |     127    |     152    |  122499    |  122372    |
|       from small pool |      54    |      61    |   37072    |   37018    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159571    |  159390    |
|       from large pool |     127    |     152    |  122499    |  122372    |
|       from small pool |      54    |      61    |   37072    |   37018    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:32:14 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17350 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  25296 MiB |  19370 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  25292 MiB |  19368 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132044    |  131895    |
|       from large pool |     101    |     122    |   98697    |   98596    |
|       from small pool |      48    |      57    |   33347    |   33299    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132044    |  131895    |
|       from large pool |     101    |     122    |   98697    |   98596    |
|       from small pool |      48    |      57    |   33347    |   33299    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     291    |     189    |
|       from large pool |     101    |     120    |     289    |     188    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:32:14 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:32:15 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:32:15 | I | in layer model.layers.4
25-01-19 11:32:15 | I | quantizing weights for layer model.layers.4
25-01-19 11:32:17 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:17 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:18 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:19 | I | collecting calibration activations in model.layers.4
25-01-19 11:32:19 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:32:19 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:32:22 | I |       - range scale = [    1.0000]
25-01-19 11:32:22 | I |         sum  error  = [   13.1812]
25-01-19 11:32:22 | I |         best error  = [   13.1812]
25-01-19 11:32:22 | I |     + error = [13.1812]
25-01-19 11:32:24 | I |       - range scale = [    1.0000]
25-01-19 11:32:24 | I |         sum  error  = [   22.0243]
25-01-19 11:32:24 | I |         best error  = [   22.0243]
25-01-19 11:32:24 | I |     + error = [22.0243]
25-01-19 11:32:24 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:32:26 | I |       - range scale = [    1.0000]
25-01-19 11:32:26 | I |         sum  error  = [   23.1976]
25-01-19 11:32:26 | I |         best error  = [   23.1976]
25-01-19 11:32:26 | I |     + error = [23.1976]
25-01-19 11:32:28 | I |       - range scale = [    1.0000]
25-01-19 11:32:28 | I |         sum  error  = [   38.8123]
25-01-19 11:32:28 | I |         best error  = [   38.8123]
25-01-19 11:32:28 | I |     + error = [38.8123]
25-01-19 11:32:29 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:32:29 | I |       - range scale = [    1.0000]
25-01-19 11:32:29 | I |         sum  error  = [    2.6406]
25-01-19 11:32:29 | I |         best error  = [    2.6406]
25-01-19 11:32:29 | I |     + error = [2.6406]
25-01-19 11:32:30 | I |       - range scale = [    1.0000]
25-01-19 11:32:30 | I |         sum  error  = [    3.6236]
25-01-19 11:32:30 | I |         best error  = [    3.6236]
25-01-19 11:32:30 | I |     + error = [3.6236]
25-01-19 11:32:30 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:32:31 | I |       - range scale = [    1.0000]
25-01-19 11:32:31 | I |         sum  error  = [    0.4327]
25-01-19 11:32:31 | I |         best error  = [    0.4327]
25-01-19 11:32:31 | I |     + error = [0.4327]
25-01-19 11:32:32 | I |       - range scale = [    1.0000]
25-01-19 11:32:32 | I |         sum  error  = [    0.6484]
25-01-19 11:32:32 | I |         best error  = [    0.6484]
25-01-19 11:32:32 | I |     + error = [0.6484]
25-01-19 11:32:32 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:32:33 | I |       - range scale = [    1.0000]
25-01-19 11:32:33 | I |         sum  error  = [    3.4721]
25-01-19 11:32:33 | I |         best error  = [    3.4721]
25-01-19 11:32:33 | I |     + error = [3.4721]
25-01-19 11:32:34 | I |       - range scale = [    1.0000]
25-01-19 11:32:34 | I |         sum  error  = [    4.9097]
25-01-19 11:32:34 | I |         best error  = [    4.9097]
25-01-19 11:32:34 | I |     + error = [4.9097]
25-01-19 11:32:34 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:32:35 | I |       - range scale = [    1.0000]
25-01-19 11:32:35 | I |         sum  error  = [    4.2730]
25-01-19 11:32:35 | I |         best error  = [    4.2730]
25-01-19 11:32:35 | I |     + error = [4.2730]
25-01-19 11:32:36 | I |       - range scale = [    1.0000]
25-01-19 11:32:36 | I |         sum  error  = [    5.7037]
25-01-19 11:32:36 | I |         best error  = [    5.7037]
25-01-19 11:32:36 | I |     + error = [5.7037]
25-01-19 11:32:36 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:32:37 | I |       - range scale = [    1.0000]
25-01-19 11:32:37 | I |         sum  error  = [    0.7225]
25-01-19 11:32:37 | I |         best error  = [    0.7225]
25-01-19 11:32:37 | I |     + error = [0.7225]
25-01-19 11:32:38 | I |       - range scale = [    1.0000]
25-01-19 11:32:38 | I |         sum  error  = [    0.9944]
25-01-19 11:32:38 | I |         best error  = [    0.9944]
25-01-19 11:32:38 | I |     + error = [0.9944]
25-01-19 11:32:38 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:32:41 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:32:43 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:32:46 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:32:48 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:32:51 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:32:53 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:33:00 | I | quantizing activations for layer model.layers.4
25-01-19 11:33:02 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:02 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:03 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:04 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:06 | I | forward this layer
25-01-19 11:33:06 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/30.pt
25-01-19 11:33:06 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/30.pt
25-01-19 11:33:06 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 28.94 MiB is free. Process 29960 has 23.66 GiB memory in use. Of the allocated memory 22.66 GiB is allocated by PyTorch, and 544.19 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:33:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 16           |        cudaMalloc retries: 16        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  23203 MiB |  23267 MiB |  35056 GiB |  35034 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  34869 GiB |  34846 GiB |
|       from small pool |      3 MiB |      5 MiB |    187 GiB |    187 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  23203 MiB |  23267 MiB |  35056 GiB |  35034 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  34869 GiB |  34846 GiB |
|       from small pool |      3 MiB |      5 MiB |    187 GiB |    187 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  23203 MiB |  23267 MiB |  35010 GiB |  34987 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  34823 GiB |  34800 GiB |
|       from small pool |      3 MiB |      5 MiB |    186 GiB |    186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23748 MiB |  23750 MiB |   1072 GiB |   1048 GiB |
|       from large pool |  23744 MiB |  23744 MiB |   1071 GiB |   1047 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 557246 KiB |   1907 MiB |  17112 GiB |  17111 GiB |
|       from large pool | 556928 KiB |   1905 MiB |  16894 GiB |  16894 GiB |
|       from small pool |    318 KiB |      4 MiB |    217 GiB |    217 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     300    |     305    |    3918 K  |    3917 K  |
|       from large pool |     187    |     200    |     624 K  |     624 K  |
|       from small pool |     113    |     115    |    3293 K  |    3293 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     300    |     305    |    3918 K  |    3917 K  |
|       from large pool |     187    |     200    |     624 K  |     624 K  |
|       from small pool |     113    |     115    |    3293 K  |    3293 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     176    |    2605    |    2430    |
|       from large pool |     173    |     173    |    2054    |    1881    |
|       from small pool |       2    |       3    |     551    |     549    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      22    |      30    |    1721 K  |    1721 K  |
|       from large pool |      15    |      22    |     258 K  |     258 K  |
|       from small pool |       7    |      15    |    1463 K  |    1463 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7949 GiB |   7949 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7946 GiB |   7946 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159591    |  159410    |
|       from large pool |     127    |     152    |  122513    |  122386    |
|       from small pool |      54    |      61    |   37078    |   37024    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159591    |  159410    |
|       from large pool |     127    |     152    |  122513    |  122386    |
|       from small pool |      54    |      61    |   37078    |   37024    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20156 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6852 GiB |   6852 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6850 GiB |   6849 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159591    |  159410    |
|       from large pool |     127    |     152    |  122513    |  122386    |
|       from small pool |      54    |      61    |   37078    |   37024    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159591    |  159410    |
|       from large pool |     127    |     152    |  122513    |  122386    |
|       from small pool |      54    |      61    |   37078    |   37024    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:06 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  25624 MiB |  19698 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  25620 MiB |  19696 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132064    |  131915    |
|       from large pool |     101    |     122    |   98711    |   98610    |
|       from small pool |      48    |      57    |   33353    |   33305    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132064    |  131915    |
|       from large pool |     101    |     122    |   98711    |   98610    |
|       from small pool |      48    |      57    |   33353    |   33305    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     301    |     199    |
|       from large pool |     101    |     120    |     299    |     198    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:06 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:33:07 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:33:07 | I | in layer model.layers.4
25-01-19 11:33:07 | I | quantizing weights for layer model.layers.4
25-01-19 11:33:09 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:09 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:10 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:11 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:11 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:33:11 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:33:14 | I |       - range scale = [    1.0000]
25-01-19 11:33:14 | I |         sum  error  = [   12.5361]
25-01-19 11:33:14 | I |         best error  = [   12.5361]
25-01-19 11:33:14 | I |     + error = [12.5361]
25-01-19 11:33:16 | I |       - range scale = [    1.0000]
25-01-19 11:33:16 | I |         sum  error  = [   21.5390]
25-01-19 11:33:16 | I |         best error  = [   21.5390]
25-01-19 11:33:16 | I |     + error = [21.5390]
25-01-19 11:33:16 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:33:18 | I |       - range scale = [    1.0000]
25-01-19 11:33:18 | I |         sum  error  = [   23.0379]
25-01-19 11:33:18 | I |         best error  = [   23.0379]
25-01-19 11:33:18 | I |     + error = [23.0379]
25-01-19 11:33:21 | I |       - range scale = [    1.0000]
25-01-19 11:33:21 | I |         sum  error  = [   38.9065]
25-01-19 11:33:21 | I |         best error  = [   38.9065]
25-01-19 11:33:21 | I |     + error = [38.9065]
25-01-19 11:33:21 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:33:22 | I |       - range scale = [    1.0000]
25-01-19 11:33:22 | I |         sum  error  = [    2.5873]
25-01-19 11:33:22 | I |         best error  = [    2.5873]
25-01-19 11:33:22 | I |     + error = [2.5873]
25-01-19 11:33:22 | I |       - range scale = [    1.0000]
25-01-19 11:33:22 | I |         sum  error  = [    3.5101]
25-01-19 11:33:22 | I |         best error  = [    3.5101]
25-01-19 11:33:22 | I |     + error = [3.5101]
25-01-19 11:33:23 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:33:23 | I |       - range scale = [    1.0000]
25-01-19 11:33:23 | I |         sum  error  = [    0.4635]
25-01-19 11:33:23 | I |         best error  = [    0.4635]
25-01-19 11:33:23 | I |     + error = [0.4635]
25-01-19 11:33:24 | I |       - range scale = [    1.0000]
25-01-19 11:33:24 | I |         sum  error  = [    0.6896]
25-01-19 11:33:24 | I |         best error  = [    0.6896]
25-01-19 11:33:24 | I |     + error = [0.6896]
25-01-19 11:33:24 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:33:25 | I |       - range scale = [    1.0000]
25-01-19 11:33:25 | I |         sum  error  = [    3.3700]
25-01-19 11:33:25 | I |         best error  = [    3.3700]
25-01-19 11:33:25 | I |     + error = [3.3700]
25-01-19 11:33:26 | I |       - range scale = [    1.0000]
25-01-19 11:33:26 | I |         sum  error  = [    4.7135]
25-01-19 11:33:26 | I |         best error  = [    4.7135]
25-01-19 11:33:26 | I |     + error = [4.7135]
25-01-19 11:33:26 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:33:27 | I |       - range scale = [    1.0000]
25-01-19 11:33:27 | I |         sum  error  = [    4.2298]
25-01-19 11:33:27 | I |         best error  = [    4.2298]
25-01-19 11:33:27 | I |     + error = [4.2298]
25-01-19 11:33:28 | I |       - range scale = [    1.0000]
25-01-19 11:33:28 | I |         sum  error  = [    5.4895]
25-01-19 11:33:28 | I |         best error  = [    5.4895]
25-01-19 11:33:28 | I |     + error = [5.4895]
25-01-19 11:33:29 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:33:29 | I |       - range scale = [    1.0000]
25-01-19 11:33:29 | I |         sum  error  = [    0.7264]
25-01-19 11:33:29 | I |         best error  = [    0.7264]
25-01-19 11:33:29 | I |     + error = [0.7264]
25-01-19 11:33:30 | I |       - range scale = [    1.0000]
25-01-19 11:33:30 | I |         sum  error  = [    0.9765]
25-01-19 11:33:30 | I |         best error  = [    0.9765]
25-01-19 11:33:30 | I |     + error = [0.9765]
25-01-19 11:33:31 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:33:33 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:33:36 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:33:38 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:33:41 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:33:43 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:33:46 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:33:52 | I | quantizing activations for layer model.layers.4
25-01-19 11:33:54 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:55 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:55 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:56 | I | collecting calibration activations in model.layers.4
25-01-19 11:33:58 | I | forward this layer
25-01-19 11:33:58 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/32.pt
25-01-19 11:33:58 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/32.pt
25-01-19 11:33:59 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:33:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 17           |        cudaMalloc retries: 17        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  36944 GiB |  36922 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  36742 GiB |  36720 GiB |
|       from small pool |      3 MiB |      5 MiB |    201 GiB |    201 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  36944 GiB |  36922 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  36742 GiB |  36720 GiB |
|       from small pool |      3 MiB |      5 MiB |    201 GiB |    201 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  36895 GiB |  36873 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  36694 GiB |  36672 GiB |
|       from small pool |      3 MiB |      5 MiB |    201 GiB |    201 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1137 GiB |   1115 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1136 GiB |   1113 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  18341 GiB |  18340 GiB |
|       from large pool |    835 MiB |   1905 MiB |  18107 GiB |  18106 GiB |
|       from small pool |      0 MiB |      4 MiB |    234 GiB |    234 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    4216 K  |    4216 K  |
|       from large pool |     185    |     200    |     668 K  |     668 K  |
|       from small pool |     109    |     115    |    3548 K  |    3548 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    4216 K  |    4216 K  |
|       from large pool |     185    |     200    |     668 K  |     668 K  |
|       from small pool |     109    |     115    |    3548 K  |    3548 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    2752    |    2579    |
|       from large pool |     171    |     173    |    2166    |    1995    |
|       from small pool |       2    |       3    |     586    |     584    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    1844 K  |    1844 K  |
|       from large pool |      17    |      22    |     272 K  |     272 K  |
|       from small pool |       8    |      15    |    1571 K  |    1571 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7949 GiB |   7949 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7947 GiB |   7947 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159611    |  159430    |
|       from large pool |     127    |     152    |  122527    |  122400    |
|       from small pool |      54    |      61    |   37084    |   37030    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159611    |  159430    |
|       from large pool |     127    |     152    |  122527    |  122400    |
|       from small pool |      54    |      61    |   37084    |   37030    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20163 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6852 GiB |   6852 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6850 GiB |   6850 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159611    |  159430    |
|       from large pool |     127    |     152    |  122527    |  122400    |
|       from small pool |      54    |      61    |   37084    |   37030    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159611    |  159430    |
|       from large pool |     127    |     152    |  122527    |  122400    |
|       from small pool |      54    |      61    |   37084    |   37030    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:59 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17353 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17353 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17345 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  25952 MiB |  20026 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  25948 MiB |  20024 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132084    |  131935    |
|       from large pool |     101    |     122    |   98725    |   98624    |
|       from small pool |      48    |      57    |   33359    |   33311    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132084    |  131935    |
|       from large pool |     101    |     122    |   98725    |   98624    |
|       from small pool |      48    |      57    |   33359    |   33311    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     311    |     209    |
|       from large pool |     101    |     120    |     309    |     208    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:33:59 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:33:59 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:33:59 | I | in layer model.layers.4
25-01-19 11:33:59 | I | quantizing weights for layer model.layers.4
25-01-19 11:34:01 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:02 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:03 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:03 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:04 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:34:04 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:34:07 | I |       - range scale = [    1.0000]
25-01-19 11:34:07 | I |         sum  error  = [   12.6908]
25-01-19 11:34:07 | I |         best error  = [   12.6908]
25-01-19 11:34:07 | I |     + error = [12.6908]
25-01-19 11:34:09 | I |       - range scale = [    1.0000]
25-01-19 11:34:09 | I |         sum  error  = [   21.4347]
25-01-19 11:34:09 | I |         best error  = [   21.4347]
25-01-19 11:34:09 | I |     + error = [21.4347]
25-01-19 11:34:09 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:34:11 | I |       - range scale = [    1.0000]
25-01-19 11:34:11 | I |         sum  error  = [   23.9515]
25-01-19 11:34:11 | I |         best error  = [   23.9515]
25-01-19 11:34:11 | I |     + error = [23.9515]
25-01-19 11:34:14 | I |       - range scale = [    1.0000]
25-01-19 11:34:14 | I |         sum  error  = [   39.4358]
25-01-19 11:34:14 | I |         best error  = [   39.4358]
25-01-19 11:34:14 | I |     + error = [39.4358]
25-01-19 11:34:14 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:34:15 | I |       - range scale = [    1.0000]
25-01-19 11:34:15 | I |         sum  error  = [    2.5555]
25-01-19 11:34:15 | I |         best error  = [    2.5555]
25-01-19 11:34:15 | I |     + error = [2.5555]
25-01-19 11:34:16 | I |       - range scale = [    1.0000]
25-01-19 11:34:16 | I |         sum  error  = [    3.4226]
25-01-19 11:34:16 | I |         best error  = [    3.4226]
25-01-19 11:34:16 | I |     + error = [3.4226]
25-01-19 11:34:16 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:34:16 | I |       - range scale = [    1.0000]
25-01-19 11:34:16 | I |         sum  error  = [    0.4703]
25-01-19 11:34:16 | I |         best error  = [    0.4703]
25-01-19 11:34:16 | I |     + error = [0.4703]
25-01-19 11:34:17 | I |       - range scale = [    1.0000]
25-01-19 11:34:17 | I |         sum  error  = [    0.6909]
25-01-19 11:34:17 | I |         best error  = [    0.6909]
25-01-19 11:34:17 | I |     + error = [0.6909]
25-01-19 11:34:17 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:34:18 | I |       - range scale = [    1.0000]
25-01-19 11:34:18 | I |         sum  error  = [    3.3236]
25-01-19 11:34:18 | I |         best error  = [    3.3236]
25-01-19 11:34:18 | I |     + error = [3.3236]
25-01-19 11:34:19 | I |       - range scale = [    1.0000]
25-01-19 11:34:19 | I |         sum  error  = [    4.6437]
25-01-19 11:34:19 | I |         best error  = [    4.6437]
25-01-19 11:34:19 | I |     + error = [4.6437]
25-01-19 11:34:20 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:34:20 | I |       - range scale = [    1.0000]
25-01-19 11:34:20 | I |         sum  error  = [    4.1914]
25-01-19 11:34:20 | I |         best error  = [    4.1914]
25-01-19 11:34:20 | I |     + error = [4.1914]
25-01-19 11:34:21 | I |       - range scale = [    1.0000]
25-01-19 11:34:21 | I |         sum  error  = [    5.3978]
25-01-19 11:34:21 | I |         best error  = [    5.3978]
25-01-19 11:34:21 | I |     + error = [5.3978]
25-01-19 11:34:22 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:34:22 | I |       - range scale = [    1.0000]
25-01-19 11:34:22 | I |         sum  error  = [    0.7239]
25-01-19 11:34:22 | I |         best error  = [    0.7239]
25-01-19 11:34:22 | I |     + error = [0.7239]
25-01-19 11:34:23 | I |       - range scale = [    1.0000]
25-01-19 11:34:23 | I |         sum  error  = [    0.9835]
25-01-19 11:34:23 | I |         best error  = [    0.9835]
25-01-19 11:34:23 | I |     + error = [0.9835]
25-01-19 11:34:24 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:34:26 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:34:29 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:34:31 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:34:34 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:34:36 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:34:39 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:34:45 | I | quantizing activations for layer model.layers.4
25-01-19 11:34:47 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:49 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:49 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:52 | I | forward this layer
25-01-19 11:34:52 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/34.pt
25-01-19 11:34:52 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/34.pt
25-01-19 11:34:52 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:34:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 18           |        cudaMalloc retries: 18        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  38917 GiB |  38895 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  38701 GiB |  38679 GiB |
|       from small pool |      3 MiB |      5 MiB |    216 GiB |    216 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  38917 GiB |  38895 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  38701 GiB |  38679 GiB |
|       from small pool |      3 MiB |      5 MiB |    216 GiB |    216 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  38865 GiB |  38843 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  38650 GiB |  38628 GiB |
|       from small pool |      3 MiB |      5 MiB |    215 GiB |    215 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1203 GiB |   1180 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1202 GiB |   1179 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  19361 GiB |  19360 GiB |
|       from large pool |    835 MiB |   1905 MiB |  19109 GiB |  19109 GiB |
|       from small pool |      0 MiB |      4 MiB |    251 GiB |    251 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    4522 K  |    4521 K  |
|       from large pool |     185    |     200    |     713 K  |     713 K  |
|       from small pool |     109    |     115    |    3808 K  |    3808 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    4522 K  |    4521 K  |
|       from large pool |     185    |     200    |     713 K  |     713 K  |
|       from small pool |     109    |     115    |    3808 K  |    3808 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    2899    |    2726    |
|       from large pool |     171    |     173    |    2278    |    2107    |
|       from small pool |       2    |       3    |     621    |     619    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |    1970 K  |    1970 K  |
|       from large pool |      18    |      22    |     287 K  |     287 K  |
|       from small pool |       8    |      15    |    1682 K  |    1682 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:34:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7949 GiB |   7949 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7947 GiB |   7947 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159631    |  159450    |
|       from large pool |     127    |     152    |  122541    |  122414    |
|       from small pool |      54    |      61    |   37090    |   37036    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159631    |  159450    |
|       from large pool |     127    |     152    |  122541    |  122414    |
|       from small pool |      54    |      61    |   37090    |   37036    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:34:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6853 GiB |   6852 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6850 GiB |   6850 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159631    |  159450    |
|       from large pool |     127    |     152    |  122541    |  122414    |
|       from small pool |      54    |      61    |   37090    |   37036    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159631    |  159450    |
|       from large pool |     127    |     152    |  122541    |  122414    |
|       from small pool |      54    |      61    |   37090    |   37036    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:34:52 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17351 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  26280 MiB |  20354 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  26276 MiB |  20352 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132104    |  131955    |
|       from large pool |     101    |     122    |   98739    |   98638    |
|       from small pool |      48    |      57    |   33365    |   33317    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132104    |  131955    |
|       from large pool |     101    |     122    |   98739    |   98638    |
|       from small pool |      48    |      57    |   33365    |   33317    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     321    |     219    |
|       from large pool |     101    |     120    |     319    |     218    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:34:52 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:34:52 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:34:52 | I | in layer model.layers.4
25-01-19 11:34:52 | I | quantizing weights for layer model.layers.4
25-01-19 11:34:55 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:55 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:56 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:57 | I | collecting calibration activations in model.layers.4
25-01-19 11:34:58 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:34:58 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:35:00 | I |       - range scale = [    1.0000]
25-01-19 11:35:00 | I |         sum  error  = [   12.7180]
25-01-19 11:35:00 | I |         best error  = [   12.7180]
25-01-19 11:35:00 | I |     + error = [12.7180]
25-01-19 11:35:02 | I |       - range scale = [    1.0000]
25-01-19 11:35:02 | I |         sum  error  = [   21.7391]
25-01-19 11:35:02 | I |         best error  = [   21.7391]
25-01-19 11:35:02 | I |     + error = [21.7391]
25-01-19 11:35:03 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:35:05 | I |       - range scale = [    1.0000]
25-01-19 11:35:05 | I |         sum  error  = [   23.9780]
25-01-19 11:35:05 | I |         best error  = [   23.9780]
25-01-19 11:35:05 | I |     + error = [23.9780]
25-01-19 11:35:08 | I |       - range scale = [    1.0000]
25-01-19 11:35:08 | I |         sum  error  = [   40.9148]
25-01-19 11:35:08 | I |         best error  = [   40.9148]
25-01-19 11:35:08 | I |     + error = [40.9148]
25-01-19 11:35:08 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:35:08 | I |       - range scale = [    1.0000]
25-01-19 11:35:08 | I |         sum  error  = [    2.5652]
25-01-19 11:35:08 | I |         best error  = [    2.5652]
25-01-19 11:35:08 | I |     + error = [2.5652]
25-01-19 11:35:09 | I |       - range scale = [    1.0000]
25-01-19 11:35:09 | I |         sum  error  = [    3.4223]
25-01-19 11:35:09 | I |         best error  = [    3.4223]
25-01-19 11:35:09 | I |     + error = [3.4223]
25-01-19 11:35:10 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:35:10 | I |       - range scale = [    1.0000]
25-01-19 11:35:10 | I |         sum  error  = [    0.4728]
25-01-19 11:35:10 | I |         best error  = [    0.4728]
25-01-19 11:35:10 | I |     + error = [0.4728]
25-01-19 11:35:11 | I |       - range scale = [    1.0000]
25-01-19 11:35:11 | I |         sum  error  = [    0.6893]
25-01-19 11:35:11 | I |         best error  = [    0.6893]
25-01-19 11:35:11 | I |     + error = [0.6893]
25-01-19 11:35:11 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:35:12 | I |       - range scale = [    1.0000]
25-01-19 11:35:12 | I |         sum  error  = [    3.3403]
25-01-19 11:35:12 | I |         best error  = [    3.3403]
25-01-19 11:35:12 | I |     + error = [3.3403]
25-01-19 11:35:13 | I |       - range scale = [    1.0000]
25-01-19 11:35:13 | I |         sum  error  = [    4.6058]
25-01-19 11:35:13 | I |         best error  = [    4.6058]
25-01-19 11:35:13 | I |     + error = [4.6058]
25-01-19 11:35:13 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:35:14 | I |       - range scale = [    1.0000]
25-01-19 11:35:14 | I |         sum  error  = [    4.1988]
25-01-19 11:35:14 | I |         best error  = [    4.1988]
25-01-19 11:35:14 | I |     + error = [4.1988]
25-01-19 11:35:15 | I |       - range scale = [    1.0000]
25-01-19 11:35:15 | I |         sum  error  = [    5.3523]
25-01-19 11:35:15 | I |         best error  = [    5.3523]
25-01-19 11:35:15 | I |     + error = [5.3523]
25-01-19 11:35:16 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:35:16 | I |       - range scale = [    1.0000]
25-01-19 11:35:16 | I |         sum  error  = [    0.7327]
25-01-19 11:35:16 | I |         best error  = [    0.7327]
25-01-19 11:35:16 | I |     + error = [0.7327]
25-01-19 11:35:17 | I |       - range scale = [    1.0000]
25-01-19 11:35:17 | I |         sum  error  = [    0.9713]
25-01-19 11:35:17 | I |         best error  = [    0.9713]
25-01-19 11:35:17 | I |     + error = [0.9713]
25-01-19 11:35:18 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:35:20 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:35:23 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:35:25 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:35:28 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:35:30 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:35:33 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:35:39 | I | quantizing activations for layer model.layers.4
25-01-19 11:35:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:42 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:43 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:43 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:46 | I | forward this layer
25-01-19 11:35:46 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/36.pt
25-01-19 11:35:46 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/36.pt
25-01-19 11:35:46 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:35:46 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 19           |        cudaMalloc retries: 19        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  40976 GiB |  40954 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  40745 GiB |  40723 GiB |
|       from small pool |      3 MiB |      5 MiB |    231 GiB |    231 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  40976 GiB |  40954 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  40745 GiB |  40723 GiB |
|       from small pool |      3 MiB |      5 MiB |    231 GiB |    231 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  40921 GiB |  40899 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  40691 GiB |  40669 GiB |
|       from small pool |      3 MiB |      5 MiB |    230 GiB |    230 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1270 GiB |   1247 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1269 GiB |   1246 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  20441 GiB |  20441 GiB |
|       from large pool |    835 MiB |   1905 MiB |  20173 GiB |  20172 GiB |
|       from small pool |      0 MiB |      4 MiB |    268 GiB |    268 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    4834 K  |    4834 K  |
|       from large pool |     185    |     200    |     759 K  |     759 K  |
|       from small pool |     109    |     115    |    4074 K  |    4074 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    4834 K  |    4834 K  |
|       from large pool |     185    |     200    |     759 K  |     759 K  |
|       from small pool |     109    |     115    |    4074 K  |    4074 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    3051    |    2878    |
|       from large pool |     171    |     173    |    2395    |    2224    |
|       from small pool |       2    |       3    |     656    |     654    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    2098 K  |    2098 K  |
|       from large pool |      17    |      22    |     302 K  |     302 K  |
|       from small pool |       8    |      15    |    1795 K  |    1795 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:35:46 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7950 GiB |   7950 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7947 GiB |   7947 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159651    |  159470    |
|       from large pool |     127    |     152    |  122555    |  122428    |
|       from small pool |      54    |      61    |   37096    |   37042    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159651    |  159470    |
|       from large pool |     127    |     152    |  122555    |  122428    |
|       from small pool |      54    |      61    |   37096    |   37042    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:35:46 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20157 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6853 GiB |   6853 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6851 GiB |   6850 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159651    |  159470    |
|       from large pool |     127    |     152    |  122555    |  122428    |
|       from small pool |      54    |      61    |   37096    |   37042    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159651    |  159470    |
|       from large pool |     127    |     152    |  122555    |  122428    |
|       from small pool |      54    |      61    |   37096    |   37042    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:35:46 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  26608 MiB |  20682 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  26604 MiB |  20680 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132124    |  131975    |
|       from large pool |     101    |     122    |   98753    |   98652    |
|       from small pool |      48    |      57    |   33371    |   33323    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132124    |  131975    |
|       from large pool |     101    |     122    |   98753    |   98652    |
|       from small pool |      48    |      57    |   33371    |   33323    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     331    |     229    |
|       from large pool |     101    |     120    |     329    |     228    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:35:46 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:35:47 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:35:47 | I | in layer model.layers.4
25-01-19 11:35:47 | I | quantizing weights for layer model.layers.4
25-01-19 11:35:49 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:50 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:50 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:51 | I | collecting calibration activations in model.layers.4
25-01-19 11:35:52 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:35:52 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:35:55 | I |       - range scale = [    1.0000]
25-01-19 11:35:55 | I |         sum  error  = [   12.8088]
25-01-19 11:35:55 | I |         best error  = [   12.8088]
25-01-19 11:35:55 | I |     + error = [12.8088]
25-01-19 11:35:57 | I |       - range scale = [    1.0000]
25-01-19 11:35:57 | I |         sum  error  = [   21.8876]
25-01-19 11:35:57 | I |         best error  = [   21.8876]
25-01-19 11:35:57 | I |     + error = [21.8876]
25-01-19 11:35:57 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:36:00 | I |       - range scale = [    1.0000]
25-01-19 11:36:00 | I |         sum  error  = [   23.8174]
25-01-19 11:36:00 | I |         best error  = [   23.8174]
25-01-19 11:36:00 | I |     + error = [23.8174]
25-01-19 11:36:02 | I |       - range scale = [    1.0000]
25-01-19 11:36:02 | I |         sum  error  = [   39.5228]
25-01-19 11:36:02 | I |         best error  = [   39.5228]
25-01-19 11:36:02 | I |     + error = [39.5228]
25-01-19 11:36:03 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:36:03 | I |       - range scale = [    1.0000]
25-01-19 11:36:03 | I |         sum  error  = [    2.5629]
25-01-19 11:36:03 | I |         best error  = [    2.5629]
25-01-19 11:36:03 | I |     + error = [2.5629]
25-01-19 11:36:04 | I |       - range scale = [    1.0000]
25-01-19 11:36:04 | I |         sum  error  = [    3.4018]
25-01-19 11:36:04 | I |         best error  = [    3.4018]
25-01-19 11:36:04 | I |     + error = [3.4018]
25-01-19 11:36:04 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:36:05 | I |       - range scale = [    1.0000]
25-01-19 11:36:05 | I |         sum  error  = [    0.4742]
25-01-19 11:36:05 | I |         best error  = [    0.4742]
25-01-19 11:36:05 | I |     + error = [0.4742]
25-01-19 11:36:06 | I |       - range scale = [    1.0000]
25-01-19 11:36:06 | I |         sum  error  = [    0.6921]
25-01-19 11:36:06 | I |         best error  = [    0.6921]
25-01-19 11:36:06 | I |     + error = [0.6921]
25-01-19 11:36:06 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:36:07 | I |       - range scale = [    1.0000]
25-01-19 11:36:07 | I |         sum  error  = [    3.3339]
25-01-19 11:36:07 | I |         best error  = [    3.3339]
25-01-19 11:36:07 | I |     + error = [3.3339]
25-01-19 11:36:08 | I |       - range scale = [    1.0000]
25-01-19 11:36:08 | I |         sum  error  = [    4.5524]
25-01-19 11:36:08 | I |         best error  = [    4.5524]
25-01-19 11:36:08 | I |     + error = [4.5524]
25-01-19 11:36:08 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:36:09 | I |       - range scale = [    1.0000]
25-01-19 11:36:09 | I |         sum  error  = [    4.1907]
25-01-19 11:36:09 | I |         best error  = [    4.1907]
25-01-19 11:36:09 | I |     + error = [4.1907]
25-01-19 11:36:10 | I |       - range scale = [    1.0000]
25-01-19 11:36:10 | I |         sum  error  = [    5.3154]
25-01-19 11:36:10 | I |         best error  = [    5.3154]
25-01-19 11:36:10 | I |     + error = [5.3154]
25-01-19 11:36:10 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:36:11 | I |       - range scale = [    1.0000]
25-01-19 11:36:11 | I |         sum  error  = [    0.7172]
25-01-19 11:36:11 | I |         best error  = [    0.7172]
25-01-19 11:36:11 | I |     + error = [0.7172]
25-01-19 11:36:12 | I |       - range scale = [    1.0000]
25-01-19 11:36:12 | I |         sum  error  = [    0.9498]
25-01-19 11:36:12 | I |         best error  = [    0.9498]
25-01-19 11:36:12 | I |     + error = [0.9498]
25-01-19 11:36:12 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:36:15 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:36:17 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:36:20 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:36:22 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:36:25 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:36:27 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:36:34 | I | quantizing activations for layer model.layers.4
25-01-19 11:36:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:41 | I | forward this layer
25-01-19 11:36:41 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/38.pt
25-01-19 11:36:41 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/38.pt
25-01-19 11:36:41 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 80.94 MiB is free. Process 29960 has 23.61 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 748.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:36:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 20           |        cudaMalloc retries: 20        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  23267 MiB |  43121 GiB |  43098 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  42874 GiB |  42852 GiB |
|       from small pool |      3 MiB |      5 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  23267 MiB |  43121 GiB |  43098 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  42874 GiB |  42852 GiB |
|       from small pool |      3 MiB |      5 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  23267 MiB |  43063 GiB |  43041 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  42818 GiB |  42795 GiB |
|       from small pool |      3 MiB |      5 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23696 MiB |  23750 MiB |   1334 GiB |   1311 GiB |
|       from large pool |  23692 MiB |  23744 MiB |   1333 GiB |   1310 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 766350 KiB |   1907 MiB |  21847 GiB |  21846 GiB |
|       from large pool | 765824 KiB |   1905 MiB |  21561 GiB |  21560 GiB |
|       from small pool |    526 KiB |      4 MiB |    286 GiB |    286 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    5154 K  |    5154 K  |
|       from large pool |     186    |     200    |     807 K  |     807 K  |
|       from small pool |     109    |     115    |    4346 K  |    4346 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    5154 K  |    5154 K  |
|       from large pool |     186    |     200    |     807 K  |     807 K  |
|       from small pool |     109    |     115    |    4346 K  |    4346 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    3193    |    3020    |
|       from large pool |     171    |     173    |    2502    |    2331    |
|       from small pool |       2    |       3    |     691    |     689    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    2229 K  |    2229 K  |
|       from large pool |      17    |      22    |     319 K  |     319 K  |
|       from small pool |       8    |      15    |    1910 K  |    1910 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:36:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7950 GiB |   7950 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7948 GiB |   7948 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159671    |  159490    |
|       from large pool |     127    |     152    |  122569    |  122442    |
|       from small pool |      54    |      61    |   37102    |   37048    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159671    |  159490    |
|       from large pool |     127    |     152    |  122569    |  122442    |
|       from small pool |      54    |      61    |   37102    |   37048    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:36:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20164 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6853 GiB |   6853 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6851 GiB |   6851 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159671    |  159490    |
|       from large pool |     127    |     152    |  122569    |  122442    |
|       from small pool |      54    |      61    |   37102    |   37048    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159671    |  159490    |
|       from large pool |     127    |     152    |  122569    |  122442    |
|       from small pool |      54    |      61    |   37102    |   37048    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:36:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17354 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17354 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  26936 MiB |  21010 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  26932 MiB |  21008 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132144    |  131995    |
|       from large pool |     101    |     122    |   98767    |   98666    |
|       from small pool |      48    |      57    |   33377    |   33329    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132144    |  131995    |
|       from large pool |     101    |     122    |   98767    |   98666    |
|       from small pool |      48    |      57    |   33377    |   33329    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     341    |     239    |
|       from large pool |     101    |     120    |     339    |     238    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:36:41 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:36:41 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:36:41 | I | in layer model.layers.4
25-01-19 11:36:41 | I | quantizing weights for layer model.layers.4
25-01-19 11:36:44 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:45 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:45 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:46 | I | collecting calibration activations in model.layers.4
25-01-19 11:36:47 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:36:47 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:36:50 | I |       - range scale = [    1.0000]
25-01-19 11:36:50 | I |         sum  error  = [   13.5301]
25-01-19 11:36:50 | I |         best error  = [   13.5301]
25-01-19 11:36:50 | I |     + error = [13.5301]
25-01-19 11:36:52 | I |       - range scale = [    1.0000]
25-01-19 11:36:52 | I |         sum  error  = [   23.6558]
25-01-19 11:36:52 | I |         best error  = [   23.6558]
25-01-19 11:36:52 | I |     + error = [23.6558]
25-01-19 11:36:53 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:36:55 | I |       - range scale = [    1.0000]
25-01-19 11:36:55 | I |         sum  error  = [   25.2625]
25-01-19 11:36:55 | I |         best error  = [   25.2625]
25-01-19 11:36:55 | I |     + error = [25.2625]
25-01-19 11:36:58 | I |       - range scale = [    1.0000]
25-01-19 11:36:58 | I |         sum  error  = [   45.2187]
25-01-19 11:36:58 | I |         best error  = [   45.2187]
25-01-19 11:36:58 | I |     + error = [45.2187]
25-01-19 11:36:58 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:36:59 | I |       - range scale = [    1.0000]
25-01-19 11:36:59 | I |         sum  error  = [    2.6269]
25-01-19 11:36:59 | I |         best error  = [    2.6269]
25-01-19 11:36:59 | I |     + error = [2.6269]
25-01-19 11:37:00 | I |       - range scale = [    1.0000]
25-01-19 11:37:00 | I |         sum  error  = [    3.4949]
25-01-19 11:37:00 | I |         best error  = [    3.4949]
25-01-19 11:37:00 | I |     + error = [3.4949]
25-01-19 11:37:00 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:37:00 | I |       - range scale = [    1.0000]
25-01-19 11:37:00 | I |         sum  error  = [    0.4819]
25-01-19 11:37:00 | I |         best error  = [    0.4819]
25-01-19 11:37:00 | I |     + error = [0.4819]
25-01-19 11:37:01 | I |       - range scale = [    1.0000]
25-01-19 11:37:01 | I |         sum  error  = [    0.7099]
25-01-19 11:37:01 | I |         best error  = [    0.7099]
25-01-19 11:37:01 | I |     + error = [0.7099]
25-01-19 11:37:02 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:37:02 | I |       - range scale = [    1.0000]
25-01-19 11:37:02 | I |         sum  error  = [    3.4535]
25-01-19 11:37:02 | I |         best error  = [    3.4535]
25-01-19 11:37:02 | I |     + error = [3.4535]
25-01-19 11:37:03 | I |       - range scale = [    1.0000]
25-01-19 11:37:03 | I |         sum  error  = [    4.7202]
25-01-19 11:37:03 | I |         best error  = [    4.7202]
25-01-19 11:37:03 | I |     + error = [4.7202]
25-01-19 11:37:04 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:37:04 | I |       - range scale = [    1.0000]
25-01-19 11:37:04 | I |         sum  error  = [    4.2878]
25-01-19 11:37:04 | I |         best error  = [    4.2878]
25-01-19 11:37:04 | I |     + error = [4.2878]
25-01-19 11:37:05 | I |       - range scale = [    1.0000]
25-01-19 11:37:05 | I |         sum  error  = [    5.4964]
25-01-19 11:37:05 | I |         best error  = [    5.4964]
25-01-19 11:37:05 | I |     + error = [5.4964]
25-01-19 11:37:06 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:37:06 | I |       - range scale = [    1.0000]
25-01-19 11:37:06 | I |         sum  error  = [    0.7304]
25-01-19 11:37:06 | I |         best error  = [    0.7304]
25-01-19 11:37:06 | I |     + error = [0.7304]
25-01-19 11:37:08 | I |       - range scale = [    1.0000]
25-01-19 11:37:08 | I |         sum  error  = [    0.9756]
25-01-19 11:37:08 | I |         best error  = [    0.9756]
25-01-19 11:37:08 | I |     + error = [0.9756]
25-01-19 11:37:08 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:37:10 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:37:13 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:37:15 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:37:18 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:37:20 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:37:23 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:37:29 | I | quantizing activations for layer model.layers.4
25-01-19 11:37:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:34 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:37 | I | forward this layer
25-01-19 11:37:37 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/40.pt
25-01-19 11:37:37 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/40.pt
25-01-19 11:37:37 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 28.94 MiB is free. Process 29960 has 23.66 GiB memory in use. Of the allocated memory 22.66 GiB is allocated by PyTorch, and 544.19 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:37:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 21           |        cudaMalloc retries: 21        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  23203 MiB |  23267 MiB |  45351 GiB |  45329 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  45089 GiB |  45067 GiB |
|       from small pool |      3 MiB |      5 MiB |    261 GiB |    261 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  23203 MiB |  23267 MiB |  45351 GiB |  45329 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  45089 GiB |  45067 GiB |
|       from small pool |      3 MiB |      5 MiB |    261 GiB |    261 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  23203 MiB |  23267 MiB |  45291 GiB |  45269 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  45031 GiB |  45008 GiB |
|       from small pool |      3 MiB |      5 MiB |    260 GiB |    260 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23748 MiB |  23750 MiB |   1404 GiB |   1380 GiB |
|       from large pool |  23744 MiB |  23744 MiB |   1402 GiB |   1379 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 557246 KiB |   1907 MiB |  23442 GiB |  23441 GiB |
|       from large pool | 556928 KiB |   1905 MiB |  23138 GiB |  23137 GiB |
|       from small pool |    318 KiB |      4 MiB |    304 GiB |    304 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     300    |     305    |    5481 K  |    5481 K  |
|       from large pool |     187    |     200    |     856 K  |     856 K  |
|       from small pool |     113    |     115    |    4625 K  |    4624 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     300    |     305    |    5481 K  |    5481 K  |
|       from large pool |     187    |     200    |     856 K  |     856 K  |
|       from small pool |     113    |     115    |    4625 K  |    4624 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     176    |    3360    |    3185    |
|       from large pool |     173    |     173    |    2634    |    2461    |
|       from small pool |       2    |       3    |     726    |     724    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      22    |      30    |    2363 K  |    2363 K  |
|       from large pool |      15    |      22    |     335 K  |     335 K  |
|       from small pool |       7    |      15    |    2027 K  |    2027 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:37:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7950 GiB |   7950 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7948 GiB |   7948 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159691    |  159510    |
|       from large pool |     127    |     152    |  122583    |  122456    |
|       from small pool |      54    |      61    |   37108    |   37054    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159691    |  159510    |
|       from large pool |     127    |     152    |  122583    |  122456    |
|       from small pool |      54    |      61    |   37108    |   37054    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:37:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6854 GiB |   6853 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6851 GiB |   6851 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159691    |  159510    |
|       from large pool |     127    |     152    |  122583    |  122456    |
|       from small pool |      54    |      61    |   37108    |   37054    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159691    |  159510    |
|       from large pool |     127    |     152    |  122583    |  122456    |
|       from small pool |      54    |      61    |   37108    |   37054    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:37:37 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17352 GiB |  17346 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  27264 MiB |  21338 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  27260 MiB |  21336 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132164    |  132015    |
|       from large pool |     101    |     122    |   98781    |   98680    |
|       from small pool |      48    |      57    |   33383    |   33335    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132164    |  132015    |
|       from large pool |     101    |     122    |   98781    |   98680    |
|       from small pool |      48    |      57    |   33383    |   33335    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     351    |     249    |
|       from large pool |     101    |     120    |     349    |     248    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:37:37 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:37:37 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:37:37 | I | in layer model.layers.4
25-01-19 11:37:37 | I | quantizing weights for layer model.layers.4
25-01-19 11:37:40 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:42 | I | collecting calibration activations in model.layers.4
25-01-19 11:37:43 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:37:43 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:37:46 | I |       - range scale = [    1.0000]
25-01-19 11:37:46 | I |         sum  error  = [   14.1484]
25-01-19 11:37:46 | I |         best error  = [   14.1484]
25-01-19 11:37:46 | I |     + error = [14.1484]
25-01-19 11:37:48 | I |       - range scale = [    1.0000]
25-01-19 11:37:48 | I |         sum  error  = [   24.7820]
25-01-19 11:37:48 | I |         best error  = [   24.7820]
25-01-19 11:37:48 | I |     + error = [24.7820]
25-01-19 11:37:49 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:37:51 | I |       - range scale = [    1.0000]
25-01-19 11:37:51 | I |         sum  error  = [   26.2117]
25-01-19 11:37:51 | I |         best error  = [   26.2117]
25-01-19 11:37:51 | I |     + error = [26.2117]
25-01-19 11:37:54 | I |       - range scale = [    1.0000]
25-01-19 11:37:54 | I |         sum  error  = [   44.9908]
25-01-19 11:37:54 | I |         best error  = [   44.9908]
25-01-19 11:37:54 | I |     + error = [44.9908]
25-01-19 11:37:54 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:37:55 | I |       - range scale = [    1.0000]
25-01-19 11:37:55 | I |         sum  error  = [    2.5833]
25-01-19 11:37:55 | I |         best error  = [    2.5833]
25-01-19 11:37:55 | I |     + error = [2.5833]
25-01-19 11:37:56 | I |       - range scale = [    1.0000]
25-01-19 11:37:56 | I |         sum  error  = [    3.4070]
25-01-19 11:37:56 | I |         best error  = [    3.4070]
25-01-19 11:37:56 | I |     + error = [3.4070]
25-01-19 11:37:56 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:37:57 | I |       - range scale = [    1.0000]
25-01-19 11:37:57 | I |         sum  error  = [    0.5162]
25-01-19 11:37:57 | I |         best error  = [    0.5162]
25-01-19 11:37:57 | I |     + error = [0.5162]
25-01-19 11:37:58 | I |       - range scale = [    1.0000]
25-01-19 11:37:58 | I |         sum  error  = [    0.7526]
25-01-19 11:37:58 | I |         best error  = [    0.7526]
25-01-19 11:37:58 | I |     + error = [0.7526]
25-01-19 11:37:58 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:37:59 | I |       - range scale = [    1.0000]
25-01-19 11:37:59 | I |         sum  error  = [    3.3780]
25-01-19 11:37:59 | I |         best error  = [    3.3780]
25-01-19 11:37:59 | I |     + error = [3.3780]
25-01-19 11:38:00 | I |       - range scale = [    1.0000]
25-01-19 11:38:00 | I |         sum  error  = [    4.5535]
25-01-19 11:38:00 | I |         best error  = [    4.5535]
25-01-19 11:38:00 | I |     + error = [4.5535]
25-01-19 11:38:00 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:38:01 | I |       - range scale = [    1.0000]
25-01-19 11:38:01 | I |         sum  error  = [    4.2510]
25-01-19 11:38:01 | I |         best error  = [    4.2510]
25-01-19 11:38:01 | I |     + error = [4.2510]
25-01-19 11:38:02 | I |       - range scale = [    1.0000]
25-01-19 11:38:02 | I |         sum  error  = [    5.3062]
25-01-19 11:38:02 | I |         best error  = [    5.3062]
25-01-19 11:38:02 | I |     + error = [5.3062]
25-01-19 11:38:02 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:38:03 | I |       - range scale = [    1.0000]
25-01-19 11:38:03 | I |         sum  error  = [    0.7548]
25-01-19 11:38:03 | I |         best error  = [    0.7548]
25-01-19 11:38:03 | I |     + error = [0.7548]
25-01-19 11:38:04 | I |       - range scale = [    1.0000]
25-01-19 11:38:04 | I |         sum  error  = [    0.9748]
25-01-19 11:38:04 | I |         best error  = [    0.9748]
25-01-19 11:38:04 | I |     + error = [0.9748]
25-01-19 11:38:05 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:38:07 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:38:10 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:38:12 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:38:15 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:38:17 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:38:20 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:38:26 | I | quantizing activations for layer model.layers.4
25-01-19 11:38:29 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:31 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:34 | I | forward this layer
25-01-19 11:38:34 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/42.pt
25-01-19 11:38:34 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/42.pt
25-01-19 11:38:34 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:38:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 22           |        cudaMalloc retries: 22        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  47666 GiB |  47644 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  47389 GiB |  47366 GiB |
|       from small pool |      3 MiB |      5 MiB |    277 GiB |    277 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  47666 GiB |  47644 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  47389 GiB |  47366 GiB |
|       from small pool |      3 MiB |      5 MiB |    277 GiB |    277 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  47604 GiB |  47581 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  47327 GiB |  47305 GiB |
|       from small pool |      3 MiB |      5 MiB |    276 GiB |    276 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1469 GiB |   1446 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1468 GiB |   1445 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  25091 GiB |  25090 GiB |
|       from large pool |    835 MiB |   1905 MiB |  24768 GiB |  24767 GiB |
|       from small pool |      0 MiB |      4 MiB |    322 GiB |    322 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    5816 K  |    5815 K  |
|       from large pool |     185    |     200    |     907 K  |     906 K  |
|       from small pool |     109    |     115    |    4909 K  |    4908 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    5816 K  |    5815 K  |
|       from large pool |     185    |     200    |     907 K  |     906 K  |
|       from small pool |     109    |     115    |    4909 K  |    4908 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    3507    |    3334    |
|       from large pool |     171    |     173    |    2746    |    2575    |
|       from small pool |       2    |       3    |     761    |     759    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    2497 K  |    2497 K  |
|       from large pool |      17    |      22    |     350 K  |     350 K  |
|       from small pool |       8    |      15    |    2146 K  |    2146 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:38:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7951 GiB |   7950 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7948 GiB |   7948 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159711    |  159530    |
|       from large pool |     127    |     152    |  122597    |  122470    |
|       from small pool |      54    |      61    |   37114    |   37060    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159711    |  159530    |
|       from large pool |     127    |     152    |  122597    |  122470    |
|       from small pool |      54    |      61    |   37114    |   37060    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:38:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20158 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6854 GiB |   6854 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6852 GiB |   6851 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159711    |  159530    |
|       from large pool |     127    |     152    |  122597    |  122470    |
|       from small pool |      54    |      61    |   37114    |   37060    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159711    |  159530    |
|       from large pool |     127    |     152    |  122597    |  122470    |
|       from small pool |      54    |      61    |   37114    |   37060    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:38:34 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  27592 MiB |  21666 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  27588 MiB |  21664 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132184    |  132035    |
|       from large pool |     101    |     122    |   98795    |   98694    |
|       from small pool |      48    |      57    |   33389    |   33341    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132184    |  132035    |
|       from large pool |     101    |     122    |   98795    |   98694    |
|       from small pool |      48    |      57    |   33389    |   33341    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     361    |     259    |
|       from large pool |     101    |     120    |     359    |     258    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:38:34 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:38:34 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:38:34 | I | in layer model.layers.4
25-01-19 11:38:34 | I | quantizing weights for layer model.layers.4
25-01-19 11:38:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:39 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:39 | I | collecting calibration activations in model.layers.4
25-01-19 11:38:40 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:38:40 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:38:43 | I |       - range scale = [    1.0000]
25-01-19 11:38:43 | I |         sum  error  = [   14.3420]
25-01-19 11:38:43 | I |         best error  = [   14.3420]
25-01-19 11:38:43 | I |     + error = [14.3420]
25-01-19 11:38:46 | I |       - range scale = [    1.0000]
25-01-19 11:38:46 | I |         sum  error  = [   24.0330]
25-01-19 11:38:46 | I |         best error  = [   24.0330]
25-01-19 11:38:46 | I |     + error = [24.0330]
25-01-19 11:38:46 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:38:49 | I |       - range scale = [    1.0000]
25-01-19 11:38:49 | I |         sum  error  = [   26.8250]
25-01-19 11:38:49 | I |         best error  = [   26.8250]
25-01-19 11:38:49 | I |     + error = [26.8250]
25-01-19 11:38:52 | I |       - range scale = [    1.0000]
25-01-19 11:38:52 | I |         sum  error  = [   43.8372]
25-01-19 11:38:52 | I |         best error  = [   43.8372]
25-01-19 11:38:52 | I |     + error = [43.8372]
25-01-19 11:38:52 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:38:53 | I |       - range scale = [    1.0000]
25-01-19 11:38:53 | I |         sum  error  = [    2.6163]
25-01-19 11:38:53 | I |         best error  = [    2.6163]
25-01-19 11:38:53 | I |     + error = [2.6163]
25-01-19 11:38:54 | I |       - range scale = [    1.0000]
25-01-19 11:38:54 | I |         sum  error  = [    3.4102]
25-01-19 11:38:54 | I |         best error  = [    3.4102]
25-01-19 11:38:54 | I |     + error = [3.4102]
25-01-19 11:38:54 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:38:54 | I |       - range scale = [    1.0000]
25-01-19 11:38:54 | I |         sum  error  = [    0.5160]
25-01-19 11:38:54 | I |         best error  = [    0.5160]
25-01-19 11:38:54 | I |     + error = [0.5160]
25-01-19 11:38:55 | I |       - range scale = [    1.0000]
25-01-19 11:38:55 | I |         sum  error  = [    0.7543]
25-01-19 11:38:55 | I |         best error  = [    0.7543]
25-01-19 11:38:55 | I |     + error = [0.7543]
25-01-19 11:38:55 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:38:56 | I |       - range scale = [    1.0000]
25-01-19 11:38:56 | I |         sum  error  = [    3.3853]
25-01-19 11:38:56 | I |         best error  = [    3.3853]
25-01-19 11:38:56 | I |     + error = [3.3853]
25-01-19 11:38:57 | I |       - range scale = [    1.0000]
25-01-19 11:38:57 | I |         sum  error  = [    4.5412]
25-01-19 11:38:57 | I |         best error  = [    4.5412]
25-01-19 11:38:57 | I |     + error = [4.5412]
25-01-19 11:38:58 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:38:58 | I |       - range scale = [    1.0000]
25-01-19 11:38:58 | I |         sum  error  = [    4.2620]
25-01-19 11:38:58 | I |         best error  = [    4.2620]
25-01-19 11:38:58 | I |     + error = [4.2620]
25-01-19 11:38:59 | I |       - range scale = [    1.0000]
25-01-19 11:38:59 | I |         sum  error  = [    5.3154]
25-01-19 11:38:59 | I |         best error  = [    5.3154]
25-01-19 11:38:59 | I |     + error = [5.3154]
25-01-19 11:39:00 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:39:00 | I |       - range scale = [    1.0000]
25-01-19 11:39:00 | I |         sum  error  = [    0.7390]
25-01-19 11:39:00 | I |         best error  = [    0.7390]
25-01-19 11:39:00 | I |     + error = [0.7390]
25-01-19 11:39:01 | I |       - range scale = [    1.0000]
25-01-19 11:39:01 | I |         sum  error  = [    0.9668]
25-01-19 11:39:01 | I |         best error  = [    0.9668]
25-01-19 11:39:01 | I |     + error = [0.9668]
25-01-19 11:39:02 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:39:04 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:39:07 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:39:09 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:39:12 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:39:14 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:39:17 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:39:23 | I | quantizing activations for layer model.layers.4
25-01-19 11:39:26 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:27 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:28 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:28 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:31 | I | forward this layer
25-01-19 11:39:31 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/44.pt
25-01-19 11:39:31 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/44.pt
25-01-19 11:39:31 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:39:31 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 23           |        cudaMalloc retries: 23        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  50066 GiB |  50044 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  49773 GiB |  49751 GiB |
|       from small pool |      3 MiB |      5 MiB |    293 GiB |    293 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  50066 GiB |  50044 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  49773 GiB |  49751 GiB |
|       from small pool |      3 MiB |      5 MiB |    293 GiB |    293 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  50001 GiB |  49979 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  49709 GiB |  49686 GiB |
|       from small pool |      3 MiB |      5 MiB |    292 GiB |    292 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1535 GiB |   1512 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1534 GiB |   1511 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  26363 GiB |  26362 GiB |
|       from large pool |    835 MiB |   1905 MiB |  26021 GiB |  26020 GiB |
|       from small pool |      0 MiB |      4 MiB |    341 GiB |    341 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    6157 K  |    6157 K  |
|       from large pool |     185    |     200    |     958 K  |     958 K  |
|       from small pool |     109    |     115    |    5198 K  |    5198 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    6157 K  |    6157 K  |
|       from large pool |     185    |     200    |     958 K  |     958 K  |
|       from small pool |     109    |     115    |    5198 K  |    5198 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    3654    |    3481    |
|       from large pool |     171    |     173    |    2858    |    2687    |
|       from small pool |       2    |       3    |     796    |     794    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |    2634 K  |    2634 K  |
|       from large pool |      18    |      22    |     366 K  |     366 K  |
|       from small pool |       8    |      15    |    2267 K  |    2267 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:39:31 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7951 GiB |   7951 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7949 GiB |   7948 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159731    |  159550    |
|       from large pool |     127    |     152    |  122611    |  122484    |
|       from small pool |      54    |      61    |   37120    |   37066    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159731    |  159550    |
|       from large pool |     127    |     152    |  122611    |  122484    |
|       from small pool |      54    |      61    |   37120    |   37066    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:39:31 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20165 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6854 GiB |   6854 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6852 GiB |   6852 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159731    |  159550    |
|       from large pool |     127    |     152    |  122611    |  122484    |
|       from small pool |      54    |      61    |   37120    |   37066    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159731    |  159550    |
|       from large pool |     127    |     152    |  122611    |  122484    |
|       from small pool |      54    |      61    |   37120    |   37066    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:39:31 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17355 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  27920 MiB |  21994 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  27916 MiB |  21992 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132204    |  132055    |
|       from large pool |     101    |     122    |   98809    |   98708    |
|       from small pool |      48    |      57    |   33395    |   33347    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132204    |  132055    |
|       from large pool |     101    |     122    |   98809    |   98708    |
|       from small pool |      48    |      57    |   33395    |   33347    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     371    |     269    |
|       from large pool |     101    |     120    |     369    |     268    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:39:31 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:39:32 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:39:32 | I | in layer model.layers.4
25-01-19 11:39:32 | I | quantizing weights for layer model.layers.4
25-01-19 11:39:34 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:39:38 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:39:38 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:39:41 | I |       - range scale = [    1.0000]
25-01-19 11:39:41 | I |         sum  error  = [   14.7098]
25-01-19 11:39:41 | I |         best error  = [   14.7098]
25-01-19 11:39:41 | I |     + error = [14.7098]
25-01-19 11:39:44 | I |       - range scale = [    1.0000]
25-01-19 11:39:44 | I |         sum  error  = [   25.1751]
25-01-19 11:39:44 | I |         best error  = [   25.1751]
25-01-19 11:39:44 | I |     + error = [25.1751]
25-01-19 11:39:44 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:39:47 | I |       - range scale = [    1.0000]
25-01-19 11:39:47 | I |         sum  error  = [   26.2985]
25-01-19 11:39:47 | I |         best error  = [   26.2985]
25-01-19 11:39:47 | I |     + error = [26.2985]
25-01-19 11:39:50 | I |       - range scale = [    1.0000]
25-01-19 11:39:50 | I |         sum  error  = [   46.2069]
25-01-19 11:39:50 | I |         best error  = [   46.2069]
25-01-19 11:39:50 | I |     + error = [46.2069]
25-01-19 11:39:50 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:39:51 | I |       - range scale = [    1.0000]
25-01-19 11:39:51 | I |         sum  error  = [    2.6124]
25-01-19 11:39:51 | I |         best error  = [    2.6124]
25-01-19 11:39:51 | I |     + error = [2.6124]
25-01-19 11:39:51 | I |       - range scale = [    1.0000]
25-01-19 11:39:51 | I |         sum  error  = [    3.4170]
25-01-19 11:39:51 | I |         best error  = [    3.4170]
25-01-19 11:39:51 | I |     + error = [3.4170]
25-01-19 11:39:52 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:39:52 | I |       - range scale = [    1.0000]
25-01-19 11:39:52 | I |         sum  error  = [    0.5101]
25-01-19 11:39:52 | I |         best error  = [    0.5101]
25-01-19 11:39:52 | I |     + error = [0.5101]
25-01-19 11:39:53 | I |       - range scale = [    1.0000]
25-01-19 11:39:53 | I |         sum  error  = [    0.7436]
25-01-19 11:39:53 | I |         best error  = [    0.7436]
25-01-19 11:39:53 | I |     + error = [0.7436]
25-01-19 11:39:53 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:39:54 | I |       - range scale = [    1.0000]
25-01-19 11:39:54 | I |         sum  error  = [    3.4235]
25-01-19 11:39:54 | I |         best error  = [    3.4235]
25-01-19 11:39:54 | I |     + error = [3.4235]
25-01-19 11:39:55 | I |       - range scale = [    1.0000]
25-01-19 11:39:55 | I |         sum  error  = [    4.5716]
25-01-19 11:39:55 | I |         best error  = [    4.5716]
25-01-19 11:39:55 | I |     + error = [4.5716]
25-01-19 11:39:55 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:39:56 | I |       - range scale = [    1.0000]
25-01-19 11:39:56 | I |         sum  error  = [    4.2953]
25-01-19 11:39:56 | I |         best error  = [    4.2953]
25-01-19 11:39:56 | I |     + error = [4.2953]
25-01-19 11:39:57 | I |       - range scale = [    1.0000]
25-01-19 11:39:57 | I |         sum  error  = [    5.3374]
25-01-19 11:39:57 | I |         best error  = [    5.3374]
25-01-19 11:39:57 | I |     + error = [5.3374]
25-01-19 11:39:57 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:39:58 | I |       - range scale = [    1.0000]
25-01-19 11:39:58 | I |         sum  error  = [    0.7637]
25-01-19 11:39:58 | I |         best error  = [    0.7637]
25-01-19 11:39:58 | I |     + error = [0.7637]
25-01-19 11:39:59 | I |       - range scale = [    1.0000]
25-01-19 11:39:59 | I |         sum  error  = [    1.0141]
25-01-19 11:39:59 | I |         best error  = [    1.0141]
25-01-19 11:39:59 | I |     + error = [1.0141]
25-01-19 11:40:00 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:40:02 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:40:04 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:40:07 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:40:09 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:40:12 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:40:14 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:40:21 | I | quantizing activations for layer model.layers.4
25-01-19 11:40:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:26 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:29 | I | forward this layer
25-01-19 11:40:29 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/46.pt
25-01-19 11:40:29 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/46.pt
25-01-19 11:40:29 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:40:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 24           |        cudaMalloc retries: 24        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  52552 GiB |  52530 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  52242 GiB |  52220 GiB |
|       from small pool |      3 MiB |      5 MiB |    309 GiB |    309 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  52552 GiB |  52530 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  52242 GiB |  52220 GiB |
|       from small pool |      3 MiB |      5 MiB |    309 GiB |    309 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  52484 GiB |  52462 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  52175 GiB |  52153 GiB |
|       from small pool |      3 MiB |      5 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1603 GiB |   1580 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1601 GiB |   1578 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  27701 GiB |  27700 GiB |
|       from large pool |    835 MiB |   1905 MiB |  27340 GiB |  27339 GiB |
|       from small pool |      0 MiB |      4 MiB |    360 GiB |    360 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    6506 K  |    6506 K  |
|       from large pool |     185    |     200    |    1011 K  |    1011 K  |
|       from small pool |     109    |     115    |    5494 K  |    5494 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    6506 K  |    6506 K  |
|       from large pool |     185    |     200    |    1011 K  |    1011 K  |
|       from small pool |     109    |     115    |    5494 K  |    5494 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    3810    |    3637    |
|       from large pool |     171    |     173    |    2979    |    2808    |
|       from small pool |       2    |       3    |     831    |     829    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    2774 K  |    2774 K  |
|       from large pool |      17    |      22    |     382 K  |     382 K  |
|       from small pool |       8    |      15    |    2391 K  |    2391 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:40:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7951 GiB |   7951 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7949 GiB |   7949 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159751    |  159570    |
|       from large pool |     127    |     152    |  122625    |  122498    |
|       from small pool |      54    |      61    |   37126    |   37072    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159751    |  159570    |
|       from large pool |     127    |     152    |  122625    |  122498    |
|       from small pool |      54    |      61    |   37126    |   37072    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:40:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6855 GiB |   6854 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6852 GiB |   6852 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159751    |  159570    |
|       from large pool |     127    |     152    |  122625    |  122498    |
|       from small pool |      54    |      61    |   37126    |   37072    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159751    |  159570    |
|       from large pool |     127    |     152    |  122625    |  122498    |
|       from small pool |      54    |      61    |   37126    |   37072    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:40:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17355 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17353 GiB |  17347 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  28248 MiB |  22322 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  28244 MiB |  22320 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132224    |  132075    |
|       from large pool |     101    |     122    |   98823    |   98722    |
|       from small pool |      48    |      57    |   33401    |   33353    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132224    |  132075    |
|       from large pool |     101    |     122    |   98823    |   98722    |
|       from small pool |      48    |      57    |   33401    |   33353    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     381    |     279    |
|       from large pool |     101    |     120    |     379    |     278    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:40:29 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:40:29 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:40:29 | I | in layer model.layers.4
25-01-19 11:40:29 | I | quantizing weights for layer model.layers.4
25-01-19 11:40:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:34 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:40:36 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:40:36 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:40:39 | I |       - range scale = [    1.0000]
25-01-19 11:40:39 | I |         sum  error  = [   14.8067]
25-01-19 11:40:39 | I |         best error  = [   14.8067]
25-01-19 11:40:39 | I |     + error = [14.8067]
25-01-19 11:40:42 | I |       - range scale = [    1.0000]
25-01-19 11:40:42 | I |         sum  error  = [   25.2299]
25-01-19 11:40:42 | I |         best error  = [   25.2299]
25-01-19 11:40:42 | I |     + error = [25.2299]
25-01-19 11:40:42 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:40:45 | I |       - range scale = [    1.0000]
25-01-19 11:40:45 | I |         sum  error  = [   28.2493]
25-01-19 11:40:45 | I |         best error  = [   28.2493]
25-01-19 11:40:45 | I |     + error = [28.2493]
25-01-19 11:40:48 | I |       - range scale = [    1.0000]
25-01-19 11:40:48 | I |         sum  error  = [   47.2800]
25-01-19 11:40:48 | I |         best error  = [   47.2800]
25-01-19 11:40:48 | I |     + error = [47.2800]
25-01-19 11:40:48 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:40:49 | I |       - range scale = [    1.0000]
25-01-19 11:40:49 | I |         sum  error  = [    2.6343]
25-01-19 11:40:49 | I |         best error  = [    2.6343]
25-01-19 11:40:49 | I |     + error = [2.6343]
25-01-19 11:40:49 | I |       - range scale = [    1.0000]
25-01-19 11:40:50 | I |         sum  error  = [    3.4433]
25-01-19 11:40:50 | I |         best error  = [    3.4433]
25-01-19 11:40:50 | I |     + error = [3.4433]
25-01-19 11:40:50 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:40:50 | I |       - range scale = [    1.0000]
25-01-19 11:40:50 | I |         sum  error  = [    0.5399]
25-01-19 11:40:50 | I |         best error  = [    0.5399]
25-01-19 11:40:50 | I |     + error = [0.5399]
25-01-19 11:40:51 | I |       - range scale = [    1.0000]
25-01-19 11:40:51 | I |         sum  error  = [    0.7713]
25-01-19 11:40:51 | I |         best error  = [    0.7713]
25-01-19 11:40:51 | I |     + error = [0.7713]
25-01-19 11:40:51 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:40:52 | I |       - range scale = [    1.0000]
25-01-19 11:40:52 | I |         sum  error  = [    3.4312]
25-01-19 11:40:52 | I |         best error  = [    3.4312]
25-01-19 11:40:52 | I |     + error = [3.4312]
25-01-19 11:40:53 | I |       - range scale = [    1.0000]
25-01-19 11:40:53 | I |         sum  error  = [    4.5610]
25-01-19 11:40:53 | I |         best error  = [    4.5610]
25-01-19 11:40:53 | I |     + error = [4.5610]
25-01-19 11:40:53 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:40:54 | I |       - range scale = [    1.0000]
25-01-19 11:40:54 | I |         sum  error  = [    4.3102]
25-01-19 11:40:54 | I |         best error  = [    4.3102]
25-01-19 11:40:54 | I |     + error = [4.3102]
25-01-19 11:40:55 | I |       - range scale = [    1.0000]
25-01-19 11:40:55 | I |         sum  error  = [    5.3425]
25-01-19 11:40:55 | I |         best error  = [    5.3425]
25-01-19 11:40:55 | I |     + error = [5.3425]
25-01-19 11:40:56 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:40:56 | I |       - range scale = [    1.0000]
25-01-19 11:40:56 | I |         sum  error  = [    0.7483]
25-01-19 11:40:56 | I |         best error  = [    0.7483]
25-01-19 11:40:56 | I |     + error = [0.7483]
25-01-19 11:40:57 | I |       - range scale = [    1.0000]
25-01-19 11:40:57 | I |         sum  error  = [    0.9725]
25-01-19 11:40:57 | I |         best error  = [    0.9725]
25-01-19 11:40:57 | I |     + error = [0.9725]
25-01-19 11:40:58 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:41:00 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:41:03 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:41:05 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:41:07 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:41:10 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:41:12 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:41:19 | I | quantizing activations for layer model.layers.4
25-01-19 11:41:22 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:23 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:23 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:27 | I | forward this layer
25-01-19 11:41:27 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/48.pt
25-01-19 11:41:27 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/48.pt
25-01-19 11:41:27 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 80.94 MiB is free. Process 29960 has 23.61 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 748.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:41:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 25           |        cudaMalloc retries: 25        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  23267 MiB |  55124 GiB |  55101 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  54797 GiB |  54775 GiB |
|       from small pool |      3 MiB |      5 MiB |    326 GiB |    326 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  23267 MiB |  55124 GiB |  55101 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  54797 GiB |  54775 GiB |
|       from small pool |      3 MiB |      5 MiB |    326 GiB |    326 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  23267 MiB |  55053 GiB |  55031 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  54727 GiB |  54705 GiB |
|       from small pool |      3 MiB |      5 MiB |    325 GiB |    325 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23696 MiB |  23750 MiB |   1666 GiB |   1643 GiB |
|       from large pool |  23692 MiB |  23744 MiB |   1664 GiB |   1641 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 766350 KiB |   1907 MiB |  29503 GiB |  29502 GiB |
|       from large pool | 765824 KiB |   1905 MiB |  29122 GiB |  29122 GiB |
|       from small pool |    526 KiB |      4 MiB |    380 GiB |    380 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    6862 K  |    6862 K  |
|       from large pool |     186    |     200    |    1065 K  |    1065 K  |
|       from small pool |     109    |     115    |    5796 K  |    5796 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    6862 K  |    6862 K  |
|       from large pool |     186    |     200    |    1065 K  |    1065 K  |
|       from small pool |     109    |     115    |    5796 K  |    5796 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    3948    |    3775    |
|       from large pool |     171    |     173    |    3082    |    2911    |
|       from small pool |       2    |       3    |     866    |     864    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    2917 K  |    2917 K  |
|       from large pool |      17    |      22    |     400 K  |     400 K  |
|       from small pool |       8    |      15    |    2516 K  |    2516 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:41:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20168 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7952 GiB |   7951 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7949 GiB |   7949 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159771    |  159590    |
|       from large pool |     127    |     152    |  122639    |  122512    |
|       from small pool |      54    |      61    |   37132    |   37078    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159771    |  159590    |
|       from large pool |     127    |     152    |  122639    |  122512    |
|       from small pool |      54    |      61    |   37132    |   37078    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:41:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20168 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20168 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20159 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6855 GiB |   6855 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6853 GiB |   6852 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159771    |  159590    |
|       from large pool |     127    |     152    |  122639    |  122512    |
|       from small pool |      54    |      61    |   37132    |   37078    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159771    |  159590    |
|       from large pool |     127    |     152    |  122639    |  122512    |
|       from small pool |      54    |      61    |   37132    |   37078    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:41:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  28576 MiB |  22650 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  28572 MiB |  22648 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132244    |  132095    |
|       from large pool |     101    |     122    |   98837    |   98736    |
|       from small pool |      48    |      57    |   33407    |   33359    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132244    |  132095    |
|       from large pool |     101    |     122    |   98837    |   98736    |
|       from small pool |      48    |      57    |   33407    |   33359    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     391    |     289    |
|       from large pool |     101    |     120    |     389    |     288    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:41:27 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:41:28 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:41:28 | I | in layer model.layers.4
25-01-19 11:41:28 | I | quantizing weights for layer model.layers.4
25-01-19 11:41:31 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:31 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:41:34 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:41:34 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:41:37 | I |       - range scale = [    1.0000]
25-01-19 11:41:37 | I |         sum  error  = [   14.2121]
25-01-19 11:41:37 | I |         best error  = [   14.2121]
25-01-19 11:41:37 | I |     + error = [14.2121]
25-01-19 11:41:40 | I |       - range scale = [    1.0000]
25-01-19 11:41:40 | I |         sum  error  = [   23.8819]
25-01-19 11:41:40 | I |         best error  = [   23.8819]
25-01-19 11:41:40 | I |     + error = [23.8819]
25-01-19 11:41:41 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:41:44 | I |       - range scale = [    1.0000]
25-01-19 11:41:44 | I |         sum  error  = [   26.0092]
25-01-19 11:41:44 | I |         best error  = [   26.0092]
25-01-19 11:41:44 | I |     + error = [26.0092]
25-01-19 11:41:47 | I |       - range scale = [    1.0000]
25-01-19 11:41:47 | I |         sum  error  = [   41.8904]
25-01-19 11:41:47 | I |         best error  = [   41.8904]
25-01-19 11:41:47 | I |     + error = [41.8904]
25-01-19 11:41:47 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:41:48 | I |       - range scale = [    1.0000]
25-01-19 11:41:48 | I |         sum  error  = [    2.6954]
25-01-19 11:41:48 | I |         best error  = [    2.6954]
25-01-19 11:41:48 | I |     + error = [2.6954]
25-01-19 11:41:48 | I |       - range scale = [    1.0000]
25-01-19 11:41:48 | I |         sum  error  = [    3.5388]
25-01-19 11:41:48 | I |         best error  = [    3.5388]
25-01-19 11:41:48 | I |     + error = [3.5388]
25-01-19 11:41:49 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:41:49 | I |       - range scale = [    1.0000]
25-01-19 11:41:49 | I |         sum  error  = [    0.5000]
25-01-19 11:41:49 | I |         best error  = [    0.5000]
25-01-19 11:41:49 | I |     + error = [0.5000]
25-01-19 11:41:50 | I |       - range scale = [    1.0000]
25-01-19 11:41:50 | I |         sum  error  = [    0.7166]
25-01-19 11:41:50 | I |         best error  = [    0.7166]
25-01-19 11:41:50 | I |     + error = [0.7166]
25-01-19 11:41:50 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:41:51 | I |       - range scale = [    1.0000]
25-01-19 11:41:51 | I |         sum  error  = [    3.6047]
25-01-19 11:41:51 | I |         best error  = [    3.6047]
25-01-19 11:41:51 | I |     + error = [3.6047]
25-01-19 11:41:52 | I |       - range scale = [    1.0000]
25-01-19 11:41:52 | I |         sum  error  = [    4.8094]
25-01-19 11:41:52 | I |         best error  = [    4.8094]
25-01-19 11:41:52 | I |     + error = [4.8094]
25-01-19 11:41:52 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:41:53 | I |       - range scale = [    1.0000]
25-01-19 11:41:53 | I |         sum  error  = [    4.4136]
25-01-19 11:41:53 | I |         best error  = [    4.4136]
25-01-19 11:41:53 | I |     + error = [4.4136]
25-01-19 11:41:54 | I |       - range scale = [    1.0000]
25-01-19 11:41:54 | I |         sum  error  = [    5.5905]
25-01-19 11:41:54 | I |         best error  = [    5.5905]
25-01-19 11:41:54 | I |     + error = [5.5905]
25-01-19 11:41:54 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:41:55 | I |       - range scale = [    1.0000]
25-01-19 11:41:55 | I |         sum  error  = [    0.7408]
25-01-19 11:41:55 | I |         best error  = [    0.7408]
25-01-19 11:41:55 | I |     + error = [0.7408]
25-01-19 11:41:56 | I |       - range scale = [    1.0000]
25-01-19 11:41:56 | I |         sum  error  = [    1.0014]
25-01-19 11:41:56 | I |         best error  = [    1.0014]
25-01-19 11:41:56 | I |     + error = [1.0014]
25-01-19 11:41:57 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:41:59 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:42:02 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:42:04 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:42:07 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:42:09 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:42:12 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:42:18 | I | quantizing activations for layer model.layers.4
25-01-19 11:42:21 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:22 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:23 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:26 | I | forward this layer
25-01-19 11:42:26 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/50.pt
25-01-19 11:42:26 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/50.pt
25-01-19 11:42:26 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 28.94 MiB is free. Process 29960 has 23.66 GiB memory in use. Of the allocated memory 22.66 GiB is allocated by PyTorch, and 544.19 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:42:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 26           |        cudaMalloc retries: 26        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  23203 MiB |  23267 MiB |  57781 GiB |  57759 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  57438 GiB |  57415 GiB |
|       from small pool |      3 MiB |      5 MiB |    343 GiB |    343 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  23203 MiB |  23267 MiB |  57781 GiB |  57759 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  57438 GiB |  57415 GiB |
|       from small pool |      3 MiB |      5 MiB |    343 GiB |    343 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  23203 MiB |  23267 MiB |  57708 GiB |  57685 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  57366 GiB |  57343 GiB |
|       from small pool |      3 MiB |      5 MiB |    342 GiB |    342 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23748 MiB |  23750 MiB |   1735 GiB |   1712 GiB |
|       from large pool |  23744 MiB |  23744 MiB |   1734 GiB |   1710 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 557246 KiB |   1907 MiB |  31362 GiB |  31361 GiB |
|       from large pool | 556928 KiB |   1905 MiB |  30962 GiB |  30961 GiB |
|       from small pool |    318 KiB |      4 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     300    |     305    |    7225 K  |    7225 K  |
|       from large pool |     187    |     200    |    1121 K  |    1121 K  |
|       from small pool |     113    |     115    |    6104 K  |    6104 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     300    |     305    |    7225 K  |    7225 K  |
|       from large pool |     187    |     200    |    1121 K  |    1121 K  |
|       from small pool |     113    |     115    |    6104 K  |    6104 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     176    |    4115    |    3940    |
|       from large pool |     173    |     173    |    3214    |    3041    |
|       from small pool |       2    |       3    |     901    |     899    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      22    |      30    |    3063 K  |    3063 K  |
|       from large pool |      15    |      22    |     419 K  |     419 K  |
|       from small pool |       7    |      15    |    2644 K  |    2644 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:42:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7952 GiB |   7952 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7950 GiB |   7949 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159791    |  159610    |
|       from large pool |     127    |     152    |  122653    |  122526    |
|       from small pool |      54    |      61    |   37138    |   37084    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159791    |  159610    |
|       from large pool |     127    |     152    |  122653    |  122526    |
|       from small pool |      54    |      61    |   37138    |   37084    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:42:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20166 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6855 GiB |   6855 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6853 GiB |   6853 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159791    |  159610    |
|       from large pool |     127    |     152    |  122653    |  122526    |
|       from small pool |      54    |      61    |   37138    |   37084    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159791    |  159610    |
|       from large pool |     127    |     152    |  122653    |  122526    |
|       from small pool |      54    |      61    |   37138    |   37084    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:42:26 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17356 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17356 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  28904 MiB |  22978 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  28900 MiB |  22976 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132264    |  132115    |
|       from large pool |     101    |     122    |   98851    |   98750    |
|       from small pool |      48    |      57    |   33413    |   33365    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132264    |  132115    |
|       from large pool |     101    |     122    |   98851    |   98750    |
|       from small pool |      48    |      57    |   33413    |   33365    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     401    |     299    |
|       from large pool |     101    |     120    |     399    |     298    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:42:26 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:42:27 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:42:27 | I | in layer model.layers.4
25-01-19 11:42:27 | I | quantizing weights for layer model.layers.4
25-01-19 11:42:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:31 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:42:34 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:42:34 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:42:37 | I |       - range scale = [    1.0000]
25-01-19 11:42:37 | I |         sum  error  = [   15.0074]
25-01-19 11:42:37 | I |         best error  = [   15.0074]
25-01-19 11:42:37 | I |     + error = [15.0074]
25-01-19 11:42:40 | I |       - range scale = [    1.0000]
25-01-19 11:42:40 | I |         sum  error  = [   25.0374]
25-01-19 11:42:40 | I |         best error  = [   25.0374]
25-01-19 11:42:40 | I |     + error = [25.0374]
25-01-19 11:42:40 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:42:43 | I |       - range scale = [    1.0000]
25-01-19 11:42:43 | I |         sum  error  = [   28.6097]
25-01-19 11:42:43 | I |         best error  = [   28.6097]
25-01-19 11:42:43 | I |     + error = [28.6097]
25-01-19 11:42:47 | I |       - range scale = [    1.0000]
25-01-19 11:42:47 | I |         sum  error  = [   47.3250]
25-01-19 11:42:47 | I |         best error  = [   47.3250]
25-01-19 11:42:47 | I |     + error = [47.3250]
25-01-19 11:42:47 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:42:48 | I |       - range scale = [    1.0000]
25-01-19 11:42:48 | I |         sum  error  = [    2.6783]
25-01-19 11:42:48 | I |         best error  = [    2.6783]
25-01-19 11:42:48 | I |     + error = [2.6783]
25-01-19 11:42:48 | I |       - range scale = [    1.0000]
25-01-19 11:42:48 | I |         sum  error  = [    3.5429]
25-01-19 11:42:48 | I |         best error  = [    3.5429]
25-01-19 11:42:48 | I |     + error = [3.5429]
25-01-19 11:42:49 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:42:49 | I |       - range scale = [    1.0000]
25-01-19 11:42:49 | I |         sum  error  = [    0.5570]
25-01-19 11:42:49 | I |         best error  = [    0.5570]
25-01-19 11:42:49 | I |     + error = [0.5570]
25-01-19 11:42:50 | I |       - range scale = [    1.0000]
25-01-19 11:42:50 | I |         sum  error  = [    0.8196]
25-01-19 11:42:50 | I |         best error  = [    0.8196]
25-01-19 11:42:50 | I |     + error = [0.8196]
25-01-19 11:42:50 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:42:51 | I |       - range scale = [    1.0000]
25-01-19 11:42:51 | I |         sum  error  = [    3.5609]
25-01-19 11:42:51 | I |         best error  = [    3.5609]
25-01-19 11:42:51 | I |     + error = [3.5609]
25-01-19 11:42:52 | I |       - range scale = [    1.0000]
25-01-19 11:42:52 | I |         sum  error  = [    4.7776]
25-01-19 11:42:52 | I |         best error  = [    4.7776]
25-01-19 11:42:52 | I |     + error = [4.7776]
25-01-19 11:42:52 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:42:53 | I |       - range scale = [    1.0000]
25-01-19 11:42:53 | I |         sum  error  = [    4.4328]
25-01-19 11:42:53 | I |         best error  = [    4.4328]
25-01-19 11:42:53 | I |     + error = [4.4328]
25-01-19 11:42:54 | I |       - range scale = [    1.0000]
25-01-19 11:42:54 | I |         sum  error  = [    5.5889]
25-01-19 11:42:54 | I |         best error  = [    5.5889]
25-01-19 11:42:54 | I |     + error = [5.5889]
25-01-19 11:42:54 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:42:55 | I |       - range scale = [    1.0000]
25-01-19 11:42:55 | I |         sum  error  = [    0.7611]
25-01-19 11:42:55 | I |         best error  = [    0.7611]
25-01-19 11:42:55 | I |     + error = [0.7611]
25-01-19 11:42:56 | I |       - range scale = [    1.0000]
25-01-19 11:42:56 | I |         sum  error  = [    1.0307]
25-01-19 11:42:56 | I |         best error  = [    1.0307]
25-01-19 11:42:56 | I |     + error = [1.0307]
25-01-19 11:42:56 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:42:59 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:43:01 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:43:04 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:43:06 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:43:09 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:43:11 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:43:18 | I | quantizing activations for layer model.layers.4
25-01-19 11:43:21 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:22 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:23 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:27 | I | forward this layer
25-01-19 11:43:27 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/52.pt
25-01-19 11:43:27 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/52.pt
25-01-19 11:43:27 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:43:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 27           |        cudaMalloc retries: 27        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  60523 GiB |  60501 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  60162 GiB |  60140 GiB |
|       from small pool |      3 MiB |      5 MiB |    360 GiB |    360 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  60523 GiB |  60501 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  60162 GiB |  60140 GiB |
|       from small pool |      3 MiB |      5 MiB |    360 GiB |    360 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  60447 GiB |  60425 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  60088 GiB |  60065 GiB |
|       from small pool |      3 MiB |      5 MiB |    359 GiB |    359 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1801 GiB |   1778 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1799 GiB |   1776 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  33266 GiB |  33265 GiB |
|       from large pool |    835 MiB |   1905 MiB |  32845 GiB |  32845 GiB |
|       from small pool |      0 MiB |      4 MiB |    420 GiB |    420 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    7595 K  |    7595 K  |
|       from large pool |     185    |     200    |    1178 K  |    1177 K  |
|       from small pool |     109    |     115    |    6417 K  |    6417 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    7595 K  |    7595 K  |
|       from large pool |     185    |     200    |    1178 K  |    1177 K  |
|       from small pool |     109    |     115    |    6417 K  |    6417 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    4262    |    4089    |
|       from large pool |     171    |     173    |    3326    |    3155    |
|       from small pool |       2    |       3    |     936    |     934    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    3209 K  |    3209 K  |
|       from large pool |      17    |      22    |     435 K  |     435 K  |
|       from small pool |       8    |      15    |    2773 K  |    2773 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:43:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7952 GiB |   7952 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7950 GiB |   7950 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159811    |  159630    |
|       from large pool |     127    |     152    |  122667    |  122540    |
|       from small pool |      54    |      61    |   37144    |   37090    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159811    |  159630    |
|       from large pool |     127    |     152    |  122667    |  122540    |
|       from small pool |      54    |      61    |   37144    |   37090    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:43:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6856 GiB |   6855 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6853 GiB |   6853 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159811    |  159630    |
|       from large pool |     127    |     152    |  122667    |  122540    |
|       from small pool |      54    |      61    |   37144    |   37090    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159811    |  159630    |
|       from large pool |     127    |     152    |  122667    |  122540    |
|       from small pool |      54    |      61    |   37144    |   37090    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:43:27 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17357 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17357 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17356 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17348 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  29232 MiB |  23306 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  29228 MiB |  23304 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132284    |  132135    |
|       from large pool |     101    |     122    |   98865    |   98764    |
|       from small pool |      48    |      57    |   33419    |   33371    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132284    |  132135    |
|       from large pool |     101    |     122    |   98865    |   98764    |
|       from small pool |      48    |      57    |   33419    |   33371    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     411    |     309    |
|       from large pool |     101    |     120    |     409    |     308    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:43:27 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:43:27 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:43:27 | I | in layer model.layers.4
25-01-19 11:43:27 | I | quantizing weights for layer model.layers.4
25-01-19 11:43:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:31 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:43:34 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:43:34 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:43:37 | I |       - range scale = [    1.0000]
25-01-19 11:43:37 | I |         sum  error  = [   14.9792]
25-01-19 11:43:37 | I |         best error  = [   14.9792]
25-01-19 11:43:37 | I |     + error = [14.9792]
25-01-19 11:43:41 | I |       - range scale = [    1.0000]
25-01-19 11:43:41 | I |         sum  error  = [   25.3464]
25-01-19 11:43:41 | I |         best error  = [   25.3464]
25-01-19 11:43:41 | I |     + error = [25.3464]
25-01-19 11:43:41 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:43:44 | I |       - range scale = [    1.0000]
25-01-19 11:43:44 | I |         sum  error  = [   28.9513]
25-01-19 11:43:44 | I |         best error  = [   28.9513]
25-01-19 11:43:44 | I |     + error = [28.9513]
25-01-19 11:43:47 | I |       - range scale = [    1.0000]
25-01-19 11:43:47 | I |         sum  error  = [   49.6517]
25-01-19 11:43:47 | I |         best error  = [   49.6517]
25-01-19 11:43:47 | I |     + error = [49.6517]
25-01-19 11:43:48 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:43:48 | I |       - range scale = [    1.0000]
25-01-19 11:43:48 | I |         sum  error  = [    2.6481]
25-01-19 11:43:48 | I |         best error  = [    2.6481]
25-01-19 11:43:48 | I |     + error = [2.6481]
25-01-19 11:43:49 | I |       - range scale = [    1.0000]
25-01-19 11:43:49 | I |         sum  error  = [    3.3623]
25-01-19 11:43:49 | I |         best error  = [    3.3623]
25-01-19 11:43:49 | I |     + error = [3.3623]
25-01-19 11:43:49 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:43:50 | I |       - range scale = [    1.0000]
25-01-19 11:43:50 | I |         sum  error  = [    0.5933]
25-01-19 11:43:50 | I |         best error  = [    0.5933]
25-01-19 11:43:50 | I |     + error = [0.5933]
25-01-19 11:43:51 | I |       - range scale = [    1.0000]
25-01-19 11:43:51 | I |         sum  error  = [    0.8476]
25-01-19 11:43:51 | I |         best error  = [    0.8476]
25-01-19 11:43:51 | I |     + error = [0.8476]
25-01-19 11:43:51 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:43:52 | I |       - range scale = [    1.0000]
25-01-19 11:43:52 | I |         sum  error  = [    3.4023]
25-01-19 11:43:52 | I |         best error  = [    3.4023]
25-01-19 11:43:52 | I |     + error = [3.4023]
25-01-19 11:43:53 | I |       - range scale = [    1.0000]
25-01-19 11:43:53 | I |         sum  error  = [    4.4257]
25-01-19 11:43:53 | I |         best error  = [    4.4257]
25-01-19 11:43:53 | I |     + error = [4.4257]
25-01-19 11:43:53 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:43:54 | I |       - range scale = [    1.0000]
25-01-19 11:43:54 | I |         sum  error  = [    4.3725]
25-01-19 11:43:54 | I |         best error  = [    4.3725]
25-01-19 11:43:54 | I |     + error = [4.3725]
25-01-19 11:43:55 | I |       - range scale = [    1.0000]
25-01-19 11:43:55 | I |         sum  error  = [    5.2450]
25-01-19 11:43:55 | I |         best error  = [    5.2450]
25-01-19 11:43:55 | I |     + error = [5.2450]
25-01-19 11:43:55 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:43:56 | I |       - range scale = [    1.0000]
25-01-19 11:43:56 | I |         sum  error  = [    0.7881]
25-01-19 11:43:56 | I |         best error  = [    0.7881]
25-01-19 11:43:56 | I |     + error = [0.7881]
25-01-19 11:43:57 | I |       - range scale = [    1.0000]
25-01-19 11:43:57 | I |         sum  error  = [    1.0031]
25-01-19 11:43:57 | I |         best error  = [    1.0031]
25-01-19 11:43:57 | I |     + error = [1.0031]
25-01-19 11:43:57 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:44:00 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:44:02 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:44:05 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:44:07 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:44:10 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:44:12 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:44:19 | I | quantizing activations for layer model.layers.4
25-01-19 11:44:22 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:23 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:28 | I | forward this layer
25-01-19 11:44:28 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/54.pt
25-01-19 11:44:28 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/54.pt
25-01-19 11:44:28 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:44:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 28           |        cudaMalloc retries: 28        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  63351 GiB |  63329 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  62973 GiB |  62950 GiB |
|       from small pool |      3 MiB |      5 MiB |    378 GiB |    378 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  63351 GiB |  63329 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  62973 GiB |  62950 GiB |
|       from small pool |      3 MiB |      5 MiB |    378 GiB |    378 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  63272 GiB |  63250 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  62895 GiB |  62872 GiB |
|       from small pool |      3 MiB |      5 MiB |    377 GiB |    377 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1867 GiB |   1844 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1865 GiB |   1842 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  34793 GiB |  34793 GiB |
|       from large pool |    835 MiB |   1905 MiB |  34352 GiB |  34351 GiB |
|       from small pool |      0 MiB |      4 MiB |    441 GiB |    441 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    7973 K  |    7973 K  |
|       from large pool |     185    |     200    |    1236 K  |    1235 K  |
|       from small pool |     109    |     115    |    6737 K  |    6737 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    7973 K  |    7973 K  |
|       from large pool |     185    |     200    |    1236 K  |    1235 K  |
|       from small pool |     109    |     115    |    6737 K  |    6737 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    4409    |    4236    |
|       from large pool |     171    |     173    |    3438    |    3267    |
|       from small pool |       2    |       3    |     971    |     969    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |    3359 K  |    3359 K  |
|       from large pool |      18    |      22    |     454 K  |     454 K  |
|       from small pool |       8    |      15    |    2905 K  |    2905 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:44:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20169 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7953 GiB |   7952 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7950 GiB |   7950 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159831    |  159650    |
|       from large pool |     127    |     152    |  122681    |  122554    |
|       from small pool |      54    |      61    |   37150    |   37096    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159831    |  159650    |
|       from large pool |     127    |     152    |  122681    |  122554    |
|       from small pool |      54    |      61    |   37150    |   37096    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:44:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20169 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20169 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20160 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6856 GiB |   6856 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6854 GiB |   6853 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159831    |  159650    |
|       from large pool |     127    |     152    |  122681    |  122554    |
|       from small pool |      54    |      61    |   37150    |   37096    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159831    |  159650    |
|       from large pool |     127    |     152    |  122681    |  122554    |
|       from small pool |      54    |      61    |   37150    |   37096    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:44:28 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17357 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17357 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17357 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17354 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  29560 MiB |  23634 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  29556 MiB |  23632 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132304    |  132155    |
|       from large pool |     101    |     122    |   98879    |   98778    |
|       from small pool |      48    |      57    |   33425    |   33377    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132304    |  132155    |
|       from large pool |     101    |     122    |   98879    |   98778    |
|       from small pool |      48    |      57    |   33425    |   33377    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     421    |     319    |
|       from large pool |     101    |     120    |     419    |     318    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:44:28 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:44:28 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:44:28 | I | in layer model.layers.4
25-01-19 11:44:28 | I | quantizing weights for layer model.layers.4
25-01-19 11:44:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:34 | I | collecting calibration activations in model.layers.4
25-01-19 11:44:35 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:44:35 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:44:39 | I |       - range scale = [    1.0000]
25-01-19 11:44:39 | I |         sum  error  = [   15.3109]
25-01-19 11:44:39 | I |         best error  = [   15.3109]
25-01-19 11:44:39 | I |     + error = [15.3109]
25-01-19 11:44:42 | I |       - range scale = [    1.0000]
25-01-19 11:44:42 | I |         sum  error  = [   27.5808]
25-01-19 11:44:42 | I |         best error  = [   27.5808]
25-01-19 11:44:42 | I |     + error = [27.5808]
25-01-19 11:44:42 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:44:46 | I |       - range scale = [    1.0000]
25-01-19 11:44:46 | I |         sum  error  = [   29.3354]
25-01-19 11:44:46 | I |         best error  = [   29.3354]
25-01-19 11:44:46 | I |     + error = [29.3354]
25-01-19 11:44:49 | I |       - range scale = [    1.0000]
25-01-19 11:44:49 | I |         sum  error  = [   53.3058]
25-01-19 11:44:49 | I |         best error  = [   53.3058]
25-01-19 11:44:49 | I |     + error = [53.3058]
25-01-19 11:44:49 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:44:50 | I |       - range scale = [    1.0000]
25-01-19 11:44:50 | I |         sum  error  = [    2.7040]
25-01-19 11:44:50 | I |         best error  = [    2.7040]
25-01-19 11:44:50 | I |     + error = [2.7040]
25-01-19 11:44:51 | I |       - range scale = [    1.0000]
25-01-19 11:44:51 | I |         sum  error  = [    3.4404]
25-01-19 11:44:51 | I |         best error  = [    3.4404]
25-01-19 11:44:51 | I |     + error = [3.4404]
25-01-19 11:44:51 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:44:52 | I |       - range scale = [    1.0000]
25-01-19 11:44:52 | I |         sum  error  = [    0.5964]
25-01-19 11:44:52 | I |         best error  = [    0.5964]
25-01-19 11:44:52 | I |     + error = [0.5964]
25-01-19 11:44:53 | I |       - range scale = [    1.0000]
25-01-19 11:44:53 | I |         sum  error  = [    0.8454]
25-01-19 11:44:53 | I |         best error  = [    0.8454]
25-01-19 11:44:53 | I |     + error = [0.8454]
25-01-19 11:44:53 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:44:53 | I |       - range scale = [    1.0000]
25-01-19 11:44:53 | I |         sum  error  = [    3.5424]
25-01-19 11:44:53 | I |         best error  = [    3.5424]
25-01-19 11:44:53 | I |     + error = [3.5424]
25-01-19 11:44:55 | I |       - range scale = [    1.0000]
25-01-19 11:44:55 | I |         sum  error  = [    4.6051]
25-01-19 11:44:55 | I |         best error  = [    4.6051]
25-01-19 11:44:55 | I |     + error = [4.6051]
25-01-19 11:44:55 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:44:56 | I |       - range scale = [    1.0000]
25-01-19 11:44:56 | I |         sum  error  = [    4.4646]
25-01-19 11:44:56 | I |         best error  = [    4.4646]
25-01-19 11:44:56 | I |     + error = [4.4646]
25-01-19 11:44:57 | I |       - range scale = [    1.0000]
25-01-19 11:44:57 | I |         sum  error  = [    5.4084]
25-01-19 11:44:57 | I |         best error  = [    5.4084]
25-01-19 11:44:57 | I |     + error = [5.4084]
25-01-19 11:44:57 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:44:58 | I |       - range scale = [    1.0000]
25-01-19 11:44:58 | I |         sum  error  = [    0.7879]
25-01-19 11:44:58 | I |         best error  = [    0.7879]
25-01-19 11:44:58 | I |     + error = [0.7879]
25-01-19 11:44:59 | I |       - range scale = [    1.0000]
25-01-19 11:44:59 | I |         sum  error  = [    0.9969]
25-01-19 11:44:59 | I |         best error  = [    0.9969]
25-01-19 11:44:59 | I |     + error = [0.9969]
25-01-19 11:44:59 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:45:01 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:45:04 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:45:06 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:45:09 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:45:11 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:45:14 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:45:20 | I | quantizing activations for layer model.layers.4
25-01-19 11:45:24 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:25 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:26 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:29 | I | forward this layer
25-01-19 11:45:29 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/56.pt
25-01-19 11:45:29 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/56.pt
25-01-19 11:45:29 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:45:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 29           |        cudaMalloc retries: 29        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  66264 GiB |  66242 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  65867 GiB |  65845 GiB |
|       from small pool |      3 MiB |      5 MiB |    396 GiB |    396 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  66264 GiB |  66242 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  65867 GiB |  65845 GiB |
|       from small pool |      3 MiB |      5 MiB |    396 GiB |    396 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  66182 GiB |  66160 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  65787 GiB |  65765 GiB |
|       from small pool |      3 MiB |      5 MiB |    395 GiB |    395 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   1934 GiB |   1911 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   1932 GiB |   1909 GiB |
|       from small pool |      4 MiB |      6 MiB |      1 GiB |      1 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  36389 GiB |  36388 GiB |
|       from large pool |    835 MiB |   1905 MiB |  35927 GiB |  35926 GiB |
|       from small pool |      0 MiB |      4 MiB |    462 GiB |    462 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    8358 K  |    8357 K  |
|       from large pool |     185    |     200    |    1295 K  |    1295 K  |
|       from small pool |     109    |     115    |    7062 K  |    7062 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    8358 K  |    8357 K  |
|       from large pool |     185    |     200    |    1295 K  |    1295 K  |
|       from small pool |     109    |     115    |    7062 K  |    7062 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    4561    |    4388    |
|       from large pool |     171    |     173    |    3555    |    3384    |
|       from small pool |       2    |       3    |    1006    |    1004    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    3510 K  |    3510 K  |
|       from large pool |      17    |      22    |     471 K  |     471 K  |
|       from small pool |       8    |      15    |    3039 K  |    3039 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:45:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7953 GiB |   7953 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7951 GiB |   7950 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159851    |  159670    |
|       from large pool |     127    |     152    |  122695    |  122568    |
|       from small pool |      54    |      61    |   37156    |   37102    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159851    |  159670    |
|       from large pool |     127    |     152    |  122695    |  122568    |
|       from small pool |      54    |      61    |   37156    |   37102    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:45:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20167 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6856 GiB |   6856 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6854 GiB |   6854 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159851    |  159670    |
|       from large pool |     127    |     152    |  122695    |  122568    |
|       from small pool |      54    |      61    |   37156    |   37102    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159851    |  159670    |
|       from large pool |     127    |     152    |  122695    |  122568    |
|       from small pool |      54    |      61    |   37156    |   37102    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:45:29 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17357 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17357 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17357 GiB |  17351 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  29888 MiB |  23962 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  29884 MiB |  23960 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132324    |  132175    |
|       from large pool |     101    |     122    |   98893    |   98792    |
|       from small pool |      48    |      57    |   33431    |   33383    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132324    |  132175    |
|       from large pool |     101    |     122    |   98893    |   98792    |
|       from small pool |      48    |      57    |   33431    |   33383    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     431    |     329    |
|       from large pool |     101    |     120    |     429    |     328    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:45:29 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:45:30 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:45:30 | I | in layer model.layers.4
25-01-19 11:45:30 | I | quantizing weights for layer model.layers.4
25-01-19 11:45:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:34 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:45:37 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:45:37 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:45:41 | I |       - range scale = [    1.0000]
25-01-19 11:45:41 | I |         sum  error  = [   15.4321]
25-01-19 11:45:41 | I |         best error  = [   15.4321]
25-01-19 11:45:41 | I |     + error = [15.4321]
25-01-19 11:45:44 | I |       - range scale = [    1.0000]
25-01-19 11:45:44 | I |         sum  error  = [   25.7993]
25-01-19 11:45:44 | I |         best error  = [   25.7993]
25-01-19 11:45:44 | I |     + error = [25.7993]
25-01-19 11:45:44 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:45:48 | I |       - range scale = [    1.0000]
25-01-19 11:45:48 | I |         sum  error  = [   30.0789]
25-01-19 11:45:48 | I |         best error  = [   30.0789]
25-01-19 11:45:48 | I |     + error = [30.0789]
25-01-19 11:45:51 | I |       - range scale = [    1.0000]
25-01-19 11:45:51 | I |         sum  error  = [   50.4965]
25-01-19 11:45:51 | I |         best error  = [   50.4965]
25-01-19 11:45:51 | I |     + error = [50.4965]
25-01-19 11:45:51 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:45:52 | I |       - range scale = [    1.0000]
25-01-19 11:45:52 | I |         sum  error  = [    2.6855]
25-01-19 11:45:52 | I |         best error  = [    2.6855]
25-01-19 11:45:52 | I |     + error = [2.6855]
25-01-19 11:45:53 | I |       - range scale = [    1.0000]
25-01-19 11:45:53 | I |         sum  error  = [    3.4080]
25-01-19 11:45:53 | I |         best error  = [    3.4080]
25-01-19 11:45:53 | I |     + error = [3.4080]
25-01-19 11:45:53 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:45:54 | I |       - range scale = [    1.0000]
25-01-19 11:45:54 | I |         sum  error  = [    0.5735]
25-01-19 11:45:54 | I |         best error  = [    0.5735]
25-01-19 11:45:54 | I |     + error = [0.5735]
25-01-19 11:45:55 | I |       - range scale = [    1.0000]
25-01-19 11:45:55 | I |         sum  error  = [    0.8100]
25-01-19 11:45:55 | I |         best error  = [    0.8100]
25-01-19 11:45:55 | I |     + error = [0.8100]
25-01-19 11:45:55 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:45:56 | I |       - range scale = [    1.0000]
25-01-19 11:45:56 | I |         sum  error  = [    3.5100]
25-01-19 11:45:56 | I |         best error  = [    3.5100]
25-01-19 11:45:56 | I |     + error = [3.5100]
25-01-19 11:45:57 | I |       - range scale = [    1.0000]
25-01-19 11:45:57 | I |         sum  error  = [    4.5539]
25-01-19 11:45:57 | I |         best error  = [    4.5539]
25-01-19 11:45:57 | I |     + error = [4.5539]
25-01-19 11:45:57 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:45:58 | I |       - range scale = [    1.0000]
25-01-19 11:45:58 | I |         sum  error  = [    4.4194]
25-01-19 11:45:58 | I |         best error  = [    4.4194]
25-01-19 11:45:58 | I |     + error = [4.4194]
25-01-19 11:45:59 | I |       - range scale = [    1.0000]
25-01-19 11:45:59 | I |         sum  error  = [    5.3344]
25-01-19 11:45:59 | I |         best error  = [    5.3344]
25-01-19 11:45:59 | I |     + error = [5.3344]
25-01-19 11:45:59 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:46:00 | I |       - range scale = [    1.0000]
25-01-19 11:46:00 | I |         sum  error  = [    0.7807]
25-01-19 11:46:00 | I |         best error  = [    0.7807]
25-01-19 11:46:00 | I |     + error = [0.7807]
25-01-19 11:46:01 | I |       - range scale = [    1.0000]
25-01-19 11:46:01 | I |         sum  error  = [    1.0098]
25-01-19 11:46:01 | I |         best error  = [    1.0098]
25-01-19 11:46:01 | I |     + error = [1.0098]
25-01-19 11:46:01 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:46:04 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:46:06 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:46:09 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:46:11 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:46:14 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:46:16 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:46:23 | I | quantizing activations for layer model.layers.4
25-01-19 11:46:26 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:27 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:28 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:29 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:32 | I | forward this layer
25-01-19 11:46:32 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/58.pt
25-01-19 11:46:32 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/58.pt
25-01-19 11:46:32 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 80.94 MiB is free. Process 29960 has 23.61 GiB memory in use. Of the allocated memory 22.41 GiB is allocated by PyTorch, and 748.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:46:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 30           |        cudaMalloc retries: 30        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22947 MiB |  23267 MiB |  69263 GiB |  69240 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  68848 GiB |  68826 GiB |
|       from small pool |      3 MiB |      5 MiB |    414 GiB |    414 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22947 MiB |  23267 MiB |  69263 GiB |  69240 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  68848 GiB |  68826 GiB |
|       from small pool |      3 MiB |      5 MiB |    414 GiB |    414 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22947 MiB |  23267 MiB |  69178 GiB |  69155 GiB |
|       from large pool |  22944 MiB |  23264 MiB |  68764 GiB |  68742 GiB |
|       from small pool |      3 MiB |      5 MiB |    413 GiB |    413 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23696 MiB |  23750 MiB |   1998 GiB |   1975 GiB |
|       from large pool |  23692 MiB |  23744 MiB |   1996 GiB |   1973 GiB |
|       from small pool |      4 MiB |      6 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 766350 KiB |   1907 MiB |  38453 GiB |  38452 GiB |
|       from large pool | 765824 KiB |   1905 MiB |  37969 GiB |  37968 GiB |
|       from small pool |    526 KiB |      4 MiB |    483 GiB |    483 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     295    |     305    |    8750 K  |    8749 K  |
|       from large pool |     186    |     200    |    1355 K  |    1355 K  |
|       from small pool |     109    |     115    |    7394 K  |    7394 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     295    |     305    |    8750 K  |    8749 K  |
|       from large pool |     186    |     200    |    1355 K  |    1355 K  |
|       from small pool |     109    |     115    |    7394 K  |    7394 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    4703    |    4530    |
|       from large pool |     171    |     173    |    3662    |    3491    |
|       from small pool |       2    |       3    |    1041    |    1039    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    3666 K  |    3666 K  |
|       from large pool |      17    |      22    |     492 K  |     491 K  |
|       from small pool |       8    |      15    |    3174 K  |    3174 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:46:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7953 GiB |   7953 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7951 GiB |   7951 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159871    |  159690    |
|       from large pool |     127    |     152    |  122709    |  122582    |
|       from small pool |      54    |      61    |   37162    |   37108    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159871    |  159690    |
|       from large pool |     127    |     152    |  122709    |  122582    |
|       from small pool |      54    |      61    |   37162    |   37108    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:46:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20163 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6857 GiB |   6856 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6854 GiB |   6854 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159871    |  159690    |
|       from large pool |     127    |     152    |  122709    |  122582    |
|       from small pool |      54    |      61    |   37162    |   37108    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159871    |  159690    |
|       from large pool |     127    |     152    |  122709    |  122582    |
|       from small pool |      54    |      61    |   37162    |   37108    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:46:32 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17357 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17349 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  30216 MiB |  24290 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  30212 MiB |  24288 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132344    |  132195    |
|       from large pool |     101    |     122    |   98907    |   98806    |
|       from small pool |      48    |      57    |   33437    |   33389    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132344    |  132195    |
|       from large pool |     101    |     122    |   98907    |   98806    |
|       from small pool |      48    |      57    |   33437    |   33389    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     441    |     339    |
|       from large pool |     101    |     120    |     439    |     338    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:46:32 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:46:33 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:46:33 | I | in layer model.layers.4
25-01-19 11:46:33 | I | quantizing weights for layer model.layers.4
25-01-19 11:46:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:39 | I | collecting calibration activations in model.layers.4
25-01-19 11:46:40 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:46:40 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:46:44 | I |       - range scale = [    1.0000]
25-01-19 11:46:44 | I |         sum  error  = [   16.0816]
25-01-19 11:46:44 | I |         best error  = [   16.0816]
25-01-19 11:46:44 | I |     + error = [16.0816]
25-01-19 11:46:47 | I |       - range scale = [    1.0000]
25-01-19 11:46:47 | I |         sum  error  = [   27.6513]
25-01-19 11:46:47 | I |         best error  = [   27.6513]
25-01-19 11:46:47 | I |     + error = [27.6513]
25-01-19 11:46:47 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:46:51 | I |       - range scale = [    1.0000]
25-01-19 11:46:51 | I |         sum  error  = [   30.9350]
25-01-19 11:46:51 | I |         best error  = [   30.9350]
25-01-19 11:46:51 | I |     + error = [30.9350]
25-01-19 11:46:55 | I |       - range scale = [    1.0000]
25-01-19 11:46:55 | I |         sum  error  = [   53.5816]
25-01-19 11:46:55 | I |         best error  = [   53.5816]
25-01-19 11:46:55 | I |     + error = [53.5816]
25-01-19 11:46:55 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:46:56 | I |       - range scale = [    1.0000]
25-01-19 11:46:56 | I |         sum  error  = [    2.6732]
25-01-19 11:46:56 | I |         best error  = [    2.6732]
25-01-19 11:46:56 | I |     + error = [2.6732]
25-01-19 11:46:56 | I |       - range scale = [    1.0000]
25-01-19 11:46:56 | I |         sum  error  = [    3.3619]
25-01-19 11:46:56 | I |         best error  = [    3.3619]
25-01-19 11:46:56 | I |     + error = [3.3619]
25-01-19 11:46:57 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:46:57 | I |       - range scale = [    1.0000]
25-01-19 11:46:57 | I |         sum  error  = [    0.6323]
25-01-19 11:46:57 | I |         best error  = [    0.6323]
25-01-19 11:46:57 | I |     + error = [0.6323]
25-01-19 11:46:58 | I |       - range scale = [    1.0000]
25-01-19 11:46:58 | I |         sum  error  = [    0.9015]
25-01-19 11:46:58 | I |         best error  = [    0.9015]
25-01-19 11:46:58 | I |     + error = [0.9015]
25-01-19 11:46:58 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:46:59 | I |       - range scale = [    1.0000]
25-01-19 11:46:59 | I |         sum  error  = [    3.4494]
25-01-19 11:46:59 | I |         best error  = [    3.4494]
25-01-19 11:46:59 | I |     + error = [3.4494]
25-01-19 11:47:00 | I |       - range scale = [    1.0000]
25-01-19 11:47:00 | I |         sum  error  = [    4.4190]
25-01-19 11:47:00 | I |         best error  = [    4.4190]
25-01-19 11:47:00 | I |     + error = [4.4190]
25-01-19 11:47:00 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:47:01 | I |       - range scale = [    1.0000]
25-01-19 11:47:01 | I |         sum  error  = [    4.4330]
25-01-19 11:47:01 | I |         best error  = [    4.4330]
25-01-19 11:47:01 | I |     + error = [4.4330]
25-01-19 11:47:02 | I |       - range scale = [    1.0000]
25-01-19 11:47:02 | I |         sum  error  = [    5.2260]
25-01-19 11:47:02 | I |         best error  = [    5.2260]
25-01-19 11:47:02 | I |     + error = [5.2260]
25-01-19 11:47:02 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:47:03 | I |       - range scale = [    1.0000]
25-01-19 11:47:03 | I |         sum  error  = [    0.8031]
25-01-19 11:47:03 | I |         best error  = [    0.8031]
25-01-19 11:47:03 | I |     + error = [0.8031]
25-01-19 11:47:04 | I |       - range scale = [    1.0000]
25-01-19 11:47:04 | I |         sum  error  = [    1.0145]
25-01-19 11:47:04 | I |         best error  = [    1.0145]
25-01-19 11:47:04 | I |     + error = [1.0145]
25-01-19 11:47:05 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:47:07 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:47:10 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:47:12 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:47:14 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:47:17 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:47:20 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:47:26 | I | quantizing activations for layer model.layers.4
25-01-19 11:47:30 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:31 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:32 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:33 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:35 | I | forward this layer
25-01-19 11:47:35 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/60.pt
25-01-19 11:47:35 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/60.pt
25-01-19 11:47:36 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 28.94 MiB is free. Process 29960 has 23.66 GiB memory in use. Of the allocated memory 22.66 GiB is allocated by PyTorch, and 544.19 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:47:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 31           |        cudaMalloc retries: 31        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  23203 MiB |  23267 MiB |  72347 GiB |  72325 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  71914 GiB |  71891 GiB |
|       from small pool |      3 MiB |      5 MiB |    433 GiB |    433 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  23203 MiB |  23267 MiB |  72347 GiB |  72325 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  71914 GiB |  71891 GiB |
|       from small pool |      3 MiB |      5 MiB |    433 GiB |    433 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  23203 MiB |  23267 MiB |  72260 GiB |  72237 GiB |
|       from large pool |  23200 MiB |  23264 MiB |  71828 GiB |  71806 GiB |
|       from small pool |      3 MiB |      5 MiB |    431 GiB |    431 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23748 MiB |  23750 MiB |   2067 GiB |   2044 GiB |
|       from large pool |  23744 MiB |  23744 MiB |   2065 GiB |   2042 GiB |
|       from small pool |      4 MiB |      6 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 557246 KiB |   1907 MiB |  40670 GiB |  40670 GiB |
|       from large pool | 556928 KiB |   1905 MiB |  40165 GiB |  40164 GiB |
|       from small pool |    318 KiB |      4 MiB |    505 GiB |    505 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     300    |     305    |    9149 K  |    9148 K  |
|       from large pool |     187    |     200    |    1417 K  |    1417 K  |
|       from small pool |     113    |     115    |    7731 K  |    7731 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     300    |     305    |    9149 K  |    9148 K  |
|       from large pool |     187    |     200    |    1417 K  |    1417 K  |
|       from small pool |     113    |     115    |    7731 K  |    7731 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     176    |    4870    |    4695    |
|       from large pool |     173    |     173    |    3794    |    3621    |
|       from small pool |       2    |       3    |    1076    |    1074    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      22    |      30    |    3824 K  |    3824 K  |
|       from large pool |      15    |      22    |     511 K  |     511 K  |
|       from small pool |       7    |      15    |    3312 K  |    3312 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:47:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20170 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7954 GiB |   7953 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7951 GiB |   7951 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159891    |  159710    |
|       from large pool |     127    |     152    |  122723    |  122596    |
|       from small pool |      54    |      61    |   37168    |   37114    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159891    |  159710    |
|       from large pool |     127    |     152    |  122723    |  122596    |
|       from small pool |      54    |      61    |   37168    |   37114    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:47:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20170 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20170 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6857 GiB |   6857 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6855 GiB |   6854 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159891    |  159710    |
|       from large pool |     127    |     152    |  122723    |  122596    |
|       from small pool |      54    |      61    |   37168    |   37114    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159891    |  159710    |
|       from large pool |     127    |     152    |  122723    |  122596    |
|       from small pool |      54    |      61    |   37168    |   37114    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:47:36 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17355 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  30544 MiB |  24618 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  30540 MiB |  24616 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132364    |  132215    |
|       from large pool |     101    |     122    |   98921    |   98820    |
|       from small pool |      48    |      57    |   33443    |   33395    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132364    |  132215    |
|       from large pool |     101    |     122    |   98921    |   98820    |
|       from small pool |      48    |      57    |   33443    |   33395    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     451    |     349    |
|       from large pool |     101    |     120    |     449    |     348    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:47:36 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:47:36 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:47:36 | I | in layer model.layers.4
25-01-19 11:47:36 | I | quantizing weights for layer model.layers.4
25-01-19 11:47:40 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:41 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:42 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:43 | I | collecting calibration activations in model.layers.4
25-01-19 11:47:44 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:47:44 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:47:47 | I |       - range scale = [    1.0000]
25-01-19 11:47:47 | I |         sum  error  = [   17.1095]
25-01-19 11:47:47 | I |         best error  = [   17.1095]
25-01-19 11:47:47 | I |     + error = [17.1095]
25-01-19 11:47:51 | I |       - range scale = [    1.0000]
25-01-19 11:47:51 | I |         sum  error  = [   28.5573]
25-01-19 11:47:51 | I |         best error  = [   28.5573]
25-01-19 11:47:51 | I |     + error = [28.5573]
25-01-19 11:47:51 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:47:55 | I |       - range scale = [    1.0000]
25-01-19 11:47:55 | I |         sum  error  = [   33.1464]
25-01-19 11:47:55 | I |         best error  = [   33.1464]
25-01-19 11:47:55 | I |     + error = [33.1464]
25-01-19 11:47:59 | I |       - range scale = [    1.0000]
25-01-19 11:47:59 | I |         sum  error  = [   55.6551]
25-01-19 11:47:59 | I |         best error  = [   55.6551]
25-01-19 11:47:59 | I |     + error = [55.6551]
25-01-19 11:47:59 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:48:00 | I |       - range scale = [    1.0000]
25-01-19 11:48:00 | I |         sum  error  = [    2.7408]
25-01-19 11:48:00 | I |         best error  = [    2.7408]
25-01-19 11:48:00 | I |     + error = [2.7408]
25-01-19 11:48:01 | I |       - range scale = [    1.0000]
25-01-19 11:48:01 | I |         sum  error  = [    3.4465]
25-01-19 11:48:01 | I |         best error  = [    3.4465]
25-01-19 11:48:01 | I |     + error = [3.4465]
25-01-19 11:48:01 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:48:01 | I |       - range scale = [    1.0000]
25-01-19 11:48:01 | I |         sum  error  = [    0.6456]
25-01-19 11:48:01 | I |         best error  = [    0.6456]
25-01-19 11:48:01 | I |     + error = [0.6456]
25-01-19 11:48:02 | I |       - range scale = [    1.0000]
25-01-19 11:48:02 | I |         sum  error  = [    0.9179]
25-01-19 11:48:02 | I |         best error  = [    0.9179]
25-01-19 11:48:02 | I |     + error = [0.9179]
25-01-19 11:48:03 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:48:03 | I |       - range scale = [    1.0000]
25-01-19 11:48:03 | I |         sum  error  = [    3.5725]
25-01-19 11:48:03 | I |         best error  = [    3.5725]
25-01-19 11:48:03 | I |     + error = [3.5725]
25-01-19 11:48:04 | I |       - range scale = [    1.0000]
25-01-19 11:48:04 | I |         sum  error  = [    4.5736]
25-01-19 11:48:04 | I |         best error  = [    4.5736]
25-01-19 11:48:04 | I |     + error = [4.5736]
25-01-19 11:48:05 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:48:05 | I |       - range scale = [    1.0000]
25-01-19 11:48:05 | I |         sum  error  = [    4.5291]
25-01-19 11:48:05 | I |         best error  = [    4.5291]
25-01-19 11:48:05 | I |     + error = [4.5291]
25-01-19 11:48:07 | I |       - range scale = [    1.0000]
25-01-19 11:48:07 | I |         sum  error  = [    5.3783]
25-01-19 11:48:07 | I |         best error  = [    5.3783]
25-01-19 11:48:07 | I |     + error = [5.3783]
25-01-19 11:48:07 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:48:08 | I |       - range scale = [    1.0000]
25-01-19 11:48:08 | I |         sum  error  = [    0.8141]
25-01-19 11:48:08 | I |         best error  = [    0.8141]
25-01-19 11:48:08 | I |     + error = [0.8141]
25-01-19 11:48:09 | I |       - range scale = [    1.0000]
25-01-19 11:48:09 | I |         sum  error  = [    1.0567]
25-01-19 11:48:09 | I |         best error  = [    1.0567]
25-01-19 11:48:09 | I |     + error = [1.0567]
25-01-19 11:48:09 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:48:12 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:48:14 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:48:17 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:48:19 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:48:22 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:48:25 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:48:31 | I | quantizing activations for layer model.layers.4
25-01-19 11:48:35 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:36 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:37 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:38 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:41 | I | forward this layer
25-01-19 11:48:41 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/62.pt
25-01-19 11:48:41 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/62.pt
25-01-19 11:48:41 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:48:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 32           |        cudaMalloc retries: 32        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  75516 GiB |  75494 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  75064 GiB |  75042 GiB |
|       from small pool |      3 MiB |      5 MiB |    451 GiB |    451 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  75516 GiB |  75494 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  75064 GiB |  75042 GiB |
|       from small pool |      3 MiB |      5 MiB |    451 GiB |    451 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  75426 GiB |  75404 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  74976 GiB |  74953 GiB |
|       from small pool |      3 MiB |      5 MiB |    450 GiB |    450 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   2133 GiB |   2110 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   2131 GiB |   2108 GiB |
|       from small pool |      4 MiB |      6 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  43034 GiB |  43033 GiB |
|       from large pool |    835 MiB |   1905 MiB |  42506 GiB |  42505 GiB |
|       from small pool |      0 MiB |      4 MiB |    527 GiB |    527 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    9555 K  |    9555 K  |
|       from large pool |     185    |     200    |    1480 K  |    1480 K  |
|       from small pool |     109    |     115    |    8074 K  |    8074 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    9555 K  |    9555 K  |
|       from large pool |     185    |     200    |    1480 K  |    1480 K  |
|       from small pool |     109    |     115    |    8074 K  |    8074 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    5017    |    4844    |
|       from large pool |     171    |     173    |    3906    |    3735    |
|       from small pool |       2    |       3    |    1111    |    1109    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      25    |      30    |    3981 K  |    3981 K  |
|       from large pool |      17    |      22    |     529 K  |     529 K  |
|       from small pool |       8    |      15    |    3452 K  |    3452 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:48:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7954 GiB |   7954 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7952 GiB |   7951 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159911    |  159730    |
|       from large pool |     127    |     152    |  122737    |  122610    |
|       from small pool |      54    |      61    |   37174    |   37120    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159911    |  159730    |
|       from large pool |     127    |     152    |  122737    |  122610    |
|       from small pool |      54    |      61    |   37174    |   37120    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:48:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20168 GiB |  20161 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6857 GiB |   6857 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6855 GiB |   6855 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159911    |  159730    |
|       from large pool |     127    |     152    |  122737    |  122610    |
|       from small pool |      54    |      61    |   37174    |   37120    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159911    |  159730    |
|       from large pool |     127    |     152    |  122737    |  122610    |
|       from small pool |      54    |      61    |   37174    |   37120    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:48:41 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17358 GiB |  17352 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  30872 MiB |  24946 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  30868 MiB |  24944 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  132384    |  132235    |
|       from large pool |     101    |     122    |   98935    |   98834    |
|       from small pool |      48    |      57    |   33449    |   33401    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  132384    |  132235    |
|       from large pool |     101    |     122    |   98935    |   98834    |
|       from small pool |      48    |      57    |   33449    |   33401    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     461    |     359    |
|       from large pool |     101    |     120    |     459    |     358    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46105    |   46103    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11476    |   11475    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:48:41 | W | attempting to recover from OOM in forward/backward pass
25-01-19 11:48:42 | I | TRAIN CURRENT LAYER_IDX = 4
25-01-19 11:48:42 | I | in layer model.layers.4
25-01-19 11:48:42 | I | quantizing weights for layer model.layers.4
25-01-19 11:48:45 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:47 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:48 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:49 | I | collecting calibration activations in model.layers.4
25-01-19 11:48:50 | I | - Quantizing decoder layer model.layers.4
25-01-19 11:48:50 | I |   - Calibrating model.layers.4.self_attn.q_proj.weight
25-01-19 11:48:54 | I |       - range scale = [    1.0000]
25-01-19 11:48:54 | I |         sum  error  = [   16.6324]
25-01-19 11:48:54 | I |         best error  = [   16.6324]
25-01-19 11:48:54 | I |     + error = [16.6324]
25-01-19 11:48:57 | I |       - range scale = [    1.0000]
25-01-19 11:48:57 | I |         sum  error  = [   27.5724]
25-01-19 11:48:57 | I |         best error  = [   27.5724]
25-01-19 11:48:57 | I |     + error = [27.5724]
25-01-19 11:48:58 | I |   - Calibrating model.layers.4.self_attn.k_proj.weight
25-01-19 11:49:01 | I |       - range scale = [    1.0000]
25-01-19 11:49:01 | I |         sum  error  = [   32.5510]
25-01-19 11:49:01 | I |         best error  = [   32.5510]
25-01-19 11:49:01 | I |     + error = [32.5510]
25-01-19 11:49:05 | I |       - range scale = [    1.0000]
25-01-19 11:49:05 | I |         sum  error  = [   54.9864]
25-01-19 11:49:05 | I |         best error  = [   54.9864]
25-01-19 11:49:05 | I |     + error = [54.9864]
25-01-19 11:49:05 | I |   - Calibrating model.layers.4.self_attn.v_proj.weight
25-01-19 11:49:06 | I |       - range scale = [    1.0000]
25-01-19 11:49:06 | I |         sum  error  = [    2.6838]
25-01-19 11:49:06 | I |         best error  = [    2.6838]
25-01-19 11:49:06 | I |     + error = [2.6838]
25-01-19 11:49:07 | I |       - range scale = [    1.0000]
25-01-19 11:49:07 | I |         sum  error  = [    3.3556]
25-01-19 11:49:07 | I |         best error  = [    3.3556]
25-01-19 11:49:07 | I |     + error = [3.3556]
25-01-19 11:49:07 | I |   - Calibrating model.layers.4.self_attn.o_proj.weight
25-01-19 11:49:08 | I |       - range scale = [    1.0000]
25-01-19 11:49:08 | I |         sum  error  = [    0.6584]
25-01-19 11:49:08 | I |         best error  = [    0.6584]
25-01-19 11:49:08 | I |     + error = [0.6584]
25-01-19 11:49:09 | I |       - range scale = [    1.0000]
25-01-19 11:49:09 | I |         sum  error  = [    0.9263]
25-01-19 11:49:09 | I |         best error  = [    0.9263]
25-01-19 11:49:09 | I |     + error = [0.9263]
25-01-19 11:49:09 | I |   - Calibrating model.layers.4.mlp.up_proj.weight
25-01-19 11:49:10 | I |       - range scale = [    1.0000]
25-01-19 11:49:10 | I |         sum  error  = [    3.4481]
25-01-19 11:49:10 | I |         best error  = [    3.4481]
25-01-19 11:49:10 | I |     + error = [3.4481]
25-01-19 11:49:11 | I |       - range scale = [    1.0000]
25-01-19 11:49:11 | I |         sum  error  = [    4.3977]
25-01-19 11:49:11 | I |         best error  = [    4.3977]
25-01-19 11:49:11 | I |     + error = [4.3977]
25-01-19 11:49:11 | I |   - Calibrating model.layers.4.mlp.gate_proj.weight
25-01-19 11:49:12 | I |       - range scale = [    1.0000]
25-01-19 11:49:12 | I |         sum  error  = [    4.4557]
25-01-19 11:49:12 | I |         best error  = [    4.4557]
25-01-19 11:49:12 | I |     + error = [4.4557]
25-01-19 11:49:13 | I |       - range scale = [    1.0000]
25-01-19 11:49:13 | I |         sum  error  = [    5.2241]
25-01-19 11:49:13 | I |         best error  = [    5.2241]
25-01-19 11:49:13 | I |     + error = [5.2241]
25-01-19 11:49:13 | I |   - Calibrating model.layers.4.mlp.down_proj.weight
25-01-19 11:49:14 | I |       - range scale = [    1.0000]
25-01-19 11:49:14 | I |         sum  error  = [    0.8392]
25-01-19 11:49:14 | I |         best error  = [    0.8392]
25-01-19 11:49:14 | I |     + error = [0.8392]
25-01-19 11:49:15 | I |       - range scale = [    1.0000]
25-01-19 11:49:15 | I |         sum  error  = [    1.0989]
25-01-19 11:49:15 | I |         best error  = [    1.0989]
25-01-19 11:49:15 | I |     + error = [1.0989]
25-01-19 11:49:15 | I |   - Quantizing model.layers.4.self_attn.q_proj.weight
25-01-19 11:49:18 | I |   - Quantizing model.layers.4.self_attn.k_proj.weight
25-01-19 11:49:20 | I |   - Quantizing model.layers.4.self_attn.v_proj.weight
25-01-19 11:49:23 | I |   - Quantizing model.layers.4.self_attn.o_proj.weight
25-01-19 11:49:25 | I |   - Quantizing model.layers.4.mlp.up_proj.weight
25-01-19 11:49:28 | I |   - Quantizing model.layers.4.mlp.gate_proj.weight
25-01-19 11:54:01 | I |   - Quantizing model.layers.4.mlp.down_proj.weight
25-01-19 11:54:11 | I | quantizing activations for layer model.layers.4
25-01-19 11:54:15 | I | collecting calibration activations in model.layers.4
25-01-19 11:54:16 | I | collecting calibration activations in model.layers.4
25-01-19 11:54:17 | I | collecting calibration activations in model.layers.4
25-01-19 11:54:18 | I | collecting calibration activations in model.layers.4
25-01-19 11:56:54 | I | forward this layer
25-01-19 11:56:54 | I | input_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_input_args_layer_4/64.pt
25-01-19 11:56:54 | I | output_file: /data/gyy/lmquant-main/lmquant/data/data_without_preprocess_llama_7b/shard/val_teacher_output_layer_4/64.pt
25-01-19 11:59:30 | W | OOM: Ran out of memory with exception: CUDA out of memory. Tried to allocate 256.00 MiB. GPU 0 has a total capacity of 23.69 GiB of which 248.94 MiB is free. Process 29960 has 23.45 GiB memory in use. Of the allocated memory 22.16 GiB is allocated by PyTorch, and 836.39 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
25-01-19 11:59:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 53           |        cudaMalloc retries: 53        |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  22691 MiB |  23267 MiB |  78795 GiB |  78773 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  78324 GiB |  78302 GiB |
|       from small pool |      3 MiB |      5 MiB |    471 GiB |    471 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  22691 MiB |  23267 MiB |  78795 GiB |  78773 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  78324 GiB |  78302 GiB |
|       from small pool |      3 MiB |      5 MiB |    471 GiB |    471 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  22691 MiB |  23267 MiB |  78701 GiB |  78679 GiB |
|       from large pool |  22688 MiB |  23264 MiB |  78232 GiB |  78210 GiB |
|       from small pool |      3 MiB |      5 MiB |    469 GiB |    469 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  23528 MiB |  23750 MiB |   2198 GiB |   2175 GiB |
|       from large pool |  23524 MiB |  23744 MiB |   2196 GiB |   2173 GiB |
|       from small pool |      4 MiB |      6 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    836 MiB |   1907 MiB |  44829 GiB |  44828 GiB |
|       from large pool |    835 MiB |   1905 MiB |  44279 GiB |  44278 GiB |
|       from small pool |      0 MiB |      4 MiB |    550 GiB |    550 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     294    |     305    |    9975 K  |    9975 K  |
|       from large pool |     185    |     200    |    1545 K  |    1545 K  |
|       from small pool |     109    |     116    |    8430 K  |    8430 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     294    |     305    |    9975 K  |    9975 K  |
|       from large pool |     185    |     200    |    1545 K  |    1545 K  |
|       from small pool |     109    |     116    |    8430 K  |    8430 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     176    |    5162    |    4989    |
|       from large pool |     171    |     173    |    4016    |    3845    |
|       from small pool |       2    |       3    |    1146    |    1144    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      26    |      30    |    4140 K  |    4140 K  |
|       from large pool |      18    |      22    |     548 K  |     548 K  |
|       from small pool |       8    |      15    |    3592 K  |    3592 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:59:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 1                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1249 MiB |   7954 GiB |   7954 GiB |
|       from large pool | 253824 KiB |   1247 MiB |   7952 GiB |   7952 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159931    |  159750    |
|       from large pool |     127    |     152    |  122751    |  122624    |
|       from small pool |      54    |      61    |   37180    |   37126    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159931    |  159750    |
|       from large pool |     127    |     152    |  122751    |  122624    |
|       from small pool |      54    |      61    |   37180    |   37126    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   65293    |   65291    |
|       from large pool |       1    |      10    |   54221    |   54220    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:59:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 2                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   6956 MiB |  10676 MiB |  20171 GiB |  20164 GiB |
|       from large pool |   6956 MiB |  10676 MiB |  20169 GiB |  20162 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7206 MiB |  11926 MiB |  16648 MiB |   9442 MiB |
|       from large pool |   7204 MiB |  11924 MiB |  16644 MiB |   9440 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 255575 KiB |   1121 MiB |   6858 GiB |   6857 GiB |
|       from large pool | 253824 KiB |   1119 MiB |   6855 GiB |   6855 GiB |
|       from small pool |   1751 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     181    |     210    |  159931    |  159750    |
|       from large pool |     127    |     152    |  122751    |  122624    |
|       from small pool |      54    |      61    |   37180    |   37126    |
|---------------------------------------------------------------------------|
| Active allocs         |     181    |     210    |  159931    |  159750    |
|       from large pool |     127    |     152    |  122751    |  122624    |
|       from small pool |      54    |      61    |   37180    |   37126    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     146    |     164    |      36    |
|       from large pool |     127    |     145    |     162    |      35    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      12    |   56519    |   56517    |
|       from large pool |       1    |      10    |   45447    |   45446    |
|       from small pool |       1    |       2    |   11072    |   11071    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:59:30 | W | |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 3                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   5912 MiB |  10832 MiB |  17359 GiB |  17353 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   5912 MiB |  10832 MiB |  17359 GiB |  17353 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   5912 MiB |  10832 MiB |  17358 GiB |  17353 GiB |
|       from large pool |   5912 MiB |  10832 MiB |  17356 GiB |  17350 GiB |
|       from small pool |      0 MiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5926 MiB |  13150 MiB |  31200 MiB |  25274 MiB |
|       from large pool |   5924 MiB |  13148 MiB |  31196 MiB |  25272 MiB |
|       from small pool |      2 MiB |      2 MiB |      4 MiB |      2 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  13704 KiB |    837 MiB |   4733 GiB |   4733 GiB |
|       from large pool |  12160 KiB |    835 MiB |   4731 GiB |   4731 GiB |
|       from small pool |   1544 KiB |      1 MiB |      2 GiB |      2 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     149    |     174    |  133104    |  132955    |
|       from large pool |     101    |     122    |   98949    |   98848    |
|       from small pool |      48    |      57    |   34155    |   34107    |
|---------------------------------------------------------------------------|
| Active allocs         |     149    |     174    |  133104    |  132955    |
|       from large pool |     101    |     122    |   98949    |   98848    |
|       from small pool |      48    |      57    |   34155    |   34107    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     102    |     121    |     471    |     369    |
|       from large pool |     101    |     120    |     469    |     368    |
|       from small pool |       1    |       1    |       2    |       1    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |      11    |   46365    |   46363    |
|       from large pool |       1    |       9    |   34629    |   34628    |
|       from small pool |       1    |       4    |   11736    |   11735    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

25-01-19 11:59:30 | W | attempting to recover from OOM in forward/backward pass
